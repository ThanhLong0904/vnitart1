const __vite__fileDeps=["assets/sectionEditor-ogc9Fxeh.js","assets/popupEditor-kzO-P6Fq.js","assets/featureEditor-H52F5l7o.js","assets/componentEditor-CQQCjiPj.js","assets/exportCustomData-Dz3_cl-h.js"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
var Rt=Object.defineProperty;var Tt=l=>{throw TypeError(l)};var _t=(l,i,t)=>i in l?Rt(l,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[i]=t;var c=(l,i,t)=>_t(l,typeof i!="symbol"?i+"":i,t),It=(l,i,t)=>i.has(l)||Tt("Cannot "+t);var Y=(l,i,t)=>(It(l,i,"read from private field"),t?t.call(l):i.get(l)),tt=(l,i,t)=>i.has(l)?Tt("Cannot add the same private member more than once"):i instanceof WeakSet?i.add(l):i.set(l,t),X=(l,i,t,e)=>(It(l,i,"write to private field"),e?e.call(l,t):i.set(l,t),t);(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))e(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&e(a)}).observe(document,{childList:!0,subtree:!0});function t(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function e(n){if(n.ep)return;n.ep=!0;const s=t(n);fetch(n.href,s)}})();class Component{constructor(){c(this,"Id",null);c(this,"FieldName",null);c(this,"Order",0);c(this,"ComponentType",null);c(this,"ComponentGroupId",null);c(this,"FormatData",null);c(this,"PlainText",null);c(this,"Column",0);c(this,"Offset",0);c(this,"Row",0);c(this,"CanSearch",!1);c(this,"CanCache",!1);c(this,"Precision",0);c(this,"GroupBy",null);c(this,"GroupFormat",null);c(this,"Label",null);c(this,"ShowLabel",!1);c(this,"Icon",null);c(this,"ClassName",null);c(this,"Style",null);c(this,"ChildStyle",null);c(this,"HotKey",null);c(this,"RefClass",null);c(this,"Events",null);c(this,"Disabled",!1);c(this,"Visibility",!1);c(this,"Validation",null);c(this,"Focus",!1);c(this,"Width",null);c(this,"PopulateField",null);c(this,"GroupEvent",null);c(this,"XsCol",0);c(this,"SmCol",0);c(this,"LgCol",0);c(this,"XlCol",0);c(this,"XxlCol",0);c(this,"DefaultVal",null);c(this,"DateTimeField",null);c(this,"Active",!1);c(this,"InsertedDate",new Date);c(this,"InsertedBy",null);c(this,"UpdatedDate",new Date);c(this,"UpdatedBy",null);c(this,"CanAdd",!1);c(this,"IsPrivate",!1);c(this,"MonthCount",0);c(this,"Query",null);c(this,"IsRealtime",!1);c(this,"RefName",null);c(this,"TopEmpty",!1);c(this,"IsCollapsible",!1);c(this,"Template",null);c(this,"PreQuery",null);c(this,"DisabledExp",null);c(this,"FocusSearch",!1);c(this,"IsSumary",!1);c(this,"FormatSumaryField",null);c(this,"OrderBySumary",null);c(this,"ShowHotKey",!1);c(this,"DefaultAddStart",0);c(this,"DefaultAddEnd",0);c(this,"UpperCase",!1);c(this,"VirtualScroll",!1);c(this,"Migration",null);c(this,"ListClass",null);c(this,"ExcelFieldName",null);c(this,"LiteGrid",!1);c(this,"ShowDatetimeField",!1);c(this,"ShowNull",!1);c(this,"AddDate",!1);c(this,"FilterEq",!1);c(this,"HeaderHeight",0);c(this,"BodyItemHeight",0);c(this,"FooterHeight",0);c(this,"ScrollHeight",0);c(this,"ScriptValidation",null);c(this,"FilterLocal",!1);c(this,"HideGrid",!1);c(this,"GroupReferenceId",null);c(this,"GroupReferenceName",null);c(this,"GroupName",null);c(this,"ShortDesc",null);c(this,"Description",null);c(this,"FeatureId",null);c(this,"ComponentId",null);c(this,"TextAlign",null);c(this,"HasFilter",!1);c(this,"Frozen",!1);c(this,"FilterTemplate",null);c(this,"Editable",!1);c(this,"FormatExcell",null);c(this,"DatabaseName",null);c(this,"Summary",null);c(this,"SummaryColSpan",0);c(this,"BasicSearch",!1);c(this,"ShowExp",null);c(this,"MinWidth",null);c(this,"MaxWidth",null);c(this,"TenantCode",null);c(this,"OrderBy",null);c(this,"ParentId",null);c(this,"Lang",null);c(this,"Name",null);c(this,"IsTab",!1);c(this,"TabGroup",null);c(this,"IsVertialTab",!1);c(this,"Responsive",!1);c(this,"OuterColumn",0);c(this,"XsOuterColumn",0);c(this,"SmOuterColumn",0);c(this,"LgOuterColumn",0);c(this,"XlOuterColumn",0);c(this,"XxlOuterColumn",0);c(this,"BadgeMonth",0);c(this,"IsDropDown",!1);c(this,"Html",null);c(this,"Css",null);c(this,"Javascript",null);c(this,"ParentElement",null);c(this,"Columns",[]);c(this,"LocalQuery")}}class Feature{constructor(){c(this,"Id","");c(this,"Name","");c(this,"Label","");c(this,"ParentId","");c(this,"Order",0);c(this,"ClassName","");c(this,"Style","");c(this,"StyleSheet","");c(this,"Script","");c(this,"Events","");c(this,"Icon","");c(this,"IsDivider",!1);c(this,"IsGroup",!1);c(this,"IsMenu",!1);c(this,"IsPublic",!1);c(this,"StartUp",!1);c(this,"ViewClass","");c(this,"EntityId","");c(this,"Description","");c(this,"Active",!1);c(this,"InsertedDate",new Date);c(this,"InsertedBy","");c(this,"UpdatedDate",new Date);c(this,"UpdatedBy","");c(this,"IsSystem",!1);c(this,"IgnoreEncode",!1);c(this,"InheritParentFeature",!1);c(this,"DeleteTemp",!1);c(this,"CustomNextCell",!1);c(this,"LoadEntity",!1);c(this,"IsLock",!1);c(this,"Html","");c(this,"Components",[]);c(this,"Layout")}}const PositionEnum={absolute:"absolute",fixed:"fixed",inherit:"inherit",initial:"initial",relative:"relative",static:"static",sticky:"sticky",unset:"unset"},KeyCodeEnum={Backspace:8,Tab:9,Enter:13,Shift:16,Ctrl:17,Alt:18,PauseBreak:19,CapsLock:20,Escape:27,PageUp:33,PageDown:34,End:35,Home:36,LeftArrow:37,UpArrow:38,RightArrow:39,DownArrow:40,Insert:45,Delete:46,Zero:48,One:49,Two:50,Three:51,Four:52,Five:53,Six:54,Seven:55,Eight:56,Nine:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,LeftWindowKey:91,RightWindowKey:92,SelectKey:93,Numpad0:96,Numpad1:97,Numpad2:98,Numpad3:99,Numpad4:100,Numpad5:101,Numpad6:102,Numpad7:103,Numpad8:104,Numpad9:105,Multiply:106,Add:107,Subtract:109,DecimalPoint:110,Divide:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,NumLock:144,ScrollLock:145,SemiColon:186,EqualSign:187,Comma:188,Dash:189,Period:190,ForwardSlash:191,GraveAccent:192,OpenBracket:219,BackSlash:220,CloseBraket:221,SingleQuote:222},OperatorEnum={In:1,NotIn:2,Gt:3,Ge:4,Lt:5,Le:6,Lr:7,Rl:8},ActiveStateEnum={All:2,Yes:1,No:0},AdvSearchOperation={Equal:1,NotEqual:2,GreaterThan:3,GreaterThanOrEqual:4,LessThan:5,LessThanOrEqual:6,Contains:7,NotContains:8,StartWith:9,NotStartWith:10,EndWidth:11,NotEndWidth:12,In:13,NotIn:14,EqualDatime:15,GreaterThanDatime:21,LessThanDatime:22,NotEqualDatime:16,EqualNull:17,NotEqualNull:18,Like:19,NotLike:20,GreaterEqualDatime:23,LessEqualDatime:24},OperationToSql={[AdvSearchOperation.Equal]:"{0} = N'{1}'",[AdvSearchOperation.NotEqual]:"{0} != N'{1}'",[AdvSearchOperation.GreaterThan]:"{0} > N'{1}'",[AdvSearchOperation.GreaterThanOrEqual]:"{0} >= N'{1}'",[AdvSearchOperation.LessThan]:"{0} < N'{1}'",[AdvSearchOperation.LessThanOrEqual]:"{0} <= N'{1}'",[AdvSearchOperation.Contains]:"charindex(N'{1}', {0}) >= 1",[AdvSearchOperation.NotContains]:"contains({0}, N'{1}') eq false",[AdvSearchOperation.StartWith]:"charindex(N'{1}', {0}) = 1",[AdvSearchOperation.NotStartWith]:"charindex(N'{1}', {0}) > 1",[AdvSearchOperation.EndWidth]:"{0} like N'%{1}')",[AdvSearchOperation.NotEndWidth]:"{0} not like N'%{1}'",[AdvSearchOperation.In]:"{0} in ({1})",[AdvSearchOperation.Like]:"{0} like N'%{1}%'",[AdvSearchOperation.NotLike]:"{0} not like N'{1}'",[AdvSearchOperation.NotIn]:"{0} not in ({1})",[AdvSearchOperation.EqualDatime]:"cast(date, {0}) = N'{1}'",[AdvSearchOperation.NotEqualDatime]:"cast(date, {0}) != N'{1}'",[AdvSearchOperation.EqualNull]:"{0} is null",[AdvSearchOperation.NotEqualNull]:"{0} is not null",[AdvSearchOperation.GreaterThanDatime]:"cast(date, {0}) > N'{1}'",[AdvSearchOperation.GreaterEqualDatime]:"cast(date, {0}) >= N'{1}'",[AdvSearchOperation.LessThanDatime]:"cast(date, {0}) < N'{1}'",[AdvSearchOperation.LessEqualDatime]:"cast(date, {0}) <= N'{1}'"},LogicOperation={And:0,Or:1},OrderbyDirection={ASC:1,DESC:2},HttpMethod={GET:"GET",POST:"POST",PUT:"PUT",PATCH:"PATCH",DELETE:"DELETE"};/*!
 *  decimal.js v10.4.3
 *  An arbitrary-precision Decimal type for JavaScript.
 *  https://github.com/MikeMcl/decimal.js
 *  Copyright (c) 2022 Michael Mclaughlin <M8ch88l@gmail.com>
 *  MIT Licence
 */var EXP_LIMIT=9e15,MAX_DIGITS=1e9,NUMERALS="0123456789abcdef",LN10="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",PI="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",DEFAULTS={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-EXP_LIMIT,maxE:EXP_LIMIT,crypto:!1},inexact,quadrant,external=!0,decimalError="[DecimalError] ",invalidArgument=decimalError+"Invalid argument: ",precisionLimitExceeded=decimalError+"Precision limit exceeded",cryptoUnavailable=decimalError+"crypto unavailable",tag="[object Decimal]",mathfloor=Math.floor,mathpow=Math.pow,isBinary=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,isHex=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,isOctal=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,isDecimal=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,BASE=1e7,LOG_BASE=7,MAX_SAFE_INTEGER=9007199254740991,LN10_PRECISION=LN10.length-1,PI_PRECISION=PI.length-1,P={toStringTag:tag};P.absoluteValue=P.abs=function(){var l=new this.constructor(this);return l.s<0&&(l.s=1),finalise(l)};P.ceil=function(){return finalise(new this.constructor(this),this.e+1,2)};P.clampedTo=P.clamp=function(l,i){var t,e=this,n=e.constructor;if(l=new n(l),i=new n(i),!l.s||!i.s)return new n(NaN);if(l.gt(i))throw Error(invalidArgument+i);return t=e.cmp(l),t<0?l:e.cmp(i)>0?i:new n(e)};P.comparedTo=P.cmp=function(l){var i,t,e,n,s=this,a=s.d,r=(l=new s.constructor(l)).d,o=s.s,h=l.s;if(!a||!r)return!o||!h?NaN:o!==h?o:a===r?0:!a^o<0?1:-1;if(!a[0]||!r[0])return a[0]?o:r[0]?-h:0;if(o!==h)return o;if(s.e!==l.e)return s.e>l.e^o<0?1:-1;for(e=a.length,n=r.length,i=0,t=e<n?e:n;i<t;++i)if(a[i]!==r[i])return a[i]>r[i]^o<0?1:-1;return e===n?0:e>n^o<0?1:-1};P.cosine=P.cos=function(){var l,i,t=this,e=t.constructor;return t.d?t.d[0]?(l=e.precision,i=e.rounding,e.precision=l+Math.max(t.e,t.sd())+LOG_BASE,e.rounding=1,t=cosine(e,toLessThanHalfPi(e,t)),e.precision=l,e.rounding=i,finalise(quadrant==2||quadrant==3?t.neg():t,l,i,!0)):new e(1):new e(NaN)};P.cubeRoot=P.cbrt=function(){var l,i,t,e,n,s,a,r,o,h,d=this,u=d.constructor;if(!d.isFinite()||d.isZero())return new u(d);for(external=!1,s=d.s*mathpow(d.s*d,1/3),!s||Math.abs(s)==1/0?(t=digitsToString(d.d),l=d.e,(s=(l-t.length+1)%3)&&(t+=s==1||s==-2?"0":"00"),s=mathpow(t,1/3),l=mathfloor((l+1)/3)-(l%3==(l<0?-1:2)),s==1/0?t="5e"+l:(t=s.toExponential(),t=t.slice(0,t.indexOf("e")+1)+l),e=new u(t),e.s=d.s):e=new u(s.toString()),a=(l=u.precision)+3;;)if(r=e,o=r.times(r).times(r),h=o.plus(d),e=divide(h.plus(d).times(r),h.plus(o),a+2,1),digitsToString(r.d).slice(0,a)===(t=digitsToString(e.d)).slice(0,a))if(t=t.slice(a-3,a+1),t=="9999"||!n&&t=="4999"){if(!n&&(finalise(r,l+1,0),r.times(r).times(r).eq(d))){e=r;break}a+=4,n=1}else{(!+t||!+t.slice(1)&&t.charAt(0)=="5")&&(finalise(e,l+1,1),i=!e.times(e).times(e).eq(d));break}return external=!0,finalise(e,l,u.rounding,i)};P.decimalPlaces=P.dp=function(){var l,i=this.d,t=NaN;if(i){if(l=i.length-1,t=(l-mathfloor(this.e/LOG_BASE))*LOG_BASE,l=i[l],l)for(;l%10==0;l/=10)t--;t<0&&(t=0)}return t};P.dividedBy=P.div=function(l){return divide(this,new this.constructor(l))};P.dividedToIntegerBy=P.divToInt=function(l){var i=this,t=i.constructor;return finalise(divide(i,new t(l),0,1,1),t.precision,t.rounding)};P.equals=P.eq=function(l){return this.cmp(l)===0};P.floor=function(){return finalise(new this.constructor(this),this.e+1,3)};P.greaterThan=P.gt=function(l){return this.cmp(l)>0};P.greaterThanOrEqualTo=P.gte=function(l){var i=this.cmp(l);return i==1||i===0};P.hyperbolicCosine=P.cosh=function(){var l,i,t,e,n,s=this,a=s.constructor,r=new a(1);if(!s.isFinite())return new a(s.s?1/0:NaN);if(s.isZero())return r;t=a.precision,e=a.rounding,a.precision=t+Math.max(s.e,s.sd())+4,a.rounding=1,n=s.d.length,n<32?(l=Math.ceil(n/3),i=(1/tinyPow(4,l)).toString()):(l=16,i="2.3283064365386962890625e-10"),s=taylorSeries(a,1,s.times(i),new a(1),!0);for(var o,h=l,d=new a(8);h--;)o=s.times(s),s=r.minus(o.times(d.minus(o.times(d))));return finalise(s,a.precision=t,a.rounding=e,!0)};P.hyperbolicSine=P.sinh=function(){var l,i,t,e,n=this,s=n.constructor;if(!n.isFinite()||n.isZero())return new s(n);if(i=s.precision,t=s.rounding,s.precision=i+Math.max(n.e,n.sd())+4,s.rounding=1,e=n.d.length,e<3)n=taylorSeries(s,2,n,n,!0);else{l=1.4*Math.sqrt(e),l=l>16?16:l|0,n=n.times(1/tinyPow(5,l)),n=taylorSeries(s,2,n,n,!0);for(var a,r=new s(5),o=new s(16),h=new s(20);l--;)a=n.times(n),n=n.times(r.plus(a.times(o.times(a).plus(h))))}return s.precision=i,s.rounding=t,finalise(n,i,t,!0)};P.hyperbolicTangent=P.tanh=function(){var l,i,t=this,e=t.constructor;return t.isFinite()?t.isZero()?new e(t):(l=e.precision,i=e.rounding,e.precision=l+7,e.rounding=1,divide(t.sinh(),t.cosh(),e.precision=l,e.rounding=i)):new e(t.s)};P.inverseCosine=P.acos=function(){var l,i=this,t=i.constructor,e=i.abs().cmp(1),n=t.precision,s=t.rounding;return e!==-1?e===0?i.isNeg()?getPi(t,n,s):new t(0):new t(NaN):i.isZero()?getPi(t,n+4,s).times(.5):(t.precision=n+6,t.rounding=1,i=i.asin(),l=getPi(t,n+4,s).times(.5),t.precision=n,t.rounding=s,l.minus(i))};P.inverseHyperbolicCosine=P.acosh=function(){var l,i,t=this,e=t.constructor;return t.lte(1)?new e(t.eq(1)?0:NaN):t.isFinite()?(l=e.precision,i=e.rounding,e.precision=l+Math.max(Math.abs(t.e),t.sd())+4,e.rounding=1,external=!1,t=t.times(t).minus(1).sqrt().plus(t),external=!0,e.precision=l,e.rounding=i,t.ln()):new e(t)};P.inverseHyperbolicSine=P.asinh=function(){var l,i,t=this,e=t.constructor;return!t.isFinite()||t.isZero()?new e(t):(l=e.precision,i=e.rounding,e.precision=l+2*Math.max(Math.abs(t.e),t.sd())+6,e.rounding=1,external=!1,t=t.times(t).plus(1).sqrt().plus(t),external=!0,e.precision=l,e.rounding=i,t.ln())};P.inverseHyperbolicTangent=P.atanh=function(){var l,i,t,e,n=this,s=n.constructor;return n.isFinite()?n.e>=0?new s(n.abs().eq(1)?n.s/0:n.isZero()?n:NaN):(l=s.precision,i=s.rounding,e=n.sd(),Math.max(e,l)<2*-n.e-1?finalise(new s(n),l,i,!0):(s.precision=t=e-n.e,n=divide(n.plus(1),new s(1).minus(n),t+l,1),s.precision=l+4,s.rounding=1,n=n.ln(),s.precision=l,s.rounding=i,n.times(.5))):new s(NaN)};P.inverseSine=P.asin=function(){var l,i,t,e,n=this,s=n.constructor;return n.isZero()?new s(n):(i=n.abs().cmp(1),t=s.precision,e=s.rounding,i!==-1?i===0?(l=getPi(s,t+4,e).times(.5),l.s=n.s,l):new s(NaN):(s.precision=t+6,s.rounding=1,n=n.div(new s(1).minus(n.times(n)).sqrt().plus(1)).atan(),s.precision=t,s.rounding=e,n.times(2)))};P.inverseTangent=P.atan=function(){var l,i,t,e,n,s,a,r,o,h=this,d=h.constructor,u=d.precision,m=d.rounding;if(h.isFinite()){if(h.isZero())return new d(h);if(h.abs().eq(1)&&u+4<=PI_PRECISION)return a=getPi(d,u+4,m).times(.25),a.s=h.s,a}else{if(!h.s)return new d(NaN);if(u+4<=PI_PRECISION)return a=getPi(d,u+4,m).times(.5),a.s=h.s,a}for(d.precision=r=u+10,d.rounding=1,t=Math.min(28,r/LOG_BASE+2|0),l=t;l;--l)h=h.div(h.times(h).plus(1).sqrt().plus(1));for(external=!1,i=Math.ceil(r/LOG_BASE),e=1,o=h.times(h),a=new d(h),n=h;l!==-1;)if(n=n.times(o),s=a.minus(n.div(e+=2)),n=n.times(o),a=s.plus(n.div(e+=2)),a.d[i]!==void 0)for(l=i;a.d[l]===s.d[l]&&l--;);return t&&(a=a.times(2<<t-1)),external=!0,finalise(a,d.precision=u,d.rounding=m,!0)};P.isFinite=function(){return!!this.d};P.isInteger=P.isInt=function(){return!!this.d&&mathfloor(this.e/LOG_BASE)>this.d.length-2};P.isNaN=function(){return!this.s};P.isNegative=P.isNeg=function(){return this.s<0};P.isPositive=P.isPos=function(){return this.s>0};P.isZero=function(){return!!this.d&&this.d[0]===0};P.lessThan=P.lt=function(l){return this.cmp(l)<0};P.lessThanOrEqualTo=P.lte=function(l){return this.cmp(l)<1};P.logarithm=P.log=function(l){var i,t,e,n,s,a,r,o,h=this,d=h.constructor,u=d.precision,m=d.rounding,f=5;if(l==null)l=new d(10),i=!0;else{if(l=new d(l),t=l.d,l.s<0||!t||!t[0]||l.eq(1))return new d(NaN);i=l.eq(10)}if(t=h.d,h.s<0||!t||!t[0]||h.eq(1))return new d(t&&!t[0]?-1/0:h.s!=1?NaN:t?0:1/0);if(i)if(t.length>1)s=!0;else{for(n=t[0];n%10===0;)n/=10;s=n!==1}if(external=!1,r=u+f,a=naturalLogarithm(h,r),e=i?getLn10(d,r+10):naturalLogarithm(l,r),o=divide(a,e,r,1),checkRoundingDigits(o.d,n=u,m))do if(r+=10,a=naturalLogarithm(h,r),e=i?getLn10(d,r+10):naturalLogarithm(l,r),o=divide(a,e,r,1),!s){+digitsToString(o.d).slice(n+1,n+15)+1==1e14&&(o=finalise(o,u+1,0));break}while(checkRoundingDigits(o.d,n+=10,m));return external=!0,finalise(o,u,m)};P.minus=P.sub=function(l){var i,t,e,n,s,a,r,o,h,d,u,m,f=this,p=f.constructor;if(l=new p(l),!f.d||!l.d)return!f.s||!l.s?l=new p(NaN):f.d?l.s=-l.s:l=new p(l.d||f.s!==l.s?f:NaN),l;if(f.s!=l.s)return l.s=-l.s,f.plus(l);if(h=f.d,m=l.d,r=p.precision,o=p.rounding,!h[0]||!m[0]){if(m[0])l.s=-l.s;else if(h[0])l=new p(f);else return new p(o===3?-0:0);return external?finalise(l,r,o):l}if(t=mathfloor(l.e/LOG_BASE),d=mathfloor(f.e/LOG_BASE),h=h.slice(),s=d-t,s){for(u=s<0,u?(i=h,s=-s,a=m.length):(i=m,t=d,a=h.length),e=Math.max(Math.ceil(r/LOG_BASE),a)+2,s>e&&(s=e,i.length=1),i.reverse(),e=s;e--;)i.push(0);i.reverse()}else{for(e=h.length,a=m.length,u=e<a,u&&(a=e),e=0;e<a;e++)if(h[e]!=m[e]){u=h[e]<m[e];break}s=0}for(u&&(i=h,h=m,m=i,l.s=-l.s),a=h.length,e=m.length-a;e>0;--e)h[a++]=0;for(e=m.length;e>s;){if(h[--e]<m[e]){for(n=e;n&&h[--n]===0;)h[n]=BASE-1;--h[n],h[e]+=BASE}h[e]-=m[e]}for(;h[--a]===0;)h.pop();for(;h[0]===0;h.shift())--t;return h[0]?(l.d=h,l.e=getBase10Exponent(h,t),external?finalise(l,r,o):l):new p(o===3?-0:0)};P.modulo=P.mod=function(l){var i,t=this,e=t.constructor;return l=new e(l),!t.d||!l.s||l.d&&!l.d[0]?new e(NaN):!l.d||t.d&&!t.d[0]?finalise(new e(t),e.precision,e.rounding):(external=!1,e.modulo==9?(i=divide(t,l.abs(),0,3,1),i.s*=l.s):i=divide(t,l,0,e.modulo,1),i=i.times(l),external=!0,t.minus(i))};P.naturalExponential=P.exp=function(){return naturalExponential(this)};P.naturalLogarithm=P.ln=function(){return naturalLogarithm(this)};P.negated=P.neg=function(){var l=new this.constructor(this);return l.s=-l.s,finalise(l)};P.plus=P.add=function(l){var i,t,e,n,s,a,r,o,h,d,u=this,m=u.constructor;if(l=new m(l),!u.d||!l.d)return!u.s||!l.s?l=new m(NaN):u.d||(l=new m(l.d||u.s===l.s?u:NaN)),l;if(u.s!=l.s)return l.s=-l.s,u.minus(l);if(h=u.d,d=l.d,r=m.precision,o=m.rounding,!h[0]||!d[0])return d[0]||(l=new m(u)),external?finalise(l,r,o):l;if(s=mathfloor(u.e/LOG_BASE),e=mathfloor(l.e/LOG_BASE),h=h.slice(),n=s-e,n){for(n<0?(t=h,n=-n,a=d.length):(t=d,e=s,a=h.length),s=Math.ceil(r/LOG_BASE),a=s>a?s+1:a+1,n>a&&(n=a,t.length=1),t.reverse();n--;)t.push(0);t.reverse()}for(a=h.length,n=d.length,a-n<0&&(n=a,t=d,d=h,h=t),i=0;n;)i=(h[--n]=h[n]+d[n]+i)/BASE|0,h[n]%=BASE;for(i&&(h.unshift(i),++e),a=h.length;h[--a]==0;)h.pop();return l.d=h,l.e=getBase10Exponent(h,e),external?finalise(l,r,o):l};P.precision=P.sd=function(l){var i,t=this;if(l!==void 0&&l!==!!l&&l!==1&&l!==0)throw Error(invalidArgument+l);return t.d?(i=getPrecision(t.d),l&&t.e+1>i&&(i=t.e+1)):i=NaN,i};P.round=function(){var l=this,i=l.constructor;return finalise(new i(l),l.e+1,i.rounding)};P.sine=P.sin=function(){var l,i,t=this,e=t.constructor;return t.isFinite()?t.isZero()?new e(t):(l=e.precision,i=e.rounding,e.precision=l+Math.max(t.e,t.sd())+LOG_BASE,e.rounding=1,t=sine(e,toLessThanHalfPi(e,t)),e.precision=l,e.rounding=i,finalise(quadrant>2?t.neg():t,l,i,!0)):new e(NaN)};P.squareRoot=P.sqrt=function(){var l,i,t,e,n,s,a=this,r=a.d,o=a.e,h=a.s,d=a.constructor;if(h!==1||!r||!r[0])return new d(!h||h<0&&(!r||r[0])?NaN:r?a:1/0);for(external=!1,h=Math.sqrt(+a),h==0||h==1/0?(i=digitsToString(r),(i.length+o)%2==0&&(i+="0"),h=Math.sqrt(i),o=mathfloor((o+1)/2)-(o<0||o%2),h==1/0?i="5e"+o:(i=h.toExponential(),i=i.slice(0,i.indexOf("e")+1)+o),e=new d(i)):e=new d(h.toString()),t=(o=d.precision)+3;;)if(s=e,e=s.plus(divide(a,s,t+2,1)).times(.5),digitsToString(s.d).slice(0,t)===(i=digitsToString(e.d)).slice(0,t))if(i=i.slice(t-3,t+1),i=="9999"||!n&&i=="4999"){if(!n&&(finalise(s,o+1,0),s.times(s).eq(a))){e=s;break}t+=4,n=1}else{(!+i||!+i.slice(1)&&i.charAt(0)=="5")&&(finalise(e,o+1,1),l=!e.times(e).eq(a));break}return external=!0,finalise(e,o,d.rounding,l)};P.tangent=P.tan=function(){var l,i,t=this,e=t.constructor;return t.isFinite()?t.isZero()?new e(t):(l=e.precision,i=e.rounding,e.precision=l+10,e.rounding=1,t=t.sin(),t.s=1,t=divide(t,new e(1).minus(t.times(t)).sqrt(),l+10,0),e.precision=l,e.rounding=i,finalise(quadrant==2||quadrant==4?t.neg():t,l,i,!0)):new e(NaN)};P.times=P.mul=function(l){var i,t,e,n,s,a,r,o,h,d=this,u=d.constructor,m=d.d,f=(l=new u(l)).d;if(l.s*=d.s,!m||!m[0]||!f||!f[0])return new u(!l.s||m&&!m[0]&&!f||f&&!f[0]&&!m?NaN:!m||!f?l.s/0:l.s*0);for(t=mathfloor(d.e/LOG_BASE)+mathfloor(l.e/LOG_BASE),o=m.length,h=f.length,o<h&&(s=m,m=f,f=s,a=o,o=h,h=a),s=[],a=o+h,e=a;e--;)s.push(0);for(e=h;--e>=0;){for(i=0,n=o+e;n>e;)r=s[n]+f[e]*m[n-e-1]+i,s[n--]=r%BASE|0,i=r/BASE|0;s[n]=(s[n]+i)%BASE|0}for(;!s[--a];)s.pop();return i?++t:s.shift(),l.d=s,l.e=getBase10Exponent(s,t),external?finalise(l,u.precision,u.rounding):l};P.toBinary=function(l,i){return toStringBinary(this,2,l,i)};P.toDecimalPlaces=P.toDP=function(l,i){var t=this,e=t.constructor;return t=new e(t),l===void 0?t:(checkInt32(l,0,MAX_DIGITS),i===void 0?i=e.rounding:checkInt32(i,0,8),finalise(t,l+t.e+1,i))};P.toExponential=function(l,i){var t,e=this,n=e.constructor;return l===void 0?t=finiteToString(e,!0):(checkInt32(l,0,MAX_DIGITS),i===void 0?i=n.rounding:checkInt32(i,0,8),e=finalise(new n(e),l+1,i),t=finiteToString(e,!0,l+1)),e.isNeg()&&!e.isZero()?"-"+t:t};P.toFixed=function(l,i){var t,e,n=this,s=n.constructor;return l===void 0?t=finiteToString(n):(checkInt32(l,0,MAX_DIGITS),i===void 0?i=s.rounding:checkInt32(i,0,8),e=finalise(new s(n),l+n.e+1,i),t=finiteToString(e,!1,l+e.e+1)),n.isNeg()&&!n.isZero()?"-"+t:t};P.toFraction=function(l){var i,t,e,n,s,a,r,o,h,d,u,m,f=this,p=f.d,E=f.constructor;if(!p)return new E(f);if(h=t=new E(1),e=o=new E(0),i=new E(e),s=i.e=getPrecision(p)-f.e-1,a=s%LOG_BASE,i.d[0]=mathpow(10,a<0?LOG_BASE+a:a),l==null)l=s>0?i:h;else{if(r=new E(l),!r.isInt()||r.lt(h))throw Error(invalidArgument+r);l=r.gt(i)?s>0?i:h:r}for(external=!1,r=new E(digitsToString(p)),d=E.precision,E.precision=s=p.length*LOG_BASE*2;u=divide(r,i,0,1,1),n=t.plus(u.times(e)),n.cmp(l)!=1;)t=e,e=n,n=h,h=o.plus(u.times(n)),o=n,n=i,i=r.minus(u.times(n)),r=n;return n=divide(l.minus(t),e,0,1,1),o=o.plus(n.times(h)),t=t.plus(n.times(e)),o.s=h.s=f.s,m=divide(h,e,s,1).minus(f).abs().cmp(divide(o,t,s,1).minus(f).abs())<1?[h,e]:[o,t],E.precision=d,external=!0,m};P.toHexadecimal=P.toHex=function(l,i){return toStringBinary(this,16,l,i)};P.toNearest=function(l,i){var t=this,e=t.constructor;if(t=new e(t),l==null){if(!t.d)return t;l=new e(1),i=e.rounding}else{if(l=new e(l),i===void 0?i=e.rounding:checkInt32(i,0,8),!t.d)return l.s?t:l;if(!l.d)return l.s&&(l.s=t.s),l}return l.d[0]?(external=!1,t=divide(t,l,0,i,1).times(l),external=!0,finalise(t)):(l.s=t.s,t=l),t};P.toNumber=function(){return+this};P.toOctal=function(l,i){return toStringBinary(this,8,l,i)};P.toPower=P.pow=function(l){var i,t,e,n,s,a,r=this,o=r.constructor,h=+(l=new o(l));if(!r.d||!l.d||!r.d[0]||!l.d[0])return new o(mathpow(+r,h));if(r=new o(r),r.eq(1))return r;if(e=o.precision,s=o.rounding,l.eq(1))return finalise(r,e,s);if(i=mathfloor(l.e/LOG_BASE),i>=l.d.length-1&&(t=h<0?-h:h)<=MAX_SAFE_INTEGER)return n=intPow(o,r,t,e),l.s<0?new o(1).div(n):finalise(n,e,s);if(a=r.s,a<0){if(i<l.d.length-1)return new o(NaN);if(l.d[i]&1||(a=1),r.e==0&&r.d[0]==1&&r.d.length==1)return r.s=a,r}return t=mathpow(+r,h),i=t==0||!isFinite(t)?mathfloor(h*(Math.log("0."+digitsToString(r.d))/Math.LN10+r.e+1)):new o(t+"").e,i>o.maxE+1||i<o.minE-1?new o(i>0?a/0:0):(external=!1,o.rounding=r.s=1,t=Math.min(12,(i+"").length),n=naturalExponential(l.times(naturalLogarithm(r,e+t)),e),n.d&&(n=finalise(n,e+5,1),checkRoundingDigits(n.d,e,s)&&(i=e+10,n=finalise(naturalExponential(l.times(naturalLogarithm(r,i+t)),i),i+5,1),+digitsToString(n.d).slice(e+1,e+15)+1==1e14&&(n=finalise(n,e+1,0)))),n.s=a,external=!0,o.rounding=s,finalise(n,e,s))};P.toPrecision=function(l,i){var t,e=this,n=e.constructor;return l===void 0?t=finiteToString(e,e.e<=n.toExpNeg||e.e>=n.toExpPos):(checkInt32(l,1,MAX_DIGITS),i===void 0?i=n.rounding:checkInt32(i,0,8),e=finalise(new n(e),l,i),t=finiteToString(e,l<=e.e||e.e<=n.toExpNeg,l)),e.isNeg()&&!e.isZero()?"-"+t:t};P.toSignificantDigits=P.toSD=function(l,i){var t=this,e=t.constructor;return l===void 0?(l=e.precision,i=e.rounding):(checkInt32(l,1,MAX_DIGITS),i===void 0?i=e.rounding:checkInt32(i,0,8)),finalise(new e(t),l,i)};P.toString=function(){var l=this,i=l.constructor,t=finiteToString(l,l.e<=i.toExpNeg||l.e>=i.toExpPos);return l.isNeg()&&!l.isZero()?"-"+t:t};P.truncated=P.trunc=function(){return finalise(new this.constructor(this),this.e+1,1)};P.valueOf=P.toJSON=function(){var l=this,i=l.constructor,t=finiteToString(l,l.e<=i.toExpNeg||l.e>=i.toExpPos);return l.isNeg()?"-"+t:t};function digitsToString(l){var i,t,e,n=l.length-1,s="",a=l[0];if(n>0){for(s+=a,i=1;i<n;i++)e=l[i]+"",t=LOG_BASE-e.length,t&&(s+=getZeroString(t)),s+=e;a=l[i],e=a+"",t=LOG_BASE-e.length,t&&(s+=getZeroString(t))}else if(a===0)return"0";for(;a%10===0;)a/=10;return s+a}function checkInt32(l,i,t){if(l!==~~l||l<i||l>t)throw Error(invalidArgument+l)}function checkRoundingDigits(l,i,t,e){var n,s,a,r;for(s=l[0];s>=10;s/=10)--i;return--i<0?(i+=LOG_BASE,n=0):(n=Math.ceil((i+1)/LOG_BASE),i%=LOG_BASE),s=mathpow(10,LOG_BASE-i),r=l[n]%s|0,e==null?i<3?(i==0?r=r/100|0:i==1&&(r=r/10|0),a=t<4&&r==99999||t>3&&r==49999||r==5e4||r==0):a=(t<4&&r+1==s||t>3&&r+1==s/2)&&(l[n+1]/s/100|0)==mathpow(10,i-2)-1||(r==s/2||r==0)&&(l[n+1]/s/100|0)==0:i<4?(i==0?r=r/1e3|0:i==1?r=r/100|0:i==2&&(r=r/10|0),a=(e||t<4)&&r==9999||!e&&t>3&&r==4999):a=((e||t<4)&&r+1==s||!e&&t>3&&r+1==s/2)&&(l[n+1]/s/1e3|0)==mathpow(10,i-3)-1,a}function convertBase(l,i,t){for(var e,n=[0],s,a=0,r=l.length;a<r;){for(s=n.length;s--;)n[s]*=i;for(n[0]+=NUMERALS.indexOf(l.charAt(a++)),e=0;e<n.length;e++)n[e]>t-1&&(n[e+1]===void 0&&(n[e+1]=0),n[e+1]+=n[e]/t|0,n[e]%=t)}return n.reverse()}function cosine(l,i){var t,e,n;if(i.isZero())return i;e=i.d.length,e<32?(t=Math.ceil(e/3),n=(1/tinyPow(4,t)).toString()):(t=16,n="2.3283064365386962890625e-10"),l.precision+=t,i=taylorSeries(l,1,i.times(n),new l(1));for(var s=t;s--;){var a=i.times(i);i=a.times(a).minus(a).times(8).plus(1)}return l.precision-=t,i}var divide=function(){function l(e,n,s){var a,r=0,o=e.length;for(e=e.slice();o--;)a=e[o]*n+r,e[o]=a%s|0,r=a/s|0;return r&&e.unshift(r),e}function i(e,n,s,a){var r,o;if(s!=a)o=s>a?1:-1;else for(r=o=0;r<s;r++)if(e[r]!=n[r]){o=e[r]>n[r]?1:-1;break}return o}function t(e,n,s,a){for(var r=0;s--;)e[s]-=r,r=e[s]<n[s]?1:0,e[s]=r*a+e[s]-n[s];for(;!e[0]&&e.length>1;)e.shift()}return function(e,n,s,a,r,o){var h,d,u,m,f,p,E,I,T,F,b,A,V,U,et,J,j,H,L,Z,nt=e.constructor,D=e.s==n.s?1:-1,y=e.d,g=n.d;if(!y||!y[0]||!g||!g[0])return new nt(!e.s||!n.s||(y?g&&y[0]==g[0]:!g)?NaN:y&&y[0]==0||!g?D*0:D/0);for(o?(f=1,d=e.e-n.e):(o=BASE,f=LOG_BASE,d=mathfloor(e.e/f)-mathfloor(n.e/f)),L=g.length,j=y.length,T=new nt(D),F=T.d=[],u=0;g[u]==(y[u]||0);u++);if(g[u]>(y[u]||0)&&d--,s==null?(U=s=nt.precision,a=nt.rounding):r?U=s+(e.e-n.e)+1:U=s,U<0)F.push(1),p=!0;else{if(U=U/f+2|0,u=0,L==1){for(m=0,g=g[0],U++;(u<j||m)&&U--;u++)et=m*o+(y[u]||0),F[u]=et/g|0,m=et%g|0;p=m||u<j}else{for(m=o/(g[0]+1)|0,m>1&&(g=l(g,m,o),y=l(y,m,o),L=g.length,j=y.length),J=L,b=y.slice(0,L),A=b.length;A<L;)b[A++]=0;Z=g.slice(),Z.unshift(0),H=g[0],g[1]>=o/2&&++H;do m=0,h=i(g,b,L,A),h<0?(V=b[0],L!=A&&(V=V*o+(b[1]||0)),m=V/H|0,m>1?(m>=o&&(m=o-1),E=l(g,m,o),I=E.length,A=b.length,h=i(E,b,I,A),h==1&&(m--,t(E,L<I?Z:g,I,o))):(m==0&&(h=m=1),E=g.slice()),I=E.length,I<A&&E.unshift(0),t(b,E,A,o),h==-1&&(A=b.length,h=i(g,b,L,A),h<1&&(m++,t(b,L<A?Z:g,A,o))),A=b.length):h===0&&(m++,b=[0]),F[u++]=m,h&&b[0]?b[A++]=y[J]||0:(b=[y[J]],A=1);while((J++<j||b[0]!==void 0)&&U--);p=b[0]!==void 0}F[0]||F.shift()}if(f==1)T.e=d,inexact=p;else{for(u=1,m=F[0];m>=10;m/=10)u++;T.e=u+d*f-1,finalise(T,r?s+T.e+1:s,a,p)}return T}}();function finalise(l,i,t,e){var n,s,a,r,o,h,d,u,m,f=l.constructor;t:if(i!=null){if(u=l.d,!u)return l;for(n=1,r=u[0];r>=10;r/=10)n++;if(s=i-n,s<0)s+=LOG_BASE,a=i,d=u[m=0],o=d/mathpow(10,n-a-1)%10|0;else if(m=Math.ceil((s+1)/LOG_BASE),r=u.length,m>=r)if(e){for(;r++<=m;)u.push(0);d=o=0,n=1,s%=LOG_BASE,a=s-LOG_BASE+1}else break t;else{for(d=r=u[m],n=1;r>=10;r/=10)n++;s%=LOG_BASE,a=s-LOG_BASE+n,o=a<0?0:d/mathpow(10,n-a-1)%10|0}if(e=e||i<0||u[m+1]!==void 0||(a<0?d:d%mathpow(10,n-a-1)),h=t<4?(o||e)&&(t==0||t==(l.s<0?3:2)):o>5||o==5&&(t==4||e||t==6&&(s>0?a>0?d/mathpow(10,n-a):0:u[m-1])%10&1||t==(l.s<0?8:7)),i<1||!u[0])return u.length=0,h?(i-=l.e+1,u[0]=mathpow(10,(LOG_BASE-i%LOG_BASE)%LOG_BASE),l.e=-i||0):u[0]=l.e=0,l;if(s==0?(u.length=m,r=1,m--):(u.length=m+1,r=mathpow(10,LOG_BASE-s),u[m]=a>0?(d/mathpow(10,n-a)%mathpow(10,a)|0)*r:0),h)for(;;)if(m==0){for(s=1,a=u[0];a>=10;a/=10)s++;for(a=u[0]+=r,r=1;a>=10;a/=10)r++;s!=r&&(l.e++,u[0]==BASE&&(u[0]=1));break}else{if(u[m]+=r,u[m]!=BASE)break;u[m--]=0,r=1}for(s=u.length;u[--s]===0;)u.pop()}return external&&(l.e>f.maxE?(l.d=null,l.e=NaN):l.e<f.minE&&(l.e=0,l.d=[0])),l}function finiteToString(l,i,t){if(!l.isFinite())return nonFiniteToString(l);var e,n=l.e,s=digitsToString(l.d),a=s.length;return i?(t&&(e=t-a)>0?s=s.charAt(0)+"."+s.slice(1)+getZeroString(e):a>1&&(s=s.charAt(0)+"."+s.slice(1)),s=s+(l.e<0?"e":"e+")+l.e):n<0?(s="0."+getZeroString(-n-1)+s,t&&(e=t-a)>0&&(s+=getZeroString(e))):n>=a?(s+=getZeroString(n+1-a),t&&(e=t-n-1)>0&&(s=s+"."+getZeroString(e))):((e=n+1)<a&&(s=s.slice(0,e)+"."+s.slice(e)),t&&(e=t-a)>0&&(n+1===a&&(s+="."),s+=getZeroString(e))),s}function getBase10Exponent(l,i){var t=l[0];for(i*=LOG_BASE;t>=10;t/=10)i++;return i}function getLn10(l,i,t){if(i>LN10_PRECISION)throw external=!0,t&&(l.precision=t),Error(precisionLimitExceeded);return finalise(new l(LN10),i,1,!0)}function getPi(l,i,t){if(i>PI_PRECISION)throw Error(precisionLimitExceeded);return finalise(new l(PI),i,t,!0)}function getPrecision(l){var i=l.length-1,t=i*LOG_BASE+1;if(i=l[i],i){for(;i%10==0;i/=10)t--;for(i=l[0];i>=10;i/=10)t++}return t}function getZeroString(l){for(var i="";l--;)i+="0";return i}function intPow(l,i,t,e){var n,s=new l(1),a=Math.ceil(e/LOG_BASE+4);for(external=!1;;){if(t%2&&(s=s.times(i),truncate(s.d,a)&&(n=!0)),t=mathfloor(t/2),t===0){t=s.d.length-1,n&&s.d[t]===0&&++s.d[t];break}i=i.times(i),truncate(i.d,a)}return external=!0,s}function isOdd(l){return l.d[l.d.length-1]&1}function maxOrMin(l,i,t){for(var e,n=new l(i[0]),s=0;++s<i.length;)if(e=new l(i[s]),e.s)n[t](e)&&(n=e);else{n=e;break}return n}function naturalExponential(l,i){var t,e,n,s,a,r,o,h=0,d=0,u=0,m=l.constructor,f=m.rounding,p=m.precision;if(!l.d||!l.d[0]||l.e>17)return new m(l.d?l.d[0]?l.s<0?0:1/0:1:l.s?l.s<0?0:l:NaN);for(i==null?(external=!1,o=p):o=i,r=new m(.03125);l.e>-2;)l=l.times(r),u+=5;for(e=Math.log(mathpow(2,u))/Math.LN10*2+5|0,o+=e,t=s=a=new m(1),m.precision=o;;){if(s=finalise(s.times(l),o,1),t=t.times(++d),r=a.plus(divide(s,t,o,1)),digitsToString(r.d).slice(0,o)===digitsToString(a.d).slice(0,o)){for(n=u;n--;)a=finalise(a.times(a),o,1);if(i==null)if(h<3&&checkRoundingDigits(a.d,o-e,f,h))m.precision=o+=10,t=s=r=new m(1),d=0,h++;else return finalise(a,m.precision=p,f,external=!0);else return m.precision=p,a}a=r}}function naturalLogarithm(l,i){var t,e,n,s,a,r,o,h,d,u,m,f=1,p=10,E=l,I=E.d,T=E.constructor,F=T.rounding,b=T.precision;if(E.s<0||!I||!I[0]||!E.e&&I[0]==1&&I.length==1)return new T(I&&!I[0]?-1/0:E.s!=1?NaN:I?0:E);if(i==null?(external=!1,d=b):d=i,T.precision=d+=p,t=digitsToString(I),e=t.charAt(0),Math.abs(s=E.e)<15e14){for(;e<7&&e!=1||e==1&&t.charAt(1)>3;)E=E.times(l),t=digitsToString(E.d),e=t.charAt(0),f++;s=E.e,e>1?(E=new T("0."+t),s++):E=new T(e+"."+t.slice(1))}else return h=getLn10(T,d+2,b).times(s+""),E=naturalLogarithm(new T(e+"."+t.slice(1)),d-p).plus(h),T.precision=b,i==null?finalise(E,b,F,external=!0):E;for(u=E,o=a=E=divide(E.minus(1),E.plus(1),d,1),m=finalise(E.times(E),d,1),n=3;;){if(a=finalise(a.times(m),d,1),h=o.plus(divide(a,new T(n),d,1)),digitsToString(h.d).slice(0,d)===digitsToString(o.d).slice(0,d))if(o=o.times(2),s!==0&&(o=o.plus(getLn10(T,d+2,b).times(s+""))),o=divide(o,new T(f),d,1),i==null)if(checkRoundingDigits(o.d,d-p,F,r))T.precision=d+=p,h=a=E=divide(u.minus(1),u.plus(1),d,1),m=finalise(E.times(E),d,1),n=r=1;else return finalise(o,T.precision=b,F,external=!0);else return T.precision=b,o;o=h,n+=2}}function nonFiniteToString(l){return String(l.s*l.s/0)}function parseDecimal(l,i){var t,e,n;for((t=i.indexOf("."))>-1&&(i=i.replace(".","")),(e=i.search(/e/i))>0?(t<0&&(t=e),t+=+i.slice(e+1),i=i.substring(0,e)):t<0&&(t=i.length),e=0;i.charCodeAt(e)===48;e++);for(n=i.length;i.charCodeAt(n-1)===48;--n);if(i=i.slice(e,n),i){if(n-=e,l.e=t=t-e-1,l.d=[],e=(t+1)%LOG_BASE,t<0&&(e+=LOG_BASE),e<n){for(e&&l.d.push(+i.slice(0,e)),n-=LOG_BASE;e<n;)l.d.push(+i.slice(e,e+=LOG_BASE));i=i.slice(e),e=LOG_BASE-i.length}else e-=n;for(;e--;)i+="0";l.d.push(+i),external&&(l.e>l.constructor.maxE?(l.d=null,l.e=NaN):l.e<l.constructor.minE&&(l.e=0,l.d=[0]))}else l.e=0,l.d=[0];return l}function parseOther(l,i){var t,e,n,s,a,r,o,h,d;if(i.indexOf("_")>-1){if(i=i.replace(/(\d)_(?=\d)/g,"$1"),isDecimal.test(i))return parseDecimal(l,i)}else if(i==="Infinity"||i==="NaN")return+i||(l.s=NaN),l.e=NaN,l.d=null,l;if(isHex.test(i))t=16,i=i.toLowerCase();else if(isBinary.test(i))t=2;else if(isOctal.test(i))t=8;else throw Error(invalidArgument+i);for(s=i.search(/p/i),s>0?(o=+i.slice(s+1),i=i.substring(2,s)):i=i.slice(2),s=i.indexOf("."),a=s>=0,e=l.constructor,a&&(i=i.replace(".",""),r=i.length,s=r-s,n=intPow(e,new e(t),s,s*2)),h=convertBase(i,t,BASE),d=h.length-1,s=d;h[s]===0;--s)h.pop();return s<0?new e(l.s*0):(l.e=getBase10Exponent(h,d),l.d=h,external=!1,a&&(l=divide(l,n,r*4)),o&&(l=l.times(Math.abs(o)<54?mathpow(2,o):Decimal.pow(2,o))),external=!0,l)}function sine(l,i){var t,e=i.d.length;if(e<3)return i.isZero()?i:taylorSeries(l,2,i,i);t=1.4*Math.sqrt(e),t=t>16?16:t|0,i=i.times(1/tinyPow(5,t)),i=taylorSeries(l,2,i,i);for(var n,s=new l(5),a=new l(16),r=new l(20);t--;)n=i.times(i),i=i.times(s.plus(n.times(a.times(n).minus(r))));return i}function taylorSeries(l,i,t,e,n){var s,a,r,o,h=l.precision,d=Math.ceil(h/LOG_BASE);for(external=!1,o=t.times(t),r=new l(e);;){if(a=divide(r.times(o),new l(i++*i++),h,1),r=n?e.plus(a):e.minus(a),e=divide(a.times(o),new l(i++*i++),h,1),a=r.plus(e),a.d[d]!==void 0){for(s=d;a.d[s]===r.d[s]&&s--;);if(s==-1)break}s=r,r=e,e=a,a=s}return external=!0,a.d.length=d+1,a}function tinyPow(l,i){for(var t=l;--i;)t*=l;return t}function toLessThanHalfPi(l,i){var t,e=i.s<0,n=getPi(l,l.precision,1),s=n.times(.5);if(i=i.abs(),i.lte(s))return quadrant=e?4:1,i;if(t=i.divToInt(n),t.isZero())quadrant=e?3:2;else{if(i=i.minus(t.times(n)),i.lte(s))return quadrant=isOdd(t)?e?2:3:e?4:1,i;quadrant=isOdd(t)?e?1:4:e?3:2}return i.minus(n).abs()}function toStringBinary(l,i,t,e){var n,s,a,r,o,h,d,u,m,f=l.constructor,p=t!==void 0;if(p?(checkInt32(t,1,MAX_DIGITS),e===void 0?e=f.rounding:checkInt32(e,0,8)):(t=f.precision,e=f.rounding),!l.isFinite())d=nonFiniteToString(l);else{for(d=finiteToString(l),a=d.indexOf("."),p?(n=2,i==16?t=t*4-3:i==8&&(t=t*3-2)):n=i,a>=0&&(d=d.replace(".",""),m=new f(1),m.e=d.length-a,m.d=convertBase(finiteToString(m),10,n),m.e=m.d.length),u=convertBase(d,10,n),s=o=u.length;u[--o]==0;)u.pop();if(!u[0])d=p?"0p+0":"0";else{if(a<0?s--:(l=new f(l),l.d=u,l.e=s,l=divide(l,m,t,e,0,n),u=l.d,s=l.e,h=inexact),a=u[t],r=n/2,h=h||u[t+1]!==void 0,h=e<4?(a!==void 0||h)&&(e===0||e===(l.s<0?3:2)):a>r||a===r&&(e===4||h||e===6&&u[t-1]&1||e===(l.s<0?8:7)),u.length=t,h)for(;++u[--t]>n-1;)u[t]=0,t||(++s,u.unshift(1));for(o=u.length;!u[o-1];--o);for(a=0,d="";a<o;a++)d+=NUMERALS.charAt(u[a]);if(p){if(o>1)if(i==16||i==8){for(a=i==16?4:3,--o;o%a;o++)d+="0";for(u=convertBase(d,n,i),o=u.length;!u[o-1];--o);for(a=1,d="1.";a<o;a++)d+=NUMERALS.charAt(u[a])}else d=d.charAt(0)+"."+d.slice(1);d=d+(s<0?"p":"p+")+s}else if(s<0){for(;++s;)d="0"+d;d="0."+d}else if(++s>o)for(s-=o;s--;)d+="0";else s<o&&(d=d.slice(0,s)+"."+d.slice(s))}d=(i==16?"0x":i==2?"0b":i==8?"0o":"")+d}return l.s<0?"-"+d:d}function truncate(l,i){if(l.length>i)return l.length=i,!0}function abs(l){return new this(l).abs()}function acos(l){return new this(l).acos()}function acosh(l){return new this(l).acosh()}function add(l,i){return new this(l).plus(i)}function asin(l){return new this(l).asin()}function asinh(l){return new this(l).asinh()}function atan(l){return new this(l).atan()}function atanh(l){return new this(l).atanh()}function atan2(l,i){l=new this(l),i=new this(i);var t,e=this.precision,n=this.rounding,s=e+4;return!l.s||!i.s?t=new this(NaN):!l.d&&!i.d?(t=getPi(this,s,1).times(i.s>0?.25:.75),t.s=l.s):!i.d||l.isZero()?(t=i.s<0?getPi(this,e,n):new this(0),t.s=l.s):!l.d||i.isZero()?(t=getPi(this,s,1).times(.5),t.s=l.s):i.s<0?(this.precision=s,this.rounding=1,t=this.atan(divide(l,i,s,1)),i=getPi(this,s,1),this.precision=e,this.rounding=n,t=l.s<0?t.minus(i):t.plus(i)):t=this.atan(divide(l,i,s,1)),t}function cbrt(l){return new this(l).cbrt()}function ceil(l){return finalise(l=new this(l),l.e+1,2)}function clamp(l,i,t){return new this(l).clamp(i,t)}function config(l){if(!l||typeof l!="object")throw Error(decimalError+"Object expected");var i,t,e,n=l.defaults===!0,s=["precision",1,MAX_DIGITS,"rounding",0,8,"toExpNeg",-EXP_LIMIT,0,"toExpPos",0,EXP_LIMIT,"maxE",0,EXP_LIMIT,"minE",-EXP_LIMIT,0,"modulo",0,9];for(i=0;i<s.length;i+=3)if(t=s[i],n&&(this[t]=DEFAULTS[t]),(e=l[t])!==void 0)if(mathfloor(e)===e&&e>=s[i+1]&&e<=s[i+2])this[t]=e;else throw Error(invalidArgument+t+": "+e);if(t="crypto",n&&(this[t]=DEFAULTS[t]),(e=l[t])!==void 0)if(e===!0||e===!1||e===0||e===1)if(e)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[t]=!0;else throw Error(cryptoUnavailable);else this[t]=!1;else throw Error(invalidArgument+t+": "+e);return this}function cos(l){return new this(l).cos()}function cosh(l){return new this(l).cosh()}function clone(l){var i,t,e;function n(s){var a,r,o,h=this;if(!(h instanceof n))return new n(s);if(h.constructor=n,isDecimalInstance(s)){h.s=s.s,external?!s.d||s.e>n.maxE?(h.e=NaN,h.d=null):s.e<n.minE?(h.e=0,h.d=[0]):(h.e=s.e,h.d=s.d.slice()):(h.e=s.e,h.d=s.d?s.d.slice():s.d);return}if(o=typeof s,o==="number"){if(s===0){h.s=1/s<0?-1:1,h.e=0,h.d=[0];return}if(s<0?(s=-s,h.s=-1):h.s=1,s===~~s&&s<1e7){for(a=0,r=s;r>=10;r/=10)a++;external?a>n.maxE?(h.e=NaN,h.d=null):a<n.minE?(h.e=0,h.d=[0]):(h.e=a,h.d=[s]):(h.e=a,h.d=[s]);return}else if(s*0!==0){s||(h.s=NaN),h.e=NaN,h.d=null;return}return parseDecimal(h,s.toString())}else if(o!=="string")throw Error(invalidArgument+s);return(r=s.charCodeAt(0))===45?(s=s.slice(1),h.s=-1):(r===43&&(s=s.slice(1)),h.s=1),isDecimal.test(s)?parseDecimal(h,s):parseOther(h,s)}if(n.prototype=P,n.ROUND_UP=0,n.ROUND_DOWN=1,n.ROUND_CEIL=2,n.ROUND_FLOOR=3,n.ROUND_HALF_UP=4,n.ROUND_HALF_DOWN=5,n.ROUND_HALF_EVEN=6,n.ROUND_HALF_CEIL=7,n.ROUND_HALF_FLOOR=8,n.EUCLID=9,n.config=n.set=config,n.clone=clone,n.isDecimal=isDecimalInstance,n.abs=abs,n.acos=acos,n.acosh=acosh,n.add=add,n.asin=asin,n.asinh=asinh,n.atan=atan,n.atanh=atanh,n.atan2=atan2,n.cbrt=cbrt,n.ceil=ceil,n.clamp=clamp,n.cos=cos,n.cosh=cosh,n.div=div,n.exp=exp,n.floor=floor,n.hypot=hypot,n.ln=ln,n.log=log,n.log10=log10,n.log2=log2,n.max=max,n.min=min,n.mod=mod,n.mul=mul,n.pow=pow,n.random=random,n.round=round,n.sign=sign,n.sin=sin,n.sinh=sinh,n.sqrt=sqrt,n.sub=sub,n.sum=sum,n.tan=tan,n.tanh=tanh,n.trunc=trunc,l===void 0&&(l={}),l&&l.defaults!==!0)for(e=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],i=0;i<e.length;)l.hasOwnProperty(t=e[i++])||(l[t]=this[t]);return n.config(l),n}function div(l,i){return new this(l).div(i)}function exp(l){return new this(l).exp()}function floor(l){return finalise(l=new this(l),l.e+1,3)}function hypot(){var l,i,t=new this(0);for(external=!1,l=0;l<arguments.length;)if(i=new this(arguments[l++]),i.d)t.d&&(t=t.plus(i.times(i)));else{if(i.s)return external=!0,new this(1/0);t=i}return external=!0,t.sqrt()}function isDecimalInstance(l){return l instanceof Decimal||l&&l.toStringTag===tag||!1}function ln(l){return new this(l).ln()}function log(l,i){return new this(l).log(i)}function log2(l){return new this(l).log(2)}function log10(l){return new this(l).log(10)}function max(){return maxOrMin(this,arguments,"lt")}function min(){return maxOrMin(this,arguments,"gt")}function mod(l,i){return new this(l).mod(i)}function mul(l,i){return new this(l).mul(i)}function pow(l,i){return new this(l).pow(i)}function random(l){var i,t,e,n,s=0,a=new this(1),r=[];if(l===void 0?l=this.precision:checkInt32(l,1,MAX_DIGITS),e=Math.ceil(l/LOG_BASE),this.crypto)if(crypto.getRandomValues)for(i=crypto.getRandomValues(new Uint32Array(e));s<e;)n=i[s],n>=429e7?i[s]=crypto.getRandomValues(new Uint32Array(1))[0]:r[s++]=n%1e7;else if(crypto.randomBytes){for(i=crypto.randomBytes(e*=4);s<e;)n=i[s]+(i[s+1]<<8)+(i[s+2]<<16)+((i[s+3]&127)<<24),n>=214e7?crypto.randomBytes(4).copy(i,s):(r.push(n%1e7),s+=4);s=e/4}else throw Error(cryptoUnavailable);else for(;s<e;)r[s++]=Math.random()*1e7|0;for(e=r[--s],l%=LOG_BASE,e&&l&&(n=mathpow(10,LOG_BASE-l),r[s]=(e/n|0)*n);r[s]===0;s--)r.pop();if(s<0)t=0,r=[0];else{for(t=-1;r[0]===0;t-=LOG_BASE)r.shift();for(e=1,n=r[0];n>=10;n/=10)e++;e<LOG_BASE&&(t-=LOG_BASE-e)}return a.e=t,a.d=r,a}function round(l){return finalise(l=new this(l),l.e+1,this.rounding)}function sign(l){return l=new this(l),l.d?l.d[0]?l.s:0*l.s:l.s||NaN}function sin(l){return new this(l).sin()}function sinh(l){return new this(l).sinh()}function sqrt(l){return new this(l).sqrt()}function sub(l,i){return new this(l).sub(i)}function sum(){var l=0,i=arguments,t=new this(i[l]);for(external=!1;t.s&&++l<i.length;)t=t.plus(i[l]);return external=!0,finalise(t,this.precision,this.rounding)}function tan(l){return new this(l).tan()}function tanh(l){return new this(l).tanh()}function trunc(l){return finalise(l=new this(l),l.e+1,1)}P[Symbol.for("nodejs.util.inspect.custom")]=P.toString;P[Symbol.toStringTag]="Decimal";var Decimal=P.constructor=clone(DEFAULTS);LN10=new Decimal(LN10);PI=new Decimal(PI);class SqlViewModel{constructor(){c(this,"SvcId","");c(this,"ComId","");c(this,"Action","");c(this,"Params","");c(this,"Ids",[]);c(this,"AnnonymousTenant",Client.Tenant);c(this,"AnnonymousEnv",Client.Env);c(this,"Paging","");c(this,"Select","");c(this,"Where","");c(this,"OrderBy","");c(this,"GroupBy","");c(this,"Having","");c(this,"Count",!1);c(this,"FieldName",[]);c(this,"SkipXQuery",!1);c(this,"Skip",0);c(this,"Top",0);c(this,"MetaConn",Client.MetaConn);c(this,"DataConn",Client.DataConn);c(this,"Table","");c(this,"WrapQuery",!0)}}class BadGatewayQueue{constructor(){this._queue=[]}Enqueue(i){!i.NoQueue&&i.Method!=="GET"&&(i.Retry=!0,this._queue.push(i))}Dequeue(){return this._queue.shift()}Peek(){return this._queue[0]}get Count(){return this._queue.length}}class Token{constructor(){c(this,"UserId",null);c(this,"CostCenterId",null);c(this,"UserName",null);c(this,"Email",null);c(this,"FirstName",null);c(this,"LastName",null);c(this,"FullName",null);c(this,"Address",null);c(this,"Avatar",null);c(this,"AccessToken",null);c(this,"RefreshToken",null);c(this,"AccessTokenExp",null);c(this,"RefreshTokenExp",null);c(this,"HashPassword",null);c(this,"Recovery",null);c(this,"Vendor",null);c(this,"RoleIds",[]);c(this,"RoleNames",[]);c(this,"CenterIds",[]);c(this,"Ssn",null);c(this,"PhoneNumber",null);c(this,"TeamId",null);c(this,"PartnerId",null);c(this,"RegionId",null);c(this,"Additional",null);c(this,"SigninDate",new Date);c(this,"TenantCode",null);c(this,"Env",null);c(this,"ConnKey",null);c(this,"SystemRole",!1);this.TenantCode=Client.Tenant,this.Env=Client.Env,this.ConnKey=Client.MetaConn}static parse(i){var t=i.split(".")[1],e=t.replace(/-/g,"+").replace(/_/g,"/"),n=decodeURIComponent(window.atob(e).split("").map(function(r){return"%"+("00"+r.charCodeAt(0).toString(16)).slice(-2)}).join(""));const s=JSON.parse(n),a=new Token;return a.CopyPropFrom(s),a}}class PatchDetail{constructor(){c(this,"Field","");c(this,"Label","");c(this,"OldVal","");c(this,"Value","");c(this,"HistoryValue","")}}class PatchVM{constructor(){c(this,"FeatureId");c(this,"ComId");c(this,"Table");c(this,"DeletedIds");c(this,"QueueName");c(this,"CacheName");c(this,"MetaConn");c(this,"DataConn");c(this,"Changes",[])}get EntityId(){const i=this.Changes.find(t=>t.Field===Utils.IdField);return i?i.Value:null}set OldId(i){let t=this.Changes.find(e=>e.Field===Utils.IdField);t?t.OldVal=i:this.Changes.push(new PatchDetail(Utils.IdField,"",i,"",""))}}class Toast{static Create(i){const t=document.createElement("div");t.className=`toast ${i.ClassName}`,t.innerHTML=i.Message;var e=document.createElement("i");e.className=i.Icon,t.appendChild(e),document.body.appendChild(t),setTimeout(()=>{t.remove()},i.Timeout)}static Success(i,t=2500,...e){Toast.Create({ClassName:"success",Timeout:t,Icon:"fal fa-check",Message:i,Params:e})}static Warning(i,...t){Toast.Create({ClassName:"warning",Icon:"fal fa-exclamation-triangle",Timeout:2500,Message:i,Params:t})}static Error(i,...t){Toast.Create({ClassName:"error",Timeout:2500,Message:i,Params:t})}static Small(i,t=2500){Toast.Create({ClassName:"sm-tran",Timeout:t,Message:i})}}const Path={ImgExt:["tif","pjp","xbm","jxl","svgz","jpeg","ico","tiff","gif","svg","jfif","webp","png","bmp","pjpeg","avif","jpg"],IsImage(l){const i=this.GetExtension(l).toLowerCase().substring(1);return this.ImgExt.includes(i)},CombineHostAndPath(l,i){return this.ContainHost(i)?i:this.Combine(l,i)},ContainHost(l){return l.includes("http://")||l.includes("https://")},GetExtension(l){return l?l.substring(l.lastIndexOf(".")):""},GetFileName(l){if(!l)return"";const i=l.lastIndexOf("/");return i>=0?l.substring(i+1):l},GetFileNameWithoutExtension(l){if(!l)return"";const i=l.lastIndexOf("/"),t=l.lastIndexOf("."),e=i>=0?i+1:0;return l.substring(e,t)},Combine(...l){return l.length?l.filter(t=>t).map(t=>{const e=t[0]==="/"?1:0,n=t[t.length-1]==="/"?t.length-1:t.length;return t.substring(e,n)}).join("/"):""}};class Action{constructor(){c(this,"hasTrigger",!1);c(this,"handler",[])}add(i){this.handler.push(i)}Invoke(i){var t;this.hasTrigger=!0,(t=this.handler)==null||t.forEach(e=>e(i))}invoke(i){var t;this.hasTrigger=!0,(t=this.handler)==null||t.forEach(e=>e(i))}}var bt,Dt,xt,Mt,Lt,Ft,Pt,Nt,At,Et,ht;const S=class S{constructor(i,t="",e=!1){c(this,"_nameSpace");c(this,"_config");c(this,"CustomPrefix",(()=>{const i=Array.from(document.head.children).find(t=>t instanceof HTMLMetaElement&&t.name==="prefix");return i==null?void 0:i.content})());this._nameSpace=t,this._config=e,this._nameSpace&&this._nameSpace.charAt(this._nameSpace.length-1)!=="."&&(this._nameSpace+="."),this.EntityName=i}static get Origin(){var i;return((i=document.head.origin)==null?void 0:i.content)||window.location.origin}static get Instance(){return S._instance||(S._instance=new S),S._instance}static get Token(){const i=Y(this,Et);return i||JSON.parse(localStorage.getItem("UserInfo"))}static set Token(i){X(this,Et,i),localStorage.setItem("UserInfo",JSON.stringify(i))}static get SystemRole(){var i;return Y(S,ht)==null&&X(S,ht,(i=Token.parse(S.Token.AccessToken))==null?void 0:i.SystemRole),Y(S,ht)}async UserSvc(i,t=!1){const e={Value:JSON.stringify(i),Url:Utils$1.UserSvc,IsRawString:!0,Method:"POST",AllowAnonymous:t};return this.SubmitAsync(e)}async ComQuery(i){const t={Value:JSON.stringify(i),Url:Utils$1.ComQuery,IsRawString:!0,Method:"POST"};return this.SubmitAsync(t)}GetIds(i){let t,e;const n=new Promise((a,r)=>{t=a,e=r});i.Select="ds.Id",i.Count=!1,i.SkipXQuery=!0;const s={Url:Utils$1.ComQuery,Value:JSON.stringify(i),IsRawString:!0,Method:"POST"};return this.SubmitAsync(s).then(a=>{var o;const r=a.length===0||a[0].length===0?[]:(o=a[0])==null?void 0:o.map(h=>h.Id);t(r)}).catch(e),n}async SubmitAsyncWithToken(i){const t=i.FormData===void 0;return new Promise((n,s)=>{var r;const a=new XMLHttpRequest;!i.Headers&&i.FormData===void 0&&(i.Headers={"Content-Type":"application/json"}),a.onreadystatechange=function(){a.readyState===XMLHttpRequest.DONE&&(a.status>=200&&a.status<300?ProcessSuccessRequest(i,n,a):ErrorHandler(i,s,a))},i.ProgressHandler!==void 0&&a.addEventListener("progress",i.ProgressHandler),a.open(i.Method,S.api+(i.FinalUrl??i.Url),!0),i.AllowAnonymous||a.setRequestHeader("Authorization","Bearer "+((r=S.Token)==null?void 0:r.AccessToken));for(const[o,h]of Object.entries(i.Headers))a.setRequestHeader(o,h);t?a.send(i.JsonData):a.send(i.FormData)})}async SubmitAsync(i){return i.AllowAnonymous||await S.RefreshToken(),await this.SubmitAsyncWithToken(i)}async FirstOrDefaultAsync(i=null,t=!1,e=!1){var a;const n=ClearCacheHeader(t),s=await this.SubmitAsync({Value:null,AddTenant:e,Url:i,Headers:n,Method:"GET"});return(a=s==null?void 0:s.Value)==null?void 0:a[0]}async GetByIdAsync(i,t){const e={JsonData:JSON.stringify({Table:i,Id:t}),Url:Utils$1.ComQuery,IsRawString:!0,Method:"POST"};return this.SubmitAsync(e)}async PostAsync(i,t="",e=!1){const n={Value:i,Url:t,Method:"POST",AllowAnonymous:e};return this.SubmitAsync(n)}async PatchAsync(i,t=null,e=!1){const n={JsonData:JSON.stringify(i),IsRawString:!0,Url:Utils$1.PatchSvc,Headers:{"Content-type":"application/json"},Method:"PATCH",AllowAnonymous:e,ErrorHandler:t};return this.SubmitAsync(n)}async PostFilesAsync(i,t="",e=null){const n=new FormData;n.append("file",i);const s={FormData:n,File:i,ProgressHandler:e,Method:"POST",Url:t};return this.SubmitAsync(s)}async SendMail(i){return this.SubmitAsync({Value:i,Method:"POST",Url:"Email"})}async DeactivateAsync(i,t,e){const n={Ids:i,Params:t,MetaConn:S.MetaConn,DataConn:e||S.DataConn};return this.SubmitAsync({Url:Utils$1.DeactivateSvc,Value:JSON.stringify(n),Method:"DELETE",IsRawString:!0,Headers:{"Content-type":"application/json"}})}async HardDeleteAsync(i,t,e,n=null){const s={Table:t,DeletedIds:i,DataConn:e||S.DataConn,MetaConn:n||S.MetaConn};return this.SubmitAsync({Url:Utils$1.DeleteSvc,JsonData:JSON.stringify(s),Method:"DELETE",IsRawString:!0,Headers:{"Content-type":"application/json"}})}static async LoadScript(i){return Array.from(document.body.children).some(n=>n instanceof HTMLScriptElement&&n.src.split("/").pop()===i.split("/").pop())?!0:new Promise(n=>{const s=document.createElement("script");s.src=i,s.addEventListener("load",()=>{n(!0)}),s.onerror=()=>(n(!0),!1),document.body.appendChild(s)})}static async LoadLink(i){return Array.from(document.head.children).some(n=>n instanceof HTMLLinkElement&&n.href.replace(document.location.origin,"")===i)?!0:new Promise(n=>{const s=document.createElement("link");s.href=i,s.addEventListener("load",()=>{n(!0)}),s.onerror=()=>(n(!0),!1),document.head.appendChild(s)})}static async RefreshToken(i=null){const t=S.Token;if(!t||new Date(t.RefreshTokenExp)<=S.EpsilonNow)return null;if(new Date(t.AccessTokenExp)>S.EpsilonNow)return t;if(new Date(t.AccessTokenExp)<=S.EpsilonNow&&new Date(t.RefreshTokenExp)>S.EpsilonNow){const e=await S.GetToken(t);return e&&(S.Token=e,i==null||i(e)),e}}static async GetToken(i){return await S.Instance.SubmitAsync({NoQueue:!0,Url:`/api/auth/refreshToken?t=${S.Token.TenantCode||S.Tenant}`,Method:"POST",JsonData:JSON.stringify({RefreshToken:i.RefreshToken}),AllowAnonymous:!0,ErrorHandler:e=>{e.status===400&&(S.Token=null,Toast.Warning("Phiên truy cập đã hết hạn! Vui lòng chờ trong giây lát, hệ thống đang tải lại trang"))}})}static RemoveGuid(i){let e=i;if(i.length>36){const n=Utils$1.GetFileNameWithoutExtension(i);e=n.substring(0,n.length-36)+"."+i.split(".").pop()}return e}static Download(i){const t=this.RemoveGuid(i),e=document.createElement("a");e.href=i.includes("http")?i:Path.Combine(S.Origin,i),e.target="_blank",e.setAttribute("download",t),document.body.appendChild(e),e.click(),document.body.removeChild(e)}};Et=new WeakMap,ht=new WeakMap,c(S,"Entities",[]),c(S,"EpsilonNow",new Date(Date.now()+1*60*1e3)),c(S,"ErrorMessage","Hệ thống đang cập nhật vui lòng chờ trong 30s!"),c(S,"ModelNamespace"),c(S,"entities"),c(S,"token"),c(S,"GuidLength",36),c(S,"Host",(((bt=document.head.host)==null?void 0:bt.content)||window.location.host).toLowerCase()),c(S,"BaseUri",(((Dt=document.head.baseUri)==null?void 0:Dt.content)||window.location.origin).toLowerCase()),c(S,"IsPortal",((xt=document.head.startup)==null?void 0:xt.content)!=="admin"),c(S,"MetaConn",((Mt=document.head.metaKey)==null?void 0:Mt.content)||"default"),c(S,"DataConn",((Lt=document.head.dataConn)==null?void 0:Lt.content)||"bl"),c(S,"Tenant",((Ft=document.head.tenant)==null?void 0:Ft.content)||"System"),c(S,"Env",((Pt=document.head.env)==null?void 0:Pt.content)||"test"),c(S,"FileFTP",((Nt=document.head.file)==null?void 0:Nt.content)||"/user"),c(S,"api",(()=>{const i=Array.from(document.head.childNodes).find(t=>t.name==="api");return i?i.content:"http://localhost:8005"})()),c(S,"Config",((At=document.head.config)==null?void 0:At.content)||""),c(S,"BadGatewayRequest",new BadGatewayQueue),c(S,"UnAuthorizedEventHandler",new Action),c(S,"SignOutEventHandler",new Action),c(S,"_instance"),tt(S,Et),tt(S,ht);let Client=S;function ProcessSuccessRequest(l,i,t){if(l.Retry){i(!0);return}if(!t.responseText){i(null);return}if(l.CustomParser){i(l.CustomParser(t.response));return}const e=typeof l.Value;if(e==="number")i(Number(t.responseText));else if(e==="string")i(t.responseText);else if(e==="object"){const n=JSON.parse(t.responseText);i(n)}else try{const n=JSON.parse(t.responseText);i(n)}catch{i(t.responseText)}}function ErrorHandler(l,i,t){var n;if(l.Retry){i(!1);return}let e;try{e=JSON.parse(t.responseText),e.StatusCode=t.status}catch{e={Message:"Đã có lỗi xảy ra trong quá trình xử lý",StackTrace:t.responseText}}if(l.ErrorHandler){l.ErrorHandler(t),i(new Error(e.Message));return}t.status>=400&&t.status<500?e&&e.Message&&l.ShowError&&console.warn(e.Message):t.status===500||t.status===404?console.warn(e):t.status===401?(n=Client.UnAuthorizedEventHandler)==null||n.call(Client,l):t.status>=502||t.status===504||t.status===503?(l.ShowError&&console.warn("Lỗi kết nối tới máy chủ, vui lòng chờ trong giây lát..."),l.Retry||Client.BadGatewayRequest.Enqueue(l)):t.responseText&&console.warn(t.responseText),i(new Error(e.Message))}function ClearCacheHeader(l){const i={};return l&&(i.Pragma="no-cache",i.Expires="0",i["Last-Modified"]=new Date().toString(),i["If-Modified-Since"]=new Date().toString(),i["Cache-Control"]="no-store, no-cache, must-revalidate, post-check=0, pre-check=0"),i}var v;let Utils$1=(v=class{static get HeadChildren(){return document.head.children}static EncodeSpecialChar(i){return i?i.split("").map(t=>v.SpecialChar[t]||t).join(""):null}static DecodeSpecialChar(i){return!i||i==null||i===null?null:i.replaceAll("%2B","+").replaceAll("%2F","/").replaceAll("%3F","?").replaceAll("%23","#").replaceAll("%26","&")}static GenerateRandomToken(i=32){let t="";const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=e.length;for(let s=0;s<i;s++)t+=e.charAt(Math.floor(Math.random()*n));return t}static ToJson(i){return JSON.stringify(i)}static Clone(i){return JSON.parse(JSON.stringify(i))}static TryParseInt(i){const t=parseInt(i,10);return isNaN(t)?null:t}static TryParseDecimal(i){try{return[!0,new Decimal(i)]}catch{return[!1,null]}}static Parse(i){try{return JSON.parse(i)}catch{return null}}static TryParse(i){try{return JSON.parse(i)}catch{return null}}static ChangeType(i,t){switch(t){case"int":case"number":return v.TryParseInt(i);case"decimal":return v.TryParseDecimal(i);case"boolean":return i==="true";default:return i}}static EncodeProperties(i){return!i||typeof i!="object"||Object.keys(i).forEach(t=>{typeof i[t]=="string"&&(i[t]=v.EncodeSpecialChar(i[t]))}),i}static DecodeProperties(i){return!i||typeof i!="object"||Object.keys(i).forEach(t=>{typeof i[t]=="string"&&(i[t]=v.DecodeSpecialChar(i[t]))}),i}static GetUrlParam(i=v.FeatureField,t=null){return new URLSearchParams(t||window.location.search).get(i)}static GetEntityById(i){return Client.Entities[i]}static GetEntity(i){return Object.values(Client.Entities).find(t=>t.Name===i)}static IsNullable(i,t){const e=v.GetPropValue(i,t);return!e||e==="object"}static GetComplexPropType(i,t){if(!i||!t||typeof t!="object")return null;const e=i.split(".");let n=t;for(const s of e){if(!n.hasOwnProperty(s))return null;n=n[s]}return typeof n}static GetPropValue(i,t){if(!i||!t||typeof i!="object")return null;const e=t.split(".");let n=i;for(const s of e){if(!n.hasOwnProperty(s))return null;n=n[s]}return n}static FormatEntity(i,t){if(i===null)return null;if(t===null)return i;let e=[],n=0,s=!1,a=!1,r=[],o=[];for(let h=0;h<i.length;h++){const d=i[h];switch(d){case"{":s=!0,a=!0,e.push(d+n.toString());break;case":":s&&!a?e.push(d):s?(a=!1,e.push(d),this.GetValues(t,r,o),r=[]):e.push(d);break;case"}":s&&(s=!1,e.push(d),n++,this.GetValues(t,r,o),r=[]);break;default:s&&a?r.push(d):e.push(d);break}}return this.Format(e.join(""),o)}static Format(i,...t){return i.replace(/{(\d+)}/g,(e,n)=>typeof t[n]<"u"?t[n]:e)}static GetValues(i,t,e=[]){if(!(t==null||t==="")){var n=i[t.join("")];e.push(n)}}static SetPropValue(i,t,e){!t||t.trim()===""||i&&typeof i=="object"&&(i[t]=e)}static GetCellText(i,t,e,n=!1,s=null){return this.DecodeSpecialChar(this.GetCellTextInternal(i,t,e,n,s))}static GetCellTextInternal(i,t,e,n=!1,s=null){let a="";if(n||t!==null&&i.FieldName===this.IdField&&typeof t=="number"&&t<=0)return"";if(t===null)return this.isNullOrWhiteSpace(i.FormatEntity)||(this.isFunction(i.FormatEntity)?a=getFunction(i.FormatEntity).call(e,e,s).toString():a=this.GetFormattedRow(i.FormatEntity,e)),a;switch(i.ComponentType){case"Datepicker":let r=new Date,o=Date.parse(t.toString());a=formatDate(o?new Date(t):r,i.FormatData||"dd/MM/yyyy");break;case"Dropdown":case"Select2":try{let m=i.FieldName;i.FieldName.substr(i.FieldName.length-2)===this.IdField&&(m=i.FieldName.substr(0,i.FieldName.length-2));let p=e[m];if(p===null||typeof p=="number"){let E=i.LocalData;p=E&&E.find(I=>compareIdField(I,t))}p===null||this.isNullOrWhiteSpace(i.FormatData)?a="":a=this.FormatEntity(i.FormatData,p)}catch{console.log(`Format of ${i.FieldName} is null`),a=""}break;case"MultipleSearchEntry":let h=i.LocalData;a=t.split(",").map(m=>parseInt(m,10)).filter(m=>m!==0).map(m=>{let f=h&&h.find(p=>this.compareIdField(p,m));return f===null||this.isNullOrWhiteSpace(i.FormatData)?"":this.FormatEntity(i.FormatData,null,f,EmptyFormat,EmptyFormat)}).join("");break;default:a=(t==null?void 0:t.toString())??"",this.isNullOrWhiteSpace(i.FormatData)||(a=this.formatString(i.FormatData,a)),this.isNullOrWhiteSpace(i.FormatEntity)||(this.IsFunction(i.FormatEntity)?a=this.getFunction(i.FormatEntity).call(e,e,s).toString():a=this.GetFormattedRow(i.FormatEntity,e)),i.ComponentType==="Number"&&i.UpperCase&&(a=a.replace(/,/g," "));break}return a}static isNullOrWhiteSpace(i){return!i||i.trim()===""||i.trim()===null}static isFunction(i){return typeof window[i]=="function"}static getFunction(i){return window[i]}static getFormattedRow(i,t){return""}static formatDate(i,t){return""}static getPropValue(i,t){return i[t]}static formatString(i,t){return i.replace("{0}",t)}static GetHtmlCode(i,t,e=v.NullFormatHandler,n=v.NotFoundHandler){if(!i)return null;const s=[];let a=0,r=!1,o="",h="";for(let d=0;d<i.length;d++){const u=i[d];switch(u){case"$":i[d+1]==="{"?(r=!0,h+="{"+a.toString()):r?o+=u:h+=u;break;case"}":r?(r=!1,h+=u,a++,v.GetValues(t[0],e,n,o,s),o=""):h+=u;break;default:if(r&&u==="{")break;r?o+=u:h+=u;break}}return h}static GetFormattedRow(i,t){var n;return v.IsFunction(i)?(n=i(t,t))==null?void 0:n.toString():v.FormatEntity2(i,null,t,v.EmptyFormat,v.EmptyFormat)}static ForEachProp(i,t){if(!i||typeof i!="object"||typeof t!="function")return;Object.keys(i).forEach(n=>t(n,i[n]))}static LastDayOfMonth(i=null){const t=i?new Date(i):new Date,e=t.getFullYear(),n=t.getMonth()+1;return new Date(e,n,0)}static IsFunction(i,t=!1,e){if(t=i&&!i.includes("return"),!i||i==null||i=="")return null;if(i instanceof Function)return i;try{var n=new Function(t?"return "+i:i);return n.call(e)}catch{return null}}static GetFileNameWithoutExtension(i){if(!i)return"";var t=i.lastIndexOf("/");t<0&&(t=0);var e=i.lastIndexOf(".");return i.substring(t+1|0,(e-1|0)-(t>=0?t:0)|0)}static IsImage(i){const t=["png","jpg","jpeg","gif","bmp"],e=s=>{const a=s.lastIndexOf(".")+1;return s.slice(a+1)};return t.includes(e(i).toLowerCase())}static GetExtension(i){return i?i.substring(i.lastIndexOf(".")):""}static IsOwner(i,t=!0){var p,E,I;const e="Id",n="OwnerUserIds",s="OwnerRoleIds",a="InsertedBy",r=",";if(!i||i[e]!==null||!Client.Token)return t;const o=(p=i[n])==null?void 0:p.toString(),h=(o==null?void 0:o.trim())!==""&&o.split(r).includes(Client.Token.UserId),d=(E=i[s])==null?void 0:E.toString(),u=(d==null?void 0:d.trim())!==""&&d.split(r).some(T=>Client.Token.RoleIds.includes(T)),m=(I=i[a])==null?void 0:I.toString();return!o&&m===Client.Token.UserId||u||h}static CastProp(i,t){if(i==null)return null;const e=new t;return this.CopyPropsFrom(i,e),e}static CopyPropsFrom(i,t){for(let e in i)i.hasOwnProperty(e)&&(t[e]=i[e])}static As(i,t){return i instanceof t?i:null}static UploadBase64Image(i,t){const e={Value:i,Url:`/user/image/?name=${t}`,IsRawString:!0,Method:HttpMethod.POST};return Client.Instance.SubmitAsync(e)}static GetMimeType(i){if(i===null)throw new Error("extension cannot be null");switch(i.startsWith(".")&&(i=i.substring(1)),i=i.toLowerCase(),i){case"323":return"text/h323";case"3g2":return"video/3gpp2";case"3gp":return"video/3gpp";case"3gp2":return"video/3gpp2";case"3gpp":return"video/3gpp";case"7z":return"application/x-7z-compressed";case"aa":return"audio/audible";case"aac":return"audio/aac";case"aaf":return"application/octet-stream";case"aax":return"audio/vnd.audible.aax";case"ac3":return"audio/ac3";case"aca":return"application/octet-stream";case"accda":return"application/msaccess.addin";case"accdb":return"application/msaccess";case"accdc":return"application/msaccess.cab";case"accde":return"application/msaccess";case"accdr":return"application/msaccess.runtime";case"accdt":return"application/msaccess";case"accdw":return"application/msaccess.webapplication";case"accft":return"application/msaccess.ftemplate";case"acx":return"application/internet-property-stream";case"addin":return"text/xml";case"ade":return"application/msaccess";case"adobebridge":return"application/x-bridge-url";case"adp":return"application/msaccess";case"adt":return"audio/vnd.dlna.adts";case"adts":return"audio/aac";case"afm":return"application/octet-stream";case"ai":return"application/postscript";case"aif":return"audio/x-aiff";case"aifc":return"audio/aiff";case"aiff":return"audio/aiff";case"air":return"application/vnd.adobe.air-application-installer-package+zip";case"amc":return"application/x-mpeg";case"application":return"application/x-ms-application";case"art":return"image/x-jg";case"asa":return"application/xml";case"asax":return"application/xml";case"ascx":return"application/xml";case"asd":return"application/octet-stream";case"asf":return"video/x-ms-asf";case"ashx":return"application/xml";case"asi":return"application/octet-stream";case"asm":return"text/plain";case"asmx":return"application/xml";case"aspx":return"application/xml";case"asr":return"video/x-ms-asf";case"asx":return"video/x-ms-asf";case"atom":return"application/atom+xml";case"au":return"audio/basic";case"avi":return"video/x-msvideo";case"axs":return"application/olescript";case"bas":return"text/plain";case"bcpio":return"application/x-bcpio";case"bin":return"application/octet-stream";case"bmp":return"image/bmp";case"c":return"text/plain";case"cab":return"application/octet-stream";case"caf":return"audio/x-caf";case"calx":return"application/vnd.ms-office.calx";case"cat":return"application/vnd.ms-pki.seccat";case"cc":return"text/plain";case"cd":return"text/plain";case"cdda":return"audio/aiff";case"cdf":return"application/x-cdf";case"cer":return"application/x-x509-ca-cert";case"chm":return"application/octet-stream";case"class":return"application/x-java-applet";case"clp":return"application/x-msclip";case"cmx":return"image/x-cmx";case"cnf":return"text/plain";case"cod":return"image/cis-cod";case"config":return"application/xml";case"contact":return"text/x-ms-contact";case"coverage":return"application/xml";case"cpio":return"application/x-cpio";case"cpp":return"text/plain";case"crd":return"application/x-mscardfile";case"crl":return"application/pkix-crl";case"crt":return"application/x-x509-ca-cert";case"cs":return"text/plain";case"csdproj":return"text/plain";case"csh":return"application/x-csh";case"csproj":return"text/plain";case"css":return"text/css";case"csv":return"text/csv";case"cur":return"application/octet-stream";case"cxx":return"text/plain";case"dat":return"application/octet-stream";case"DataSourceFilter":return"application/xml";case"dbproj":return"text/plain";case"dcr":return"application/x-director";case"def":return"text/plain";case"deploy":return"application/octet-stream";case"der":return"application/x-x509-ca-cert";case"dgml":return"application/xml";case"dib":return"image/bmp";case"dif":return"video/x-dv";case"dir":return"application/x-director";case"disco":return"text/xml";case"dll":return"application/x-msdownload";case"dll.config":return"text/xml";case"dlm":return"text/dlm";case"doc":return"application/msword";case"docm":return"application/vnd.ms-word.document.macroenabled.12";case"docx":return"application/vnd.openxmlformats-officedocument.wordprocessingml.document";case"dot":return"application/msword";case"dotm":return"application/vnd.ms-word.template.macroenabled.12";case"dotx":return"application/vnd.openxmlformats-officedocument.wordprocessingml.template";case"dsp":return"application/octet-stream";case"dsw":return"text/plain";case"dtd":return"text/xml";case"dtsconfig":return"text/xml";case"dv":return"video/x-dv";case"dvi":return"application/x-dvi";case"dwf":return"drawing/x-dwf";case"dwp":return"application/octet-stream";case"dxr":return"application/x-director";case"eml":return"message/rfc822";case"emz":return"application/octet-stream";case"eot":return"application/octet-stream";case"eps":return"application/postscript";case"etl":return"application/etl";case"etx":return"text/x-setext";case"evy":return"application/envoy";case"exe":return"application/octet-stream";case"exe.config":return"text/xml";case"fdf":return"application/vnd.fdf";case"fif":return"application/fractals";case"filters":return"application/xml";case"fla":return"application/octet-stream";case"flr":return"x-world/x-vrml";case"flv":return"video/x-flv";case"fsscript":return"application/fsharp-script";case"fsx":return"application/fsharp-script";case"generictest":return"application/xml";case"gif":return"image/gif";case"group":return"text/x-ms-group";case"gsm":return"audio/x-gsm";case"gtar":return"application/x-gtar";case"gz":return"application/x-gzip";case"h":return"text/plain";case"hdf":return"application/x-hdf";case"hdml":return"text/x-hdml";case"hhc":return"application/x-oleobject";case"hhk":return"application/octet-stream";case"hhp":return"application/octet-stream";case"hlp":return"application/winhlp";case"hpp":return"text/plain";case"hqx":return"application/mac-binhex40";case"hta":return"application/hta";case"htc":return"text/x-component";case"htm":return"text/html";case"html":return"text/html";case"htt":return"text/webviewhtml";case"hxa":return"application/xml";case"hxc":return"application/xml";case"hxd":return"application/octet-stream";case"hxe":return"application/xml";case"hxf":return"application/xml";case"hxh":return"application/octet-stream";case"hxi":return"application/octet-stream";case"hxk":return"application/xml";case"hxq":return"application/octet-stream";case"hxr":return"application/octet-stream";case"hxs":return"application/octet-stream";case"hxt":return"text/html";case"hxv":return"application/xml";case"hxw":return"application/octet-stream";case"hxx":return"text/plain";case"i":return"text/plain";case"ico":return"image/x-icon";case"ics":return"application/octet-stream";case"idl":return"text/plain";case"ief":return"image/ief";case"iii":return"application/x-iphone";case"inc":return"text/plain";case"inf":return"application/octet-stream";case"inl":return"text/plain";case"ins":return"application/x-internet-signup";case"ipa":return"application/x-itunes-ipa";case"ipg":return"application/x-itunes-ipg";case"ipproj":return"text/plain";case"ipsw":return"application/x-itunes-ipsw";case"iqy":return"text/x-ms-iqy";case"isp":return"application/x-internet-signup";case"ite":return"application/x-itunes-ite";case"itlp":return"application/x-itunes-itlp";case"itms":return"application/x-itunes-itms";case"itpc":return"application/x-itunes-itpc";case"ivf":return"video/x-ivf";case"jar":return"application/java-archive";case"java":return"application/octet-stream";case"jck":return"application/liquidmotion";case"jcz":return"application/liquidmotion";case"jfif":return"image/pjpeg";case"jnlp":return"application/x-java-jnlp-file";case"jpb":return"application/octet-stream";case"jpe":return"image/jpeg";case"jpeg":return"image/jpeg";case"jpg":return"image/jpeg";case"js":return"application/x-javascript";case"jsx":return"text/jscript";case"jsxbin":return"text/plain";case"latex":return"application/x-latex";case"library-ms":return"application/windows-library+xml";case"lit":return"application/x-ms-reader";case"loadtest":return"application/xml";case"lpk":return"application/octet-stream";case"lsf":return"video/x-la-asf";case"lst":return"text/plain";case"lsx":return"video/x-la-asf";case"lzh":return"application/octet-stream";case"m13":return"application/x-msmediaview";case"m14":return"application/x-msmediaview";case"m1v":return"video/mpeg";case"m2t":return"video/vnd.dlna.mpeg-tts";case"m2ts":return"video/vnd.dlna.mpeg-tts";case"m2v":return"video/mpeg";case"m3u":return"audio/x-mpegurl";case"m3u8":return"audio/x-mpegurl";case"m4a":return"audio/m4a";case"m4b":return"audio/m4b";case"m4p":return"audio/m4p";case"m4r":return"audio/x-m4r";case"m4v":return"video/x-m4v";case"mac":return"image/x-macpaint";case"mak":return"text/plain";case"man":return"application/x-troff-man";case"manifest":return"application/x-ms-manifest";case"map":return"text/plain";case"master":return"application/xml";case"mda":return"application/msaccess";case"mdb":return"application/x-msaccess";case"mde":return"application/msaccess";case"mdp":return"application/octet-stream";case"me":return"application/x-troff-me";case"mfp":return"application/x-shockwave-flash";case"mht":return"message/rfc822";case"mhtml":return"message/rfc822";case"mid":return"audio/mid";case"midi":return"audio/mid";case"mix":return"application/octet-stream";case"mk":return"text/plain";case"mmf":return"application/x-smaf";case"mno":return"text/xml";case"mny":return"application/x-msmoney";case"mod":return"video/mpeg";case"mov":return"video/quicktime";case"movie":return"video/x-sgi-movie";case"mp2":return"video/mpeg";case"mp2v":return"video/mpeg";case"mp3":return"audio/mpeg";case"mp4":return"video/mp4";case"mp4v":return"video/mp4";case"mpa":return"video/mpeg";case"mpe":return"video/mpeg";case"mpeg":return"video/mpeg";case"mpf":return"application/vnd.ms-mediapackage";case"mpg":return"video/mpeg";case"mpp":return"application/vnd.ms-project";case"mpv2":return"video/mpeg";case"mqv":return"video/quicktime";case"ms":return"application/x-troff-ms";case"msi":return"application/octet-stream";case"mso":return"application/octet-stream";case"mts":return"video/vnd.dlna.mpeg-tts";case"mtx":return"application/xml";case"mvb":return"application/x-msmediaview";case"mvc":return"application/x-miva-compiled";case"mxp":return"application/x-mmxp";case"nc":return"application/x-netcdf";case"nsc":return"video/x-ms-asf";case"nws":return"message/rfc822";case"ocx":return"application/octet-stream";case"oda":return"application/oda";case"odc":return"text/x-ms-odc";case"odh":return"text/plain";case"odl":return"text/plain";case"odp":return"application/vnd.oasis.opendocument.presentation";case"ods":return"application/oleobject";case"odt":return"application/vnd.oasis.opendocument.text";case"one":return"application/onenote";case"onea":return"application/onenote";case"onepkg":return"application/onenote";case"onetmp":return"application/onenote";case"onetoc":return"application/onenote";case"onetoc2":return"application/onenote";case"orderedtest":return"application/xml";case"osdx":return"application/opensearchdescription+xml";case"p10":return"application/pkcs10";case"p12":return"application/x-pkcs12";case"p7b":return"application/x-pkcs7-certificates";case"p7c":return"application/pkcs7-mime";case"p7m":return"application/pkcs7-mime";case"p7r":return"application/x-pkcs7-certreqresp";case"p7s":return"application/pkcs7-signature";case"pbm":return"image/x-portable-bitmap";case"pcast":return"application/x-podcast";case"pct":return"image/pict";case"pcx":return"application/octet-stream";case"pcz":return"application/octet-stream";case"pdf":return"application/pdf";case"pfb":return"application/octet-stream";case"pfm":return"application/octet-stream";case"pfx":return"application/x-pkcs12";case"pgm":return"image/x-portable-graymap";case"pic":return"image/pict";case"pict":return"image/pict";case"pkgdef":return"text/plain";case"pkgundef":return"text/plain";case"pko":return"application/vnd.ms-pki.pko";case"pls":return"audio/scpls";case"pma":return"application/x-perfmon";case"pmc":return"application/x-perfmon";case"pml":return"application/x-perfmon";case"pmr":return"application/x-perfmon";case"pmw":return"application/x-perfmon";case"png":return"image/png";case"pnm":return"image/x-portable-anymap";case"pnt":return"image/x-macpaint";case"pntg":return"image/x-macpaint";case"pnz":return"image/png";case"pot":return"application/vnd.ms-powerpoint";case"potm":return"application/vnd.ms-powerpoint.template.macroenabled.12";case"potx":return"application/vnd.openxmlformats-officedocument.presentationml.template";case"ppa":return"application/vnd.ms-powerpoint";case"ppam":return"application/vnd.ms-powerpoint.addin.macroenabled.12";case"ppm":return"image/x-portable-pixmap";case"pps":return"application/vnd.ms-powerpoint";case"ppsm":return"application/vnd.ms-powerpoint.slideshow.macroenabled.12";case"ppsx":return"application/vnd.openxmlformats-officedocument.presentationml.slideshow";case"ppt":return"application/vnd.ms-powerpoint";case"pptm":return"application/vnd.ms-powerpoint.presentation.macroenabled.12";case"pptx":return"application/vnd.openxmlformats-officedocument.presentationml.presentation";case"prf":return"application/pics-rules";case"prm":return"application/octet-stream";case"prx":return"application/octet-stream";case"ps":return"application/postscript";case"psc1":return"application/powershell";case"psd":return"application/octet-stream";case"psess":return"application/xml";case"psm":return"application/octet-stream";case"psp":return"application/octet-stream";case"pub":return"application/x-mspublisher";case"pwz":return"application/vnd.ms-powerpoint";case"qht":return"text/x-html-insertion";case"qhtm":return"text/x-html-insertion";case"qt":return"video/quicktime";case"qti":return"image/x-quicktime";case"qtif":return"image/x-quicktime";case"qtl":return"application/x-quicktimeplayer";case"qxd":return"application/octet-stream";case"ra":return"audio/x-pn-realaudio";case"ram":return"audio/x-pn-realaudio";case"rar":return"application/octet-stream";case"ras":return"image/x-cmu-raster";case"rat":return"application/rat-file";case"rc":return"text/plain";case"rc2":return"text/plain";case"rct":return"text/plain";case"rdlc":return"application/xml";case"resx":return"application/xml";case"rf":return"image/vnd.rn-realflash";case"rgb":return"image/x-rgb";case"rgs":return"text/plain";case"rm":return"application/vnd.rn-realmedia";case"rmi":return"audio/mid";case"rmp":return"application/vnd.rn-rn_music_package";case"roff":return"application/x-troff";case"rpm":return"audio/x-pn-realaudio-plugin";case"rqy":return"text/x-ms-rqy";case"rtf":return"application/rtf";case"rtx":return"text/richtext";case"ruleset":return"application/xml";case"s":return"text/plain";case"safariextz":return"application/x-safari-safariextz";case"scd":return"application/x-msschedule";case"sct":return"text/scriptlet";case"sd2":return"audio/x-sd2";case"sdp":return"application/sdp";case"sea":return"application/octet-stream";case"searchconnector-ms":return"application/windows-search-connector+xml";case"setpay":return"application/set-payment-initiation";case"setreg":return"application/set-registration-initiation";case"settings":return"application/xml";case"sgimb":return"application/x-sgimb";case"sgml":return"text/sgml";case"sh":return"application/x-sh";case"shar":return"application/x-shar";case"shtml":return"text/html";case"sit":return"application/x-stuffit";case"sitemap":return"application/xml";case"skin":return"application/xml";case"sldm":return"application/vnd.ms-powerpoint.slide.macroenabled.12";case"sldx":return"application/vnd.openxmlformats-officedocument.presentationml.slide";case"slk":return"application/vnd.ms-excel";case"sln":return"text/plain";case"slupkg-ms":return"application/x-ms-license";case"smd":return"audio/x-smd";case"smi":return"application/octet-stream";case"smx":return"audio/x-smd";case"smz":return"audio/x-smd";case"snd":return"audio/basic";case"snippet":return"application/xml";case"snp":return"application/octet-stream";case"sol":return"text/plain";case"sor":return"text/plain";case"spc":return"application/x-pkcs7-certificates";case"spl":return"application/futuresplash";case"src":return"application/x-wais-source";case"srf":return"text/plain";case"ssisdeploymentmanifest":return"text/xml";case"ssm":return"application/streamingmedia";case"sst":return"application/vnd.ms-pki.certstore";case"stl":return"application/vnd.ms-pki.stl";case"sv4cpio":return"application/x-sv4cpio";case"sv4crc":return"application/x-sv4crc";case"svc":return"application/xml";case"swf":return"application/x-shockwave-flash";case"t":return"application/x-troff";case"tar":return"application/x-tar";case"tcl":return"application/x-tcl";case"testrunconfig":return"application/xml";case"testsettings":return"application/xml";case"tex":return"application/x-tex";case"texi":return"application/x-texinfo";case"texinfo":return"application/x-texinfo";case"tgz":return"application/x-compressed";case"thmx":return"application/vnd.ms-officetheme";case"thn":return"application/octet-stream";case"tif":return"image/tiff";case"tiff":return"image/tiff";case"tlh":return"text/plain";case"tli":return"text/plain";case"toc":return"application/octet-stream";case"tr":return"application/x-troff";case"trm":return"application/x-msterminal";case"trx":return"application/xml";case"ts":return"video/vnd.dlna.mpeg-tts";case"tsv":return"text/tab-separated-values";case"ttf":return"application/octet-stream";case"tts":return"video/vnd.dlna.mpeg-tts";case"txt":return"text/plain";case"u32":return"application/octet-stream";case"uls":return"text/iuls";case"user":return"text/plain";case"ustar":return"application/x-ustar";case"vb":return"text/plain";case"vbdproj":return"text/plain";case"vbk":return"video/mpeg";case"vbproj":return"text/plain";case"vbs":return"text/vbscript";case"vcf":return"text/x-vcard";case"vcproj":return"application/xml";case"vcs":return"text/plain";case"vcxproj":return"application/xml";case"vddproj":return"text/plain";case"vdp":return"text/plain";case"vdproj":return"text/plain";case"vdx":return"application/vnd.ms-visio.viewer";case"vml":return"text/xml";case"vscontent":return"application/xml";case"vsct":return"text/xml";case"vsd":return"application/vnd.visio";case"vsi":return"application/ms-vsi";case"vsix":return"application/vsix";case"vsixlangpack":return"text/xml";case"vsixmanifest":return"text/xml";case"vsmdi":return"application/xml";case"vspscc":return"text/plain";case"vss":return"application/vnd.visio";case"vsscc":return"text/plain";case"vssettings":return"text/xml";case"vssscc":return"text/plain";case"vst":return"application/vnd.visio";case"vstemplate":return"text/xml";case"vsto":return"application/x-ms-vsto";case"vsw":return"application/vnd.visio";case"vsx":return"application/vnd.visio";case"vtx":return"application/vnd.visio";case"wav":return"audio/wav";case"wave":return"audio/wav";case"wax":return"audio/x-ms-wax";case"wbk":return"application/msword";case"wbmp":return"image/vnd.wap.wbmp";case"wcm":return"application/vnd.ms-works";case"wdb":return"application/vnd.ms-works";case"wdp":return"image/vnd.ms-photo";case"webarchive":return"application/x-safari-webarchive";case"webtest":return"application/xml";case"wiq":return"application/xml";case"wiz":return"application/msword";case"wks":return"application/vnd.ms-works";case"wlmp":return"application/wlmoviemaker";case"wlpginstall":return"application/x-wlpg-detect";case"wlpginstall3":return"application/x-wlpg3-detect";case"wm":return"video/x-ms-wm";case"wma":return"audio/x-ms-wma";case"wmd":return"application/x-ms-wmd";case"wmf":return"application/x-msmetafile";case"wml":return"text/vnd.wap.wml";case"wmlc":return"application/vnd.wap.wmlc";case"wmls":return"text/vnd.wap.wmlscript";case"wmlsc":return"application/vnd.wap.wmlscriptc";case"wmp":return"video/x-ms-wmp";case"wmv":return"video/x-ms-wmv";case"wmx":return"video/x-ms-wmx";case"wmz":return"application/x-ms-wmz";case"wpl":return"application/vnd.ms-wpl";case"wps":return"application/vnd.ms-works";case"wri":return"application/x-mswrite";case"wrl":return"x-world/x-vrml";case"wrz":return"x-world/x-vrml";case"wsc":return"text/scriptlet";case"wsdl":return"text/xml";case"wvx":return"video/x-ms-wvx";case"x":return"application/directx";case"xaf":return"x-world/x-vrml";case"xaml":return"application/xaml+xml";case"xap":return"application/x-silverlight-app";case"xbap":return"application/x-ms-xbap";case"xbm":return"image/x-xbitmap";case"xdr":return"text/plain";case"xht":return"application/xhtml+xml";case"xhtml":return"application/xhtml+xml";case"xla":return"application/vnd.ms-excel";case"xlam":return"application/vnd.ms-excel.addin.macroenabled.12";case"xlc":return"application/vnd.ms-excel";case"xld":return"application/vnd.ms-excel";case"xlk":return"application/vnd.ms-excel";case"xll":return"application/vnd.ms-excel";case"xlm":return"application/vnd.ms-excel";case"xls":return"application/vnd.ms-excel";case"xlsb":return"application/vnd.ms-excel.sheet.binary.macroenabled.12";case"xlsm":return"application/vnd.ms-excel.sheet.macroenabled.12";case"xlsx":return"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet";case"xlt":return"application/vnd.ms-excel";case"xltm":return"application/vnd.ms-excel.template.macroenabled.12";case"xltx":return"application/vnd.openxmlformats-officedocument.spreadsheetml.template";case"xlw":return"application/vnd.ms-excel";case"xml":return"text/xml";case"xmta":return"application/xml";case"xof":return"x-world/x-vrml";case"xoml":return"text/plain";case"xpm":return"image/x-xpixmap";case"xps":return"application/vnd.ms-xpsdocument";case"xrm-ms":return"text/xml";case"xsc":return"application/xml";case"xsd":return"text/xml";case"xsf":return"text/xml";case"xsl":return"text/xml";case"xslt":return"text/xml";case"xsn":return"application/octet-stream";case"xss":return"application/xml";case"xtp":return"application/octet-stream";case"xwd":return"image/x-xwindowdump";case"z":return"application/x-compress";case"zip":return"application/x-zip-compressed";default:return"application/octet-stream"}}},c(v,"SystemId","1"),c(v,"TenantField","t"),c(v,"Pixel","px"),c(v,"FeatureField","f"),c(v,"QuestionMark","?"),c(v,"Amp","&"),c(v,"BreakLine","<br />"),c(v,"ApplicationJson","application/json"),c(v,"Authorization","Authorization"),c(v,"SelfVendorId","65"),c(v,"IdField","Id"),c(v,"NewLine",`\r
`),c(v,"Indent","	"),c(v,"Dot","."),c(v,"Slash","/"),c(v,"Hash","#"),c(v,"Comma",";"),c(v,"Semicolon",";"),c(v,"Space"," "),c(v,"ComponentId","20"),c(v,"ComponentGroupId","30"),c(v,"HistoryId","4199"),c(v,"InsertedBy","InsertedBy"),c(v,"OwnerUserIds","OwnerUserIds"),c(v,"OwnerRoleIds","OwnerRoleIds"),c(v,"ComQuery","/api/feature/go"),c(v,"PatchSvc","/api/feature/run"),c(v,"PatchesSvc","user/SavePatches"),c(v,"UserSvc","/user/svc"),c(v,"DeleteSvc","/api/feature/delete"),c(v,"DeactivateSvc","/user/Deactivate"),c(v,"ExportExcel","/user/excel"),c(v,"FileSvc","/user/file"),c(v,"Return","return "),c(v,"SpecialChar",{"+":"%2B","/":"%2F","?":"%3F","#":"%23","&":"%26"}),c(v,"ReverseSpecialChar",{"%2B":"+","%2F":"/","%3F":"?","%23":"#","%26":"&"}),c(v,"NullFormatHandler",i=>"null"),c(v,"NotFoundHandler",i=>"{"+i+"}"),c(v,"EmptyFormat",i=>""),v);class OutOfViewPort{constructor(){this.Top=!1,this.Left=!1,this.Right=!1,this.Bottom=!1,this.Any=!1,this.All=!1}}class Str{static Format(i,...t){return i.replace(/{(\d+)}/g,(e,n)=>typeof t[n]<"u"?t[n]:e)}static Join(i,...t){t.join(i)}}c(Str,"Empty",""),c(Str,"Comma",","),c(Str,"Type","string");function HasElement(){return this!=null&&this.length>0}Array.prototype.Nothing=function(){return this.length===0};Array.prototype.Flattern=function(l){if(this.Nothing())return this;var i=this.Select(t=>l(t)).Where(t=>t!=null).SelectMany(t=>t);return i.Nothing()?this:this.concat(i.Flattern(l))};Array.prototype.Any=function(l){if(!l)return this.length>0;for(let i=0;i<this.length;i++)if(l(this[i]))return!0};Array.prototype.Where=Array.prototype.filter;Array.prototype.SelectMany=Array.prototype.flatMap;Array.prototype.SelectForEach=Array.prototype.map;Array.prototype.Select=Array.prototype.map;Array.prototype.HasElement=HasElement;Array.prototype.ToArray=function(){return this};Array.prototype.Contains=function(l){return this.indexOf(l)!==-1};Array.prototype.Remove=function(l){var i=this.indexOf(l);i!==-1&&this.splice(i,1)};Array.prototype.ToDictionary=function(l,i){return i==null&&(i=t=>t),this.reduce((t,e)=>(t[l(e)]=i(e),t),{})};Array.prototype.FirstOrDefault=function(l=null){if(!l)return this.length>0?this[0]:null;for(let i=0;i<this.length;i++)if(l(this[i]))return this[i]};Array.prototype.GroupBy=function(l){const i=this.reduce((t,e)=>{const n=l(e),s=JSON.stringify(n);return t[s]||(t[s]=[],t[s].keyObj=n),t[s].push(e),t},{});return Object.keys(i).map(t=>{const e=i[t];return e.Key=i[t].keyObj,e})};Array.prototype.ForEach=Array.prototype.forEach;Array.prototype.DistinctBy=function(l){return this.GroupBy(l).FirstOrDefault()};Array.prototype.Distinct=function(){return this.GroupBy(l=>l).FirstOrDefault()};Array.prototype.ForEachAsync=async function(l){var i=this.map(l);return await Promise.all(i),this};Array.prototype.Clear=function(){for(;this.length;)this.pop()};Array.prototype.AddRange=Array.prototype.push;Array.prototype.Combine=function(l=null,i=","){return l?this.map(l).join(i):this.join(i)};Array.prototype.OrderBy=function(l,i,t=!0,e=!0){return this.slice().sort((n,s)=>{const a=l(n),r=l(s);if(a!=r)return a>r?t?1:-1:t?-1:1;const o=i(n),h=i(s);return o>h?e?1:-1:e?-1:1})};Array.prototype.All=Array.prototype.every;Array.prototype.IndexOf=Array.prototype.findIndex;Array.prototype.LastOrDefault=function(l=null){return l?this.findLast(l):this.length>0?this[this.length-1]:null};Promise.prototype.Done=Promise.prototype.then;Promise.prototype.done=Promise.prototype.then;Date.prototype.addSeconds=function(l){var i=new Date(this.valueOf());return i.setSeconds(i.getSeconds()+l),i};Date.prototype.addMinutes=function(l){var i=new Date(this.valueOf());return i.setMinutes(i.getMinutes()+l),i};Date.prototype.addHours=function(l){var i=new Date(this.valueOf());return i.setHours(i.getHours()+l),i};Date.prototype.addDays=function(l){var i=new Date(this.valueOf());return i.setDate(i.getDate()+l),i};Date.prototype.addMonths=function(l){var i=new Date(this.valueOf());return i.setMonth(i.getMonth()+l),i};Date.prototype.addYears=function(l){var i=new Date(this.valueOf());return i.setFullYear(i.getFullYear()+l),i};HTMLElement.prototype.HasClass=function(l){return this.classList.contains(l)};HTMLElement.prototype.ReplaceClass=function(l,i){this.classList.remove(l),this.classList.add(i)};Number.prototype.leadingDigit=function(){return this<10?"0"+this:""+this};Event.prototype.Top=function(){return this.clientY};Event.prototype.Left=function(){return parseFloat(this.clientX)};Event.prototype.KeyCode=function(){return this.keyCode??-1};Event.prototype.KeyCodeEnum=function(){return this.keyCode??-1};Event.prototype.ShiftKey=function(){return this.shiftKey};Event.prototype.CtrlOrMetaKey=function(){return this.ctrlKey||this.metaKey};Event.prototype.AltKey=function(){return this.altKey};Event.prototype.GetChecked=function(){return this.target&&this.target.type==="checkbox"?this.target.checked:!1};Event.prototype.GetInputText=function(){return this.target&&typeof this.target.value=="string"?this.target.value:""};HTMLElement.prototype.GetFullHeight=function(){if(!this)return 0;const l=window.getComputedStyle(this),i=parseFloat(l.marginTop)||0,t=parseFloat(l.marginBottom)||0;return this.scrollHeight+i+t};HTMLElement.prototype.AddClass=function(l){!this||!l||this.classList.add(l)};HTMLElement.prototype.RemoveClass=function(l){!this||!l||this.classList.remove(l)};HTMLElement.prototype.ToggleClass=function(l){!this||!l||this.classList.toggle(l)};HTMLElement.prototype.Show=function(){this&&(this.style.display="")};HTMLElement.prototype.GetComputedStyle=function(){return window.getComputedStyle(this)};HTMLElement.prototype.Hide=function(){this&&(this.style.display="none")};HTMLElement.prototype.Hidden=function(){if(!this)return!0;const l=this.getBoundingClientRect();return window.getComputedStyle(this).display==="none"||l.bottom===0&&l.top===0&&l.width===0&&l.height===0};HTMLElement.prototype.OutOfViewport=function(){const l=this.getBoundingClientRect(),i=new OutOfViewPort;return i.Top=l.top<0,i.Left=l.left<0,i.Bottom=l.bottom>window.innerHeight,i.Right=l.right>window.innerWidth,i.Any=i.Top||i.Left||i.Bottom||i.Right,i.All=i.Top&&i.Left&&i.Bottom&&i.Right,i};HTMLCollection.prototype.forEach=function(l){Array.from(this).forEach(l)};class ValidationRule{constructor(i,t,e,n,s,a){this.Rule=i,this.Message=t,this.Value1=e,this.Value2=n,this.Condition=s,this.RejectInvalid=a}}c(ValidationRule,"Required","required"),c(ValidationRule,"MinLength","minLength"),c(ValidationRule,"CheckLength","checkLength"),c(ValidationRule,"MaxLength","maxLength"),c(ValidationRule,"GreaterThanOrEqual","min"),c(ValidationRule,"LessThanOrEqual","max"),c(ValidationRule,"GreaterThan","gt"),c(ValidationRule,"LessThan","lt"),c(ValidationRule,"Equal","eq"),c(ValidationRule,"NotEqual","ne"),c(ValidationRule,"RegEx","regEx"),c(ValidationRule,"Unique","unique");class EventType{}c(EventType,"Abort","abort"),c(EventType,"AfterPrint","afterprint"),c(EventType,"AnimationEnd","animationend"),c(EventType,"AnimationIteration","animationiteration"),c(EventType,"AnimationStart","animationstart"),c(EventType,"BeforePrint","beforeprint"),c(EventType,"BeforeUnload","beforeunload"),c(EventType,"Blocked","blocked"),c(EventType,"Blur","blur"),c(EventType,"Cached","cached"),c(EventType,"CanPlay","canplay"),c(EventType,"CanPlayThrough","canplaythrough"),c(EventType,"Change","change"),c(EventType,"Checking","checking"),c(EventType,"Click","click"),c(EventType,"Close","close"),c(EventType,"Complete","complete"),c(EventType,"CompositionEnd","compositionend"),c(EventType,"CompositionStart","compositionstart"),c(EventType,"CompositionUpdate","compositionupdate"),c(EventType,"ContextMenu","contextmenu"),c(EventType,"Copy","copy"),c(EventType,"Cut","cut"),c(EventType,"DblClick","dblclick"),c(EventType,"DeviceLight","devicelight"),c(EventType,"DeviceMotion","devicemotion"),c(EventType,"DeviceOrientation","deviceorientation"),c(EventType,"DeviceProximity","deviceproximity"),c(EventType,"DischargingTimeChange","dischargingtimechange"),c(EventType,"DOMContentLoaded","domcontentloaded"),c(EventType,"Downloading","downloading"),c(EventType,"Drag","drag"),c(EventType,"DragEnd","dragend"),c(EventType,"DragEnter","dragenter"),c(EventType,"DragLeave","dragleave"),c(EventType,"DragOver","dragover"),c(EventType,"DragStart","dragstart"),c(EventType,"Drop","drop"),c(EventType,"DurationChange","durationchange"),c(EventType,"Emptied","emptied"),c(EventType,"Ended","ended"),c(EventType,"Error","error"),c(EventType,"Focus","focus"),c(EventType,"FocusIn","focusin"),c(EventType,"FocusOut","focusout"),c(EventType,"FullScreenChange","fullscreenchange"),c(EventType,"FullScreenError","fullscreenerror"),c(EventType,"GamepadConnected","gamepadconnected"),c(EventType,"GamepadDisconnected","gamepaddisconnected"),c(EventType,"HashChange","hashchange"),c(EventType,"Input","input"),c(EventType,"Invalid","invalid"),c(EventType,"KeyDown","keydown"),c(EventType,"KeyPress","keypress"),c(EventType,"KeyUp","keyup"),c(EventType,"LevelChange","levelchange"),c(EventType,"Load","load"),c(EventType,"LoadedData","loadeddata"),c(EventType,"LoadedMetaData","loadedmetadata"),c(EventType,"LoadEnd","loadend"),c(EventType,"LoadStart","loadstart"),c(EventType,"Message","message"),c(EventType,"MouseDown","mousedown"),c(EventType,"MouseEnter","mouseenter"),c(EventType,"MouseLeave","mouseleave"),c(EventType,"MouseMove","mousemove"),c(EventType,"MouseOut","mouseout"),c(EventType,"MouseOver","mouseover"),c(EventType,"MouseUp","mouseup"),c(EventType,"NoUpdate","noupdate"),c(EventType,"Obsolete","obsolete"),c(EventType,"Offline","offline"),c(EventType,"Online","online"),c(EventType,"Open","open"),c(EventType,"OrientationChange","orientationchange"),c(EventType,"PageHide","pagehide"),c(EventType,"PageShow","pageshow"),c(EventType,"Paste","paste"),c(EventType,"Pause","pause"),c(EventType,"PointerLockChange","pointerlockchange"),c(EventType,"PointerLockError","pointerlockerror"),c(EventType,"Play","play"),c(EventType,"Playing","playing"),c(EventType,"PopState","popstate"),c(EventType,"Progress","progress"),c(EventType,"RateChange","ratechange"),c(EventType,"ReadyStateChange","readystatechange"),c(EventType,"RepeatEvent","repeatevent"),c(EventType,"Reset","reset"),c(EventType,"Resize","resize"),c(EventType,"Scroll","scroll"),c(EventType,"Seeked","seeked"),c(EventType,"Seeking","seeking"),c(EventType,"Select","select"),c(EventType,"Show","show"),c(EventType,"Stalled","stalled"),c(EventType,"Storage","storage"),c(EventType,"Submit","submit"),c(EventType,"Success","success"),c(EventType,"Suspend","suspend"),c(EventType,"SVGAbort","svgabort"),c(EventType,"SVGError","svgerror"),c(EventType,"SVGLoad","svgload"),c(EventType,"SVGResize","svgresize"),c(EventType,"SVGScroll","svgscroll"),c(EventType,"SVGUnload","svgunload"),c(EventType,"SVGZoom","svgzoom"),c(EventType,"Timeout","timeout"),c(EventType,"TimeUpdate","timeupdate"),c(EventType,"TouchCancel","touchcancel"),c(EventType,"TouchEnd","touchend"),c(EventType,"TouchEnter","touchenter"),c(EventType,"TouchLeave","touchleave"),c(EventType,"TouchMove","touchmove"),c(EventType,"TouchStart","touchstart"),c(EventType,"TransitionEnd","transitionend"),c(EventType,"Unload","unload"),c(EventType,"UpdateReady","updateready"),c(EventType,"UpgradeNeeded","upgradeneeded"),c(EventType,"UserProximity","userproximity"),c(EventType,"VersionChange","versionchange"),c(EventType,"VisibilityChange","visibilitychange"),c(EventType,"VolumeChange","volumechange"),c(EventType,"Waiting","waiting"),c(EventType,"Wheel","wheel");class ComponentType{}c(ComponentType,"Datepicker","Datepicker"),c(ComponentType,"ListView","ListView"),c(ComponentType,"GridView","GridView"),c(ComponentType,"ListViewItem","ListViewItem"),c(ComponentType,"EditForm","EditForm"),c(ComponentType,"Checkbox","Checkbox"),c(ComponentType,"Numbox","Numbox"),c(ComponentType,"Number","Numbox"),c(ComponentType,"Textbox","Textbox"),c(ComponentType,"Textarea","Textarea"),c(ComponentType,"SearchEntry","SearchEntry"),c(ComponentType,"Section","Section"),c(ComponentType,"MultipleSearchEntry","MultipleSearchEntry");class Uuid7{static TimeNs(){return 100*new Date().getTime()}static NewGuid(){return"-"+this.Guid()}static Guid(i=null){let e;if(i===null)e=this.TimeNs();else{if(i===0)return"00000000-0000-0000-0000-000000000000";e=i}let n=BigInt(e),s=BigInt(n/16000000000n),a=n%16000000000n,r=BigInt(a*0x10000n/16000000000n),o;i!==null?(n===this._x&&s===this._y&&r===this._z?this._seq<16383&&(this._seq+=1):(this._seq=0,this._x=n,this._y=s,this._z=r),o=this._seq):(n===this._x_asOf&&s===this._y_asOf&&r===this._z_asOf?this._seq_asOf<16383&&(this._seq_asOf+=1):(this._seq_asOf=0,this._x_asOf=n,this._y_asOf=s,this._z_asOf=r),o=this._seq_asOf);let h=new Uint8Array(8);crypto.getRandomValues(h),h[0]=128|o>>8,h[1]=o&255;let d=new Uint8Array(16);return d.set(new Uint32Array([Number(n),Number(s),Number(r)])),d.set(h,8),[this._toHex(d[3],2),this._toHex(d[2],2),this._toHex(d[1],2),this._toHex(d[0],2),"-",this._toHex(d[5],2),this._toHex(d[4],2),"-",this._toHex(d[7],2),this._toHex(d[6],2),"-",this._toHex(d[8],2),this._toHex(d[9],2),"-",this._toHex(d[10],2),this._toHex(d[11],2),this._toHex(d[12],2),this._toHex(d[13],2),this._toHex(d[14],2),this._toHex(d[15],2)].join("")}static _toHex(i,t){return i.toString(16).padStart(t,"0")}static String(i=null){return this.Guid(i)}static Id25(i=null){let t=this.Guid(i);return this.Id25Internal(t)}static Id25Internal(i){const t="0123456789abcdefghijkmnopqrstuvwxyz";let e=new Array(25),n=new Uint8Array(i.length);for(let o=0;o<i.length;o++)n[o]=i.charCodeAt(o);let s=this.ArrToBigInt(n),a,r=BigInt(t.length);for(let o=24;o>=0;o--)[s,a]=[s/r,s%r],e[o]=t[Number(a)];return e.join("")}static ArrToBigInt(i){return i.reduce((t,e)=>t<<8n|BigInt(e),0n)}static CheckTimingPrecision(){let i=new Set,t=0,e=Date.now();for(;Date.now()-e<500&&t<1e3;)i.add(this.TimeNs()),t+=1;let n=i.size,s=1e6*(Date.now()-e)/n,a=1e6*(Date.now()-e)/t;return n===t?`Precision is ${s.toFixed(0)}ns with no repeats in ${t} loops taking ${Date.now()-e}ms`:`Precision is ${s.toFixed(0)}ns rather than ${a.toFixed(0)}ns (${n} unique timestamps from ${t} loops taking ${Date.now()-e}ms)`}}const N=class N{static get Culture(){if(N._culture!==void 0&&N._culture!==null)return N._culture.replace('"',"");const i=localStorage.getItem("Culture");return i!==null&&(N._culture=i.replace('"',"")),i!==null?i.replace('"',""):null}static set Culture(i){N._culture!==i&&(N._culture=i!==null?i.replace('"',""):null,localStorage.setItem("Culture",i!==null?i.replace('"',""):null))}static SetCultureAndTranslate(i){N.Culture=i,N.Translate()}static Get(i){if(i===null||i==="")return"";if(N.Culture===null)return i;const t=N._dictionaries[N.Culture];if(t==null){const e=localStorage.getItem(N.Culture);e!==null&&(N._dictionaries[N.Culture]=e)}return t!=null&&t[i]!==void 0?t[i]:i}static async Translate(i=!0){return new Promise((e,n)=>{const s=new SqlViewModel;s.DataConn=Client.MetaConn,s.MetaConn=Client.MetaConn,s.ComId="Dictionary",s.Action="GetAll",s.AnnonymousTenant=Client.Tenant,Client.Instance.UserSvc(s,i).Done(r=>{N.DictionaryLoaded(r[0].map(o=>o.As())),e(!0)})})}static DictionaryLoaded(i){const t=i.filter((e,n,s)=>s.findIndex(a=>a.Key===e.Key)===n).reduce((e,n)=>(e[n.Key]=n.Value,e),{});N._dictionaries[N.Culture]=t,localStorage.setItem(N.Culture,t),N.Travel(document).forEach(e=>{const n=e[N.LangProp];n==null||n===""||n.split(",").forEach(s=>{const a=e[N.LangKey+s],r=e[N.LangParam+s],o=t[a]!==void 0?t[a]:a;r!=null&&r.length>0?e[s]=Str.Format(o,r):e[s]=o})})}static*Travel(i){yield i;for(const t of i.childNodes)yield*this.Travel(t)}};c(N,"LangProp","langprop"),c(N,"LangKey","langkey"),c(N,"LangParam","Para"),c(N,"LangCode","langcode"),c(N,"Active","Active"),c(N,"_dictionaries",{}),c(N,"_culture");let LangSelect=N;class ElementType{static get a(){return"a"}static get abbr(){return"abbr"}static get address(){return"address"}static get area(){return"area"}static get article(){return"article"}static get aside(){return"aside"}static get audio(){return"audio"}static get b(){return"b"}static get base(){return"base"}static get bdi(){return"bdi"}static get bdo(){return"bdo"}static get blockquote(){return"blockquote"}static get button(){return"button"}static get canvas(){return"canvas"}static get caption(){return"caption"}static get cite(){return"cite"}static get code(){return"code"}static get col(){return"col"}static get colgroup(){return"colgroup"}static get datalist(){return"datalist"}static get dd(){return"dd"}static get del(){return"del"}static get details(){return"details"}static get dfn(){return"dfn"}static get div(){return"div"}static get dl(){return"dl"}static get dt(){return"dt"}static get em(){return"em"}static get embed(){return"embed"}static get fieldset(){return"fieldset"}static get figcaption(){return"figcaption"}static get figure(){return"figure"}static get footer(){return"footer"}static get form(){return"form"}static get h1(){return"h1"}static get h2(){return"h2"}static get h3(){return"h3"}static get h4(){return"h4"}static get h5(){return"h5"}static get h6(){return"h6"}static get head(){return"head"}static get header(){return"header"}static get i(){return"i"}static get iframe(){return"iframe"}static get img(){return"img"}static get input(){return"input"}static get ins(){return"ins"}static get kbd(){return"kbd"}static get keygen(){return"keygen"}static get label(){return"label"}static get legend(){return"legend"}static get li(){return"li"}static get link(){return"link"}static get main(){return"main"}static get map(){return"map"}static get mark(){return"mark"}static get menu(){return"menu"}static get menuitem(){return"menuitem"}static get meta(){return"meta"}static get meter(){return"meter"}static get nav(){return"nav"}static get object(){return"object"}static get ol(){return"ol"}static get optgroup(){return"optgroup"}static get option(){return"option"}static get output(){return"output"}static get p(){return"p"}static get param(){return"param"}static get pre(){return"pre"}static get progress(){return"progress"}static get q(){return"q"}static get rp(){return"rp"}static get rt(){return"rt"}static get ruby(){return"ruby"}static get s(){return"s"}static get samp(){return"samp"}static get script(){return"script"}static get section(){return"section"}static get select(){return"select"}static get small(){return"small"}static get source(){return"source"}static get span(){return"span"}static get strong(){return"strong"}static get style(){return"style"}static get sub(){return"sub"}static get summary(){return"summary"}static get sup(){return"sup"}static get table(){return"table"}static get tbody(){return"tbody"}static get td(){return"td"}static get textarea(){return"textarea"}static get tfoot(){return"tfoot"}static get th(){return"th"}static get thead(){return"thead"}static get time(){return"time"}static get title(){return"title"}static get tr(){return"tr"}static get track(){return"track"}static get u(){return"u"}static get ul(){return"ul"}static get var(){return"var"}static get video(){return"video"}}const Direction={top:"top",right:"right",bottom:"bottom",left:"left"};class HTML{constructor(){c(this,"Context")}get Instance(){return this}Take(i){return i==null?this:(typeof i=="string"?this.Context=document.querySelector(i):this.Context=i,this)}GetContext(){return this.Context}Add(i){const t=document.createElement(i);return this.Context.appendChild(t),this.Context=t,this}get Div(){return this.Add("div")}get Iframe(){return this.Add("iframe")}get Link(){return this.Add("link")}get Script(){return this.Add("script")}get Header(){return this.Add("header")}get Section(){return this.Add("section")}get Canvas(){return this.Add("canvas")}get Video(){return this.Add("video")}get Audio(){return this.Add("audio")}get H1(){return this.Add("h1")}get H2(){return this.Add("h2")}get H3(){return this.Add("h3")}get H4(){return this.Add("h4")}get H5(){return this.Add("h5")}get H6(){return this.Add("h6")}get Nav(){return this.Add("nav")}get Input(){return this.Add("input")}get Select(){return this.Add("select")}get Option(){return this.Add("option")}get Span(){return this.Add("span")}get Small(){return this.Add("small")}get I(){return this.Add("i")}get Img(){return this.Add("img")}get Button(){return this.Add("button")}get Table(){return this.Add("table")}get Thead(){return this.Add("thead")}get Th(){return this.Add("th")}get TBody(){return this.Add("tbody")}get TFooter(){return this.Add("tfoot")}get TRow(){return this.Add("tr")}get TData(){return this.Add("td")}get P(){return this.Add("p")}get TextArea(){return this.Add("textarea")}get Br(){var i=document.createElement("br");return this.Context.appendChild(i),this}get Hr(){var i=document.createElement("hr");return this.Context.appendChild(i),this}get Ul(){return this.Add("ul")}get Li(){return this.Add("li")}get Aside(){return this.Add("aside")}get A(){return this.Add("a")}get Form(){return this.Add("form")}get Label(){return this.Add("label")}get End(){return this.Context=this.Context.parentElement,this}Render(){}Event(i,t,...e){return this.Context.addEventListener(i,n=>t(n,...e)),this}Trigger(i){var t=new Event(i);return this.Context.dispatchEvent(t),this}ClassName(i){return this.Context.className!=""?this.Context.className+=" "+i:this.Context.className=i,this}Id(i){return this.Context.id=i,this}Style(i){return i==null?this:(this.Context.style.cssText+=i,this)}Width(i){return this.Context.style.width=i,this}Padding(i,t,e){return e==null&&(e="px"),this.Style(`padding-${i}: ${t}${e}`)}TextAlign(i){return this.Style("text-align: "+i)}Text(i){if(i==null)return this;var t=new Text(i);return this.Context.appendChild(t),this}Button2(i="",t="button info small",e=""){return this.Button.Render(),e!==""&&this.Span.ClassName(e).End.Text(" ").Render(),this.ClassName(t).IText(i)}Title(i){return i?(this.MarkLangProp(this.Context,i,"title"),this.Attr("title",LangSelect.Get(i))):this}Margin(i,t,e="px"){return this.Style(`margin-${i} : ${t}${e}`)}MarginRem(i,t){return this.Style(`margin-${i} : ${t}rem`)}IText(i,...t){if(!i)return this;const e=LangSelect.Get(i),n=t.length>0?Str.Format(e,t):e,s=document.createTextNode(n);return this.MarkLangProp(s,i,"TextContent",t),this.Context.appendChild(s),this}InnerHTML(i){return this.Context.innerHTML=i,this}SmallCheckbox(i=!1){return this.Label.ClassName("checkbox input-small transition-on style2").Input.Attr("type","checkbox").Type("checkbox").End.Span.ClassName("check myCheckbox"),this.Context.previousElementSibling.checked=i,this}Type(i){return this.Context.type=i,this}Attr(i,t){return this.Context.setAttribute(i,t),this}Href(i){return this.Context.setAttribute("href",i),this}Src(i){return this.Context.setAttribute("src",i),this}TabIndex(i){return this.Context.setAttribute("tabindex",i.toString()),this}DataAttr(i,t){return this.Context.setAttribute("data-"+i,t),this}PlaceHolder(i){return!i||i.trim()===""?this:(this.MarkLangProp(this.Context,i,"placeholder"),this.Attr("placeholder",LangSelect.Get(i)))}MarkLangProp(i,t,e,...n){if(!i)return;const s=LangSelect.LangKey+e,a=LangSelect.LangParam+e;i[s]=t,n.length>0&&(i[a]=n);const r=i[LangSelect.LangProp],h=(r?r+","+e:e).split(",").filter((d,u,m)=>m.indexOf(d)===u);i[LangSelect.LangProp]=h.join(",")}Value(i){const t=this.Context;return t.value=i,this}Icon(i){const t=i.includes("mif")||i.includes("fa")||i.includes("fa-");return this.Span.ClassName("icon"),t?this.ClassName(i).Render():this.Style(`background-image: url(${Client.Origin+i});`).ClassName("iconBg").Render(),this}Position(i,t=null,e="px"){return t==null?this.Style(`position: {${i}}`):this.Style(`position: ${i}; ${i}: ${t}${e};`)}Escape(i){const t=this.Context;return t.tabIndex=-1,t.focus(),t.addEventListener("keydown",e=>{if(e.keyCode===27){const n=t.parentElement;e.stopPropagation(),i(e),n.focus()}}),this}IconForSpan(i){if(!i||i.trim().length===0)return this;i=i.trim();const t=this.Context;return this.ClassName("icon"),i.includes("mif")||i.includes("fa")||i.includes("fa-")?t.classList.add(i):(t.classList.add("iconBg"),t.style.backgroundImage=`url(${i})`),this}Floating(i,t){return this.Position(PositionEnum.fixed).Position(Direction.top,i).Position(Direction.left,t)}IHtml(i,...t){if(!i)return this;const e=this.Context,n=LangSelect.Get(i);return this.MarkLangProp(e,i,"innerHTML",t),e.innerHTML=n,this}ColSpan(i){return this.Attr("colspan",i.toString())}RowSpan(i){return this.Attr("rowspan",i.toString())}EndOf(i){typeof i=="object"&&i.toString&&(i=i.toString());let t=this.Context;for(;t!==null&&t.querySelector(i)===null;)t=t.parentElement;if(t===null)throw new Error("Cannot find the element of selector "+i);return this.Context=t,this}Closest(i){return this.Context&&typeof this.Context.closest=="function"&&(this.Context=this.Context.closest(i.toString())),this}Clear(){return this.Context.innerHTML="",this}Checkbox(i){this.Add(ElementType.input);var t=this.Context;return t instanceof HTMLInputElement&&(t.setAttribute("type","checkbox"),t.checked=i??!1),this}Sticky(i=null,t=null){const e=this.Context;return e?(e.previousElementSibling&&e.tagName===e.previousElementSibling.tagName&&(t==="0"?t=`${e.offsetLeft}px`:i==="0"&&(i=`${e.offsetTop}px`)),i!==null&&this.Style(`top: ${i};`),t!==null&&this.Style(`left: ${t};`),this.Style("position: sticky; z-index: 1;")):this}ForEach(i,t){for(let e=0;e<i.length;e++)t(i[e],e);return this}Display(i){const t=this.Context;return t.style.display=i?"":"none",this}Visibility(i){var t=this.Context;return t.style.visibility=i?"":"hidden",this}}const Html=new HTML;var gt,lt,dt,yt,ot;const Q=class Q{constructor(i,t=null){c(this,"DefaultObject",{});c(this,"TabGroup",!1);c(this,"IsListViewItem",!1);c(this,"Parent");c(this,"Children",[]);c(this,"ParentElement");c(this,"Element");c(this,"Entity",null);c(this,"Meta");c(this,"DefaultValue");c(this,"Classes",[]);tt(this,gt);c(this,"Disposed",new Action);c(this,"DOMContentLoaded",new Action);c(this,"OnToggle",new Action);tt(this,lt);c(this,"UserInput",new Action);c(this,"OldValue");c(this,"ValidationResult",{});c(this,"ValidationRules",{});tt(this,dt);tt(this,yt);c(this,"_dirty");c(this,"AlwaysValid");c(this,"IdField","Id");c(this,"AfterSaved",new Action);c(this,"BeforeSaved",new Action);c(this,"PopulateDirty",!0);c(this,"LocalData",[]);c(this,"IsListViewItem",!1);c(this,"IsButton",!1);c(this,"IsRow",!1);c(this,"IsListView",!1);c(this,"IsSearchEntry",!1);c(this,"IsEditForm",!1);c(this,"Popup",!1);c(this,"IsTab",!1);c(this,"_events",{});tt(this,ot);var n,s;if(this.Meta=i,this.ParentElement=(n=this.Meta)==null?void 0:n.ParentElement,this.Element=t,this.AlwaysLogHistory=!1,this.Entity={},((s=this.Meta)==null?void 0:s.Validation)!=null){var e=typeof i.Validation===Str.Type?JSON.parse(i.Validation.toString()):i.Validation;e.length>0&&(this.ValidationRules=e.ToDictionary(a=>a.Rule,a=>a))}this.DOMContentLoaded.add(()=>{this.SetRequired(),this.SendQueueAction("Subscribe"),i!=null&&i.Events&&this.DispatchEvent(i.Events,EventType.DOMContentLoaded,this.Entity).Done()})}get ClassName(){return this.Element.className}set ClassName(i){this.Element.className=i}get TabEditor(){if(Y(this,lt)!=null)return Y(this,lt);X(this,lt,this.FindClosest(i=>i.IsTab))}set TabEditor(i){X(this,lt,i)}get EditForm(){return Y(this,yt)}set EditForm(i){X(this,yt,i)}get IsSmallUp(){return document.body.clientWidth>768}get IsMediumUp(){return document.body.clientWidth>992}get IsLargeUp(){return document.body.clientWidth>1200}get Disabled(){return Y(this,dt)}set Disabled(i){X(this,dt,i),this.SetDisableUI(i),this.Children.Flattern(t=>t.Children).forEach(t=>{X(t,dt,i),t.SetDisableUI(i)})}get Dirty(){var i=this._dirty&&!this.AlwaysValid||this.FilterChildren(t=>t._dirty,t=>!t.PopulateDirty||t.AlwaysValid).Any();return i}set Dirty(i){this._dirty=i,i||this.FilterChildren(t=>t._dirty,t=>!t.PopulateDirty||t.AlwaysValid).forEach(t=>t._dirty=!1)}get IsValid(){return Object.keys(this.ValidationResult).length===0}get CacheName(){var e;var i=(e=this.Meta)==null?void 0:e.CacheName;if(!i)return null;var t=Utils$1.IsFunction(i);return t?t.call(null,this):i}get QueueName(){var i;return(i=this.Meta)==null?void 0:i.QueueName}get EntityId(){var i;return(i=this.Entity)==null?void 0:i.Id}set EntityId(i){this.Entity!=null&&(this.Entity.Id=i)}get ComLabel(){var i;return(i=this.Meta)==null?void 0:i.Label}get Name(){var i;return(i=this.Meta)==null?void 0:i.FieldName}set Name(i){this.Meta==null&&(this.Meta=new Component),this.Meta.FieldName=i||null}get Id(){var i;return(i=this.Meta)==null?void 0:i.Id}set Id(i){this.Meta==null&&(this.Meta=new Component),this.Meta.Id=i}get ComponentType(){var i;return(i=this.Meta)==null?void 0:i.ComponentType}set ComponentType(i){this.Meta==null&&(this.Meta=new Component),this.Meta.ComponentType=i}get EmptyRow(){return Y(this,gt)}set EmptyRow(i){X(this,gt,i)}get MetaConn(){var i;return(i=this.Meta)==null?void 0:i.MetaConn}get DataConn(){var i;return(i=this.Meta)==null?void 0:i.DataConn}get FieldVal(){return!this.Entity||!this.Name?null:this.Entity[this.Name]}set FieldVal(i){this.Entity==null||this.Name==null||(this.Entity[this.Name]=i)}get FirstChild(){return this.Children.FirstOrDefault()}DispatchEvent(i,t,...e){return i?this.InvokeEvent(i,t,...e):Promise.resolve(!0)}InvokeEvent(i,t,...e){let n;try{n=JSON.parse(i)}catch{return Promise.resolve(!1)}const s=n[t];if(!s)return Promise.resolve(!1);const a=Utils$1.IsFunction(s);if(a)return a.call(null,this,this.EditForm),Promise.resolve(!0);let r=this.EditForm;if(!r)return Promise.resolve(!1);const o=r[s];return o?new Promise((d,u)=>{let m=o.apply(r,e);!m||m.isCompleted==null?d(!1):m.then(()=>d(!0)).catch(f=>u(f))}):Promise.resolve(!1)}DispatchCustomEvent(i,t,...e){if(!i)return Promise.resolve(!0);const n=t.toString();return this.InvokeEvent(i,n,...e)}SetRequired(){var t;const i=this.Element;i!=null&&((t=this.ValidationRules)!=null&&t.hasOwnProperty(ValidationRule.Required)?i.setAttribute(ValidationRule.Required,"true"):i.removeAttribute(ValidationRule.Required))}Validate(i,t,e){var d,u;if(!this.ValidationRules.hasOwnProperty(i))return!0;let n=this.ValidationRules[i];if(n===null||n.Value1===null)return!0;let s=n.Value1.toString();if(s==="")return!0;let a=n.Value1,r=a,[o,h]=this.Entity.GetComplexProp(s);if(o&&(r=(u=(d=this.Parent.FirstOrDefault(m=>m.Name===s))==null?void 0:d.Meta)==null?void 0:u.Label,a=h),e(t,a))delete this.ValidationResult[i];else return this.ValidationResult[i]=Str.Format(n.Message,this.Meta.Label,r),!0;return!1}SetDisableUI(i){const t=this.Element;t!=null&&(i?t.setAttribute("disabled","disabled"):(t.removeAttribute("disabled"),t.setAttribute("enable","true")))}SetDefaultVal(){if(!Utils$1.isNullOrWhiteSpace(this.Meta.DefaultVal)&&!(this.Entity==null||this.EntityId==null)){var i=Utils$1.IsFunction(this.Meta.DefaultVal);i?i.call(this,this):this.Entity[this.Name]==null&&(this.Entity[this.Name]=this.DefaultValue)}}ValidateRequired(i){if(this.Element===null||Object.keys(this.ValidationRules).length===0||this.EmptyRow||this.AlwaysValid)return!0;if(!this.ValidationRules.hasOwnProperty(ValidationRule.Required))return this.Element.removeAttribute(ValidationRule.Required),!0;const t=this.ValidationRules[ValidationRule.Required];return this.Element.setAttribute(ValidationRule.Required,"true"),i==null||i.toString().trim()===""?(this.Element.removeAttribute("readonly"),this.ValidationResult[ValidationRule.Required]=t.Message.replace("{0}",LangSelect.Get(this.Meta.Label)).replace("{1}",this.Entity),!1):(delete this.ValidationResult[ValidationRule.Required],!0)}AddRule(i){this.ValidationRules[i.Rule]=i,i.Rule===ValidationRule.Required&&this.Element.setAttribute(ValidationRule.Required,"true")}RemoveRule(i){delete this.ValidationRules[i],Object.keys(this.ValidationRules).includes(ValidationRule.Required)||this.Element.removeAttribute(ValidationRule.Required)}GetInvalid(){return this.Children.Flattern(i=>i.AlwaysValid?null:i.Children).Where(i=>!i.IsValid)}CascadeField(){if(!this.Meta.CascadeField)return;const i=this.FindClosest(e=>e.IsRow)??this.EditForm,t=this.Meta.CascadeField.split(",").map(e=>e.trim()).filter(e=>e!=="");t.length!==0&&t.forEach(e=>{i.FilterChildren(n=>n.Name===e).forEach(n=>{n instanceof SearchEntry&&n!==null?(n.Value=null,n.Meta.LocalData=null):n.UpdateView()})})}PopulateFields(i=null){if(this.Entity==null||this.Meta.PopulateField==null)return;const t=this.FindClosest(ListViewItem.prototype)??this.FindClosest(ComponentType.EditForm),e=t!==null?t:this.EditForm,n=Utils$1.IsFunction(this.Meta.PopulateField);if(n){try{n.call(null,this,i)}catch(a){console.error(a)}e.UpdateView(!0);return}const s=this.Meta.PopulateField.split(",").map(a=>a.trim()).filter(a=>a!=="");i===null||s.length===0||s.forEach(a=>{e.FilterChildren(r=>r.Name===a).forEach(r=>{const o=Utils$1.GetPropValue(i,a),h=Utils$1.GetPropValue(this.Entity,a),d=this.Entity[a];o===h||d===null||new d!==h||(this.Entity[a]=o,r.UpdateView(!0,!1))})})}GetValueTextAct(){return this.Element.textContent}AddIdToPatch(i){const t=i.findIndex(e=>e.Field===Utils$1.IdField);t!==-1&&i.splice(t,1),this.EntityId===null?i.push({Field:Utils$1.IdField,Value:Uuid7.Id25()}):i.push({Field:Utils$1.IdField,Value:this.EntityId,OldVal:this.EntityId})}addEventListener(i,t){if(t===null)throw new Error("Handler cannot be null");const e=this._events[i]||null;e==null?this._events[i]=[t]:e.push(t)}removeEventListener(i,t){if(t===null)throw new Error("Handler cannot be null");(this._events[i]||null)!==null&&delete this._events[i]}FindComponentByName(i,t){return this.FirstOrDefault(e=>e.Name===i&&(t==null||e.Classes.includes(t)))}FindClosest(i=null){let t=this;for(;t!=null;){if(i==null||i(t))return t;t=t.Parent}return null}get Show(){return Y(this,ot)}set Show(i){this.Toggle(i)}Toggle(i){this.Element&&(X(this,ot,i),Y(this,ot)?(this.Element.style.display="",this.Meta&&this.Meta.ShowLabel&&!this.Parent&&this.Meta.FieldName&&(this.Element.parentElement.style.display="",this.Element.parentElement.previousElementSibling.style.display=""),this.OnToggle.invoke(Y(this,ot))):(this.Element.style.display="none",this.Meta&&this.Meta.ShowLabel&&!this.Parent&&this.Meta.FieldName&&(this.Element.parentElement.style.display="none",this.Element.parentElement.previousElementSibling.style.display="none")))}ToggleShow(i){var t=Utils$1.IsFunction(i);if(t){var e=t.call(null,this);this.Show=e??!1}}ToggleDisabled(i){if(i instanceof Boolean){this.Disabled=i;return}var t=Utils$1.IsFunction(i);if(t){let e=t(null,this)||!1;this.Disabled=e}}ListViewItemTab(i){}UpdateView(i=!1,t=null,...e){if(this.PrepareUpdateView(i,t),!(!this.Children||this.Children.length===0))if(e.length>0){const n=this.FilterChildren(r=>r instanceof Section&&e.includes(r.Name)).flatMap(r=>r.FilterChildren(o=>!(o instanceof Section))),s=this.FilterChildren(r=>e.includes(r.Name)&&!(r instanceof Section));[...new Set([...n,...s].filter(r=>!(r instanceof Section)))].forEach(r=>{r.PrepareUpdateView(i,t),r.UpdateView(i,t,...e)})}else this.FilterChildren(s=>s.ComponentType!="Section").forEach(s=>{s.PrepareUpdateView(i,t),s.UpdateView(i,t,...e)})}PrepareUpdateView(i,t){var e,n;i&&(this.EmptyRow=!1),this.ToggleShow((e=this.Meta)==null?void 0:e.ShowExp),this.ToggleDisabled((n=this.Meta)==null?void 0:n.DisabledExp),t!==void 0&&(this._setDirty=t)}Nothing(){return!this.Children||this.Children.length===0}DisposeChildren(){if(this.Nothing())return;let i=this.Flatten(t=>t.Children).filter(t=>t.Element!==null&&t.Parent!==null&&t.Nothing());for(;i.length>0&&i==1&&i[0]!=this;)i.forEach(t=>{t!==null&&(t.Dispose(),t.Parent&&t.Parent.Children&&(t.Parent.Children=t.Parent.Children.filter(e=>e!==t)))}),i=this.Flatten(t=>t.Children).filter(t=>t.Element!==null&&t.Parent!==null&&t.Nothing())}Flatten(i){const t=[],e=[this];for(;e.length>0;){const n=e.pop();t.push(n);const s=i(n);s&&e.push(...s)}return t}Dispose(){var i;this.SendQueueAction("Unsubscribe"),this.DisposeChildren(),this.RemoveDOM(),this.Children=null,this.DOMContentLoaded=null,this.OnToggle=null,this.Parent!=null&&this.Parent.Children!=null&&this.Parent.Children.ToArray().HasElement()&&this.Parent.Children.ToArray().Contains(this)&&this.Parent.Children.ToArray().Remove(this),(i=this.Disposed)==null||i.Invoke()}RemoveDOM(){this.Element!=null&&(this.Element.remove(),this.Element=null)}SendQueueAction(i){var n,s;var t=this.QueueName;if(!t)return;const e={QueueName:t,Action:i};(s=(n=this.EditForm)==null?void 0:n.NotificationClient)==null||s.Send(JSON.stringify(e)),i=="Subscribe"?window.addEventListener(t,this.QueueHandler):window.removeEventListener(t,this.QueueHandler)}GetValueText(){return this.Element===null?"":this.Element instanceof HTMLInputElement?this.Element.value:this.Element instanceof HTMLTextAreaElement?this.Element.value:""}ValidateAsync(){return Promise.resolve(!0)}static IsEmpty(i){return i.length===0}FilterChildren(i,t,e=null){return this.FilterChildrenTyped(i,t,e)}FilterChildrenTyped(i=null,t=null,e=new Set){if(e=e??new Set,Q.IsEmpty(this.Children))return[];let n=[];for(const s of this.Children){let a=s instanceof Q?s:null;a===null&&Q.IsEmpty(s.Children)||t&&t(a)||(a!==null&&(!i||i(a))&&!e.has(a)&&(e.add(a),n.push(a)),n=n.concat(s.FilterChildrenTyped(i,t,e)))}return n}FindActiveComponent(i){const t=e=>!e.hidden()&&i(e);return this.Children.Where(t).Flattern(e=>t(e)?e.Children:null)}FirstOrDefault(i){return this.Children.Flattern(t=>t.Children).FirstOrDefault(i)}AddChild(i,t=null,e=null,n=null){if(i.IsSingleton){i.Render();return}i.ParentElement||(i.ComponentType==null&&this.TabEditor?i.Popup?i.ParentElement=Element||this.TabEditor.TabContainer:i.ParentElement=this.TabEditor.TabContainer:i.ParentElement=Html.Context),(!i.Entity||this.DeepEqual(i.Entity,this.DefaultObject))&&(i.Entity=this.Entity??{}),!i.EditForm&&!i.Popup&&(i.EditForm=this.EditForm),t===null||t>=this.Children.length||t<0?this.Children.push(i):this.Children.splice(t,1,i),i.Parent||(i.Parent=this),Html.Take(i.ParentElement),i.Render(),i.ToggleShow(e||(i.Meta?i.Meta.ShowExp:"")),i.ToggleDisabled(n||(i.Meta?i.Meta.DisabledExp:""))}DeepEqual(i,t){if(i===t)return!0;if(typeof i!="object"||i===null||typeof t!="object"||t===null)return!1;let e=Object.keys(i),n=Object.keys(t);if(e.length!==n.length)return!1;for(let s of e)if(!n.includes(s)||!deepEqual(i[s],t[s]))return!1;return!0}RemoveChild(i){const t=this.Children.indexOf(i);t>-1&&this.Children.splice(t,1)}Focus(){var i;(i=this.Element)==null||i.focus()}SetDisabled(i,...t){t==null||t.length==0?this.Disabled=i:this.FilterChildren(e=>t.includes(e.Name)).forEach(e=>e.Disabled=i)}};gt=new WeakMap,lt=new WeakMap,dt=new WeakMap,yt=new WeakMap,ot=new WeakMap,c(Q,"SmallScreen",768),c(Q,"ExSmallScreen",567),c(Q,"MediumScreen",992),c(Q,"LargeScreen",1200),c(Q,"ExLargeScreen",1452),c(Q,"TabContainer",document.getElementById("tab-content"));let EditableComponent=Q;const editableComponent=Object.freeze(Object.defineProperty({__proto__:null,EditableComponent},Symbol.toStringTag,{value:"Module"}));class Textbox extends EditableComponent{constructor(i,t){super(i,t),this.DefaultValue="",t.tagName=="INPUT"?this.Input=t:t.tagName=="TEXTAREA"&&(this.TextArea=t),this._value=null,this.MultipleLine=!1,this.Password=!1,this._text="",this._oldText=""}get Text(){return this._text}set Text(i){this._text=i,this.Input!=null&&(this.Input.value=this._text),this.TextArea!=null&&(this.TextArea.value=this._text)}get Value(){return this._value}set Value(i){var e;this._value=i,this._value!==null&&typeof this._value===Str.Type&&this.EditForm&&this.EditForm.Meta&&!this.EditForm.Meta.IgnoreEncode&&(this.Entity[this.Name]=Utils$1.EncodeSpecialChar(Utils$1.DecodeSpecialChar(this._value))),this.Entity&&(this.Entity[this.Name]=this._value);let t=this.EditForm&&this.EditForm.Meta&&this.EditForm.Meta.IgnoreEncode?this._value:Utils$1.DecodeSpecialChar(this._value);this.Meta.FormatData&&(t=Utils$1.FormatEntity(this.Meta.FormatData,this.Entity[this.Name])),this.Meta.FormatEntity&&(t=Utils$1.FormatEntity2(this.Meta.FormatEntity,null,this.Entity,Utils$1.EmptyFormat,Utils$1.EmptyFormat)),(e=Utils$1.IsFunction(this.Meta.Renderer))==null||e.call(this,this),this.Text=t,this.PopulateFields()}Render(){var n,s,a;this.SetDefaultVal();var i=this.Entity&&this.Entity[this.Name]||null,t=i!=null&&typeof i===Str.Type&&this.EditForm!=null&&this.EditForm.Meta!=null&&!this.EditForm.Meta.IgnoreEncode;if(t){const r=Utils$1.DecodeSpecialChar(i),o=Utils$1.EncodeSpecialChar(r);this.Entity[this.Name]=o}var e=i;this.Meta.FormatData&&(e=Utils$1.FormatEntity(this.Meta.FormatData,i)),this.Meta.FormatEntity&&(e=Utils$1.FormatEntity(this.Meta.FormatEntity,this.Entity)),this._text=this.EditForm!=null&&this.EditForm.Meta!=null&&this.EditForm.Meta.IgnoreEncode?e:Utils$1.DecodeSpecialChar(e)??"",this.OldValue=this._text,this.MultipleLine||this.TextArea!=null?(this.TextArea==null?(Html.Take(this.ParentElement).TextArea.Value(this._text).PlaceHolder(this.Meta.PlainText),this.Element=this.TextArea=Html.Context):this.TextArea&&(Html.Take(this.Element),this.Element=this.TextArea,this.TextArea.value=this._text),this.Meta.Row>0&&Html.Instance.Attr("rows",this.Meta.Row??1),this.TextArea.addEventListener("input",r=>this.PopulateUIChange(EventType.Input)),this.TextArea.addEventListener("change",r=>this.PopulateUIChange(EventType.Change))):(this.Input==null?((n=Html.Take(this.ParentElement).Input.Value(this._text))==null||n.PlaceHolder(this.Meta.PlainText),this.Element=this.Input=Html.Context):(Html.Take(this.Element),this.Element=this.Input,this.Input.value=this._text),this.Input.addEventListener("input",r=>this.PopulateUIChange(EventType.Input)),this.Input.addEventListener("change",r=>this.PopulateUIChange(EventType.Change))),(s=Utils$1.IsFunction(this.Meta.Renderer))==null||s.call(this,this),this.Password&&Html.Instance.Style("text-security: disc;-webkit-text-security: disc;-moz-text-security: disc;"),this.Meta.ShowLabel||Html.Instance.PlaceHolder(this.Meta.PlainText),this.Element&&this.Element.closest("td")&&this.Element.closest("td").addEventListener("keydown",this.ListViewItemTab.bind(this)),(a=this.DOMContentLoaded)==null||a.Invoke()}PopulateUIChange(i,t=!1){var e,n;this.Disabled||(this._oldText=this._text,this._text=this.Input?this.Input.value:this.TextArea.value,this._text=this.Password?this._text:t?(e=this._text)==null?void 0:e.trim():this._text,this.Meta.UpperCase&&this._text!=null&&(this.Text=this._text.toLocaleUpperCase()),this._value=this.EditForm!=null&&this.EditForm.Meta!=null&&this.EditForm.Meta.IgnoreEncode?this._text:Utils$1.EncodeSpecialChar(this._text),this.Entity[this.Name]=this._value,this.Dirty=!0,(n=this.UserInput)==null||n.Invoke({NewData:this._text,OldData:this._oldText,EvType:i}),this.PopulateFields(),this.DispatchEvent(this.Meta.Events,i,this.Entity))}UpdateView(i=!1,t=null,...e){var n;this.Value=this.Entity&&Utils$1.GetPropValue(this.Entity,this.Name),this.Dirty||((n=this.DOMContentLoaded)==null||n.Invoke(),this.OldValue=this._text)}ValidateAsync(){return this.ValidationRules.Nothing()?Promise.resolve(!0):new Promise((t,e)=>{this.ValidationResult.Clear(),this.Validate(ValidationRule.MinLength,this._text,(n,s)=>this._text!=null&&this._text.length>=s),this.Validate(ValidationRule.CheckLength,this._text,(n,s)=>this._text==null||this._text==""||this._text.length==s),this.Validate(ValidationRule.MaxLength,this._text,(n,s)=>this._text==null||this._text.length<=s),this.Validate(ValidationRule.RegEx,this._text,this.ValidateRegEx),this.ValidateRequired(this.Text),this.ValidateUnique().then(()=>{t(this.IsValid)})})}ValidateRegEx(i,t){if(i===null)return!0;var e=new RegExp(t),n=e.test(i),s=this.ValidationRules[ValidationRule.RegEx];if(s&&!n&&s.RejectInvalid){var a=this.Input.selectionEnd;return this.Text=this._oldText,this._value=this._oldText,this.Input.selectionStart=a,this.Input.selectionEnd=a,e.test(this._oldText)}return n}ValidateUnique(){if(!this.ValidationRules.hasOwnProperty(ValidationRule.Unique))return Promise.resolve(!0);var i=this.ValidationRules[ValidationRule.Unique];if(i===null||this._text.trim()==="")return Promise.resolve(!0);const t=Utils$1.IsFunction(this.Meta.PreQuery);this.Meta.RefName?this.EditForm.Meta.EntityName:this.Meta.RefName;const e={ComId:this.Meta.Id,Params:t?JSON.stringify(t.call(null,this)):null,MetaConn:this.MetaConn,DataConn:this.DataConn};var n=new Promise((s,a)=>{Client.Instance.ComQuery(e).then(r=>{var o=r.length>0&&r[0].length>0;return o}).then(r=>{r?this.ValidationResult[ValidationRule.Unique]=`${i.Message} ${LangSelect.Get(this.Meta.Label)} ${this._text}`:delete this.ValidationResult[ValidationRule.Unique],s(!0)}).catch(r=>{console.error("Query error:",r),a(r)})});return n}SetDisableUI(i){this.Input!=null&&(this.Input.readOnly=i),this.TextArea!=null&&(this.TextArea.readOnly=i)}}class Numbox extends EditableComponent{constructor(i,t=null){super(i,t),t&&t.tagName=="INPUT"&&(this._input=t),this._value=null,this._isString=!1,this._decimalSeparator=".",this.SetSelection=!0,this.DefaultValue=0}get Value(){return this._value}set Value(i){var r,o,h,d;const t=this._value;if(this._value=i,i===null)this._input.value="",this._value=null;else{var[e,n]=Utils$1.TryParseDecimal((r=this._value)==null?void 0:r.toString());if(e){this._value=n;const u=(((o=this._input.value)==null?void 0:o.match(/,/g))||[]).length,m=this._input.selectionEnd;this._input.value.split("").filter(p=>p===".").length>1;var s=this._value.toFixed(this.Meta.Precision??0).replace(/\B(?=(\d{3})+(?!\d))/g,",");this._input.value=s;const f=(((h=this._input.value)==null?void 0:h.match(/,/g))||[]).length-u;this.SetSelection&&(this._input.selectionStart=m+f,this._input.selectionEnd=m+f)}else{var[e,n]=Utils$1.TryParseDecimal(t==null?void 0:t.toString());e||(this.parsedVal=new Decimal(0)),this._value=new Decimal(n),this._input.value=n.toFixed(this.Meta.Precision||0)}}t==null||this._value==null?this.Dirty=t!=this._value:this.Dirty=!((d=this._value)!=null&&d.eq(t)),this.Entity[this.Name]=this._value,this.PopulateFields();var a=Utils$1.IsFunction(this.Meta.Renderer);a&&a.call(this,this)}SetValue(){var s;const i=this._value;if(this.EmptyRow=!1,!this._input.value){this.Value=null;return}this._input.value=this._input.value.trim(),this._input.value.slice(-1)===this._decimalSeparator&&(this._input.value=this._input.value.substring(0,this._input.value.length-1));const t=this._input.value.replace(/,/g,""),[e,n]=Utils$1.TryParseDecimal(t);if(!e){this.Value=this._value;return}this._value=new Decimal(n),this.Value=this._value,(s=this.UserInput)==null||s.invoke({NewData:this._value,OldData:i,EvType:EventType.Input}),this.DispatchEvent(this.Meta.Events,EventType.Input,this.Entity,this._value,i).done()}Render(){var t;if(this.SetDefaultVal(),this.Entity!=null&&this.Entity[this.Name]!=null&&(this._value=this.GetDecimalValue()),!this._input||this._input===null){Html.Take(this.ParentElement).Input.Render();const e=Html.Context;e instanceof HTMLInputElement&&(this.Element=this._input=e)}else this.Element=this._input;this._input.type="tel",this._input.setAttribute("autocorrect","off"),this._input.setAttribute("spellcheck","false"),this._input.addEventListener("input",this.SetValue.bind(this)),this._input.addEventListener("change",this.ChangeSetValue.bind(this)),this._input.autocomplete="off",this.Value=this._value;let i=Utils$1.IsFunction(this.Meta.Renderer);i&&window.setTimeout(()=>i.call(this,this,this._input),100),(t=this.DOMContentLoaded)==null||t.invoke()}IsNullable(){const i=this.Entity.GetComplexProp(this.Name);return i==null}ChangeSetValue(){var s,a;const i=this._value;if(this.EmptyRow=!1,!this._input.value){this.Value=null,(s=this.UserInput)==null||s.Invoke({NewData:null,OldData:i,EvType:EventType.Change});return}this._input.value=this._input.value.trim(),this._input.value.slice(-1)==="."&&(this._input.value=this._input.value.substring(0,this._input.value.length-1));const t=this._input.value.replace(",",""),[e,n]=Utils$1.TryParseDecimal(t);if(!e){this.Value=this._value;return}this.Value=new Decimal(n),this.Dirty=!0,(a=this.UserInput)==null||a.Invoke({NewData:n,OldData:i,EvType:EventType.Change}),this.PopulateFields(),this.DispatchEvent(this.Meta.Events,EventType.Change,this.Entity,n,i).done()}GetDecimalValue(){if(this.Entity==null)return null;const i=this.Entity[this.Meta.FieldName];if(i==null||this._isString&&i.toString().IsNullOrWhiteSpace())return null;try{return new Decimal(i)}catch{return null}}UpdateView(i=!1,t=null,...e){var n;this.Value=this.GetDecimalValue(),this.Dirty||((n=this.DOMContentLoaded)==null||n.invoke(),this.OldValue=this._input.value)}async ValidateAsync(){return this.ValidationRules.Nothing()?!0:(this.ValidationResult.Clear(),this.ValidateRequired(this._value),this.Validate(ValidationRule.GreaterThan,this._value,(i,t)=>t==null||i!=null&&i>t),this.Validate(ValidationRule.LessThan,this._value,(i,t)=>t==null||i!=null&&i<t),this.Validate(ValidationRule.GreaterThanOrEqual,this._value,(i,t)=>t==null||i!=null&&i>=t),this.Validate(ValidationRule.LessThanOrEqual,this._value,(i,t)=>t==null||i!=null&&i<=t),this.Validate(ValidationRule.Equal,this._value,(i,t)=>i===t),this.Validate(ValidationRule.NotEqual,this._value,(i,t)=>i!==t),this.IsValid)}SetDisableUI(i){this._input.readOnly=i}}const rt=class rt{constructor(){}static Init(){if(this._instance!==null)return;this._instance=new rt;let i=document.getElementById("spinner");if(i)this._span=i,this._backdrop=i.previousElementSibling;else{let t=document.createElement("div");t.className="backdrop",t.style.background="transparent !important",document.body.appendChild(t);let e=document.createElement("span");e.className="spinner",t.appendChild(e),this._span=e,this._backdrop=t}this._span.style.display="none",this._backdrop.style.display="none"}static AppendTo(i,t=!0,e=!0,n=7e3){this._span&&(this._span.parentElement===i&&this._span.style.display===""||(i?i.appendChild(this._span):document.body.appendChild(this._span),this._span.style.display="",t&&(this._backdrop.style.display=""),e&&(window.clearTimeout(this._hiddenAwaiter),this._hiddenAwaiter=window.setTimeout(()=>this.Hide(),n))))}static Hide(){this._span&&(this._span.style.display="none",this._backdrop.style.display="none")}};c(rt,"_instance",null),c(rt,"_span",null),c(rt,"_backdrop",null),c(rt,"_hiddenAwaiter",null);let Spinner=rt;const scriptRel="modulepreload",assetsURL=function(l){return"/vnitart1/"+l},seen={},__vitePreload=function(i,t,e){let n=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const s=document.querySelector("meta[property=csp-nonce]"),a=(s==null?void 0:s.nonce)||(s==null?void 0:s.getAttribute("nonce"));n=Promise.all(t.map(r=>{if(r=assetsURL(r),r in seen)return;seen[r]=!0;const o=r.endsWith(".css"),h=o?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${r}"]${h}`))return;const d=document.createElement("link");if(d.rel=o?"stylesheet":scriptRel,o||(d.as="script",d.crossOrigin=""),d.href=r,a&&d.setAttribute("nonce",a),document.head.appendChild(d),o)return new Promise((u,m)=>{d.addEventListener("load",u),d.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${r}`)))})}))}return n.then(()=>i()).catch(s=>{const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=s,window.dispatchEvent(a),!a.defaultPrevented)throw s})},CustomEventType={BeforeCopied:"BeforeCopied",UpdateHeader:"UpdateHeader",AfterWebsocket:"AfterWebsocket",AfterCopied:"AfterCopied",BeforeDeleted:"BeforeDeleted",AfterDeleted:"AfterDeleted",Deactivated:"Deactivated",BeforePasted:"BeforePasted",AfterPasted:"AfterPasted",BeforeCreated:"BeforeCreated",AfterCreated:"AfterCreated",BeforeEmptyRowCreated:"BeforeEmptyRowCreated",AfterEmptyRowCreated:"AfterEmptyRowCreated",BeforeCreatedList:"BeforeCreatedList",AfterCreatedList:"AfterCreatedList",Selected:"Selected",RowFocusIn:"RowFocusIn",RowFocusOut:"RowFocusOut",RowMouseEnter:"RowMouseEnter",RowMouseLeave:"RowMouseLeave",OpenRef:"OpenRef",BeforePatchUpdate:"BeforePatchUpdate",ValidatePatchUpdate:"ValidatePatchUpdate",BeforePatchCreate:"BeforePatchCreate",AfterPatchUpdate:"AfterPatchUpdate"};class Message{}c(Message,"NotDirty","Data was not changed!"),c(Message,"ReasonOfChange","Auto change");class StringBuilder{constructor(i=""){this._buffer=[i]}Append(i){return this._buffer.push(i),this}ToString(){return this._buffer.join("")}}class FeaturePolicy{constructor(){c(this,"Id","");c(this,"FeatureId","");c(this,"RoleId","");c(this,"CanRead",!1);c(this,"CanWrite",!1);c(this,"CanDelete",!1);c(this,"CanDeleteAll",!1);c(this,"Active",!1);c(this,"InsertedDate",new Date);c(this,"InsertedBy","");c(this,"UpdatedDate",null);c(this,"UpdatedBy","");c(this,"CanDeactivate",!1);c(this,"CanDeactivateAll",!1);c(this,"LockDeleteAfterCreated","");c(this,"LockUpdateAfterCreated","");c(this,"EntityId","");c(this,"RecordId","");c(this,"UserId","");c(this,"CanShare",!1);c(this,"CanShareAll",!1);c(this,"Desc","");c(this,"CanWriteAll",!1);c(this,"EntityName","");c(this,"CanWriteMeta",!1);c(this,"CanWriteMetaAll",!1)}}class ObservableArgs{constructor(){c(this,"EvType");c(this,"Com");c(this,"NewData");c(this,"OldData");c(this,"NewMatch");c(this,"OldMatch");c(this,"NewEntity");c(this,"OldEntity");c(this,"FieldName")}}var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs(l){return l&&l.__esModule&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l}var dayjs_min={exports:{}};(function(l,i){(function(t,e){l.exports=e()})(commonjsGlobal,function(){var t=1e3,e=6e4,n=36e5,s="millisecond",a="second",r="minute",o="hour",h="day",d="week",u="month",m="quarter",f="year",p="date",E="Invalid Date",I=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,T=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,F={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(D){var y=["th","st","nd","rd"],g=D%100;return"["+D+(y[(g-20)%10]||y[g]||y[0])+"]"}},b=function(D,y,g){var w=String(D);return!w||w.length>=y?D:""+Array(y+1-w.length).join(g)+D},A={s:b,z:function(D){var y=-D.utcOffset(),g=Math.abs(y),w=Math.floor(g/60),C=g%60;return(y<=0?"+":"-")+b(w,2,"0")+":"+b(C,2,"0")},m:function D(y,g){if(y.date()<g.date())return-D(g,y);var w=12*(g.year()-y.year())+(g.month()-y.month()),C=y.clone().add(w,u),x=g-C<0,M=y.clone().add(w+(x?-1:1),u);return+(-(w+(g-C)/(x?C-M:M-C))||0)},a:function(D){return D<0?Math.ceil(D)||0:Math.floor(D)},p:function(D){return{M:u,y:f,w:d,d:h,D:p,h:o,m:r,s:a,ms:s,Q:m}[D]||String(D||"").toLowerCase().replace(/s$/,"")},u:function(D){return D===void 0}},V="en",U={};U[V]=F;var et="$isDayjsObject",J=function(D){return D instanceof Z||!(!D||!D[et])},j=function D(y,g,w){var C;if(!y)return V;if(typeof y=="string"){var x=y.toLowerCase();U[x]&&(C=x),g&&(U[x]=g,C=x);var M=y.split("-");if(!C&&M.length>1)return D(M[0])}else{var _=y.name;U[_]=y,C=_}return!w&&C&&(V=C),C||!w&&V},H=function(D,y){if(J(D))return D.clone();var g=typeof y=="object"?y:{};return g.date=D,g.args=arguments,new Z(g)},L=A;L.l=j,L.i=J,L.w=function(D,y){return H(D,{locale:y.$L,utc:y.$u,x:y.$x,$offset:y.$offset})};var Z=function(){function D(g){this.$L=j(g.locale,null,!0),this.parse(g),this.$x=this.$x||g.x||{},this[et]=!0}var y=D.prototype;return y.parse=function(g){this.$d=function(w){var C=w.date,x=w.utc;if(C===null)return new Date(NaN);if(L.u(C))return new Date;if(C instanceof Date)return new Date(C);if(typeof C=="string"&&!/Z$/i.test(C)){var M=C.match(I);if(M){var _=M[2]-1||0,k=(M[7]||"0").substring(0,3);return x?new Date(Date.UTC(M[1],_,M[3]||1,M[4]||0,M[5]||0,M[6]||0,k)):new Date(M[1],_,M[3]||1,M[4]||0,M[5]||0,M[6]||0,k)}}return new Date(C)}(g),this.init()},y.init=function(){var g=this.$d;this.$y=g.getFullYear(),this.$M=g.getMonth(),this.$D=g.getDate(),this.$W=g.getDay(),this.$H=g.getHours(),this.$m=g.getMinutes(),this.$s=g.getSeconds(),this.$ms=g.getMilliseconds()},y.$utils=function(){return L},y.isValid=function(){return this.$d.toString()!==E},y.isSame=function(g,w){var C=H(g);return this.startOf(w)<=C&&C<=this.endOf(w)},y.isAfter=function(g,w){return H(g)<this.startOf(w)},y.isBefore=function(g,w){return this.endOf(w)<H(g)},y.$g=function(g,w,C){return L.u(g)?this[w]:this.set(C,g)},y.unix=function(){return Math.floor(this.valueOf()/1e3)},y.valueOf=function(){return this.$d.getTime()},y.startOf=function(g,w){var C=this,x=!!L.u(w)||w,M=L.p(g),_=function(at,W){var it=L.w(C.$u?Date.UTC(C.$y,W,at):new Date(C.$y,W,at),C);return x?it:it.endOf(h)},k=function(at,W){return L.w(C.toDate()[at].apply(C.toDate("s"),(x?[0,0,0,0]:[23,59,59,999]).slice(W)),C)},$=this.$W,q=this.$M,K=this.$D,ct="set"+(this.$u?"UTC":"");switch(M){case f:return x?_(1,0):_(31,11);case u:return x?_(1,q):_(0,q+1);case d:var st=this.$locale().weekStart||0,ut=($<st?$+7:$)-st;return _(x?K-ut:K+(6-ut),q);case h:case p:return k(ct+"Hours",0);case o:return k(ct+"Minutes",1);case r:return k(ct+"Seconds",2);case a:return k(ct+"Milliseconds",3);default:return this.clone()}},y.endOf=function(g){return this.startOf(g,!1)},y.$set=function(g,w){var C,x=L.p(g),M="set"+(this.$u?"UTC":""),_=(C={},C[h]=M+"Date",C[p]=M+"Date",C[u]=M+"Month",C[f]=M+"FullYear",C[o]=M+"Hours",C[r]=M+"Minutes",C[a]=M+"Seconds",C[s]=M+"Milliseconds",C)[x],k=x===h?this.$D+(w-this.$W):w;if(x===u||x===f){var $=this.clone().set(p,1);$.$d[_](k),$.init(),this.$d=$.set(p,Math.min(this.$D,$.daysInMonth())).$d}else _&&this.$d[_](k);return this.init(),this},y.set=function(g,w){return this.clone().$set(g,w)},y.get=function(g){return this[L.p(g)]()},y.add=function(g,w){var C,x=this;g=Number(g);var M=L.p(w),_=function(q){var K=H(x);return L.w(K.date(K.date()+Math.round(q*g)),x)};if(M===u)return this.set(u,this.$M+g);if(M===f)return this.set(f,this.$y+g);if(M===h)return _(1);if(M===d)return _(7);var k=(C={},C[r]=e,C[o]=n,C[a]=t,C)[M]||1,$=this.$d.getTime()+g*k;return L.w($,this)},y.subtract=function(g,w){return this.add(-1*g,w)},y.format=function(g){var w=this,C=this.$locale();if(!this.isValid())return C.invalidDate||E;var x=g||"YYYY-MM-DDTHH:mm:ssZ",M=L.z(this),_=this.$H,k=this.$m,$=this.$M,q=C.weekdays,K=C.months,ct=C.meridiem,st=function(W,it,mt,Ct){return W&&(W[it]||W(w,x))||mt[it].slice(0,Ct)},ut=function(W){return L.s(_%12||12,W,"0")},at=ct||function(W,it,mt){var Ct=W<12?"AM":"PM";return mt?Ct.toLowerCase():Ct};return x.replace(T,function(W,it){return it||function(mt){switch(mt){case"YY":return String(w.$y).slice(-2);case"YYYY":return L.s(w.$y,4,"0");case"M":return $+1;case"MM":return L.s($+1,2,"0");case"MMM":return st(C.monthsShort,$,K,3);case"MMMM":return st(K,$);case"D":return w.$D;case"DD":return L.s(w.$D,2,"0");case"d":return String(w.$W);case"dd":return st(C.weekdaysMin,w.$W,q,2);case"ddd":return st(C.weekdaysShort,w.$W,q,3);case"dddd":return q[w.$W];case"H":return String(_);case"HH":return L.s(_,2,"0");case"h":return ut(1);case"hh":return ut(2);case"a":return at(_,k,!0);case"A":return at(_,k,!1);case"m":return String(k);case"mm":return L.s(k,2,"0");case"s":return String(w.$s);case"ss":return L.s(w.$s,2,"0");case"SSS":return L.s(w.$ms,3,"0");case"Z":return M}return null}(W)||M.replace(":","")})},y.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},y.diff=function(g,w,C){var x,M=this,_=L.p(w),k=H(g),$=(k.utcOffset()-this.utcOffset())*e,q=this-k,K=function(){return L.m(M,k)};switch(_){case f:x=K()/12;break;case u:x=K();break;case m:x=K()/3;break;case d:x=(q-$)/6048e5;break;case h:x=(q-$)/864e5;break;case o:x=q/n;break;case r:x=q/e;break;case a:x=q/t;break;default:x=q}return C?x:L.a(x)},y.daysInMonth=function(){return this.endOf(u).$D},y.$locale=function(){return U[this.$L]},y.locale=function(g,w){if(!g)return this.$L;var C=this.clone(),x=j(g,w,!0);return x&&(C.$L=x),C},y.clone=function(){return L.w(this.$d,this)},y.toDate=function(){return new Date(this.valueOf())},y.toJSON=function(){return this.isValid()?this.toISOString():null},y.toISOString=function(){return this.$d.toISOString()},y.toString=function(){return this.$d.toUTCString()},D}(),nt=Z.prototype;return H.prototype=nt,[["$ms",s],["$s",a],["$m",r],["$H",o],["$W",h],["$M",u],["$y",f],["$D",p]].forEach(function(D){nt[D[1]]=function(y){return this.$g(y,D[0],D[1])}}),H.extend=function(D,y){return D.$i||(D(y,Z,H),D.$i=!0),H},H.locale=j,H.isDayjs=J,H.unix=function(D){return H(1e3*D)},H.en=U[V],H.Ls=U,H.p={},H})})(dayjs_min);var dayjs_minExports=dayjs_min.exports;const dayjs=getDefaultExportFromCjs(dayjs_minExports);var vi={exports:{}};(function(l,i){(function(t,e){l.exports=e(dayjs_minExports)})(commonjsGlobal,function(t){function e(a){return a&&typeof a=="object"&&"default"in a?a:{default:a}}var n=e(t),s={name:"vi",weekdays:"chủ nhật_thứ hai_thứ ba_thứ tư_thứ năm_thứ sáu_thứ bảy".split("_"),months:"tháng 1_tháng 2_tháng 3_tháng 4_tháng 5_tháng 6_tháng 7_tháng 8_tháng 9_tháng 10_tháng 11_tháng 12".split("_"),weekStart:1,weekdaysShort:"CN_T2_T3_T4_T5_T6_T7".split("_"),monthsShort:"Th01_Th02_Th03_Th04_Th05_Th06_Th07_Th08_Th09_Th10_Th11_Th12".split("_"),weekdaysMin:"CN_T2_T3_T4_T5_T6_T7".split("_"),ordinal:function(a){return a},formats:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM [năm] YYYY",LLL:"D MMMM [năm] YYYY HH:mm",LLLL:"dddd, D MMMM [năm] YYYY HH:mm",l:"DD/M/YYYY",ll:"D MMM YYYY",lll:"D MMM YYYY HH:mm",llll:"ddd, D MMM YYYY HH:mm"},relativeTime:{future:"%s tới",past:"%s trước",s:"vài giây",m:"một phút",mm:"%d phút",h:"một giờ",hh:"%d giờ",d:"một ngày",dd:"%d ngày",M:"một tháng",MM:"%d tháng",y:"một năm",yy:"%d năm"}};return n.default.locale(s,null,!0),s})})(vi);dayjs.locale("vi");class Datepicker extends EditableComponent{constructor(t,e=null){var n;super(t,e);c(this,"HHmmFormat","00");c(this,"formats",["DD/MM/YYYY - HH:mm","DD/MM/YYYY - HH:m","DD/MM/YYYY - H:mm","DD/MM/YYYY - HH:","DD/MM/YYYY - H:","DD/MM/YYYY - H:m","DD/MM/YYYY - HH","DD/MM/YYYY - H","DD/MM/YYYY","DDMMYYYY","D/M/YYYY","DMYYYY","DD/MM/YY","DDMMYY","D/M","DM","DD/MM","DDMM"]);c(this,"calendar",null);c(this,"renderAwaiter",null);c(this,"closeAwaiter",null);c(this,"value");c(this,"_closeAwaiter");this.DefaultValue=dayjs(),this.Meta=t,this.InitFormat=(n=this.Meta.FormatData)!=null&&n.includes("{0:")?this.Meta.FormatData.replace("{0:","").replace("}",""):this.Meta.Precision===7?"dd/MM/yyyy - HH:mm":"DD/MM/YYYY",this.currentFormat=this.InitFormat,e!=null&&(e.firstElementChild instanceof HTMLInputElement?this.Input=e.firstElementChild:this.Input=Html.Take(e).Input.Context),this.value=null,this.nullable=!1,this.simpleNoEvent=!1,this.show=!1,this.someday=new Date,this.hour=null,this.minute=null}get Value(){return this.value}set Value(t){if(this.value!==t){if(this.value=t,this.value){const n=this.Input.selectionEnd;var e=Utils$1.IsFunction(this.Meta.FormatEntity);e?this.Input.value=e.call(this,t,this):this.Input.value=dayjs(this.value).format(this.InitFormat),this.Input.selectionStart=n,this.Input.selectionEnd=n}else this.nullable?this.Input.value=null:(this.value=new Date,this.Input.value=dayjs(this.value).format(this.InitFormat));this.Entity[this.Name]=this.value,this.Dirty=!0}}Render(){var e;this.SetDefaultVal(),this.Entity[this.Name]=this.value;let t="";this.Entity[this.Name]!==null&&(t=dayjs(this.Entity[this.Name]).format(this.InitFormat)),Html.Take(this.ParentElement),this.Input?(Html.Take(this.Input),this.Element=this.Input):(Html.Div.ClassName("datetime-picker").TabIndex(-1),Html.Input.Render(),this.Element=Html.Context,this.Input=this.Element),Html.Event("keydown",n=>{this.Disabled||!n||n.keyCode===13&&this.ParseDate()}).Value(t).Event("focus",()=>{if(this.simpleNoEvent){this.simpleNoEvent=!1;return}this.Meta.FocusSearch||this.RenderCalendar()}).Event("change",()=>this.ParseDate()).PlaceHolder(this.Meta.PlainText).Attr("autocomplete","off").Attr("name",this.Name),this.Input.addEventListener("keydown",n=>this.KeyDownDateTime(n)),(e=this.Input.parentElement)==null||e.addEventListener("focusout",()=>this.CloseCalendar()),Html.End.Div.ClassName("btn-group").Button.TabIndex(-1).Span.ClassName("fal fa-calendar").Event("click",()=>{this.Input.Disabled||(this.show?this.CloseCalendar():this.RenderCalendar())})}KeyDownDateTime(t){if(t.KeyCodeEnum()===KeyCodeEnum.Enter&&this.value===null){if(this.Disabled)return;this.show?this.CloseCalendar():this.RenderCalendar()}}IsNullable(t){return this.Entity===null||Utils$1.IsNullable(this.Name,this.Entity)}ParseDate(){if(Utils$1.isNullOrWhiteSpace(this.Input.value)){this.Input.value="",this.TriggerUserChange(null);return}const{parsed:t,datetime:e,format:n}=this.TryParseDateTime(this.Input.value);if(t)this.Value=e,this.TriggerUserChange(e);else{if(this.EditForm.Meta.CustomNextCell)return;this.Input.value="",this.TriggerUserChange(null)}}CloseCalendar(){this._closeAwaiter=setTimeout(()=>{this.show=!1,this.calendar&&(this.calendar.style.display="none"),this.Input.value=this.value?dayjs(this.value).format(this.InitFormat):"",this.hour=null,this.minute=null},250)}RenderCalendar(t=null){this.Disabled||(clearTimeout(this._closeAwaiter),this._closeAwaiter=setTimeout(()=>{this.RenderCalendarTask(t||this.value||new Date)},100))}RenderCalendarTask(t){if(this.Disabled)return;let e=t||this.value||new Date;this.show=!0,clearTimeout(this._closeAwaiter),this.calendar?(this.calendar.innerHTML="",this.calendar.style.display=""):(Html.Take(document.body).Div.ClassName("datepicker-content open open-up").TabIndex(-1).Trigger("focus"),this.calendar=Html.Context),Html.Take(this.calendar).Div.ClassName("calendar-container datepicker").Div.ClassName("v2-calendar relative").Div.ClassName("calendar-header day-select").Div.ClassName("relative flex justify-space align-center").Div.ClassName("icon-calendar-header left-icon fal fa-arrow-left").Event("click",()=>{e.setDate(1),e.setMonth(e.getMonth()-1),this.RenderCalendarTask(e)}).End.Div.ClassName("calender-current-date").Span.IText(e.getMonth()+1).End.End.Div.ClassName("icon-calendar-header right-icon fal fa-arrow-right").Event("click",()=>{e.setDate(1),e.setMonth(e.getMonth()+1),this.RenderCalendarTask(e)}).End.Div.ClassName("icon-calendar-header left-icon fal fa-arrow-left").Event("click",()=>{e.setDate(1),e.setFullYear(e.getFullYear()-1),this.RenderCalendarTask(e)}).End.Div.ClassName("calender-current-date").Span.IText(e.getFullYear()).End.End.Div.ClassName("icon-calendar-header right-icon fal fa-arrow-right").Event("click",()=>{e.setDate(1),e.setFullYear(e.getFullYear()+1),this.RenderCalendarTask(e)}).End.End.End.Div.ClassName("separate-line-header").End.Div.ClassName("calendar-body").Table.ClassName("calendar-table").Thead.TRow.Th.Text("T2").End.Th.Text("T3").End.Th.Text("T4").End.Th.Text("T5").End.Th.Text("T6").End.Th.Text("T7").End.Th.Text("CN").End.End.End.TBody.ClassName("date-in-month").Render();const n=new Date,s=new Date(e.getFullYear(),e.getMonth(),1),a=new Date(e.getFullYear(),e.getMonth()+1,0);for(var r=new Date(s);r.getDay()!==1;)r.setDate(r.getDate()-1);for(var o=new Date(a);o.getDay()!==0;)o.setDate(o.getDate()+1);(o-r)/(1e3*60*60*24*7)>=6&&o.setDate(o.getDate()-7);var h=new Date(r);const d=this.SetSelectedDay.bind(this);for(;h<=o;)for(var u=0;u<7;u++)h.getDay()===1&&Html.Instance.TRow.Render(),h<s||h>a?Html.Instance.TData.ClassName("ms-date").Text(""):Html.Instance.TData.ClassName("date-in-table ms-date").Text(h.getDate().toString()).Event("click",d,h),h.getDate()===n.getDate()&&h.getMonth()===n.getMonth()&&h.getFullYear()===e.getFullYear()&&Html.Instance.ClassName("date-in-table ms-date ms-date-current"),this.value&&h.getDate()===this.value.getDate()&&h.getMonth()===this.value.getMonth()&&h.getFullYear()===this.value.getFullYear()&&Html.Instance.ClassName("date-in-table ms-date ms-date-day-seleted"),Html.Instance.End.Render(),h.getDay()===0&&Html.Instance.End.Render(),h=h.addDays(1);Html.Instance.End.End.Div.ClassName("SeparateLine").End.End.Render(),this.Meta.Precision===7&&Html.Instance.Div.ClassName("Time").Div.ClassName("ms-label mr-12-px ms-label-bold").IText("Time").End.Div.ClassName("change-hour").Div.ClassName("ms-number ms-number-container input-time").Span.Div.ClassName("ms-number-group").Div.ClassName("ms-number-input").Input.Value(e.getHours().toString().padStart(2,"0")).Event("click",()=>clearTimeout(_closeAwaiter)).Event("change",this.ChangeHour).End.End.End.End.End.Div.ClassName("ms-label mr-6-px ml-6-px").Text(":").End.Div.ClassName("change-minute").Div.ClassName("ms-number ms-number-container input-time").Span.Div.ClassName("ms-number-group").Div.ClassName("ms-number-input").Input.Value(e.getMinutes().toString().padStart(2,"0")).Event("click",()=>clearTimeout(_closeAwaiter)).Event("change",this.ChangeMinute).End.End.End.End.End.End.Render(),Html.Instance.Div.ClassName("calendar-footer").Button.Event("click",()=>{this.TriggerUserChange(n)}).ClassName("pick-today-button").IText("Today").End.End.End.End.Render(),ComponentExt.AlterPosition(this.calendar,this.Element);const m=this.Element.closest(".scroll-content");m&&m.addEventListener("scroll",ComponentExt.AlterPosition(this.calendar,this.Element))}TryParseDateTime(t){let e=dayjs(),n=!1,s=null;for(let a=0;a<this.formats.length;a++)if(e=dayjs(t,this.formats[a],!0),e.isValid()){n=!0,s=this.formats[a];break}return{parsed:n,dateTime:e,format:s}}TriggerUserChange(t){var s;if(this.Disabled)return;let e=this.value;this.Value=t;var n={NewData:this.value,OldData:e,EvType:"change"};(s=this.UserInput)==null||s.invoke(n),this.PopulateFields(),this.CascadeField(),this.simpleNoEvent=!0,this.Input.focus()}SetSelectedDay(t,e){this.CloseCalendar(),this.TriggerUserChange(e)}IncreaseTime(t,e=!1){let n=this.value||this.someday;e?(n.setMinutes(n.getMinutes()+t),this.minute.value=n.getMinutes().toString().padStart(2,"0")):(n.setHours(n.getHours()+t),this.hour.value=n.getHours().toString().padStart(2,"0")),this.TriggerUserChange(n)}ChangeHour(t){let e=parseInt(this.hour.value);if(isNaN(e)||e<0||e>23)return;let n=this.value||this.someday;n.setHours(e),this.TriggerUserChange(n)}ChangeMinute(t){let e=parseInt(this.minute.value);if(isNaN(e)||e<0||e>59)return;let n=this.value||this.someday;n.setMinutes(e),this.TriggerUserChange(n)}ChangeHourMinuteHotKey(t){t.KeyCode()===KeyCodeEnum.UpArrow?this.IncreaseTime(1,t.target===this.minute):t.KeyCode()===KeyCodeEnum.DownArrow&&this.IncreaseTime(-1,t.target===this.minute)}ValidateAsync(){if(!this.ValidationRules||this.ValidationRules.Nothing())return Promise.resolve(!0);let t=!0;return["gt","lt","min","max","eq","ne"].forEach(n=>{t=t&&this.Validate(n,this.value)}),Promise.resolve(t)}Validate(t,e){switch(t){case"gt":return e>new Date(this.Meta.MinDate);case"lt":return e<new Date(this.Meta.MaxDate);default:return!0}}RemoveDOM(){var t;(t=this.Element)!=null&&t.parentElement&&(this.Element.parentElement.innerHTML=Str.Empty,this.Element=null)}SetDisableUI(t){var e;return this.Input&&(this.Input.readonly=t),(e=this.FieldVal)==null?void 0:e.toString()}}class Checkbox extends EditableComponent{constructor(t,e=null){super(t);c(this,"_value",null);c(this,"_input",null);if(!t)throw new Error("ui is required");this.Meta=t,this.ParentElement=e,e&&e.tagName.toLowerCase()==="input"?(this.Element=e,this._input=e):this.ParentElement=e,this.DefaultValue=!1}Render(){var t,e;this.ParentElement!=null&&this.Element==null&&(Html.Take(this.ParentElement).TabIndex(-1).SmallCheckbox(this._value??!1),this._input=Html.Context.previousElementSibling),this.Element=this._input.parentElement??this._input,Html.Take(this._input).Event("input",this.UserChange.bind(this)),this.SetDisableUI(!this.Meta.Editable),this.SetDefaultVal(),this.Value=Utils$1.GetPropValue(this.Entity,this.Name),this.Entity[this.Name]=this._value,(t=this.Element.closest("td"))==null||t.addEventListener("keydown",this.ListViewItemTab.bind(this)),(e=this.DOMContentLoaded)==null||e.invoke()}GetValueText(){return this._value===null?"N/A":this._value?"Check":"Not check"}UserChange(t){if(this.Disabled){t.preventDefault();return}const e=this._input.checked;this.DataChanged(e)}DataChanged(t){var s;const e=this._value;this._value=t,this.Entity&&(this.Entity[this.Name]=t),this.Dirty=!0;var n=new ObservableArgs({NewData:this._value,OldData:e,EvType:EventType.Change}),n={NewData:this._value,OldData:e,EvType:EventType.Change};(s=this.UserInput)==null||s.invoke(n),this.PopulateFields(),this.CascadeField(),this.DispatchEvent(this.Meta.Events,EventType.Change,this.Entity).Done()}get Value(){return this._value}set Value(t){this._value=t,this._input.checked=t}UpdateView(t=!1,e=null,...n){var a;const s=(a=this.Entity)==null?void 0:a.GetComplexProp(this.Name);this.Value=s,this.Dirty||(this.OldValue=this._input.value)}SetDisableUI(t){t?this.Element.setAttribute("disabled","disabled"):this.Element.removeAttribute("disabled"),this._input.disabled=t}}class ConfirmDialog extends EditableComponent{constructor(){super(null);c(this,"DivElement");c(this,"DisposeAfterYes",!0);c(this,"YesConfirmed",new Action);c(this,"NoConfirmed",new Action);this._yesBtn=null,this.PElement=null,this.OpenEditForm=null,this.Textbox=null,this.Number=null,this.Datepicker=null,this.Precision=null,this.SearchEntry=null,this.Canceled=null,this.IgnoreNoButton=!1,this.MultipleLine=!0,this.YesText="Đồng ý",this.NoText="Không",this.CancelText="Đóng",this.Content="Bạn có chắc chắn muốn xóa dữ liệu?",this.NeedAnswer=!1,this.ComType="Textbox",this.IgnoreCancelButton=!0,this.PopulateDirty=!1,this.Title="Xác nhận"}Render(){if(Html.Take(this.PElement||document.body),Html.Div.ClassName("backdrop").Style("align-items: center;").Escape(()=>this.Dispose()),this.PElement&&Html.Instance.Style("position: fixed !important;"),this.Element=Html.Context,this.ParentElement=this.Element.parentElement,Html.Instance.Div.ClassName("popup-content confirm-dialog").Style("top: auto;").Div.ClassName("popup-title").IHtml(this.Title).Div.ClassName("icon-box").Span.ClassName("fa fa-times").Event("click",()=>this.CloseDispose()).EndOf(".popup-title").Div.ClassName("popup-body").P.IHtml(this.Content).End.Div.ClassName("box-shadow panel group").Event("keydown",e=>this.HotKeyHandler(e)).MarginRem("top",1).TextAlign("center"),this.DivElement=Html.Context,this.NeedAnswer){if(this.ComType==="Textbox"){const e=new Component;e.PlainText="Nhập câu trả lời",e.ShowLabel=!1,e.FieldName=Message.ReasonOfChange,e.Row=2,e.MultipleLine=this.MultipleLine;const n=new Textbox(e);this.AddChild(n),Html.Instance.End.Render()}if(this.ComType==="Number"){const e={PlainText:"Nhập số",FieldName:"ReasonOfChange",Visibility:!0,ShowLabel:!1},n=new Numbox(e);this.AddChild(n)}if(this.ComType==="Datepicker"){const e={plainText:"Chọn ngày",showLabel:!1,fieldName:"ReasonOfChange",row:2,focusSearch:!0,visibility:!0,precision:this.Precision},n=new Datepicker(e);this.AddChild(n)}}Html.Instance.Button2(this.YesText,"btn btn-success mt-2","fal fa-check").Event("click",()=>{this.ValidateAsync().then(e=>{var n;if(e){try{this.YesConfirmed&&((n=this.YesConfirmed)==null||n.invoke())}catch(s){console.error(s.stack)}this.DisposeAfterYes&&this.Dispose()}})}).End.Render(),this._yesBtn=Html.Context,this.IgnoreNoButton||Html.Instance.Button2(this.NoText,"btn btn-danger  mt-2","fal fa-window-close").MarginRem("left",1).Event("click",()=>{var e;try{(e=this.NoConfirmed)==null||e.invoke()}catch(n){console.error(n.stack)}this.CloseDispose()}).End.Render(),this.IgnoreCancelButton||Html.Instance.Button2(this.CancelText,"btn btn-success mt-2","fal fa-times").MarginRem("left",1).Event("click",()=>this.Dispose()).Render()}Dispose(){super.Dispose()}CloseDispose(){this.Canceled&&this.Canceled(),super.Dispose()}static RenderConfirm(t,e,n=null){const s=new ConfirmDialog;return s.Content=t,s.Render(),s.YesConfirmed=e,s.NoConfirmed=n,s}HotKeyHandler(t){t.KeyCode()===KeyCodeEnum.Enter&&this._yesBtn.click()}}const B=class B extends EditableComponent{constructor(i,t){super(i,t),this._path="",this._input=document.createElement("input"),this._preview=null,this._disabledDelete=!1,this._gallerys=document.createElement("div"),this.DataSource=this.Meta.Template||"image/*",this.DefaultValue="",this.FileUploaded=new Action,this.zoomLevel=0,this.flagZoomIn=1,this.zoomMaxLevel=3}get Path(){return this._path}set Path(i){if(this.Element.parentElement.querySelectorAll(".gallery").forEach(n=>n.remove()),this._path=i,this.Entity&&(this.Entity[this.Name]=this._path),!this._path||this._path.trim()==="")return;const e=this._path.split(B.PathSeparator);!e||e.length===0||e.forEach(n=>{this.RenderFileThumb(n)})}get ImageSources(){return this.Path?this.Path.split(B.PathSeparator):null}Render(){var i,t,e;this._path=(i=Utils$1.GetPropValue(this.Entity,this.Name))==null?void 0:i.toString(),this._path&&this._path.split(B.PathSeparator),this.RenderUploadForm(),this.Path=this._path,(t=this.DOMContentLoaded)==null||t.invoke(),(e=this.Element.closest("td"))==null||e.addEventListener("keydown",this.ListViewItemTab)}RenderFileThumb(i){const t=document.createElement("div");t.className="gallery",this._gallerys.appendChild(t);const e=this.RemoveGuid(i);if(Utils$1.IsImage(i)){const s=document.createElement("img");s.className="image",Object.assign(s.style,this.Meta.ChildStyle),s.src=i.includes("http")?i:Client.Origin+Utils$1.DecodeSpecialChar(i),t.appendChild(s),s.addEventListener("click",()=>this.Preview(i))}else{const s=document.createElement("a");s.className=e.includes("pdf")?"fal fa-file-pdf":"fal fa-file",s.title=Utils$1.DecodeSpecialChar(e),Object.assign(s.style,this.Meta.ChildStyle),s.href=i.includes("http")?i:Client.Origin+Utils$1.DecodeSpecialChar(i),t.appendChild(s)}if(!this.Disabled){const s=document.createElement("i");s.className="fas fa-trash-alt",s.addEventListener("click",()=>this.RemoveFile(i)),t.appendChild(s)}return this._gallerys}RemoveGuid(i){let t=i;if(i.length>B.GuidLength){const e=Utils$1.GetFileNameWithoutExtension(i);t=e.substring(0,e.length-B.GuidLength)+"."+i.split(".").pop()}return t}SetCanDeleteImage(i){this._disabledDelete=!i,i&&this.UpdateView()}Preview(i){if(!Utils$1.IsImage(i)){console.log("Not an image: Downloading file."),window.location.href=i;return}let t=document.createElement("img");t.src=i,t.style.cssText="width:100%;",this._preview&&this._preview.remove(),this._preview=t,document.body.appendChild(t),t.addEventListener("click",()=>{t.remove(),this._preview=null}),zoom()}ZoomImage(i){this.flagZoomIn<this.zoomMaxLevel?(this.zoomLevel===0||this.zoomLevel<this.zoomMaxLevel)&&(i.style.cursor="zoom-in",i.height+=450,i.width+=400,this.zoomLevel++,this.flagZoomIn++):this.flagZoomIn===this.zoomMaxLevel&&(this.zoomLevel===1&&(this.flagZoomIn=1),i.style.cursor="zoom-out",i.height-=450,i.width-=400,this.zoomLevel--)}MoveAround(i,t){const e=i.keyCode;if(![37,39].includes(e))return;const n=i.target.querySelector("img");n&&(e===37?this.MoveLeft(t,n):e===39&&this.MoveRight(t,n))}MoveLeft(i,t){const e=this.Path.split("    ");let n=e.indexOf(i);return n===0?n=e.length-1:n--,t.Src=(this.Path.includes("http")?"":Client.Origin)+e[n],e[n]}MoveRight(i,t){const e=this.Path.split("    ");let n=e.indexOf(i);return n===e.length-1?n=0:n++,t.Src=(this.Path.includes("http")?"":Client.Origin)+e[n],e[n]}OpenFileDialog(i){this.Disabled||this.OpenNativeFileDialog(i)}RenderUploadForm(){var i=this.Meta.Precision==0;this.Meta.VirtualScroll?(Html.Take(this.ParentElement).Div.ClassName("ms-upload").Div.ClassName("ms-title-upload").Div.ClassName("attach-text").Div.ClassName("mi mi-18 mi-attach m-r-8 cursor-default").End.Div.IText(this.Meta.Label??"Attach").End.End.Div.ClassName("max-size-upload").IText("Maximum size 5MB").End.End.Span.Div.ClassName("ms-img-upload").Div.ClassName("ms-input-upload").Input.Type("file").Attr("title","").Attr("accept",""),i&&Html.Instance.Attr("multiple","multiple"),this.Element=this._input=Html.Context,this.Element.addEventListener("drop",t=>this.UploadDropImages(t)),this.Element.addEventListener("change",t=>this.UploadSelectedImages(t)),this.CanWrite||(this._input.readOnly=!0),Html.Instance.End.Div.ClassName("w-full-100").Div.ClassName("w-full-100").End.Div.ClassName("img-upload"),this._gallerys=Html.Context,Html.Instance.End.End.Span.ClassName("text-input").IText("Drag/drop files here or click here").EndOf(".ms-upload").End.Render()):(Html.Take(this.ParentElement).ClassName("choose-files-file").Input.Type("file").Attr("name","files").ClassName("d-none").Attr("accept",DataSourceFilter),Element=_input=Html.Context,this.Element.addEventListener("change",t=>this.UploadSelectedImages(t)),i&&Html.Instance.Attr("multiple","multiple"),Html.Take(this.ParentElement).Div.ClassName("file-upload"),this.CanWrite&&Html.Instance.I.ClassName("fal fa-cloud-upload").Event(EventType.Click,this.OpenFileDialog).End.Render(),Html.Instance.Div.ClassName("gallerys-file").Render(),this._gallerys=Html.Context)}RemoveFile(i,t){if(this.Disabled||(i.StopPropagation(),!t||t.trim()===""))return;const n=`Bạn chắc chắn muốn xóa ${Utils$1.GetFileNameWithoutExtension(this.RemoveGuid(Utils$1.DecodeSpecialChar(t)))+Utils$1.GetExtension(this.RemoveGuid(Utils$1.DecodeSpecialChar(t)))}`;ConfirmDialog.RenderConfirm(n,()=>{Client.Instance.PostAsync(t,Client.FileFTP+"/DeleteFile").then(s=>{var h;const a=this._path,r=this._path.replace(t,"").replace(B.PathSeparator+B.PathSeparator,"").split(B.PathSeparator).filter(d=>d!=null).Distinct();this.Path=r.join(B.PathSeparator),this.dirty=!0;const o={NewData:this._path,OldData:a,FieldName:this.Name,EvType:EventType.Change};(h=this.UserInput)==null||h.Invoke(o),this.DispatchEvent(this.Meta.Events,EventType.Change,this.Entity)})})}UploadSelectedImages(i){if(i.preventDefault(),this.EditForm.IsLock){console.log("Edit form is locked.");return}const t=i.target.files;if(!t.length){console.log("No files selected.");return}const e=this._path;this.UploadAllFiles(t).then(()=>{var s;this.Dirty=!0,this._input.value="";const n={NewData:this._path,OldData:e,FieldName:this.Name,EvType:EventType.Change};(s=this.UserInput)==null||s.Invoke(n),this.DispatchEvent(this.Meta.Events,EventType.Change,this.Entity)}).catch(n=>{console.error("Failed to upload files:",n)})}UpdateView(i=!1,t=null,...e){var n;this.Path=(n=Utils$1.GetPropValue(this.Entity,this.Name))==null?void 0:n.toString(),super.UpdateView(i,t,...e)}async UploadFile(i){if(this.Meta.IsRealtime||!i.type.match("image.*"))try{return await Client.Instance.PostFilesAsync(i,Utils$1.FileSvc)}catch(t){throw console.error("Error posting file:",t),t}else return new Promise((t,e)=>{const n=new FileReader;n.onload=async s=>{try{const a=await Utils$1.UploadBase64Image(s.target.result,i.name);t(a),await Client.Instance.PatchAsync({Table:"FileUpload",Changes:[{Field:"Id",Value:Uuid7.Id25()},{Field:"EntityName",Value:this.Meta.RefName},{Field:"RecordId",Value:this.EntityId},{Field:"SectionId",Value:this.Meta.ComponentGroupId},{Field:"FieldName",Value:this.Name},{Field:"FileName",Value:i.name},{Field:"FilePath",Value:a}]})}catch(a){console.error("Error in file upload process:",a),e(a)}},n.readAsDataURL(i)})}async UploadAllFiles(i){var n;Spinner.AppendTo(this.EditForm.Element);const t=Array.from(i).map(this.UploadFile);let e=await Promise.all(t);if(e.length){if(this.Meta.Precision===0){const s=this.Path+B.PathSeparator+e.join(B.PathSeparator);e=[...new Set(s.trim().split(B.PathSeparator))]}this._path,this.Path=e.join(B.PathSeparator),Spinner.Hide(),(n=this.FileUploaded)==null||n.Invoke()}}OpenNativeFileDialog(i){i==null||i.preventDefault(),this._input.click()}GetValueText(){return!this.ImageSources||this.ImageSources.length===0?null:this.ImageSources.map(i=>{const t=this.RemoveGuid(i);return`<a target="_blank" href="${i}">${t}</a>`}).join(",")}};c(B,"PathSeparator","    "),c(B,"PNGUrlPrefix","data:image/png;base64,"),c(B,"JpegUrlPrefix","data:image/jpeg;base64,"),c(B,"GuidLength",36);let Image=B;class Button extends EditableComponent{constructor(t,e=null){super(t);c(this,"IsButton",!0);this.Meta=t,this.ButtonEle=e,this._textEle=null}Render(){var t,e;if(this.ButtonEle)this.Element=this.ButtonEle;else{if(!this.ParentElement)throw new Error("ParentElement is required");Html.Take(this.ParentElement).Button.Render(),this.Element=this.ButtonEle=Html.Context}Html.Take(this.Element).ClassName(this.Meta.ClassName).Event("click",()=>this.DispatchClick()).Style(this.Meta.Style),this.Meta.Icon&&Html.Icon(this.Meta.Icon).End.Text(" ").Render(),Html.Span.ClassName("caption").IText(this.Meta.Label||""),this._textEle=Html.Context,(t=this.Element.closest("td"))==null||t.addEventListener("keydown",n=>this.ListViewItemTab(n)),(e=this.DOMContentLoaded)==null||e.invoke()}async DispatchClick(){if(!(this.Disabled||this.Element.hidden)){this.Disabled=!0;try{Spinner.AppendTo(this.Element),this.DispatchEvent(this.Meta.Events,"click",this.Entity,this).then(()=>{this.Disabled=!1,Spinner.Hide()})}finally{window.setTimeout(()=>{this.Disabled=!1},2e3)}}}GetValueText(){var t;return!this.Entity||!this.Name?this._textEle.textContent:(t=this.FieldVal)==null?void 0:t.toString()}}class ObservableList{constructor(i=[]){this._data=i,this.Listeners=[]}Clear(){for(;this._data.length;)this._data.pop()}Subscribe(i){this.Listeners.push(i)}Unsubscribe(i){this.Listeners=this.Listeners.filter(t=>t!==i)}Notify(i,t,e){const n={ListData:this._data,Item:t,Index:e,Action:i};this.Listeners.forEach(s=>s(n))}get Data(){return this._data}set Data(i){this._data=i,this.Notify("Render")}Add(i,t=this._data.length){this._data.splice(t,0,i),this.Notify("Add",i,t)}Remove(i){const t=this._data.indexOf(i);t>-1&&(this._data.splice(t,1),this.Notify("Remove",i,t))}RemoveAt(i){if(i>=0&&i<this._data.length){const t=this._data[i];this._data.splice(i,1),this.Notify("Remove",t,i)}}Update(i,t){t>=0&&t<this._data.length&&(this._data[t]=i,this.Notify("Update",i,t))}}let SearchEntry$1=class extends EditableComponent{constructor(i,t=null){super(i);c(this,"IsSearchEntry",!0);c(this,"IsMultiple",!1);c(this,"_findMatchTextAwaiter");this.DefaultValue="",this.SEntryClass="search-entry",this.Meta.ComponentGroup=null,this.Meta.Row=this.Meta.Row??50,this.RowData=new ObservableList,this._input=null,this._rootResult=null,this._parentInput=null,this._backdrop=null,this._waitForInput=null,this._waitForDispose=null,this._contextMenu=!1,this.SearchResultEle=null,this._gv=null,this.DisplayField=this.Meta.FieldName.substring(0,this.Meta.FieldName.length-2)}Render(){this.SetDefaultVal(),this._value=this.Entity[this.Name],this.RenderInputAndEvents(),this.RenderIcons(),this.FindMatchText(),this.SearchResultEle=this.Element.closest("div")}RenderInputAndEvents(){if(this.ParentElement.tagName=="INPUT"&&(this.Element=this._input=this.ParentElement),this.Element==null)this.Element=this._input=Html.Take(this.ParentElement).Div.Position(PositionEnum.relative).TabIndex(-1).ClassName(this.SEntryClass).Input.GetContext(),this._parentInput=this._input.parentElement;else if(this._input=this.Element,!this._input.parentElement.classList.includes(this.SEntryClass)){var i=document.createElement("div");i.classList.add(this.SEntryClass),this._input.parentElement.appendChild(i),this._input.parentElement.insertBefore(i,this._input)}this._input.autocomplete="off",Html.Take(this._input).PlaceHolder(this.Meta.PlainText).Event(EventType.ContextMenu,()=>this._contextMenu=!0).Event(EventType.Focus,this.FocusIn.bind(this)).Event(EventType.FocusOut,this.DiposeGvWrapper.bind(this)).Event(EventType.Click,this.SEClickOpenRef.bind(this)).Event(EventType.Change,this.SEChangeHandler.bind(this)).Event(EventType.Input,()=>this.Search(this._input.value,!1,null,!0,!1))}SEClickOpenRef(){this.Disabled&&!this.Meta.FocusSearch&&this.OpenRefDetail()}SEChangeHandler(){this._value===null&&(this._input.value="")}SEKeydownHandler(i){var e,n;if(this.Disabled||i===null)return;let t=i.KeyCodeEnum();switch(t){case KeyCodeEnum.Escape:this._gv!==null&&(i.stopPropagation(),this._gv.Show=!1);break;case KeyCodeEnum.UpArrow:((e=this._gv)==null?void 0:e.Element)!==null&&this._gv.Show&&(i.stopPropagation(),this._gv.MoveUp());break;case KeyCodeEnum.DownArrow:((n=this._gv)==null?void 0:n.Element)!==null&&this._gv.Show&&(i.stopPropagation(),this._gv.MoveDown());break;case KeyCodeEnum.Enter:this.EnterKeydownHandler(t);break;case KeyCodeEnum.F6:this._gv!==null&&this._gv.Show&&(i.preventDefault(),this._gv.HotKeyF6Handler(i,KeyCodeEnum.F6));break;default:i.shiftKey&&t===KeyCodeEnum.Delete&&(this._input.value=null,this.Search());break}}EnterKeydownHandler(i){if(this.Meta.HideGrid){this.Search(this._input.value,!0,0,!0);return}this.EditForm.Meta.CustomNextCell&&(this._gv===null||!this._gv.Show)||(this._gv!==null&&this._gv.Show?this.EnterKeydownTableStillShow(i):this.Search(null,!0,0))}EnterKeydownTableStillShow(i){var t,e,n;if(this._gv.SelectedIndex>=0){let s=(t=this._gv)==null?void 0:t.AllListViewItem.find(a=>a.RowNo===this._gv.SelectedIndex).Entity;this.EntrySelected(s)}else((e=this._gv)==null?void 0:e.RowData)!==null&&this._gv.RowData.Data.length===1&&i===KeyCodeEnum.Enter&&this.EntrySelected((n=this._gv)==null?void 0:n.RowData.Data[0])}FocusIn(){if(this.ParentElement.classList.add("cell-selected"),this._contextMenu){this._contextMenu=!1;return}this.Disabled||this.Meta.FocusSearch||this.Search(null,!1,0)}FocusOut(){this.ParentElement.classList.remove("cell-selected")}Dispose(){this.DisposeGv(),super.Dispose()}DiposeGvWrapper(i=null){window.clearTimeout(this._waitForDispose),this._waitForDispose=window.setTimeout(this.DisposeGv.bind(this),50)}DisposeGv(){this.DisposeMobileSearchResult(),this._gv!==null&&(this._gv.Show=!1),this._parentInput.appendChild(this._input)}RenderIcons(){let i=LangSelect.Get("Tạo mới dữ liệu ");Html.Take(this.Element.parentElement).Div.ClassName("search-icons");let t=Html.Instance.Icon("fa fa-info-circle").Title(LangSelect.Get("Thông tin chi tiết ")+LangSelect.Get(this.Meta.Label)).Event("click",this.OpenRefDetail.bind(this)).End.Icon("fa fa-plus").Title(`${i} ${LangSelect.Get(this.Meta.Label)}`).Event("click",this.OpenRefDetail.bind(this)).End.GetContext();this.Element.nextElementSibling!==null?this.Element.parentElement.insertBefore(t,this.Element.nextElementSibling):this.Element.parentElement.appendChild(t)}OpenRefDetail(){!this.Meta.RefClass||this.Matched===null||ComponentExt.LoadFeature(this.Meta.RefClass).Done(this.FeatureLoaded.bind(this))}FeatureLoaded(feature){var i;let instance=new(eval(this.Meta.RefClass));instance.Id=feature.Name,instance.ParentForm=this.TabEditor,instance.ParentElement=this.TabEditor.Element,this.TabEditor.AddChild(instance);let res;if(!this.Meta.Template.trim()!==""){Utils$1.IsFunction(this.Meta.Template)?(i=Utils$1.IsFunction(this.Meta.Template))==null||i.call(null,res,this):res=Utils$1.FormatEntity2(this.Meta.Template,null,this.Matched,Utils$1.EmptyFormat,Utils$1.EmptyFormat);let t=JSON.parse(res);instance.Entity=t}instance.DOMContentLoaded+=()=>{let t=instance.FindComponentByName("Button"),e=document.createElement("td");t.Element.querySelector("tr").prepend(e),Html.Take(e).Button.ClassName("btn btn-secondary").Icon("fal fa-file-check").End.IText("Apply").Event("click",()=>{instance.IsFormValid().Done(s=>{s&&instance.SavePatch().Done(a=>{a&&(this.SaveAndApply(instance.Entity),instance.Dispose())})})}).End.Render()}}SaveAndApply(i){var e,n,s;let t=this.Value;if(this.Dirty=!0,this.Matched=i,!this.Parent.IsListViewItem){this.Value=(e=i[this.IdField])==null?void 0:e.toString(),this.Dirty=!0,this.Parent.EditForm.Dirty=!0,this.UserInput!==null&&(this.CascadeAndPopulate(),(n=this.UserInput)==null||n.Invoke({NewData:this._value,OldData:t,EvType:EventType.Change}));return}this.UserInput!==null&&(this.CascadeAndPopulate(),this.DispatchEvent(this.Meta.Events,EventType.Change,this.Entity,this.Parent.Entity,this.Matched),(s=this.UserInput)==null||s.Invoke({NewData:this._value,OldData:t,EvType:EventType.Change}))}Search(i=null,t=!0,e=500,n=!1,s=!1){this.Meta.HideGrid&&!s||(window.clearTimeout(this._waitForInput),this._waitForInput=window.setTimeout(()=>{if(this._gv!==null&&(this._gv.Wheres=[],this._gv.AdvSearchVM.Conditions=[],this._gv.CellSelected=[]),t&&!this._input.value){this.InputEmptyHandler(n);return}this.TriggerSearch(i)},e))}TriggerSearch(i=null){this.RenderGridView(Utils$1.DecodeSpecialChar(i))}async RenderGridView(i=null){var e,n,s;if(!this._isRendering){if(this._isRendering=!0,this._gv!==null){this.RenderRootResult(),this._gv.ParentElement=this._rootResult,this._gv.Entity=this.Entity,this._gv.ListViewSearch.EntityVM.SearchTerm=i,this._gv.RowData.Data=[],this._gv.ActionFilter(),this.GridResultDomLoaded(),this._isRendering=!1;return}Utils$1.isNullOrWhiteSpace(this.Meta.GroupBy)&&(this._gv=new GridView$1(this.Meta)),this.RenderRootResult(),this.ParentElement=this._rootResult,this._gv.EditForm=this.EditForm,this._gv.Meta=this.Meta,this._gv.ParentElement=this._rootResult,this._gv.Entity=this.Entity,this._gv.Parent=this,this._gv.AlwaysValid=!0,this._gv.PopulateDirty=!1,this._gv.ShouldSetEntity=!1,this._gv.DOMContentLoaded.add(this.GridResultDomLoaded.bind(this)),this._gv.AddSections(),this._gv.Show=!1,this._gv.Render(),this._gv.Element.classList.add("floating"),this._gv.RowClick.add(this.EntrySelected.bind(this)),this._isRendering=!1,this._gv.Paginator&&((e=this._gv.Paginator)==null?void 0:e.Element)!==null&&(this._gv.Paginator.Element.tabIndex=-1,this._gv.Paginator.Element.addEventListener("focusin",()=>window.clearTimeout(this._waitForDispose)),this._gv.Paginator.Element.addEventListener("focusout",this.DiposeGvWrapper.bind(this))),this._gv.MainSection&&((n=this._gv.MainSection)==null?void 0:n.Element)!==null&&(this._gv.MainSection.Element.tabIndex=-1,this._gv.MainSection.Element.addEventListener("focusin",()=>window.clearTimeout(this._waitForDispose)),this._gv.MainSection.Element.addEventListener("focusout",this.DiposeGvWrapper.bind(this))),this._gv.HeaderSection&&((s=this._gv.HeaderSection)==null?void 0:s.Element)!==null&&(this._gv.HeaderSection.Element.tabIndex=-1,this._gv.HeaderSection.Element.addEventListener("focusin",()=>window.clearTimeout(this._waitForDispose)),this._gv.HeaderSection.Element.addEventListener("focusout",this.DiposeGvWrapper.bind(this))),this.Meta.LocalHeader===null&&(this.Meta.LocalHeader=Array.from(this._gv.header.filter(a=>a.id!=null)));var t=this.Element.closest(".tab-item");t!=null&&t.addEventListener(EventType.Scroll,this.AlterPositionGV.bind(this))}}RenderRootResult(){this._rootResult===null&&(!this.IsSmallUp&&this._backdrop===null?(Html.Take(EditableComponent.TabContainer).Div.ClassName("backdrop"),this._backdrop=Html.Context,Html.Instance.Div.ClassName("popup-content").Style("top: 0;width: 100%;").Div.ClassName("popup-title").Span.IconForSpan("fal fal fa-search").End.Span.IText("Search").End.Div.ClassName("icon-box").Span.ClassName("fa fa-times").Event("click",this.DisposeMobileSearchResult.bind(this)).End.End.End.Div.ClassName("popup-body scroll-content"),this._rootResult=Html.Context,this._rootResult.appendChild(this._input)):this.IsSmallUp&&(this._rootResult=document.createElement("div"),this._rootResult.classList.add("result-wrapper"),this.SearchResultEle.appendChild(this._rootResult)))}DisposeMobileSearchResult(){this._parentInput.appendChild(this._input),this._backdrop!==null&&(this._backdrop.remove(),this._backdrop=null),this._rootResult!==null&&(this._rootResult.remove(),this._rootResult=null)}async GridResultDomLoaded(){var i;this.FocusBackWithoutEvent(),this._gv.SelectedIndex=-1,this._gv.RowAction(t=>{t.Selected=!1}),this._gv.Element.style.inset=null,this.RenderRootResult(),this._rootResult.appendChild(this._gv.Element),this.Meta.HideGrid||(this._gv.Show=!0),this.IsSmallUp?ComponentExt.AlterPosition(this._gv.Element,this._input):(this._gv.Element.style.maxWidth="100%",this._gv.Element.style.minWidth="calc(100% - 2rem)"),this.Meta.HideGrid&&this.EntrySelected((i=this._gv)==null?void 0:i.RowData.Data[0]),this.FocusBackWithoutEvent()}AlterPositionGV(){ComponentExt.AlterPosition(this._gv.Element,this._input)}FocusBackWithoutEvent(){window.clearTimeout(this._waitForDispose),window.clearTimeout(this._waitForInput),this.Meta.IsPivot||this._input.focus()}InputEmptyHandler(i){var n;let t=this._value,e=this.Matched;this.Matched=null,this._value=null,this._input.value="",e!==this.Matched&&(this.Entity[this.Name]=null,this.Dirty=!0,this.CascadeAndPopulate(),this.DispatchEvent(this.Meta.Events,EventType.Change,this.Entity,this.Matched,e).Done(),(n=this.UserInput)==null||n.Invoke({NewData:this._value,OldData:t,EvType:EventType.Change})),!(i&&!this._input.value)&&(this.IsMultiple&&(this._isRendering=!1),this.TriggerSearch(null))}FindMatchText(){this.Matched=this.Entity[this.DisplayField]||null,this.SetMatchedValue()}CascadeAndPopulate(){this.CascadeField(),this.PopulateFields(this.Matched)}SetMatchedValue(){this._input.value=this.EmptyRow?"":this.GetMatchedText(this.Matched),this.UpdateValue()}UpdateValue(){var i,t;this.Dirty||(this.OriginalText=this._input.value,(i=this.DOMContentLoaded)==null||i.invoke(),this.OldValue=(t=this._value)==null?void 0:t.toString())}PatchDetail(){let i=[{Label:this.ComLabel+"(value)",Field:this.Name,Value:this._value,OldVal:this.OldValue}];if(!this.Meta.FieldText){let t=Utils$1.GetPropValue(this.Entity,this.Meta.DisplayField)??{};t[this.Meta.DisplayDetail]=this._input.value,i.push({Label:this.ComLabel+"(text)",Field:this.Meta.DisplayField,Value:JSON.stringify(t),HistoryValue:this._input.value,OldVal:this.OriginalText})}return i}GetMatchedText(i){if(i===null&&this.Entity===null||!i)return"";let t=Utils$1.FormatEntity(this.Meta.FormatData,i);return Utils$1.DecodeSpecialChar(t??"")}EntrySelected(i){if(window.clearTimeout(this._waitForDispose),this.EmptyRow=!1,i===null||this.Disabled)return;let t=this.Matched;this.Matched=i;let e=this._value;this._value=i[this.IdField],this.Entity!==null&&this.Name&&(this.Entity[this.Name]=this._value),this.Dirty=!0,this.Matched=i,this.SetMatchedValue(),this._gv!==null&&(this._gv.Show=!1),this.CascadeAndPopulate(),this.DispatchEvent(this.Meta.Events,EventType.Change,this.Entity,i,t).Done(()=>{var n;(n=this.UserInput)==null||n.Invoke({NewData:this._value,OldData:e,EvType:EventType.Change}),this.DiposeGvWrapper()})}UpdateView(i=!1,t=null,...e){if(this._value=Utils$1.GetPropValue(this.Entity,this.Name),this._value===null){this.Matched=null,this._input.value=null,this.UpdateValue();return}this.FindMatchText()}async ValidateAsync(){return this.ValidationRules.Nothing()?!0:(this.ValidationResult.Clear(),this.ValidateRequired(this._value),this.Validate(ValidationRule.Equal,this._value,(i,t)=>i===t),this.Validate(ValidationRule.NotEqual,this._value,(i,t)=>i!==t),this.IsValid)}SetDisableUI(i){this._input!==null&&(this._input.readOnly=i)}RemoveDOM(){this._input!==null&&this._input.parentElement!==null&&this._input.parentElement.remove()}};const searchEntry=Object.freeze(Object.defineProperty({__proto__:null,SearchEntry:SearchEntry$1},Symbol.toStringTag,{value:"Module"})),pt=class pt extends EditableComponent{constructor(t,e=null){super(t);c(this,"time");this.Element=e||null,this.DefaultValue="",this.editor=null}Render(){this.Element||(this.ParentElement.style.textAlign="unset",Html.Take(this.ParentElement).Div.ClassName("code-editor").Style("height:150px;max-height:150px;position: relative;"),this.Element=Html.Context),this.Config().then(()=>{typeof require>"u"||require(["vs/editor/editor.main"],this.EditorLoaded.bind(this))})}UpdateView(t=!1,e=null,...n){this.editor.setValue(this.FieldVal)}async Config(){if(typeof require>"u"||pt._hasConfig)return;pt._hasConfig=!0,require.config({paths:{vs:"https://unpkg.com/monaco-editor@0.8.3/min/vs"}}),window.MonacoEnvironment={getWorkerUrl:()=>t};let t=URL.createObjectURL(new Blob([`
            self.MonacoEnvironment = {
                baseUrl: 'https://unpkg.com/monaco-editor@0.8.3/min/'
            };
            importScripts('https://unpkg.com/monaco-editor@0.8.3/min/vs/base/worker/workerMain.js');
            `],{type:"text/javascript"}))}EditorLoaded(){this.editor=monaco.editor.create(this.Element,{value:this.FieldVal??Str.Empty,language:this.Meta.Lang??"javascript",theme:this.Meta.Theme??"vs-light",automaticLayout:!0,minimap:{enabled:!1}}),window.addEventListener("resize",this.ResizeHandler.bind(this)),this.editor.getModel().onDidChangeContent(()=>{this.FieldVal=this.editor.getValue(),this.Dirty=!0}),this.Element.classList.add("code-editor"),this.Element.style.resize="both",this.Element.style.border="1px solid #dde",this.addEventListener("UpdateView",()=>{this.editor.setValue(this.FieldVal)}),Html.Take(this.Element).Icon("fal fal fa-compress-wide").Style("position: absolute; z-index: 1000; top: 0; right: 0;").Event("click",()=>{ComponentExt.FullScreen(this.Element)})}ResizeHandler(){window.clearTimeout(this.time),this.time=window.setTimeout(()=>{const t=this.Parent.Element.clientWidth-30;this.Element.style.width=t+"px"},200)}};c(pt,"_hasConfig");let CodeEditor=pt;class ComponentFactory{static GetComponent(i,t,e=null,n=!1){if(i===null)throw new Error("ui is required");if(!i.ComponentType)return null;i.ComponentType=i.ComponentType.trim();let s;switch(i.ComponentType){case"Input":s=new Textbox(i,e);break;case"Number":s=new Numbox(i,e);break;case"Datepicker":s=new Datepicker(i,e);break;case"Checkbox":s=new Checkbox(i,e);break;case"FileUpload":s=new Image(i,e);break;case"Button":s=new Button(i,e);break;case"GridView":s=new GridView$1(i,e);break;case"Dropdown":s=new SearchEntry$1(i,e);break;case"CodeEditor":s=new CodeEditor(i,e);break;default:s=new Textbox(i,e);break}return s.CanWrite=n,s[Utils$1.IdField]=`${i.Id.toString()}`,s.Name=i.FieldName,s.ComponentType=i.ComponentType,s.EditForm=t,s}}/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var extendStatics=function(l,i){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},extendStatics(l,i)};function __extends(l,i){extendStatics(l,i);function t(){this.constructor=l}l.prototype=i===null?Object.create(i):(t.prototype=i.prototype,new t)}function __values(l){var i=typeof Symbol=="function"&&l[Symbol.iterator],t=0;return i?i.call(l):{next:function(){return l&&t>=l.length&&(l=void 0),{value:l&&l[t++],done:!l}}}}function __read(l,i){var t=typeof Symbol=="function"&&l[Symbol.iterator];if(!t)return l;var e=t.call(l),n,s=[],a;try{for(;(i===void 0||i-- >0)&&!(n=e.next()).done;)s.push(n.value)}catch(r){a={error:r}}finally{try{n&&!n.done&&(t=e.return)&&t.call(e)}finally{if(a)throw a.error}}return s}function __spread(){for(var l=[],i=0;i<arguments.length;i++)l=l.concat(__read(arguments[i]));return l}var Event$1=function(){function l(i,t){this.target=t,this.type=i}return l}(),ErrorEvent=function(l){__extends(i,l);function i(t,e){var n=l.call(this,"error",e)||this;return n.message=t.message,n.error=t,n}return i}(Event$1),CloseEvent=function(l){__extends(i,l);function i(t,e,n){t===void 0&&(t=1e3),e===void 0&&(e="");var s=l.call(this,"close",n)||this;return s.wasClean=!0,s.code=t,s.reason=e,s}return i}(Event$1);/*!
 * Reconnecting WebSocket
 * by Pedro Ladaria <pedro.ladaria@gmail.com>
 * https://github.com/pladaria/reconnecting-websocket
 * License MIT
 */var getGlobalWebSocket=function(){if(typeof WebSocket<"u")return WebSocket},isWebSocket=function(l){return typeof l<"u"&&!!l&&l.CLOSING===2},DEFAULT={maxReconnectionDelay:1e4,minReconnectionDelay:1e3+Math.random()*4e3,minUptime:5e3,reconnectionDelayGrowFactor:1.3,connectionTimeout:4e3,maxRetries:1/0,maxEnqueuedMessages:1/0,startClosed:!1,debug:!1};(function(){function l(i,t,e){var n=this;e===void 0&&(e={}),this._listeners={error:[],message:[],open:[],close:[]},this._retryCount=-1,this._shouldReconnect=!0,this._connectLock=!1,this._binaryType="blob",this._closeCalled=!1,this._messageQueue=[],this.onclose=null,this.onerror=null,this.onmessage=null,this.onopen=null,this._handleOpen=function(s){n._debug("open event");var a=n._options.minUptime,r=a===void 0?DEFAULT.minUptime:a;clearTimeout(n._connectTimeout),n._uptimeTimeout=setTimeout(function(){return n._acceptOpen()},r),n._ws.binaryType=n._binaryType,n._messageQueue.forEach(function(o){return n._ws.send(o)}),n._messageQueue=[],n.onopen&&n.onopen(s),n._listeners.open.forEach(function(o){return n._callEventListener(s,o)})},this._handleMessage=function(s){n._debug("message event"),n.onmessage&&n.onmessage(s),n._listeners.message.forEach(function(a){return n._callEventListener(s,a)})},this._handleError=function(s){n._debug("error event",s.message),n._disconnect(void 0,s.message==="TIMEOUT"?"timeout":void 0),n.onerror&&n.onerror(s),n._debug("exec error listeners"),n._listeners.error.forEach(function(a){return n._callEventListener(s,a)}),n._connect()},this._handleClose=function(s){n._debug("close event"),n._clearTimeouts(),n._shouldReconnect&&n._connect(),n.onclose&&n.onclose(s),n._listeners.close.forEach(function(a){return n._callEventListener(s,a)})},this._url=i,this._protocols=t,this._options=e,this._options.startClosed&&(this._shouldReconnect=!1),this._connect()}return Object.defineProperty(l,"CONNECTING",{get:function(){return 0},enumerable:!0,configurable:!0}),Object.defineProperty(l,"OPEN",{get:function(){return 1},enumerable:!0,configurable:!0}),Object.defineProperty(l,"CLOSING",{get:function(){return 2},enumerable:!0,configurable:!0}),Object.defineProperty(l,"CLOSED",{get:function(){return 3},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"CONNECTING",{get:function(){return l.CONNECTING},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"OPEN",{get:function(){return l.OPEN},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"CLOSING",{get:function(){return l.CLOSING},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"CLOSED",{get:function(){return l.CLOSED},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"binaryType",{get:function(){return this._ws?this._ws.binaryType:this._binaryType},set:function(i){this._binaryType=i,this._ws&&(this._ws.binaryType=i)},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"retryCount",{get:function(){return Math.max(this._retryCount,0)},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"bufferedAmount",{get:function(){var i=this._messageQueue.reduce(function(t,e){return typeof e=="string"?t+=e.length:e instanceof Blob?t+=e.size:t+=e.byteLength,t},0);return i+(this._ws?this._ws.bufferedAmount:0)},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"extensions",{get:function(){return this._ws?this._ws.extensions:""},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"protocol",{get:function(){return this._ws?this._ws.protocol:""},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"readyState",{get:function(){return this._ws?this._ws.readyState:this._options.startClosed?l.CLOSED:l.CONNECTING},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"url",{get:function(){return this._ws?this._ws.url:""},enumerable:!0,configurable:!0}),l.prototype.close=function(i,t){if(i===void 0&&(i=1e3),this._closeCalled=!0,this._shouldReconnect=!1,this._clearTimeouts(),!this._ws){this._debug("close enqueued: no ws instance");return}if(this._ws.readyState===this.CLOSED){this._debug("close: already closed");return}this._ws.close(i,t)},l.prototype.reconnect=function(i,t){this._shouldReconnect=!0,this._closeCalled=!1,this._retryCount=-1,!this._ws||this._ws.readyState===this.CLOSED?this._connect():(this._disconnect(i,t),this._connect())},l.prototype.send=function(i){if(this._ws&&this._ws.readyState===this.OPEN)this._debug("send",i),this._ws.send(i);else{var t=this._options.maxEnqueuedMessages,e=t===void 0?DEFAULT.maxEnqueuedMessages:t;this._messageQueue.length<e&&(this._debug("enqueue",i),this._messageQueue.push(i))}},l.prototype.addEventListener=function(i,t){this._listeners[i]&&this._listeners[i].push(t)},l.prototype.dispatchEvent=function(i){var t,e,n=this._listeners[i.type];if(n)try{for(var s=__values(n),a=s.next();!a.done;a=s.next()){var r=a.value;this._callEventListener(i,r)}}catch(o){t={error:o}}finally{try{a&&!a.done&&(e=s.return)&&e.call(s)}finally{if(t)throw t.error}}return!0},l.prototype.removeEventListener=function(i,t){this._listeners[i]&&(this._listeners[i]=this._listeners[i].filter(function(e){return e!==t}))},l.prototype._debug=function(){for(var i=[],t=0;t<arguments.length;t++)i[t]=arguments[t];this._options.debug&&console.log.apply(console,__spread(["RWS>"],i))},l.prototype._getNextDelay=function(){var i=this._options,t=i.reconnectionDelayGrowFactor,e=t===void 0?DEFAULT.reconnectionDelayGrowFactor:t,n=i.minReconnectionDelay,s=n===void 0?DEFAULT.minReconnectionDelay:n,a=i.maxReconnectionDelay,r=a===void 0?DEFAULT.maxReconnectionDelay:a,o=0;return this._retryCount>0&&(o=s*Math.pow(e,this._retryCount-1),o>r&&(o=r)),this._debug("next delay",o),o},l.prototype._wait=function(){var i=this;return new Promise(function(t){setTimeout(t,i._getNextDelay())})},l.prototype._getNextUrl=function(i){if(typeof i=="string")return Promise.resolve(i);if(typeof i=="function"){var t=i();if(typeof t=="string")return Promise.resolve(t);if(t.then)return t}throw Error("Invalid URL")},l.prototype._connect=function(){var i=this;if(!(this._connectLock||!this._shouldReconnect)){this._connectLock=!0;var t=this._options,e=t.maxRetries,n=e===void 0?DEFAULT.maxRetries:e,s=t.connectionTimeout,a=s===void 0?DEFAULT.connectionTimeout:s,r=t.WebSocket,o=r===void 0?getGlobalWebSocket():r;if(this._retryCount>=n){this._debug("max retries reached",this._retryCount,">=",n);return}if(this._retryCount++,this._debug("connect",this._retryCount),this._removeListeners(),!isWebSocket(o))throw Error("No valid WebSocket class provided");this._wait().then(function(){return i._getNextUrl(i._url)}).then(function(h){i._closeCalled||(i._debug("connect",{url:h,protocols:i._protocols}),i._ws=i._protocols?new o(h,i._protocols):new o(h),i._ws.binaryType=i._binaryType,i._connectLock=!1,i._addListeners(),i._connectTimeout=setTimeout(function(){return i._handleTimeout()},a))})}},l.prototype._handleTimeout=function(){this._debug("timeout event"),this._handleError(new ErrorEvent(Error("TIMEOUT"),this))},l.prototype._disconnect=function(i,t){if(i===void 0&&(i=1e3),this._clearTimeouts(),!!this._ws){this._removeListeners();try{this._ws.close(i,t),this._handleClose(new CloseEvent(i,t,this))}catch{}}},l.prototype._acceptOpen=function(){this._debug("accept open"),this._retryCount=0},l.prototype._callEventListener=function(i,t){"handleEvent"in t?t.handleEvent(i):t(i)},l.prototype._removeListeners=function(){this._ws&&(this._debug("removeListeners"),this._ws.removeEventListener("open",this._handleOpen),this._ws.removeEventListener("close",this._handleClose),this._ws.removeEventListener("message",this._handleMessage),this._ws.removeEventListener("error",this._handleError))},l.prototype._addListeners=function(){this._ws&&(this._debug("addListeners"),this._ws.addEventListener("open",this._handleOpen),this._ws.addEventListener("close",this._handleClose),this._ws.addEventListener("message",this._handleMessage),this._ws.addEventListener("error",this._handleError))},l.prototype._clearTimeouts=function(){clearTimeout(this._connectTimeout),clearTimeout(this._uptimeTimeout)},l})();const vt=class vt extends EditableComponent{constructor(){super(...arguments);c(this,"PElement",null);c(this,"Top",0);c(this,"Left",0);c(this,"_selectedContextMenuItem",null);c(this,"_selectedItem",null);c(this,"IsRoot",!1);c(this,"_selectedIndex",-1);c(this,"MenuItems",[]);c(this,"_active","active");c(this,"IsSingleton",!0);c(this,"time")}static get Instance(){return this._instance||(this._instance=new vt,this._instance.MenuItems=[]),this._instance.PElement=null,this._instance}Render(){this.Element==null&&(Html.Take(this.PElement??document.body).Ul.ClassName("context-menu"),this.Element=Html.Instance.Context),this.PElement==null&&this.Element!=null&&document.body.appendChild(this.Element),this.PElement!=null&&this.Element!=null&&this.PElement.appendChild(this.Element),this.Element=this.Element,this.Element.addEventListener("focusout",()=>this.Dispose()),this.Element.addEventListener("keydown",t=>this.HotKeyHandler(t)),Html.Take(this.Element).Clear().TabIndex(-1).Floating(this.Top,this.Left),this.ParentElement=this.Element.ParentElement,this.RenderMenuItems(this.MenuItems),window.setTimeout(()=>{this.Element!=null&&(this.Element.style.display="block",this.Element.focus(),this.AlterPosition())},50)}RenderMenuItems(t,e=0){for(let n=0;n<t.length;n++){const s=t[n];s&&(Html.Instance.Li.Style(s.Style).Render(),s.Ele=Html.Context,n==0&&e==0&&(t[n].MenuItems==null||t[n].MenuItems.length==0)&&(this._selectedIndex=n,this.SetSelectedItem(Html.Context)),s.Disabled?Html.Instance.Attr("disabled","disabled"):Html.Instance.Event("click",a=>this.MenuItemClickHandler(a,s)),Html.Instance.Icon(s.Icon).End.Span.IText(s.Text).End.Render(),s.MenuItems!=null&&s.MenuItems.length>0&&(Html.Instance.Ul.Render(),this.RenderMenuItems(s.MenuItems,e+1),Html.Instance.End.Render()),Html.Instance.End.Render())}}SetSelectedItem(t){this._selectedItem=t,this._selectedItem.classList.add(this._active)}MenuItemClickHandler(t,e){t.stopPropagation(),!(!e||!e.Click)&&(e.Click(e.Parameter),this.Element.dispatchEvent(new Event("focusout")))}HotKeyHandler(t){if(t.preventDefault(),!this.Element||!this.Element.children||this.Element.children.length===0)return;const e=this._selectedItem?this._selectedItem.parentElement.children:this.Element.children;switch(t.KeyCode()){case 27:this.Dispose();break;case 37:if(this.IsRoot||!this._selectedItem||!this._selectedItem.parentElement)return;Array.from(this._selectedItem.parentElement.children).forEach(a=>a.classList.remove(this._active)),this._selectedItem=this._selectedItem.parentElement;break;case 38:t.preventDefault(),t.stopPropagation(),Array.from(e).forEach(a=>a.classList.remove(this._active)),this._selectedIndex=this._selectedIndex>0?this._selectedIndex-1:e.length-1,this.SetSelectedItem(e[this._selectedIndex]);break;case 39:const s=this._selectedItem?this._selectedItem.lastElementChild:null;if(!s||!s.children||s.children.length===0)return;Array.from(s.children).forEach(a=>a.classList.remove(this._active)),this.SetSelectedItem(s.firstElementChild);break;case 40:t.preventDefault(),t.stopPropagation(),Array.from(e).forEach(a=>a.classList.remove(this._active)),this._selectedIndex=this._selectedIndex<e.length-1?this._selectedIndex+1:0,this.SetSelectedItem(e[this._selectedIndex]);break;case 13:!this._selectedItem&&this.Element.firstElementChild instanceof HTMLElement&&this.SetSelectedItem(this.Element.firstElementChild),this.MenuItemClickHandler(t,this.MenuItems.find(a=>a.Ele===this._selectedItem));break}}AlterPosition(){this.Floating(this.Top,this.Left);const t=this.Element.getBoundingClientRect(),e=this.Element.OutOfViewport();e.Bottom&&(this.Element.style.top=`${this.Top-t.height}px`),e.Right&&(this.Element.style.left=`${this.Left-t.width}px`,this.Element.style.top=`${this.Top}px`),this.Element.OutOfViewport().Bottom&&(this.Element.style.top=`${this.Top-t.height}px`,this.Element.style.top=`${this.Top-t.height-this.Element.clientHeight}px`)}Dispose(){window.clearTimeout(this.time),this.time=window.setTimeout(()=>{this.Element!=null&&(this.Element.remove(),this.Element=null)},100)}Floating(t,e){this.Element.style.position="fixed",this.Element.style.top=`${t}px`,this.Element.style.left=`${e}px`}};c(vt,"_instance",null);let ContextMenu=vt;const O=class O extends EditableComponent{constructor(t=null){super(null);c(this,"IsEditForm",!0);c(this,"OpenFrom");c(this,"ListViews",[]);c(this,"Pop",!1);c(this,"Portal",!0);c(this,"IsLock",!1);c(this,"Meta");c(this,"_allCom",[]);c(this,"TabGroup",[]);c(this,"SectionMd");c(this,"BeforeSaved",new Action);c(this,"AfterSaved",new Action);c(this,"ShouldLoadEntity",!1);c(this,"IconElement",null);c(this,"TitleElement",null);c(this,"Policies",[]);c(this,"_componentCoppy");c(this,"CtxCom");this.urlSearch=new URLSearchParams(window.location.search),this.entity=t,this.Meta=new Feature,t!=null&&window.addEventListener(EventType.Resize,this.ResizeHandler.bind(this))}get AllCom(){return this._allCom!==null?this._allCom:(O.LayoutForm===null?this._allCom=this.Meta.Component.slice():this._allCom=this.Meta.Component.concat(O.LayoutForm.Meta.Component),this._allCom)}get FeatureName(){var t;return this.Name||((t=this.Meta)==null?void 0:t.Name)}get Href(){return this.href}set Href(t){this.href=t}GetPatchEntity(){const t=this.EntityId==null,e=this.FilterChildren(a=>!a.IsButton&&(t||a.Dirty)&&a.Meta!=null&&a.Name!=null,a=>a.IsListView||a.AlwaysValid||!a.PopulateDirty),n=e.SelectMany(a=>{var h;if(typeof a.GetPatchDetail=="function")return a.GetPatchDetail();const r=Utils$1.GetPropValue(a.Entity,a.Name);return[{Label:a.ComLabel,Field:a.Name,OldVal:a.OldValue!=null?a.OldValue.toString():(h=a.OldValue)==null?void 0:h.toString(),Value:r!=null?r.toString():this.EditForm.Meta.IgnoreEncode?r==null?void 0:r.toString().trim():Utils$1.EncodeSpecialChar(r==null?void 0:r.toString().trim())}]}).DistinctBy(a=>a.Field);return this.AddIdToPatch(e),{Changes:n,Table:this.Meta.EntityName,QueueName:this.QueueName,CacheName:this.CacheName}}async SavePatch(){if(!this.Dirty)return Toast.Warning(Message.NotDirty),!1;try{if(!await this.IsFormValid())return!1;let e=[];Object.getOwnPropertyNames(this.Entity).forEach(a=>{if(this.Entity[a]instanceof Array||this.Entity[a]instanceof Object)return;let r;typeof this.Entity[a]=="boolean"?r=this.Entity[a]?"1":"0":r=this.Entity[a];let o={Label:a,Field:a,OldVal:null,Value:r};e.push(o)});let n={Changes:e,Table:this.Meta.EntityId};const s=await Client.Instance.PatchAsync(n);return this.Dirty=!1,Toast.Success("Update success"),s}catch(t){return Toast.Warning(t.message),!1}}ResizeHandler(){this.ResizeTabGroup(),this.ResizeListView()}ResizeListView(){const t=this.ListViews.find(s=>!s.Element.Hidden());if(!t)return;const e=t.Parent.Children.filter(s=>s.IsListView),n=e.some(s=>s.Name.includes("Mobile"));e.forEach(s=>{n?(s.Show=this.IsSmallUp?!s.Name.includes("Mobile"):s.Name.includes("Mobile"),s.Show&&(this._CurrentListView=s)):this._CurrentListView=s})}ResizeTabGroup(){this.Element&&(this.Element.HasClass("mobile")||this.TabGroup.Nothing())||this.TabGroup.ForEach(t=>{!t||!t.Element||(this.IsLargeUp&&t.Meta.Responsive&&t.Element.parentElement.HasClass("tab-horizontal")?t.Element.parentElement.ReplaceClass("tab-horizontal","tab-vertical"):!this.IsLargeUp&&t.Meta.Responsive&&t.Element.parentElement.HasClass("tab-vertical")&&t.Element.parentElement.ReplaceClass("tab-vertical","tab-horizontal"))})}async LoadFeatureAndRender(t=null){this.SectionMd=this.SectionMd||await __vitePreload(()=>Promise.resolve().then(()=>section),void 0);const e=ComponentExt.LoadFeature(this.Meta.FieldName);this.LoadEntity().then(n=>{e.then(s=>{this.LayoutLoaded(s,t)})})}Render(){this.LoadFeatureAndRender(),this.LastForm=this}LayoutLoaded(t,e=null){this.SetCurrentUserProperties(),this.SetFeatureProperties(t);const n=this.BuildTree(t.ComponentGroup.sort((s,a)=>s.Order-a.Order));this.SetFeatureStyleSheet(t.StyleSheet),this.Policies=t.FeaturePolicies,this.RenderTabOrSection(n,this),this.ResizeHandler(),this.InitDOMEvents(),e==null||e.call(null),this.DispatchFeatureEvent(t.Events,EventType.DOMContentLoaded)}InitDOMEvents(){Html.Take(this.Element).TabIndex(-1).Trigger("focus").Event(EventType.FocusIn,()=>this.DispatchFeatureEvent(this.Meta.Events,EventType.FocusIn)).Event(EventType.KeyDown,t=>this.KeyDownIntro(t)).Event(EventType.FocusOut,()=>this.DispatchFeatureEvent(this.Meta.Events,EventType.FocusOut)),this.Popup||Html.Instance.ClassName("tab-item")}SetCurrentUserProperties(){const t=Client.Token;this.currentUserId=t==null?void 0:t.UserId,this.regionId=t==null?void 0:t.RegionId,this.centerIds=t!=null&&t.CenterIds?t.CenterIds.join(Str.Comma):Str.Empty,this.roleIds=t!=null&&t.RoleIds?t.RoleIds.join(Str.Comma):Str.Empty,this.costCenterId=t==null?void 0:t.CostCenterId,this.roleNames=t!=null&&t.RoleNames?t.RoleNames.join(Str.Comma):Str.Empty}UpdateIndependantGridView(){const t=this.GetDirtyGrid();return t.length?t.flatMap(e=>e.GetPatches()):null}GetDirtyGrid(){return this.ListViews.filter(t=>t.Meta.Id&&t.Meta.CanAdd).filter(t=>t.FilterChildren(e=>e.Dirty,e=>!e.PopulateDirty).length>0)}DeleteGridView(){this.GetDeleteGrid().forEach(e=>{Client.Instance.HardDeleteAsync(e.DeleteTempIds,e.Meta.RefName,e.DataConn,e.MetaConn).then(n=>{if(!n){Toast.Warning("Error deleting details, please check again");return}e.RowAction(s=>{e.DeleteTempIds.includes(s.EntityId)&&s.Dispose()}),e.DeleteTempIds.Clear()})})}GetDeleteGrid(){return this.ListViews.filter(t=>t.Meta.Id).filter(t=>t.DeleteTempIds.length>0)}BuildTree(t){const e=new Map(t.map(a=>[a.Id,a]));let n;for(const a of t)if(a.IsVerticalTab&&this.Element.clientWidth<EditableComponent.SmallScreen&&(a.IsVerticalTab=!1),!!a.ParentId){if(!e.has(a.ParentId)){console.log(`The parent key ${a.ParentId} of ${a.FieldName} doesn't exist`);continue}n=e.get(a.ParentId),n.Children||(n.Children=[]),n.Children.includes(a)||n.Children.push(a),a.Parent=n}for(const a of t)if(!(!a.Children||!a.Children.length)){for(const r of a.Children)r.ComponentGroup=a;a.Children&&(a.Children=a.Children.sort((r,o)=>r.Order-o.Order))}t.forEach(a=>this.CalcItemInRow(a.Children.slice()));const s=t.filter(a=>!a.ParentId);return s.length||console.log("No component group is root component. Wrong feature name or the configuration is wrong"),s}CalcItemInRow(t){let e=0,n=0,s=0;for(let a=0;a<t.length;a++){const r=t[a],o=this.GetInnerColumn(r.Parent),h=this.GetOuterColumn(r);if(!(o<=0)&&(n++,e+=h,e%o===0)){let d=a;for(;d>=s;)t[d].ItemInRow=n,d--;n=0,s=a}}}GetInnerColumn(t){if(!t)return 0;const e=this.Element.clientWidth;let n;return e<EditableComponent.ExSmallScreen&&t.XsCol>0?n=t.XsCol:e<EditableComponent.SmallScreen&&t.SmCol>0?n=t.SmCol:e<EditableComponent.MediumScreen&&t.Column>0?n=t.Column:e<EditableComponent.LargeScreen&&t.LgCol>0?n=t.LgCol:e<EditableComponent.ExLargeScreen&&t.XlCol>0?n=t.XlCol:n=t.XxlCol||t.Column,n||0}GetOuterColumn(t){if(!t)return 0;const e=this.Element.clientWidth;let n;return e<EditableComponent.ExSmallScreen&&t.XsOuterColumn>0?n=t.XsOuterColumn:e<EditableComponent.SmallScreen&&t.SmOuterColumn>0?n=t.SmOuterColumn:e<EditableComponent.MediumScreen&&t.OuterColumn>0?n=t.OuterColumn:e<EditableComponent.LargeScreen&&t.LgOuterColumn>0?n=t.LgOuterColumn:e<EditableComponent.ExLargeScreen&&t.XlOuterColumn>0?n=t.XlOuterColumn:n=t.XxlOuterColumn||t.OuterColumn,n||0}BindingTemplate(t,e,n=null,s=null,a=new Set){if(!t||a.has(t)||(a.add(t),t.children.length===0&&this.RenderCellText(t,n)!==null))return;const r=this.ResolveMeta(t),o=s?s(t,r,e,n):this.BindingCom(t,r,e,n);e=o instanceof this.SectionMd.Section?o:e,t.children.forEach(h=>this.BindingTemplate(h,e,n,s,a))}ResolveMeta(t){let e=new Component;const n=t.dataset[this.IdField.toLowerCase()];n&&(e=this.AllCom.find(s=>s.Id===n));for(const s of Object.getOwnPropertyNames(Component.prototype)){const a=t.dataset[s.toLowerCase()];if(!a)continue;let r=null;try{r=typeof e[s]=="string"?a:JSON.parse(a),e=e||new Component,e[s]=r}catch{continue}}return e}RenderCellText(t,e){const n=t.textContent.trim();if(n&&n.startsWith("{")&&n.endsWith("}")){const s={FieldName:n.slice(1,-1)},a=new Label(s,t);return a.Entity=e,O.LayoutForm?O.LayoutForm.AddChild(a):a.Render(),a}return null}static GetFeatureNameFromUrl(){let t=new StringBuilder,e=window.location.pathname.toLowerCase().replace(Client.BaseUri.toLowerCase(),"");if(e.startsWith(Utils$1.Slash)&&(e=e.substring(1)),!e.trim())return null;for(let n=0;n<e.length&&!(e[n]==="?"||e[n]==="#");n++)t.Append(e[n]);return t.toString()}get EntityName(){return this.Meta.EntityName}async LoadEntity(){const e=O.GetFeatureNameFromUrl()===this.FeatureName?Utils$1.GetUrlParam(Utils$1.IdField):this.EntityId;if(!this.ShouldLoadEntity||!e)return null;try{const n=await Client.Instance.GetByIdAsync(this.EntityName,this.DataConn,[e]);return n?(this.Entity=n[0],n[0]):null}catch(n){return console.error("Failed to load entity:",n),null}}LockUpdate(){this.Meta.FeaturePolicy=this.Meta.FeaturePolicy??this.Meta.FeaturePolicies;const t=this.Meta.FeaturePolicy.filter(n=>n.RecordId);!this.Meta.IsPublic&&!Utils$1.IsOwner(this.Entity)&&t.every(n=>!n.CanWrite&&!n.CanWriteAll)&&this.LockUpdateButCancel()}LockUpdateButCancel(){this.Disabled=!0,this.SetDisabled(!1,O.BtnCancel)}get Icon(){return this._icon}set Icon(t){this._icon=t,this.IconElement!==null&&Html.Take(this.IconElement).IconForSpan(t)}get Title(){return this._title}set Title(t){this._title=t,this.TitleElement!==null&&(this.TitleElement.innerHTML="",Html.Take(this.TitleElement).IText(t))}SetFeatureProperties(t){t&&(this.Meta=t,t.ClassName&&this.Element.classList.add(t.ClassName),this.Icon||(this.Icon=t.Icon),this.Title||(this.Title=t.Label))}SetFeatureStyleSheet(t){if(!t)return;const e=document.createElement("style");e.appendChild(document.createTextNode(t)),e.setAttribute("source","feature"),this.Element.appendChild(e)}RenderTabOrSection(t,e){e.EditForm||(e.EditForm=e),t.sort((n,s)=>n.Order-s.Order).forEach(n=>{n.Disabled=this.Disabled||n.Disabled,n.IsTab?this.SectionMd.Section.RenderTabGroup(e??this,n):this.SectionMd.Section.RenderSection(e??this,n)})}DispatchFeatureEvent(t,e){if(t&&t[e]){const n=new CustomEvent(e,{detail:this.Entity});this.Element.dispatchEvent(n)}}async KeyDownIntro(t){if(t.KeyCode()===72&&t.CtrlOrMetaKey()){t.preventDefault(),await Client.LoadScript("https://unpkg.com/intro.js/intro.js");const n={ComId:"Intro",Action:"GetByFeatureId",Params:JSON.stringify({Id:this.Meta.Id}),MetaConn:this.MetaConn,DataConn:this.DataConn};try{const s=await Client.Instance.UserSvc(n);let a=`(x) => {
                    introJs().setOptions({
                        steps: [{ intro: "Tutorial start" }]`;s.forEach(o=>{a+=`, {
                        element: document.querySelector('#${o.FieldName}'),
                        intro: "${o.Label}"
                    }`}),a+="]).start();}",new Function("return "+a)()(this)}catch(s){console.error("Error setting up intro.js tutorial:",s)}}}RenderTemplate(t){let e=document.getElementById(O.SpecialEntryPoint)||document.getElementById("template")||this.Element;if(this.ParentForm&&this.Portal&&!this.Popup&&(this.ParentForm.Element=null,this.ParentForm.Dispose(),this.ParentForm=null),e.innerHTML=Str.Empty,t.Template){e.innerHTML=t.Template,this.BindingTemplate(e,this);const n=Array.from(e.querySelectorAll("[id='inner-entry']")).shift();this.ResetEntryPoint(n),e=n||e,e.style.display==="none"&&(e.style.display=Str.Empty)}return e}ResetEntryPoint(t){t&&(t.innerHTML=Str.Empty)}BindingCom(t,e,n,s){var r;if(!t||!e||!e.ComponentType)return null;let a=null;return e.ComponentType===ComponentType.Section?(a=new this.SectionMd.Section(null,t),a.Meta=e,a.Meta=e):a=ComponentFactory.GetComponent(e,this,t),a?(a.ParentElement=a.ParentElement||t,a.Entity=s||((r=a.EditForm)==null?void 0:r.Entity)||this.Entity,n.AddChild(a),a):null}Cancel(){this.DirtyCheckAndCancel()}CancelWithoutAsk(){this.Dispose()}DirtyCheckAndCancel(t=null){if(!this.Dirty){this.Dispose(),t&&t();return}const e=new ConfirmDialog;e.Content="Do you want to save changes before closing?",e.YesConfirmed.add(()=>{this.SavePatch().then(n=>{n.status==200&&(this.Dispose(),t&&t())})}),e.NoConfirmed=()=>{this.Dispose(),t&&t()},e.IgnoreCancelButton=!0,e.Render()}Dispose(){window.removeEventListener("resize",this.ResizeHandler.bind(this)),super.Dispose()}async IsFormValid(t=!0,e=null,n=null){e=e||(r=>r.Children.length===0&&!r.Disabled),n=n||(r=>r.AlwaysValid||r.EmptyRow);const s=this.FilterChildren(e,n).map(r=>({IsValid:r.ValidateAsync(),com:r}));await Promise.all(s.map(r=>r.IsValid));const a=s.filter(r=>!r.com.IsValid).map(r=>r.com);if(a.length>0){if(t){a.forEach(h=>{h.Disabled=!1}),a[0].Focus();const o=a.flatMap(h=>h.ValidationResult.Values);Toast.Warning(o.join(`
`))}return!1}return!0}Print(t=".printable"){const e=this.Element.querySelector(t);if(e){const n=window.open(Str.Empty,"_blank");n.document.write(e.innerHTML),n.document.close(),n.focus(),n.print(),n.close()}}async EmailPdf(t,e=[]){if(!t)throw new Error("EmailVM must not be null.");const n=e.map(s=>{const a=this.Element.querySelector(s);return this.PrintSection(a,!1)});t.PdfText=t.PdfText.concat(n);try{const s=await Client.Instance.PostAsync(t,"/user/EmailAttached");return Toast.Success("Email sent successfully!"),s}catch(s){throw Toast.Error("Error while sending email: "+s.message),s}}PrintSection(t,e=!0,n=null,s=!1,a=null){if(!t)return null;if(!e)return t.innerHTML;const r=window.open("","_blank");if(r.document.body.innerHTML=t.innerHTML,n&&n.length){const o=r.document.createElement("style");o.innerHTML=n.join(" "),r.document.head.appendChild(o)}return s?setTimeout(()=>{r.addEventListener("beforeprint",o=>{if(a&&a.Style){const h=r.document.createElement("style");h.innerHTML=a.Style,r.document.head.appendChild(h)}}),r.print(),r.addEventListener("afterprint",async o=>{a&&a.Events&&a.Events.AfterPrint&&await this.DispatchEvent(a.Events.AfterPrint,"afterprint",this),r.close()}),r.addEventListener("mousemove",()=>r.close()),r.addEventListener("click",()=>r.close()),r.addEventListener("keyup",o=>{o.key==="Escape"&&r.close()})},250):(r.print(),r.close()),t.innerHTML}GetGridPolicies(t,e="Component"){return t=t??Client.Token.RoleIds,this.Policies.filter(s=>s.RoleId||s.UserId&&Client.Token.UserId==s.UserId).filter(s=>s.EntityName==e&&t.includes(s.RecordId))}GetDefaultGridPolicies(){var t=this.Policies.filter(e=>e.RoleId==null||Client.Token!=null&&e.RoleId&&Client.Token.RoleIds.includes(e.RoleId)||e.UserId&&Client.Token.UserId==e.UserId);return t}Delete(){const t=new ConfirmDialog;t.Content="Are you sure you want to delete this?",t.YesConfirmed=async()=>{var e;try{await Client.Instance.HardDeleteAsync([this.EntityId],this.Meta.EntityName,this.DataConn,this.MetaConn)?(Toast.Success("Data deleted successfully"),(e=this.ParentForm)==null||e.UpdateView(),this.Dispose()):Toast.Warning("An error occurred while deleting data")}catch(n){Toast.Warning("An error occurred: "+n.message)}},t.Render()}SignIn(){var t;(t=Client.UnAuthorizedEventHandler)==null||t.call(null)}SignOut(){window.event.preventDefault(),Client.Instance.PostAsync(Client.Token,"user/SignOut").then(e=>{var n,s;Toast.Success("You have successfully signed out!"),(n=Client.SignOutEventHandler)==null||n.call(),Client.Token=null,(s=O.NotificationClient)==null||s.Close(),window.location.reload()}).catch(e=>{Toast.Warning("Error during sign out: "+e.message)})}GetElementPolicies(t,e="Component"){return Array.isArray(t)?this.Policies.filter(n=>n.EntityName===e&&t.includes(n.RecordId)):this.Policies.filter(n=>n.EntityName===e&&n.RecordId===t)}CopyComponent(t){this._componentCoppy=new Component,this._componentCoppy.CopyPropFrom(t)}AddComponent(t){var r;const e=t.action,n=t.group,s={ComponentType:e,ComponentGroupId:n.Id,Label:"New Component",Visibility:!0,Order:(r=n.Children)!=null&&r.length?Math.max(...n.Children.map(o=>o.Order))+1:0},a=ComponentExt.MapToPatch(s,"Component");Client.Instance.PatchAsync(a).then(()=>{n.Children.push(s),this.UpdateRender(s,n),Toast.Success("Component added successfully!")}).catch(o=>{Toast.Error("Error adding component: "+o.message)})}UpdateRender(t,e){const n=this.FindComponentByName(e.FieldName),s=ComponentFactory.GetComponent(t,this);s&&(s.ParentElement=n.Element,n.AddChild(s))}SysConfigMenu(t,e,n,s){if(t.preventDefault(),t.stopPropagation(),this.CtxCom=s,!this.Policies.some(o=>o.CanWriteMeta||o.CanWriteMetaAll))return;const r=ContextMenu.Instance;r.Top=t.Top(),r.Left=t.Left(),r.MenuItems=[],e!==null&&r.MenuItems.push({Icon:"fal fa-cog",Text:"Component Properties",Click:this.ComponentProperties.bind(this),Parameter:e}),n!==null&&r.MenuItems.push({Icon:"fal fa-cogs",Text:"Section Properties",Click:this.SectionProperties.bind(this),Parameter:n}),r.MenuItems.push({Icon:"fal fa-folder-open",Text:"Screen Properties",Click:this.FeatureProperties.bind(this)}),r.Render()}async SectionProperties(t){const e=await __vitePreload(()=>import("./sectionEditor-ogc9Fxeh.js"),__vite__mapDeps([0,1])),n=new e.SectionEditor;n.Name="section-editor",n.ParentElement=this.Element,n.Entity=t,n.OpenFrom=this.EditForm,this.AddChild(n)}async FeatureProperties(){var t=await __vitePreload(()=>import("./featureEditor-H52F5l7o.js"),__vite__mapDeps([2,1]));const e=new t.FeatureEditor;e.Name="feature-editor",e.ParentElement=this.Element,e.Entity=this.Meta,e.OpenFrom=this.EditForm,this.AddChild(e)}async ComponentProperties(t){const e=await __vitePreload(()=>import("./componentEditor-CQQCjiPj.js"),__vite__mapDeps([3,1])),n=new e.ComponentEditor;n.Name="component-editor",n.ParentElement=this.Element,n.Entity=t,n.OpenFrom=this.EditForm,this.AddChild(n)}CloneFeature(t){const e=t,n=new ConfirmDialog;n.Content="Do you want to clone this feature?",n.Title="Confirm",n.YesConfirmed=()=>{const s={ComId:"Feature",Action:"Clone",Ids:[e.Id],MetaConn:this.MetaConn,DataConn:this.DataConn};Client.Instance.UserSvc(s).Done()},this.AddChild(n)}};c(O,"LayoutForm"),c(O,"ExpiredDate","ExpiredDate"),c(O,"BtnExpired","btnExpired"),c(O,"BtnSave","btnSave"),c(O,"BtnSend","btnSend"),c(O,"BtnApprove","btnApprove"),c(O,"BtnReject","btnReject"),c(O,"StatusIdField","StatusId"),c(O,"BtnCancel","btnCancel"),c(O,"BtnPrint","btnPrint"),c(O,"BtnPreview","btnPreview"),c(O,"SpecialEntryPoint","entry"),c(O,"Portal",!1),c(O,"NotificationClient");let EditForm=O;const editForm=Object.freeze(Object.defineProperty({__proto__:null,EditForm},Symbol.toStringTag,{value:"Module"}));var draggabilly={exports:{}},getSize={exports:{}};/*!
 * Infinite Scroll v2.0.4
 * measure size of elements
 * MIT license
 */var hasRequiredGetSize;function requireGetSize(){return hasRequiredGetSize||(hasRequiredGetSize=1,function(l){(function(i,t){l.exports?l.exports=t():i.getSize=t()})(window,function(){function t(a){let r=parseFloat(a);return a.indexOf("%")==-1&&!isNaN(r)&&r}let e=["paddingLeft","paddingRight","paddingTop","paddingBottom","marginLeft","marginRight","marginTop","marginBottom","borderLeftWidth","borderRightWidth","borderTopWidth","borderBottomWidth"];function n(){let a={width:0,height:0,innerWidth:0,innerHeight:0,outerWidth:0,outerHeight:0};return e.forEach(r=>{a[r]=0}),a}function s(a){if(typeof a=="string"&&(a=document.querySelector(a)),!(a&&typeof a=="object"&&a.nodeType))return;let o=getComputedStyle(a);if(o.display=="none")return n();let h={};h.width=a.offsetWidth,h.height=a.offsetHeight;let d=h.isBorderBox=o.boxSizing=="border-box";e.forEach(b=>{let A=o[b],V=parseFloat(A);h[b]=isNaN(V)?0:V});let u=h.paddingLeft+h.paddingRight,m=h.paddingTop+h.paddingBottom,f=h.marginLeft+h.marginRight,p=h.marginTop+h.marginBottom,E=h.borderLeftWidth+h.borderRightWidth,I=h.borderTopWidth+h.borderBottomWidth,T=t(o.width);T!==!1&&(h.width=T+(d?0:u+E));let F=t(o.height);return F!==!1&&(h.height=F+(d?0:m+I)),h.innerWidth=h.width-(u+E),h.innerHeight=h.height-(m+I),h.outerWidth=h.width+f,h.outerHeight=h.height+p,h}return s})}(getSize)),getSize.exports}var unidragger={exports:{}},evEmitter={exports:{}},hasRequiredEvEmitter;function requireEvEmitter(){return hasRequiredEvEmitter||(hasRequiredEvEmitter=1,function(l){(function(i,t){l.exports?l.exports=t():i.EvEmitter=t()})(typeof window<"u"?window:commonjsGlobal,function(){function i(){}let t=i.prototype;return t.on=function(e,n){if(!e||!n)return this;let s=this._events=this._events||{},a=s[e]=s[e]||[];return a.includes(n)||a.push(n),this},t.once=function(e,n){if(!e||!n)return this;this.on(e,n);let s=this._onceEvents=this._onceEvents||{},a=s[e]=s[e]||{};return a[n]=!0,this},t.off=function(e,n){let s=this._events&&this._events[e];if(!s||!s.length)return this;let a=s.indexOf(n);return a!=-1&&s.splice(a,1),this},t.emitEvent=function(e,n){let s=this._events&&this._events[e];if(!s||!s.length)return this;s=s.slice(0),n=n||[];let a=this._onceEvents&&this._onceEvents[e];for(let r of s)a&&a[r]&&(this.off(e,r),delete a[r]),r.apply(this,n);return this},t.allOff=function(){return delete this._events,delete this._onceEvents,this},i})}(evEmitter)),evEmitter.exports}/*!
 * Unidragger v3.0.1
 * Draggable base class
 * MIT license
 */var hasRequiredUnidragger;function requireUnidragger(){return hasRequiredUnidragger||(hasRequiredUnidragger=1,function(l){(function(i,t){l.exports?l.exports=t(i,requireEvEmitter()):i.Unidragger=t(i,i.EvEmitter)})(typeof window<"u"?window:commonjsGlobal,function(t,e){function n(){}let s=n.prototype=Object.create(e.prototype);s.handleEvent=function(d){let u="on"+d.type;this[u]&&this[u](d)};let a,r;"ontouchstart"in t?(a="touchstart",r=["touchmove","touchend","touchcancel"]):t.PointerEvent?(a="pointerdown",r=["pointermove","pointerup","pointercancel"]):(a="mousedown",r=["mousemove","mouseup"]),s.touchActionValue="none",s.bindHandles=function(){this._bindHandles("addEventListener",this.touchActionValue)},s.unbindHandles=function(){this._bindHandles("removeEventListener","")},s._bindHandles=function(d,u){this.handles.forEach(m=>{m[d](a,this),m[d]("click",this),t.PointerEvent&&(m.style.touchAction=u)})},s.bindActivePointerEvents=function(){r.forEach(d=>{t.addEventListener(d,this)})},s.unbindActivePointerEvents=function(){r.forEach(d=>{t.removeEventListener(d,this)})},s.withPointer=function(d,u){u.pointerId===this.pointerIdentifier&&this[d](u,u)},s.withTouch=function(d,u){let m;for(let f of u.changedTouches)f.identifier===this.pointerIdentifier&&(m=f);m&&this[d](u,m)},s.onmousedown=function(d){this.pointerDown(d,d)},s.ontouchstart=function(d){this.pointerDown(d,d.changedTouches[0])},s.onpointerdown=function(d){this.pointerDown(d,d)};const o=["TEXTAREA","INPUT","SELECT","OPTION"],h=["radio","checkbox","button","submit","image","file"];return s.pointerDown=function(d,u){let m=o.includes(d.target.nodeName),f=h.includes(d.target.type),p=!m||f;!this.isPointerDown&&!d.button&&p&&(this.isPointerDown=!0,this.pointerIdentifier=u.pointerId!==void 0?u.pointerId:u.identifier,this.pointerDownPointer={pageX:u.pageX,pageY:u.pageY},this.bindActivePointerEvents(),this.emitEvent("pointerDown",[d,u]))},s.onmousemove=function(d){this.pointerMove(d,d)},s.onpointermove=function(d){this.withPointer("pointerMove",d)},s.ontouchmove=function(d){this.withTouch("pointerMove",d)},s.pointerMove=function(d,u){let m={x:u.pageX-this.pointerDownPointer.pageX,y:u.pageY-this.pointerDownPointer.pageY};this.emitEvent("pointerMove",[d,u,m]),!this.isDragging&&this.hasDragStarted(m)&&this.dragStart(d,u),this.isDragging&&this.dragMove(d,u,m)},s.hasDragStarted=function(d){return Math.abs(d.x)>3||Math.abs(d.y)>3},s.dragStart=function(d,u){this.isDragging=!0,this.isPreventingClicks=!0,this.emitEvent("dragStart",[d,u])},s.dragMove=function(d,u,m){this.emitEvent("dragMove",[d,u,m])},s.onmouseup=function(d){this.pointerUp(d,d)},s.onpointerup=function(d){this.withPointer("pointerUp",d)},s.ontouchend=function(d){this.withTouch("pointerUp",d)},s.pointerUp=function(d,u){this.pointerDone(),this.emitEvent("pointerUp",[d,u]),this.isDragging?this.dragEnd(d,u):this.staticClick(d,u)},s.dragEnd=function(d,u){this.isDragging=!1,setTimeout(()=>delete this.isPreventingClicks),this.emitEvent("dragEnd",[d,u])},s.pointerDone=function(){this.isPointerDown=!1,delete this.pointerIdentifier,this.unbindActivePointerEvents(),this.emitEvent("pointerDone")},s.onpointercancel=function(d){this.withPointer("pointerCancel",d)},s.ontouchcancel=function(d){this.withTouch("pointerCancel",d)},s.pointerCancel=function(d,u){this.pointerDone(),this.emitEvent("pointerCancel",[d,u])},s.onclick=function(d){this.isPreventingClicks&&d.preventDefault()},s.staticClick=function(d,u){let m=d.type==="mouseup";m&&this.isIgnoringMouseUp||(this.emitEvent("staticClick",[d,u]),m&&(this.isIgnoringMouseUp=!0,setTimeout(()=>{delete this.isIgnoringMouseUp},400)))},n})}(unidragger)),unidragger.exports}/*!
 * Draggabilly v3.0.0
 * Make that shiz draggable
 * https://draggabilly.desandro.com
 * MIT license
 */(function(l){(function(i,t){l.exports?l.exports=t(i,requireGetSize(),requireUnidragger()):i.Draggabilly=t(i,i.getSize,i.Unidragger)})(typeof window<"u"?window:commonjsGlobal,function(t,e,n){function s(){}let a=t.jQuery;function r(p,E){this.element=typeof p=="string"?document.querySelector(p):p,a&&(this.$element=a(this.element)),this.options={},this.option(E),this._create()}let o=r.prototype=Object.create(n.prototype);o.option=function(p){this.options={...this.options,...p}};const h=["relative","absolute","fixed"];o._create=function(){this.position={},this._getPosition(),this.startPoint={x:0,y:0},this.dragPoint={x:0,y:0},this.startPosition={...this.position};let p=getComputedStyle(this.element);h.includes(p.position)||(this.element.style.position="relative"),this.on("pointerDown",this.handlePointerDown),this.on("pointerUp",this.handlePointerUp),this.on("dragStart",this.handleDragStart),this.on("dragMove",this.handleDragMove),this.on("dragEnd",this.handleDragEnd),this.setHandles(),this.enable()},o.setHandles=function(){let{handle:p}=this.options;typeof p=="string"?this.handles=this.element.querySelectorAll(p):typeof p=="object"&&p.length?this.handles=p:p instanceof HTMLElement?this.handles=[p]:this.handles=[this.element]};const d=["dragStart","dragMove","dragEnd"];let u=o.emitEvent;o.emitEvent=function(p,E){if(!this.isEnabled&&d.includes(p))return;u.call(this,p,E);let T=t.jQuery;if(!T||!this.$element)return;let F,b=E;E&&E[0]instanceof Event&&([F,...b]=E);let V=T.Event(F);V.type=p,this.$element.trigger(V,b)},o._getPosition=function(){let p=getComputedStyle(this.element),E=this._getPositionCoord(p.left,"width"),I=this._getPositionCoord(p.top,"height");this.position.x=isNaN(E)?0:E,this.position.y=isNaN(I)?0:I,this._addTransformPosition(p)},o._getPositionCoord=function(p,E){if(p.includes("%")){let I=e(this.element.parentNode);return I?parseFloat(p)/100*I[E]:0}return parseInt(p,10)},o._addTransformPosition=function(p){let E=p.transform;if(!E.startsWith("matrix"))return;let I=E.split(","),T=E.startsWith("matrix3d")?12:4,F=parseInt(I[T],10),b=parseInt(I[T+1],10);this.position.x+=F,this.position.y+=b},o.handlePointerDown=function(p,E){this.isEnabled&&(this.pointerDownPointer={pageX:E.pageX,pageY:E.pageY},p.preventDefault(),document.activeElement.blur(),this.bindActivePointerEvents(p),this.element.classList.add("is-pointer-down"))},o.handleDragStart=function(){this.isEnabled&&(this._getPosition(),this.measureContainment(),this.startPosition.x=this.position.x,this.startPosition.y=this.position.y,this.setLeftTop(),this.dragPoint.x=0,this.dragPoint.y=0,this.element.classList.add("is-dragging"),this.animate())},o.measureContainment=function(){let p=this.getContainer();if(!p)return;let E=e(this.element),I=e(p),{borderLeftWidth:T,borderRightWidth:F,borderTopWidth:b,borderBottomWidth:A}=I,V=this.element.getBoundingClientRect(),U=p.getBoundingClientRect(),et=T+F,J=b+A,j=this.relativeStartPosition={x:V.left-(U.left+T),y:V.top-(U.top+b)};this.containSize={width:I.width-et-j.x-E.width,height:I.height-J-j.y-E.height}},o.getContainer=function(){let p=this.options.containment;return p?p instanceof HTMLElement?p:typeof p=="string"?document.querySelector(p):this.element.parentNode:void 0},o.handleDragMove=function(p,E,I){if(!this.isEnabled)return;let T=I.x,F=I.y,b=this.options.grid,A=b&&b[0],V=b&&b[1];T=m(T,A),F=m(F,V),T=this.containDrag("x",T,A),F=this.containDrag("y",F,V),T=this.options.axis=="y"?0:T,F=this.options.axis=="x"?0:F,this.position.x=this.startPosition.x+T,this.position.y=this.startPosition.y+F,this.dragPoint.x=T,this.dragPoint.y=F};function m(p,E,I){return E?(I=I||"round",Math[I](p/E)*E):p}o.containDrag=function(p,E,I){if(!this.options.containment)return E;let T=p=="x"?"width":"height",F=this.relativeStartPosition[p],b=m(-F,I,"ceil"),A=this.containSize[T];return A=m(A,I,"floor"),Math.max(b,Math.min(A,E))},o.handlePointerUp=function(){this.element.classList.remove("is-pointer-down")},o.handleDragEnd=function(){this.isEnabled&&(this.element.style.transform="",this.setLeftTop(),this.element.classList.remove("is-dragging"))},o.animate=function(){this.isDragging&&(this.positionDrag(),requestAnimationFrame(()=>this.animate()))},o.setLeftTop=function(){let{x:p,y:E}=this.position;this.element.style.left=`${p}px`,this.element.style.top=`${E}px`},o.positionDrag=function(){let{x:p,y:E}=this.dragPoint;this.element.style.transform=`translate3d(${p}px, ${E}px, 0)`},o.setPosition=function(p,E){this.position.x=p,this.position.y=E,this.setLeftTop()},o.enable=function(){this.isEnabled||(this.isEnabled=!0,this.bindHandles())},o.disable=function(){this.isEnabled&&(this.isEnabled=!1,this.isDragging&&this.dragEnd(),this.unbindHandles())};const f=["transform","left","top","position"];return o.destroy=function(){this.disable(),f.forEach(p=>{this.element.style[p]=""}),this.unbindHandles(),this.$element&&this.$element.removeData("draggabilly")},o._init=s,a&&a.bridget&&a.bridget("draggabilly",r),r})})(draggabilly);var draggabillyExports=draggabilly.exports;const Draggabilly=getDefaultExportFromCjs(draggabillyExports),TAB_CONTENT_MARGIN=9,TAB_CONTENT_OVERLAP_DISTANCE=1,TAB_CONTENT_MIN_WIDTH=24,TAB_CONTENT_MAX_WIDTH=240,TAB_SIZE_SMALL=84,TAB_SIZE_SMALLER=60,TAB_SIZE_MINI=48,noop=l=>{},closest=(l,i)=>{let t=1/0,e=-1;return i.forEach((n,s)=>{Math.abs(l-n)<t&&(t=Math.abs(l-n),e=s)}),e},tabTemplate=`
    <div class="chrome-tab">
      <div class="chrome-tab-dividers"></div>
      <div class="chrome-tab-background">
        <svg version="1.1" xmlns="http://www.w3.org/2000/svg"><defs><symbol id="chrome-tab-geometry-left" viewBox="0 0 214 36"><path d="M17 0h197v36H0v-2c4.5 0 9-3.5 9-8V8c0-4.5 3.5-8 8-8z"/></symbol><symbol id="chrome-tab-geometry-right" viewBox="0 0 214 36"><use xlink:href="#chrome-tab-geometry-left"/></symbol><clipPath id="crop"><rect class="mask" width="100%" height="100%" x="0"/></clipPath></defs><svg width="52%" height="100%"><use xlink:href="#chrome-tab-geometry-left" width="214" height="36" class="chrome-tab-geometry"/></svg><g transform="scale(-1, 1)"><svg width="52%" height="100%" x="-100%" y="0"><use xlink:href="#chrome-tab-geometry-right" width="214" height="36" class="chrome-tab-geometry"/></svg></g></svg>
      </div>
      <div class="chrome-tab-content">
        <div class="chrome-tab-favicon"></div>
        <div class="chrome-tab-title"></div>
        <div class="chrome-tab-drag-handle"></div>
        <div class="chrome-tab-close"></div>
      </div>
    </div>
  `,defaultTapProperties={title:"New tab",favicon:!1};let instanceId=0;class ChromeTabs{constructor(){this.draggabillies=[],this.tabs=[]}static init(i){this.el=i,this.instanceId=instanceId,this.el.setAttribute("data-chrome-tabs-instance-id",this.instanceId),instanceId+=1,this.setupCustomProperties(),this.setupStyleEl(),this.setupEvents(),this.layoutTabs(),this.setupDraggabilly()}static emit(i,t){this.el.dispatchEvent(new CustomEvent(i,{detail:t}))}static setupCustomProperties(){this.el.style.setProperty("--tab-content-margin",`${TAB_CONTENT_MARGIN}px`)}static setupStyleEl(){this.styleEl=document.createElement("style"),this.el.appendChild(this.styleEl)}static setupEvents(){window.addEventListener("resize",i=>{this.cleanUpPreviouslyDraggedTabs(),this.layoutTabs()}),this.el.addEventListener("dblclick",i=>{[this.el,this.tabContentEl].includes(i.target)&&this.addTab()}),this.tabEls.forEach(i=>this.setTabCloseEventListener(i))}static get tabEls(){return Array.prototype.slice.call(this.el.querySelectorAll(".chrome-tab"))}static get tabContentEl(){return this.el.querySelector(".chrome-tabs-content")}static get tabContentWidths(){const i=this.tabEls.length,t=this.tabContentEl.clientWidth,e=(i-1)*TAB_CONTENT_OVERLAP_DISTANCE,n=(t-2*TAB_CONTENT_MARGIN+e)/i,s=Math.max(TAB_CONTENT_MIN_WIDTH,Math.min(TAB_CONTENT_MAX_WIDTH,n)),a=Math.floor(s),r=a*i+2*TAB_CONTENT_MARGIN-e,o=t-r,h=[];let d=o;for(let u=0;u<i;u+=1){const m=a<TAB_CONTENT_MAX_WIDTH&&d>0?1:0;h.push(a+m),d>0&&(d-=1)}return h}static get tabContentPositions(){const i=[],t=this.tabContentWidths;let e=TAB_CONTENT_MARGIN;return t.forEach((n,s)=>{const a=s*TAB_CONTENT_OVERLAP_DISTANCE;i.push(e-a),e+=n}),i}static get tabPositions(){const i=[];return this.tabContentPositions.forEach(t=>{i.push(t-TAB_CONTENT_MARGIN)}),i}static layoutTabs(){const i=this.tabContentWidths;this.tabEls.forEach((e,n)=>{const s=i[n],a=s+2*TAB_CONTENT_MARGIN;e.style.width=a+"px",e.removeAttribute("is-small"),e.removeAttribute("is-smaller"),e.removeAttribute("is-mini"),s<TAB_SIZE_SMALL&&e.setAttribute("is-small",""),s<TAB_SIZE_SMALLER&&e.setAttribute("is-smaller",""),s<TAB_SIZE_MINI&&e.setAttribute("is-mini","")});let t="";this.tabPositions.forEach((e,n)=>{t+=`
          .chrome-tabs[data-chrome-tabs-instance-id="${this.instanceId}"] .chrome-tab:nth-child(${n+1}) {
            transform: translate3d(${e}px, 0, 0)
          }
        `}),this.styleEl.innerHTML=t}static createNewTabEl(){const i=document.createElement("div");return i.innerHTML=tabTemplate,i.firstElementChild}static addTab(i,{animate:t=!0,background:e=!1}={}){const n=this.createNewTabEl();return t&&(n.classList.add("chrome-tab-was-just-added"),setTimeout(()=>n.classList.remove("chrome-tab-was-just-added"),500)),i=Object.assign({},defaultTapProperties,i),this.tabContentEl.appendChild(n),this.setTabCloseEventListener(n),this.updateTab(n,i),this.emit("tabAdd",{tabEl:n}),e||this.setCurrentTab(n),this.cleanUpPreviouslyDraggedTabs(),this.layoutTabs(),this.setupDraggabilly(),this.tabs.push({ul:n,content:i.content}),n}static setTabCloseEventListener(i){i.querySelector(".chrome-tab-close").addEventListener("click",t=>this.removeTab(i))}static get activeTabEl(){return this.el.querySelector(".chrome-tab[active]")}static hasActiveTab(){return!!this.activeTabEl}static setCurrentTab(i,t){const e=this.activeTabEl;if(e===i)return;e&&e.removeAttribute("active"),i.setAttribute("active",""),this.emit("activeTabChange",{tabEl:i});const n=this.tabs.find(s=>s.ul===i);n!=null&&(t||n.content.Focus())}static removeTab(i){let t=this.tabs.findIndex(n=>n.ul===i);if(t!==-1){const n=this.tabs[t];if(n!=null){var e;if(!this.Dirty){i===this.activeTabEl&&(i.nextElementSibling?this.setCurrentTab(i.nextElementSibling):i.previousElementSibling&&this.setCurrentTab(i.previousElementSibling)),i!=null&i.parentNode!=null&&(i.parentNode.removeChild(i),this.emit("tabRemove",{tabEl:i})),n.content.Dispose();return}n.content._confirm=(e=new Core.Components.Forms.ConfirmDialog,e.Content="Do you want to save the data before closing?",e.OpenEditForm=n.content,e.TabEditor=n.content.TabEditor,e),n.content._confirm.YesConfirmed=Bridge.fn.combine(n.content._confirm.YesConfirmed,Bridge.fn.bind(this,function(){var s=0,a,r=Bridge.fn.bind(this,function(){for(;;)switch(s=System.Array.min([0,1],s),s){case 0:{if(a=n.content._confirm.OpenEditForm.Save(),s=1,a.isCompleted())continue;a.continue(r);return}case 1:{a.getAwaitedResult(),i===this.activeTabEl&&(i.nextElementSibling?this.setCurrentTab(i.nextElementSibling):i.previousElementSibling&&this.setCurrentTab(i.previousElementSibling)),i!=null&i.parentNode!=null&&(i.parentNode.removeChild(i),this.emit("tabRemove",{tabEl:i})),n.content._confirm.OpenEditForm.Dispose(),n.content._confirm.Dispose();return}default:return}},arguments);r()})),this._confirm.NoConfirmed=Bridge.fn.combine(this._confirm.NoConfirmed,Bridge.fn.bind(this,function(){this._confirm.OpenEditForm.Dispose(),this._confirm.Dispose()})),this._confirm.IgnoreCancelButton=!0,this._confirm.Render()}}this.cleanUpPreviouslyDraggedTabs(),this.layoutTabs(),this.setupDraggabilly()}static updateTab(i,t){i.querySelector(".chrome-tab-title").textContent=t.title;const e=i.querySelector(".chrome-tab-favicon");t.favicon?(t.favicon.includes("fa-")?e.className=t.favicon:e.style.backgroundImage=`url('${t.favicon}')`,e.removeAttribute("hidden","")):(e.setAttribute("hidden",""),e.removeAttribute("style")),t.id&&i.setAttribute("data-tab-id",t.id)}static cleanUpPreviouslyDraggedTabs(){this.tabEls.forEach(i=>i.classList.remove("chrome-tab-was-just-dragged"))}static setupDraggabilly(){const i=this.tabEls,t=this.tabPositions;this.isDragging&&(this.isDragging=!1,this.el.classList.remove("chrome-tabs-is-sorting"),this.draggabillyDragging.element.classList.remove("chrome-tab-is-dragging"),this.draggabillyDragging.element.style.transform="",this.draggabillyDragging.dragEnd(),this.draggabillyDragging.isDragging=!1,this.draggabillyDragging.positionDrag=noop,this.draggabillyDragging.destroy(),this.draggabillyDragging=null),this.draggabillies.forEach(e=>e.destroy()),i.forEach((e,n)=>{const s=t[n],a=new Draggabilly(e,{axis:"x",handle:".chrome-tab-drag-handle",containment:this.tabContentEl});this.draggabillies.push(a),a.on("pointerDown",r=>{this.setCurrentTab(e)}),a.on("dragStart",r=>{this.isDragging=!0,this.draggabillyDragging=a,e.classList.add("chrome-tab-is-dragging"),this.el.classList.add("chrome-tabs-is-sorting")}),a.on("dragEnd",r=>{this.isDragging=!1;const o=parseFloat(e.style.left,10);e.style.transform="translate3d(0, 0, 0)",requestAnimationFrame(h=>{e.style.left="0",e.style.transform=`translate3d(${o}px, 0, 0)`,requestAnimationFrame(d=>{e.classList.remove("chrome-tab-is-dragging"),this.el.classList.remove("chrome-tabs-is-sorting"),e.classList.add("chrome-tab-was-just-dragged"),requestAnimationFrame(u=>{e.style.transform="",this.layoutTabs(),this.setupDraggabilly()})})})}),a.on("dragMove",(r,o,h)=>{const d=this.tabEls,u=d.indexOf(e),m=s+h.x,f=closest(m,t),p=Math.max(0,Math.min(d.length,f));u!==p&&this.animateTabMove(e,u,p)})})}static animateTabMove(i,t,e){e<t?i.parentNode.insertBefore(i,this.tabEls[e]):i.parentNode.insertBefore(i,this.tabEls[e+1]),this.emit("tabReorder",{tabEl:i,originIndex:t,destinationIndex:e}),this.layoutTabs()}}c(ChromeTabs,"draggabillies",[]),c(ChromeTabs,"tabs",[]);const R=class R extends EditForm{constructor(t=null){super(t);c(this,"Popup",!1);c(this,"IsTab",!0);c(this,"PopUpMenu");this.PopulateDirty=!1,this._hotKeyComponents=[],this.DataSearchEntry={}}get Show(){return super.Show}set Show(t){super.Show=t,t&&!this.Popup&&ChromeTabs.setCurrentTab(this._li,this.Pop)}Render(){this.ParentElement||(this.ParentElement=R.TabContainer),this.Popup?this.RenderPopup():this.RenderTab(),this.Focus()}get TabTitle(){var t;return((t=this.Meta)==null?void 0:t.Label)??this.Title}RenderTab(){Html.Take(R.TabWrapper),this._li=ChromeTabs.addTab({title:this.Meta.Title==null?this.TabTitle:this.Title,favicon:this.Meta.Icon==null?this.Meta.Icon:this.Icon,content:this}),Html.Take(R.TabContainer).TabIndex(-1).Trigger(EventType.Focus).Div.Event(EventType.KeyDown,t=>this.HotKeyHandler(t)).Render(),this.Element=Html.Context,this.ParentElement=R.TabContainer,R.Tabs.push(this),super.Render()}RenderPopup(){var t;Html.Take(this.ParentElement??((t=this.Parent)==null?void 0:t.Element)??R.TabContainer).Div.ClassName("backdrop").TabIndex(-1).Trigger(EventType.Focus).Event(EventType.KeyDown,e=>this.HotKeyHandler(e)),this._backdrop=Html.Context,Html.Instance.Div.ClassName("popup-content").Div.ClassName("popup-title").Span.IText(this.Title),this.TitleElement=Html.Context,Client.Instance.SystemRole&&this.TitleElement.addEventListener("contextmenu",e=>this.SysConfigMenu(e,null,null,null)),Html.Instance.End.Div.ClassName("menu-item"),this.PopUpMenu=Html.Context,Html.Instance.End.End.Div.ClassName("popup-body"),this.Element=Html.Context,super.Render(),this._backdrop.OutOfViewport().Top&&this._backdrop.scrollIntoView(!0)}TriggerMatchHotKey(t,e,n,s,a){if(e==null)return;let r=[];n&&r.push(KeyCodeEnum.Shift),s&&r.push(KeyCodeEnum.Ctrl),a&&r.push(KeyCodeEnum.Alt),e<KeyCodeEnum.Shift?r.unshift(e):e>KeyCodeEnum.Alt&&r.push(e),this._hotKeyComponents=this._hotKeyComponents||this.FilterChildren(o=>o instanceof Button&&o.Meta.HotKey.trim()!=="").map(o=>o),this._hotKeyComponents.forEach(o=>{var f;let h=o.Meta.HotKey.split(",");if(h.length===0)return;let u=h[h.length-1].split("-").map(p=>{let E=KeyCodeEnum[p.trim()];return E||null}).filter(p=>p!=null).sort((p,E)=>p-E);JSON.stringify(r)===JSON.stringify(u)&&(t.preventDefault(),t.stopPropagation(),(f=o.Element)==null||f.click())})}HotKeyHandler(t){var o;const e=t.KeyCodeEnum();if(e===KeyCodeEnum.F6){let h=this.FindActiveComponent(d=>d instanceof GridView$1).FirstOrDefault();if(h instanceof GridView$1){h&&!h.AllListViewItem.some(d=>d.Selected)&&(h.AllListViewItem.length?h.AllListViewItem[0].Focus():h.ListViewSearch.Focus());return}}if(t.AltKey()&&e===KeyCodeEnum.GraveAccent){if(R.Tabs.length<=1)return;let h=R.Tabs.indexOf(this);if(h=h>=R.Tabs.length-1?0:h+1,h<0||h>R.Tabs.length)return;(o=R.Tabs[h])==null||o.Focus()}const n=t.ShiftKey(),s=t.CtrlOrMetaKey(),a=t.AltKey();if(this.DefaultHotKeys(e,n,s,a)){t.preventDefault(),t.stopPropagation();return}e>=KeyCodeEnum.Shift&&e<=KeyCodeEnum.Alt||this.TriggerMatchHotKey(t,e,n,s,a)}DefaultHotKeys(t,e,n,s){var a;if(!t)return!1;if(t===KeyCodeEnum.Escape&&!e&&!n&&!s)return this.DirtyCheckAndCancel(),!0;if(n&&s&&(t===KeyCodeEnum.LeftArrow||t===KeyCodeEnum.RightArrow)){let r=R.Tabs.indexOf(this);return r=t===KeyCodeEnum.LeftArrow?r===0?R.Tabs.length-1:r-1:r>=R.Tabs.length-1?0:r+1,r<0||r>R.Tabs.length?!1:((a=R.Tabs[r])==null||a.Focus(),!0)}if(n&&e&&t===KeyCodeEnum.F){let r=this.FindActiveComponent(o=>o instanceof ListView).FirstOrDefault();if(r instanceof ListView)return!r||!r.Meta.CanSearch||r.ListViewSearch.AdvancedSearch(null),!0}return!1}Focus(){this.Popup||(R.Tabs.forEach(t=>t.Show=!1),this.FeatureName&&(this.Href=Client.BaseUri+"/"+this.FeatureName+(this.EntityId?`?Id=${this.EntityId}`:""),window.history.pushState(null,LangSelect.Get(this.TabTitle),this.Href))),this.Show=!0,document.title=LangSelect.Get(this.TabTitle)}Close(t){var s,a;const e=parseInt((s=t.which)==null?void 0:s.toString()),n=parseInt((a=t.button)==null?void 0:a.toString());(e===2||n===1)&&(t.preventDefault(),this.DirtyCheckAndCancel())}Dispose(){!this.Popup&&this._li&&this.DisposeTab(),super.Dispose()}DisposeTab(){this.ParentForm&&(this.ParentForm.focus(),this.ParentForm=null),R.Tabs=R.Tabs.filter(e=>e!==this);let t=ChromeTabs.tabs.findIndex(e=>e.ul===this._li);t!==-1&&ChromeTabs.tabs.splice(t,1),ChromeTabs.tabs.length==0&&window.history.pushState({page:null},"Home",window.location.origin||"")}RemoveDOM(){var t,e,n,s;(t=this.Element)==null||t.remove(),(e=this._li)==null||e.remove(),(n=this._backdrop)==null||n.remove(),(s=this._backdropGridView)==null||s.remove()}};c(R,"TabWrapper",document.getElementById("tabs")),c(R,"TabContainer",document.getElementById("tab-content")),c(R,"Tabs",[]),c(R,"ActiveTab",()=>R.Tabs.find(t=>t.Show)),c(R,"FindTab",t=>R.Tabs.find(e=>e.Id===t)),c(R,"ShowTabText"),c(R,"ActiveClass","active");let TabEditor=R;const tabEditor=Object.freeze(Object.defineProperty({__proto__:null,TabEditor},Symbol.toStringTag,{value:"Module"}));class ComponentExt{constructor(){c(this,"StepPx",10)}static MapToPatch(i,t=null,e=null){const n={Table:t,Changes:[]};return Utils$1.ForEachProp(i,(s,a)=>{s.startsWith("$")||e&&!e.includes(s)||n.Changes.push({Field:s,Value:a==null?void 0:a.toString()})}),n}static MapToFilterOperator(i,t){if(!t||!i.FieldName)return"";t=t.trim();let e=i.DisplayField?`JSON_VALUE(ds.[${i.DisplayField}], '$.${i.DisplayDetail}')`:`ds.[${i.FieldName}]`;if(!e)return"";if(i.ComponentType===ComponentType.Datepicker){let n=Date.parse(t);if(!Number.isNaN(n)){const a=new Date(n).toISOString();return`cast(${e} as date) = cast('${a}' as date)`}return""}else{if(i.ComponentType===ComponentType.Checkbox)return`${e} = ${!!t}`;if(i.ComponentType===ComponentType.Numbox){const n=parseFloat(t);return isNaN(n)?"":`${e} = ${n}`}}return i.FilterTemplate?`${i.FilterTemplate.replace(/\{0\}/g,t)}`:`charindex(N'${t}', ${e}) >= 1`}static async InitFeatureByName(i,t=!0){const e=await this.LoadFeature(i);if(!e)throw new Error("Feature not found");const n=new TabEditor(e.EntityName);return e.Script&&ComponentExt.AssignMethods(e,n),EditForm.Portal=t,n.Meta=e,n.Name=e.Name||"",n.Id=e.Name+e.Id,n.Icon=e.Icon,n.Render(),n}static LoadFeature(i,t=null){return new Promise((e,n)=>{Client.Instance.SubmitAsync({Url:"/api/feature/getFeature?name="+i,IsRawString:!0,Method:"GET"}).then(a=>{e(a)}).catch(a=>n(a))})}static LoadPublicFeature(i,t=null){return new Promise((e,n)=>{Client.Instance.SubmitAsync({Url:"/api/feature/getPublicFeature?name="+i,IsRawString:!0,Method:"GET"}).then(a=>{e(a)}).catch(a=>n(a))})}static AssignMethods(i,t){const e=new Function("return "+i.Script)();Object.assign(t,e),typeof t.Init=="function"&&t.Init()}static FindComponentEvent(i,t){let e=i.ParentForm;for(;e!==null&&!e[t];)e=e.ParentForm;return e}static SetShow(i,t,...e){i.Children.filter(n=>e.includes(n.Name)).forEach(n=>n.Show=t)}static AlterPosition(i,t){if(!i||!t)return;const e=t.getBoundingClientRect();var n=e.bottom;i.style.top="auto",i.style.right="auto",i.style.bottom="auto",i.style.left="auto",Html.Take(i).Floating(n,e.left);const s={Right:e.right>window.innerWidth,Bottom:e.bottom>window.innerHeight};s.Right&&(s.Bottom?e.Top>i.ClientHeight?this.TopCenter(i,parentEle):e.Left>i.ClientWidth&&this.LeftMiddle(i,parentEle):this.BottomCenter(i,parentEle)),s.Bottom&&(this.RightMiddle(i,parentEle),s.Right&&this.LeftMiddle(i,parentEle),s.Left&&this.TopCenter(i,parentEle))}static BottomCenter(i,t){const e=t.getBoundingClientRect();i.style.right="auto",i.style.top=e.bottom+"px",PositionUtils.MoveLeft(i)}static GetComputedPx(i,t){const e=window.getComputedStyle(i)[t];return e&&parseFloat(e.replace("px",""))||0}static TopCenter(i,t){i.style.right="auto",PositionUtils.MoveLeft(i),PositionUtils.MoveTop(i,t)}static MoveLeft(i){for(;PositionUtils.IsOutOfViewport(i).right;){const t=PositionUtils.GetComputedPx(i,"left")-this.StepPx;i.style.left=t+"px"}}static MoveTop(i,t){const e=t?t.getBoundingClientRect().top:null;for(;PositionUtils.IsOutOfViewport(i).bottom||t&&i.getBoundingClientRect().bottom>e;){const n=PositionUtils.GetComputedPx(i,"top")-(t?1:this.StepPx);i.style.top=n+"px"}}static LeftMiddle(i,t){const e=t.getBoundingClientRect();i.style.left="auto",i.style.bottom="auto",i.style.right=e.left+"px",this.MoveTop(i)}static RightMiddle(i,t){const e=t.getBoundingClientRect();i.style.right="auto",i.style.bottom="auto",i.style.left=e.right+"px",this.MoveTop(i)}static IsOutOfViewport(i){const t=i.getBoundingClientRect();return{top:t.top<0,right:t.right>(window.innerWidth||document.documentElement.clientWidth),bottom:t.bottom>(window.innerHeight||document.documentElement.clientHeight),left:t.left<0}}static DownloadFile(i,t){const e=document.createElement("a");e.style.display="none",e.href=URL.createObjectURL(t),e.download=i,document.body.appendChild(e),e.click(),document.body.removeChild(e)}static FullScreen(i){i.requestFullscreen?i.requestFullscreen():i.webkitRequestFullscreen?i.webkitRequestFullscreen():i.msRequestFullscreen&&i.msRequestFullscreen()}static FindClosest(i,t){if(i instanceof t)return i;for(;i.Parent!=null;)if(i=i.Parent,i instanceof t)return i;return null}static async OpenTabOrPopup(i,t){const e=await __vitePreload(()=>Promise.resolve().then(()=>editableComponent),void 0),{EditForm:n}=await __vitePreload(async()=>{const{EditForm:r}=await Promise.resolve().then(()=>editForm);return{EditForm:r}},void 0),{TabEditor:s}=await __vitePreload(async()=>{const{TabEditor:r}=await Promise.resolve().then(()=>tabEditor);return{TabEditor:r}},void 0);let a;i instanceof n?a=i:i instanceof e.default&&(a=n||this.FindClosest(i,n)),t instanceof s&&(t.Popup?i.AddChild(t):t.Render(),t.ParentForm=a,t.OpenFrom=a instanceof n&&(a==null?void 0:a.FirstOrDefault(r=>r.Entity===t.Entity)))}async OpenTabOrPopup(i,t){var s;const{EditForm:e}=await __vitePreload(async()=>{const{EditForm:a}=await Promise.resolve().then(()=>editForm);return{EditForm:a}},void 0);let n;i instanceof e?n=i:n=i.EditForm||i.FindClosest(a=>a instanceof e),t.Popup?i.AddChild(t):t.Render(),t.ParentForm=n,t.OpenFrom=(s=n==null?void 0:n.FilterChildren(a=>a.Entity===t.Entity))==null?void 0:s[0]}static async OpenTab(i,t,e,n,s=!1,a=!1){const r=await __vitePreload(()=>Promise.resolve().then(()=>tabEditor),void 0);if(!s&&r.TabEditor.FindTab(t)){const d=r.TabEditor.FindTab(t);return d.Focus(),d}const o=await this.LoadFeature(e),h=n();return h.Popup=s,h.Name=e,h.Id=t,h.Meta=o,this.AssignMethods(o,h),await this.OpenTabOrPopup(i,h),h}static OpenPopup(i,t,e,n=!1,s=!1){const a=()=>{let r=0,o=JSON.stringify(i);for(let h=0;h<o.length;h++){const d=o.charCodeAt(h);r=(r<<5)-r+d,r|=0}return r};return this.OpenTab(i,a().toString(),t,e,!0,n)}}class Label extends EditableComponent{constructor(i,t=null){super(i,t)}Render(){this.SetDefaultVal();const i=this.Entity[this.Meta.FieldName];let t="";if(this.Element||this.RenderNewEle(t,i),this.Meta&&this.Meta.ComponentType=="Checkbox"){this.Element.InnerHTML=i?"✅":"☐";return}if(Utils$1.isNullOrWhiteSpace(this.Meta.Query))t=this.CalcCellText(i),this.UpdateEle(t);else{var e=Utils$1.IsFunction(this.Meta.Query);if(this.Meta.Query){this.QueryCellText(e);return}}}RenderCellTextAsync(){}UpdateEle(i){this.Element.innerHTML=i,i.includes("<div")||this.Element.setAttribute("title",i)}RenderNewEle(i,t){Html.Take(this.ParentElement).TextAlign(this.CalcTextAlign(this.Meta,t)),i.includes("<div")?Html.Instance.Div.Render():Html.Instance.Span.Render(),Html.Instance.ClassName("cell-text").InnerHTML(i),this.Element=Html.Context,Html.Instance.End.Render()}CalcCellText(i){var e;var t=Utils$1.GetCellText(this.Meta,i,this.Entity,!1,this.EmptyRow,(e=this.EditForm)==null?void 0:e.Entity);return(!t||t=="null")&&(t=""),t}QueryCellText(i){if(!this.Meta.PreQuery||i===null)return;const t=Utils$1.IsFunction(this.Meta.PreQuery),e=t?t.call(this,this).toString():"",n={MetaConn:this.MetaConn,DataConn:this.DataConn,Params:JSON.stringify(e),ComId:this.Meta.Id};Client.Instance.SubmitAsync({Method:"POST",Url:Utils$1.ComQuery,Value:JSON.stringify(n)}).then(s=>{if(s.Nothing())return;const a=i.call(this,this,s).toString();this.UpdateEle(a,null,!1)})}LabelClickHandler(i){this.DispatchEvent(this.Meta.Events,"click",this.Entity)}CalcTextAlign(i,t){const e=i.TextAlignEnum;return e||(i.ReferenceId||t===null||typeof t=="string"?"left":typeof t=="number"?"right":"center")}UpdateView(i=!1,t=null,e){this.PrepareUpdateView(i,t),this.Render()}GetValueTextAct(){return this.Element.textContent}}class Paginator extends EditableComponent{constructor(t){super(null,null);c(this,"Parent");if(!t)throw new Error("paginationOptions is required");this.Entity=t,this.Options=t,this.Options.StartIndex=this.Options.StartIndex||1,this.Element=null,this.PopulateDirty=!1,this.AlwaysValid=!0}Render(){Html.Take(this.Parent.Element).Div.ClassName("grid-toolbar paging").Label.IText("Pagination").End.Render(),this.Element=Html.Context;var t=new Label({FieldName:"StartIndex"}),e=new Label({FieldName:"EndIndex"}),n=new Label({FieldName:"Total"}),s=new Numbox({FieldName:"PageNumber"});if(s.AlwaysValid=!0,s.SetSeclection=!1,!this.Options.Virtal){var a=new Numbox({FieldName:"PageSize"});a.SetSeclection=!1,this.AddChild(a),a.Element.addEventListener("change",this.ReloadListView),Html.Instance.End.Render()}Html.Instance.Div.Style("display: flex;").Render(),this.AddChild(t),Html.Instance.Text("-"),this.AddChild(e),Html.Instance.IText(" of "),this.AddChild(n),this.Options.Virtal||(Html.Take(this.Element).Ul.ClassName("pagination").Li.Text("❮").Event("click",this.PrevPage.bind(this)).End.Render(),this.AddChild(s),s.Element.addEventListener("change",()=>{this.Options.PageIndex=this.Options.PageNumber-1,this.ReloadListView()}),Html.Instance.End.Li.Text("❯").Event("click",this.NextPage.bind(this)).End.Render())}CreateNumberInput(t){const e=document.createElement("input");return e.type="number",e.value=this.Options[t],e.addEventListener("change",()=>{this.Options[t]=parseInt(e.value),this.ReloadListView()}),e}CreateLabel(t,e=""){const n=document.createElement("label");return n.textContent=e?e.replace("{0:n0}",this.Options[t].toLocaleString()):this.Options[t],n}NextPage(){const t=Math.ceil(this.Options.Total/this.Options.PageSize);this.Options.PageNumber>=t||(this.Options.PageIndex++,this.Options.ClickHandler&&this.Options.ClickHandler(this.Options.PageIndex,null),this.ReloadListView())}PrevPage(){this.Options.PageIndex<=0||(this.Options.PageIndex--,this.Options.ClickHandler&&this.Options.ClickHandler(this.Options.PageIndex,null),this.ReloadListView())}ReloadListView(){this.Parent instanceof ListView&&this.Parent.ActionFilter()}}var St;class TabComponent extends EditableComponent{constructor(t,e=null){super(t);c(this,"BadgeElement");c(this,"Badge");c(this,"_li");c(this,"DisplayBadge");tt(this,St,!1)}set Show(t){this._li&&(super.Show=t,t?(this._li.classList.add("active"),this._li.querySelector("a").classList.add("active"),this.DispatchEvent(this.Meta.Events,"FocusIn",this.Entity).Done()):(this._li.classList.remove("active"),this._li.querySelector("a").classList.remove("active"),this.DispatchEvent(this.Meta.Events,"FocusOut",this.Entity).Done()))}Render(){Html.Take(this.Parent.Ul).Li.A.ClassName("nav-link tab-default").I.ClassName(this.Meta.Icon??"").End.Span.IText(this.Meta.Label??this.Meta.Name).Render(),Html.Instance.End.Span.ClassName("ml-1 badge badge-warning"),this.BadgeElement=Html.Context,this.DisplayBadge?Html.Instance.Text(this.Badge??""):this.BadgeElement.style.display="none",this._li=Html.Context.parentElement.parentElement,Html.Instance.End.Div.ClassName("desc").IText(this.Meta.Description??"").End.Render(),this._li.addEventListener("click",()=>{this.HasRendered?this.Focus():(this.Focus(),this.RenderTabContent())})}Focus(){this.Parent.Children.forEach(t=>{t.Show=!1}),this.Show=!0}RenderTabContent(){Html.Take(this.Parent.TabContent).Div.ClassName("tab-content"),this.Element=Html.Context,Section$1.RenderSection(this,this.Meta,null,this.EditForm),this.HasRendered=!0}}St=new WeakMap;class TabGroup extends EditableComponent{constructor(t,e=null){super(t);c(this,"ListViewType");c(this,"Ul");c(this,"TabContent");c(this,"ShouldCountBage");c(this,"HasRendered");c(this,"TabGroupElement");this.ListViewType=["ListView","GroupListView","GridView","GroupGridView"],this.Ul=null,this.TabContent=null,this.ShouldCountBage=!1,this.HasRendered=!1,this.TabGroup=!0}Render(){Html.Take(this.ParentElement).Div.ClassName("tab-group").ClassName(this.Meta.IsVertialTab?"tab-vertical":"tab-horizontal"),this.TabGroupElement=Html.Context,Html.Instance.Div.ClassName("headers-wrapper").Ul.ClassName("nav-config  nav nav-tabs nav-tabs-bottom mb-0"),this.Ul=Html.Context,Element=this.Ul.parentElement,Html.Instance.End.End.Render(),this.EditForm.ButtonFrozen!=null&&!this.EditForm.IsLoadButtonFrozen&&(Section$1.RenderGroupContent(this.Parent,this.EditForm.ButtonFrozen,this.EditForm.writePermission,this.EditForm.width),this.EditForm.IsLoadButtonFrozen=!0),Html.Instance.Div.ClassName("tabs-content"),this.TabContent=Html.Context}}var z;let Section$1=(z=class extends EditableComponent{constructor(t,e=null){super(null,e);c(this,"_chevron");this.elementType=t,this.Element=e,this.innerEle=null,this._chevron=null}Render(){var t,e,n,s,a,r,o;if(this.elementType==null?this.elementType=(e=(t=this.Element)==null?void 0:t.tagName)==null?void 0:e.toLowerCase():(Html.Take(this.ParentElement).Add(this.elementType.tagName==null?this.elementType:(s=(n=this.elementType)==null?void 0:n.tagName)==null?void 0:s.toLowerCase()),this.Element=Html.Context),this.Meta!==null){if(this.Meta.Html&&this.Meta.Html!=""){let h=this.Meta.Css&&this.Meta.Css!="";const d=(((a=this.Meta.FieldName)==null?void 0:a.toLowerCase())??"")+this.Meta.Id;if(h){const m=/(?:^|[\s\r\n])\.([a-zA-Z0-9-_]+)/g;if(h=h.replace(m,f=>/\d/.test(f)||f.includes("minmax")?f:f.replace(/([.])/,`[${d}]$1`)),!document.head.querySelector("#"+d)){const f=document.createElement("style");f.id=d,f.appendChild(document.createTextNode(h)),document.head.appendChild(f)}}if(this.Element!=null){const m=Utils$1.GetHtmlCode(this.Meta.Html,[this.Entity])??"";this.Element.innerHTML=m}const u=!this.Meta.Id&&this.EditForm?this.EditForm.GetElementPolicies(this.Meta.Children.map(m=>m.Id).concat([...this.Meta.Id]),Utils$1.ComponentId):[];if(this.SplitChild(this.Element.children,u,d),this.Meta.Javascript)try{const f=new Function(this.Meta.Javascript).call(null,this.EditForm);for(const p in f)this[p]=f[p].bind(this)}catch(m){console.log(m.message)}this.RenderChildrenSection(this.Meta);return}this.Meta.IsDropDown&&(Html.Take(this.Element).ClassName("dd-wrap").Style("position: relative;").TabIndex(-1).Event(EventType.FocusOut,this.HideDetailIfButtonOnly).Button.ClassName("btn ribbon").IText(this.Meta.Label).Event(EventType.Click,this.DropdownBtnClick.bind(this)).Span.Text("▼").EndOf(ElementType.button).Div.ClassName("dropdown").TabIndex(-1).Render(),this.Meta.IsCollapsible===!0&&Html.Instance.Style("display: none;"),this.innerEle=Html.Context,this._chevron=(o=(r=this.innerEle)==null?void 0:r.previousElementSibling)==null?void 0:o.firstElementChild,this.Element=Html.Context),this.Meta.Responsive&&!this.Meta.IsTab||this.Meta.IsDropDown?this.RenderComponentResponsive(this.Meta):this.RenderComponent(this.Meta),this.RenderChildrenSection(this.Meta)}}SplitChild(t,e,n){var s,a,r;for(const o of t){if(o.setAttribute(n,""),o.dataset.name!==void 0){const h=new z(ElementType.div,null);h.Element=o;const d=this.Meta.Children.find(E=>E.FieldName===o.dataset.name);if(o.removeAttribute("data-name"),!d||d.Hidden)continue;const u=e.filter(E=>E.RecordId===d.Id),m=!d.IsPrivate||u.every(E=>E.CanRead),f=!d.IsPrivate||u.every(E=>E.CanWrite);if(!m)continue;const p=ComponentFactory.GetComponent(d,this.EditForm);if(p==null)return;if(p.IsListView&&this.EditForm.ListViews.push(p),p.ParentElement=o,this.AddChild(p),p instanceof EditableComponent&&(p.Disabled=d.Disabled||this.Disabled||!f||p.Disabled),p.Element){if(d.ChildStyle){const E=Html.Context;Html.Take(p.Element).Style(d.ChildStyle),Html.Take(E)}d.ClassName&&p.Element.classList.add(d.ClassName),d.Row===1&&((r=(a=(s=p.ParentElement)==null?void 0:s.parentElement)==null?void 0:a.classList)==null||r.add("inline-label")),Client.Instance.SystemRole&&p.Element.addEventListener("contextmenu",E=>this.EditForm.SysConfigMenu(E,d,this.Meta,null))}d.Focus&&p.Focus()}if(o.dataset.click!==void 0){const h=o.dataset.click;o.removeAttribute("data-click"),o.addEventListener(EventType.Click,async()=>{let d=null;d=this[h];try{await d.apply(this.EditForm,[this])}catch(u){throw console.log(u.message),console.log(u.stack),u}})}}}HandleMeta(){if(!this.Meta.Html)return;const t=this.Meta.Css,e=this.Meta.Id,n=`${this.Meta.FieldName.toLowerCase()}${e}`;if(t){const s=`${n}-style`;if(!document.getElementById(s)){const a=document.createElement("style");a.id=s,a.textContent=t.replace(/(?:^|[\s\r\n])\.([a-zA-Z0-9-_]+)/g,(r,o)=>`.${n} ${o}`),document.head.appendChild(a)}}if(this.Element.innerHTML=Utils$1.GetHtmlCode(this.Meta.Html,[this.Entity]),this.Meta.Javascript)try{new Function("editForm",this.Meta.Javascript).call(this,this.EditForm)}catch(s){console.error("Error executing JavaScript:",s)}}get Chevron(){return this._chevron}set Chevron(t){this._chevron=t}RenderDropDown(){const t=document.createElement("button");t.className="btn ribbon",t.textContent=this.Meta.Label,t.addEventListener("click",this.DropdownBtnClick.bind(this));const e=document.createElement("span");e.textContent="▼",t.appendChild(e);const n=document.createElement("div");n.className="dropdown",n.style.display="none",n.tabIndex=-1,this.Element.appendChild(t),this.Element.appendChild(n),this.InnerEle=n,this.Chevron=e,this.Element.addEventListener("focusout",this.HideDetailIfButtonOnly.bind(this))}DropdownBtnClick(){const t=this.InnerEle.style.display!=="none";this.InnerEle.style.display=t?"none":"block",this.Chevron.textContent=t?"▼":"▲"}HideDetailIfButtonOnly(){this._isAllBtn===null&&(this._isAllBtn=Array.from(this.InnerEle.children).every(t=>t.tagName==="BUTTON")),this._isAllBtn&&(this.InnerEle.style.display="none",this.Chevron.textContent="▼")}static HasElementAndAll(t,e){return t===null||t.length===0?!1:t.every(e)}static RenderSection(t,e,n=null,s=null){s=s??t.EditForm;const a=s.GetElementPolicies([e.Id],Utils$1.ComponentGroupId),r=!e.IsPrivate||this.HasElementAndAll(a,p=>p.CanRead),o=!e.IsPrivate||this.HasElementAndAll(a,p=>p.CanWrite);if(!r)return null;let h=e.Width;const d=s.GetOuterColumn(e),u=s.GetInnerColumn(e.Parent);if(d>0&&u>0){const p=(d/u*100).toFixed(2);e.ItemInRow||(e.ItemInRow=2),h=d===u?"100%":`${p}%`}var f=this.RenderGroupContent(t,e,o,h,n,s);return f}static RenderGroupContent(t,e,n,s,a,r){var d,u;var o=r??t.EditForm;Html.Take(t.Element).Div.ClassName("section-item").Width(s).Div.ClassName(e.ClassName??"").Event(EventType.ContextMenu,m=>o.SysConfigMenu(m,null,e,null)),e.Label&&(Html.Instance.Label.ClassName("header").IText(e.Label),Html.Instance.End.Render()),(d=e.ClassName)!=null&&d.includes("ribbon")||Html.Instance.ClassName("panel").ClassName("group"),Html.Instance.Display(!e.Hidden).Style(e.Style||"");const h=new z(null,Html.Context);return h.EditForm=o,h.Id=e.FieldName+e.Id,h.Name=e.FieldName,h.Meta=e,h.Disabled=t.Disabled||e.Disabled||!n||o.IsLock||h.Disabled,t.AddChild(h,null,e.ShowExp),Html.Take(t.Element),(u=h.DOMContentLoaded)==null||u.Invoke(),h}static RenderTabGroup(t,e,n=null){const s=t.Disabled||e.Disabled;t.EditForm.TabGroup||(t.EditForm.TabGroup=[]);var a=t.EditForm.TabGroup.find(h=>h.Name===e.TabGroup);if(a){var o=new TabComponent(e);o.Parent=a,o.ParentElement=a.Element,o.Entity=t.Entity,o.Meta=e,o.Name=e.Name,o.EditForm=t.EditForm,o.Disabled=s,a.Children.push(o),o.Render()}else{a=new TabGroup(e),a.Name=e.TabGroup,a.Parent=t,a.ParentElement=t.Element,a.Entity=n??t.Entity,a.Meta=e,a.EditForm=t.EditForm,a.Children=[],a.Disabled=s;var r=new TabComponent(e);r.Parent=a,r.Entity=t.Entity,r.Meta=e,r.Name=e.FieldName,r.EditForm=t.EditForm,r.Disabled=s,a.Children.push(r),t.EditForm.TabGroup.push(a),t.Children.push(a),a.Render(),r.Render(),r.RenderTabContent(),r.Focus(),r.ToggleShow(e.ShowExp),r.ToggleDisabled(e.DisabledExp)}}RenderChildrenSection(t){!t.Children||t.Children.length===0||t.Children.sort((e,n)=>e.Order-n.Order).forEach(e=>{e.IsTab?z.RenderTabGroup(this,e):z.RenderSection(this,e)})}ChangeLabel(t,e){clearTimeout(this._imeout),this._imeout=setTimeout(()=>{var n;this.SubmitLabelChanged("Component",e.Id,(n=t==null?void 0:t.target)==null?void 0:n.textContent)},1e3)}SubmitLabelChanged(t,e,n){var s=new PatchVM;s.Table=t,s.Changes=[{Field:this.IdField,Value:e},{Field:"Label",Value:n}],Client.Instance.PatchAsync(s).then(a=>{console.log("patch success")})}static SubmitLabelChanged(t,e,n){var s={Table:t,Changes:[{Field:"IdField",Value:e},{Field:"Component.Label",Value:n}]};Client.Instance.PatchAsync(s).Done()}static ChangeComponentGroupLabel(t,e){window.clearTimeout(z._imeout1),z._imeout1=window.setTimeout(()=>{this.SubmitLabelChanged("Meta",e.Id,Utils$1.DecodeSpecialChar(t.target instanceof HTMLElement&&t.target.textContent))},1e3)}RenderComponentResponsive(t){if(t.Children==[])return;const e=Html.Instance,n=this.EditForm.GetElementPolicies(t.Children.map(r=>r.Id),Utils$1.ComponentId),s=this.EditForm.GetInnerColumn(t);s>0&&Html.Take(this.Element).ClassName("grid").Style(`grid-template-columns: repeat(${s}, 1fr)`);let a=0;t.Children.sort((r,o)=>r.Order-o.Order).forEach(r=>{if(r.Hidden)return;const o=n.filter(p=>p.RecordId===r.Id),h=!r.IsPrivate||o.every(p=>p.CanRead),d=!r.IsPrivate||o.every(p=>p.CanWrite);if(!h)return;Html.Take(this.Element);const u=r.Column||2;r.Label=r.Label||"";let m=null;r.ShowLabel&&(e.Div.IText(r.Label).TextAlign(a===0?"left":"right").Render(),m=Html.Context,e.End.Render());const f=ComponentFactory.GetComponent(r,this.EditForm);if(f!==null&&(f.IsListView&&(this.EditForm.ListViews.push(f),this.AddChild(f)),f instanceof EditableComponent)){if(f.Disabled=r.Disabled||this.Disabled||!d||this.EditForm.IsLock||f.Disabled,this.AddChild(f),f.Element!=null){if(r.ChildStyle){const p=Html.Context;Html.Take(f.Element).Style(r.ChildStyle),Html.Take(p)}r.ClassName&&f.Element.AddClass(r.ClassName),r.Row===1&&f.ParentElement.parentElement.AddClass("inline-label"),Client.Instance.SystemRole&&f.Element.AddEventListener("contextmenu",p=>this.EditForm.SysConfigMenu(p,r,t,f)),r.Focus&&f.Focus()}u<=s?(m!==null&&m.nextElementSibling!==null&&u!==2?m.nextElementSibling instanceof HTMLElement&&(m.nextElementSibling.style.gridColumn=`${a+2}/${a+u+1}`):f.Element!==null&&(f.Element.style.gridColumn=`${a+2}/${a+u+1}`),a+=u):a=0,a===s&&(a=0)}})}RenderCom(t,e,n){if(t.Hidden)return;const s=n.filter(m=>m.RecordId===t.Id),a=!t.IsPrivate||s.every(m=>m.CanRead),r=!t.IsPrivate||s.every(m=>m.CanWrite);var o=this.EditForm.GetInnerColumn(t);if(!a)return;Html.Take(this.Element);const h=t.Column||2;t.Label=t.Label||"";let d=null;t.ShowLabel&&(Html.Div.IText(t.Label).TextAlign(e===0?"left":"right").Render(),d=Html.Context,Html.End.Render());const u=ComponentFactory.GetComponent(t,this.EditForm);if(u!==null){if(u.IsListView&&this.EditForm.ListViews.push(u),this.AddChild(u),u instanceof EditableComponent&&(u.Disabled=t.Disabled||this.Disabled||!r||this.EditForm.IsLock||u.Disabled),u.Element){if(t.ChildStyle){const m=Html.Context;Html.Take(u.Element).Style(t.ChildStyle),Html.Take(m)}t.ClassName&&u.Element.classList.add(t.ClassName),t.Row===1&&u.ParentElement.parentElement.classList.add("inline-label"),Client.SystemRole&&u.Element.addEventListener("contextmenu",m=>this.EditForm.SysConfigMenu(m,t,t,u))}t.Focus&&u.Focus(),h<=o?(d&&d.nextElementSibling&&h!==2?d.nextElementSibling instanceof HTMLElement&&(d.nextElementSibling.style.gridColumn=`${e+2}/${e+h+1}`):u.Element&&(u.Element.style.gridColumn=`${e+2}/${e+h+1}`),e+=h):e=0,e===o&&(e=0)}}async ComponentProperties(t){const{ComponentBL:e}=await __vitePreload(async()=>{const{ComponentBL:a}=await import("./componentEditor-CQQCjiPj.js");return{ComponentBL:a}},__vite__mapDeps([3,1])),{EditForm:n}=await __vitePreload(async()=>{const{EditForm:a}=await Promise.resolve().then(()=>editForm);return{EditForm:a}},void 0);var s=new e({Entity:t,ParentElement:this.Element,OpenFrom:this.FindClosest(a=>a instanceof n)});this.AddChild(s)}RenderComponent(t){var s;if(!t.Components||t.Components.length==0)return;(s=t.ClassName)!=null&&s.includes("ribbon-group")&&this.EditForm.Popup&&Html.Take(this.EditForm.PopUpMenu),Html.Table.ClassName("ui-layout").TBody.TRow.Render();let e=0;const n=this.EditForm.GetElementPolicies(t.Components.map(a=>a.Id),Utils$1.ComponentId);t.Components.sort((a,r)=>a.Order-r.Order).forEach(a=>{if(a.Hidden)return;const r=n.filter(m=>m.RecordId===a.Id),o=!a.IsPrivate||r.every(m=>m.CanRead),h=!a.IsPrivate||r.every(m=>m.CanWrite);if(!o)return;const d=a.Column||2;a.Label=a.Label||"",a.ShowLabel?(Html.TData.Visibility(a.Visibility).Div.IText(a.Label).TextAlign(e===0?"left":"right"),Html.EndOf("td").TData.Visibility(a.Visibility).ColSpan(d-1).Render()):Html.TData.Visibility(a.Visibility).ColSpan(d).ClassName("text-left").Style("padding-left: 0;").Render(),a.Style&&Html.Style(a.Style),a.Width&&Html.Width(a.Width);const u=ComponentFactory.GetComponent(a,this.EditForm);if(u!==null){if(u.IsListView&&this.EditForm.ListViews.push(u),this.AddChild(u),u instanceof EditableComponent&&(u.Disabled=a.Disabled||this.Disabled||!h||this.EditForm.IsLock||u.Disabled),u.Element){if(a.ChildStyle){const m=Html.Context;Html.Take(u.Element).Style(a.ChildStyle),Html.Take(m)}a.Row===1&&u.ParentElement.parentElement.classList.add("inline-label"),Client.Instance.SystemRole&&a.ComponentType!="CodeEditor"&&u.Element.addEventListener("contextmenu",m=>this.EditForm.SysConfigMenu(m,a,t,u))}a.Focus&&u.Focus(),Html.EndOf("td"),a.Offset!=null&&a.Offset>0&&(Html.TData.ColSpan(a.Offset).End.Render(),e+=a.Offset),e+=d,e===this.EditForm.GetInnerColumn(t)&&(e=0,Html.EndOf("tr").TRow.Render())}})}},c(z,"_imeout1"),z);const section=Object.freeze(Object.defineProperty({__proto__:null,Section:Section$1},Symbol.toStringTag,{value:"Module"}));class ListViewSection extends Section$1{constructor(){super(...arguments);c(this,"ListView")}Render(){this.ListView=this.Parent,super.Render()}}class AdvancedSearch extends EditableComponent{constructor(t){super(null);c(this,"Parent");c(this,"Entity");this.Name="AdvancedSearch",this.Title="Tìm kiếm nâng cao",this.Icon="fa fa-search-plus",this.Parent=t}LocalRender(){this._headers=this.Parent.Header.filter(s=>s.Id!=null&&s.Label&&s.Active&&!s.Hidden);const t=new FeaturePolicy;t.CanRead=!0,t.CanWrite=!0,t.CanDelete=!0,this.Entity=this.Parent.AdvSearchVM;var e=this.Parent.Meta.OrderBy;this.Parent.OrderBy=e?e.split(",").map(s=>{if(!s)return null;var a=s.trim().replace(new RegExp("\\s+","g")," ").replace("ds.","").split(" ");if(a.length<1)return null;var r=this._headers.find(h=>h.FieldName==a[0]);if(r==null)return null;var o={ComId:r.Id,FieldName:r.FieldName};return a.length==1?o.OrderbyDirectionId=OrderbyDirection.ASC:o.OrderbyDirectionId=a[1].toLowerCase()==="asc"?OrderbyDirection.ASC:OrderbyDirection.DESC,o}).filter(s=>s!=null):this.Parent.OrderBy;var n=this.AddSection();this.AddFilters(n),this.AddOrderByGrid(n)}AddSection(){var t=new Section$1(ElementType.div);t.Meta={Column:4,Label:"Filter",Active:!0,ClassName:"scroll-content"},this.AddChild(t);var e=new HTMLLabelElement;return t.Element.appendChild(e),e.textContent="Status",t.ClassName="filter-warpper panel group wrapper",t}AddFilters(t){this._filterGrid=new GridView({Id:Uuid7.Id25(),FieldName:"Conditions",Column:4,RefName:"FieldCondition",LocalRender:!0,IgnoreConfirmHardDelete:!0,CanAdd:!0,Events:"{'DOMContentLoaded': 'FilterDomLoaded'}"}),this._filterGrid.OnDeleteConfirmed=()=>{this._filterGrid.GetSelectedRows().forEach(e=>{this._filterGrid.RowData.remove(e)})},this._filterGrid.Header=this._filterGrid.Meta.LocalHeader=[{Id:"1",FieldName:"FieldId",Events:"{'change': 'FieldId_Changed'}",Label:"Tên cột",RefName:"Component",FormatData:"ShortDesc",Active:!0,Editable:!0,ComponentType:"SearchEntry",MinWidth:"100px",MaxWidth:"200px",LocalRender:!0,LocalData:this._headers,LocalHeader:[{FieldName:"ShortDesc",Label:"Column",Active:!0}],Validation:'[{"Rule": "required", "Message": "{0} is required"}]'},{Id:"2",FieldName:"CompareOperatorId",Label:"Toán tử",ReferenceId:this._entityId,RefName:"Entity",ComponentType:"SearchEntry",FormatData:"Description",Active:!0,Editable:!0,MinWidth:"150px",LocalRender:!0,LocalData:IEnumerableExtensions.ToEntity(AdvSearchOperation),LocalHeader:[{EntityId:this._entityId,FieldName:"Name",Label:"Operator",Active:!0},{EntityId:this._entityId,FieldName:"Description",Label:"Allias",Active:!0}],Validation:'[{"Rule": "required", "Message": "{0} is required"}]'},{Id:"3",FieldName:"Value",Label:"Value",ReferenceId:this._entityId,RefName:"Entity",ComponentType:"Input",Active:!0,Editable:!0,MinWidth:"450px",Validation:'[{"Rule": "required", "Message": "{0} is required"}]'},{Id:"2",FieldName:"LogicOperatorId",Label:"logic",ReferenceId:this._entityId,RefName:"Entity",ComponentType:"SearchEntry",FormatData:"Description",Active:!0,Editable:!0,DefaultVal:"0",LocalRender:!0,LocalData:LogicOperation.ToEntity(),LocalHeader:[{EntityId:this._entityId,FieldName:"Name",Label:"Logic",Active:!0},{EntityId:this._entityId,FieldName:"Value",Label:"Value",Active:!0}]}],this._filterGrid.RowData.Data=this._filterGrid.Meta.LocalData=this.Entity.Conditions,this._filterGrid.ParentElement=t.Element,t.AddChild(this._filterGrid),this._filterGrid.Element.addEventListener(EventType.KeyDown,this.ToggleIndent.bind(this))}FilterDomLoaded(){this._filterGrid.MainSection.Children.forEach(t=>{var e=t.Entity;this.FieldId_Changed(e,e.Field)})}HeaderForAdvSearch(){return this.Parent.Header.filter(t=>t.Id!=null&&t.Label&&t.Active&&!t.Hidden)}AddOrderByGrid(t){this._orderByGrid=new GridView({FieldName:"OrderBy",Column:4,ReferenceId:this._orderById,RefName:"Entity",CanAdd:!0,IgnoreConfirmHardDelete:!0,LocalRender:!0}),this._orderByGrid.OnDeleteConfirmed=()=>{this._orderByGrid.GetSelectedRows().forEach(e=>{this._orderByGrid.RowData.Remove(e)})},this._orderByGrid.Meta.LocalHeader=[{Id:"1",FieldName:"FieldId",Events:"{'change': 'FieldId_Changed'}",Label:"Tên cột",ReferenceId:this._ComponentId,RefName:"Component",FormatData:"ShortDesc",Active:!0,Editable:!0,ComponentType:"SearchEntry",MinWidth:"100px",MaxWidth:"200px",LocalData:this._headers,LocalRender:!0,LocalHeader:[{EntityId:this._ComponentId,FieldName:"ShortDesc",Label:"Tên cột",Active:!0}]},{Id:"2",EntityId:this._orderById,FieldName:"OrderbyDirectionId",Label:"Thứ tự",ReferenceId:this._entityId,RefName:"Entity",ComponentType:"SearchEntry",FormatData:"Description",Active:!0,Editable:!0,MinWidth:"100px",MaxWidth:"120px",LocalData:OrderbyDirection.ToEntity(),LocalHeader:[{EntityId:this._entityId,FieldName:"Name",Label:"Thứ tự",Active:!0}],LocalRender:!0}],this._orderByGrid.Meta.LocalData=this.Entity.OrderBy,this._orderByGrid.ParentElement=t.Element,t.AddChild(this._orderByGrid)}ToggleIndent(t){var e=t.KeyCodeEnum();if(e==KeyCodeEnum.Tab){t.preventDefault();var n=t.ShiftKey(),s=this._filterGrid.GetSelectedRows(),a=s.reduce((r,o)=>(r[o.Id]=o,r),{});this._filterGrid.RowAction(r=>{var o=r.Entity;o.Level+=n?-1:1,Array.from(r.Element.querySelectorAll("td")).forEach(h=>{h.style.paddingLeft=o.Level+"rem"})},r=>a.hasOwnProperty(r.Entity.Id))}}DirtyCheckAndCancel(){super.Dispose()}async ApplyAdvSearch(){await this.ValidateAsync()&&(this.CalcAdvSearchQuery(),this.Parent.ReloadData(!1,0).Done())}CalcAdvSearchQuery(){this.Parent.Wheres=this.Entity.Conditions.map((t,e)=>({Condition:this.GetSearchValue(t)})).filter(t=>t.Condition)}GetSearchValue(t){var e=!1,n=t.Value;if(n==null&&t.CompareOperatorId!=AdvSearchOperation.EqualNull&&t.CompareOperatorId!=AdvSearchOperation.NotEqualNull)return null;t.Field.ComponentType.includes(ComponentType.Datepicker)&&n?n=n:t.Field.ComponentType==nameof(Number)?n=n+"":n=n.EncodeSpecialChar()+"";var s=OperationToSql[t.CompareOperatorId],a=e?Str.Empty:Str.Format(s,t.OriginFieldName,n);return a}FieldId_Changed(t,e){var h,d;if(!(t==null||e==null)){t.OriginFieldName=e.FieldName,t.Field=e;var n=this._filterGrid.FirstOrDefault(u=>u.Entity==t&&u.Name=="Value"),s=this._filterGrid.find(u=>u.Entity==t&&u.FieldName=="CompareOperatorId");if(n!=null){var a=n.ParentElement,r=n.Parent;n.Dispose();var o=null;e.ComponentType.includes(ComponentType.Datepicker)?(o=this.SetSearchDateTime(s,e),t.Value=new dayjs().format("YYYY/MM/DD")):e.ComponentType.includes(ComponentType.SearchEntry)||e.ComponentType.includes(ComponentType.MultipleSearchEntry)?(o=this.SetSearchId(s,e),t.Value=""):e.ComponentType.includes(ComponentType.Checkbox)?(o=this.SetSearchBool(s,e),t.Value=ActiveStateEnum.All,t.Display.ValueText="All"):e.ComponentType.includes(ComponentType.Numbox)?(o=this.SetSearchDecimal(s,e),t.Value="0"):o=AdvancedSearch.SetSearchString(s,e),o.UserInput+=u=>{o.Entity.Value=u.NewData},t.LogicOperatorId=t.LogicOperatorId||LogicOperation.And,(h=this._filterGrid.FirstOrDefault(u=>u.Meta!=null&&u.Entity==t&&u.Name=="LogicOperatorId"))==null||h.UpdateView(),t.CompareOperatorId=(d=s.Meta.LocalData.find(u=>u.Id==t.CompareOperatorId))==null?void 0:d.Id,s.Value=t.CompareOperatorId,s.Display.ValueText=Object.keys(AdvSearchOperation).find(u=>AdvSearchOperation[u]===t.CompareOperatorId),s.UpdateView(),o.Entity=t,o.Value=t.Value,o.Parent=r,r.Children.splice(2,0,o),o.ParentElement=a,o.Render()}}}static OperatorFactory(t){var e=AdvSearchOperation.ToEntity();switch(t){case ComponentType.Textbox:return e.filter(n=>n.Id>=AdvSearchOperation.Contains&&n.Id<AdvSearchOperation.In||n.Id==AdvSearchOperation.Equal||n.Id==AdvSearchOperation.NotEqual).sort((n,s)=>n.Id==AdvSearchOperation.Contains?-1:1);case ComponentType.Datepicker:return e.filter(n=>n.Id<AdvSearchOperation.Contains);case ComponentType.Number:return e.filter(n=>n.Id<AdvSearchOperation.Contains);case ComponentType.Checkbox:return e.filter(n=>n.Id==AdvSearchOperation.Equal);case ComponentType.SearchEntry:return e.filter(n=>n.Id==AdvSearchOperation.In||n.Id==AdvSearchOperation.NotIn)}return null}static SetSearchString(t,e){var n,s=new Component;return s.CopyPropFrom(e),s.ComponentType=ComponentType.Textbox,n=new Textbox(e),t.Meta.LocalData=AdvancedSearch.OperatorFactory(ComponentType.Textbox),n}SetSearchDecimal(t,e){var n,s=new Component;return s.CopyPropFrom(e),s.ComponentType=ComponentType.Numbox,n=new Numbox(e),t.Meta.LocalData=AdvancedSearch.OperatorFactory(ComponentType.Number),n}SetSearchBool(t,e){var n=new Component;n.CopyPropFrom(e);var s;return n.FormatData="{Description}",n.ComponentType=ComponentType.MultipleSearchEntry,n.LocalRender=!0,n.LocalData=ActiveStateEnum.ToEntity(),n.LocalHeader=AdvancedSearch.GetBooleanSearchHeader(),s=new MultipleSearchEntry(n),t.Meta.LocalData=AdvancedSearch.OperatorFactory(ComponentType.SearchEntry),s}static GetBooleanSearchHeader(){return[{FieldName:nameof(Models.Entity.Name),Label:"Trạng thái",Active:!0},{FieldName:nameof(Models.Entity.Description),Label:"Miêu tả",Active:!0}]}SetSearchId(t,e){t.Meta.LocalData=AdvancedSearch.OperatorFactory(ComponentType.SearchEntry),t.FieldVal=AdvSearchOperation.In,t.Entity.Display=t.Entity.Display??{OperationText:AdvSearchOperation.GetFieldNameByVal(AdvSearchOperation.In)};var n=new Component;n.CopyPropFrom(e),n.ComponentType=ComponentType.MultipleSearchEntry;var s=new MultipleSearchEntry(n);return s}SetSearchDateTime(t,e){var n,s=new Component;return s.CopyPropFrom(e),s.ComponentType=nameof(Datepicker),s.Precision=7,n=new Datepicker(s),t.Meta.LocalData=AdvSearchOperation.ToEntity().filter(a=>a.Id<AdvSearchOperation.Contains),n}}class ListViewSearchVM{constructor(){this.Id=Uuid7.Id25(),this.SearchTerm="",this.FullTextSearch="",this.ScanTerm="",this.StartDate=null,this.DateTimeField="",this.EndDate=null}}class ListViewSearch extends EditableComponent{constructor(t){super(t,null);c(this,"Parent");c(this,"ParentGridView");c(this,"_uploader");c(this,"_fullTextSearch");c(this,"BasicSearch");c(this,"_hasRender",!1);this.PopulateDirty=!1,this.AlwaysValid=!0,this.Meta=t,this.DateTimeField=t.DateTimeField??"InsertedDate",this.Entity=new ListViewSearchVM}get EntityVM(){return this.Entity}get DateTimeField(){return this._dateTimeField}set DateTimeField(t){this._dateTimeField=t}ListView_DataLoaded(t){if(!this._hasRender&&(this._hasRender=!0,this.BasicSearch=this.Parent.Header.filter(a=>a.Active&&!a.Hidden).sort((a,r)=>r.Order-a.Order),this.BasicSearch.length!==0)){Html.Take(this.Element);var e=this.BasicSearch.map(a=>{var r=a,o=r.ComponentType;r.ShowLabel=!1,r.PlainText=a.Label,r.Visibility=!0,r.Column=1;var h=AdvancedSearch.OperatorFactory(o??ComponentType.Textbox)[0].Id;return this.Parent.AdvSearchVM.Conditions.push({FieldId:r.Id,CompareOperatorId:h,LogicOperatorId:LogicOperation.And,Field:a}),r}),n={Children:e,Responsive:!0,Column:e.length,ClassName:"wrapper"},s=Section$1.RenderSection(this,n);for(s.Children.forEach(a=>{a.UserInput.add(r=>{var h;var o=this.Parent.AdvSearchVM.Conditions.find(d=>d.FieldId===a.Meta.Id);o.Value=(h=a.FieldVal)==null?void 0:h.toString()})});s.Element.children.length>0;)this.Element.insertBefore(s.Element.firstChild,this.Element.firstChild)}}async Render(){if(this.Parent.DataLoaded.add(this.ListView_DataLoaded.bind(this)),!!this.Meta.CanSearch){if(Html.Take(this.Parent.Element.firstChild).TabIndex(-1).Event(EventType.KeyPress,this.EnterSearch.bind(this)),this.Element=Html.Context,this.RenderImportBtn(),this.Meta.ComponentType==="GridView"||this.Meta.ComponentType==="TreeView"||!this.Meta.IsRealtime){var t=new Textbox({FieldName:"SearchTerm",Visibility:!0,Label:"Tìm kiếm",PlainText:"Tìm kiếm",ShowLabel:!1});t.ParentElement=this.Element,t.UserInput=null,this.AddChild(t)}var e=new Datepicker({FieldName:"StartDate",Visibility:!0,Label:"From date",PlainText:"From date",ShowLabel:!1});e.ParentElement=this.Element,e.UserInput=null,this.AddChild(e);var n=new Datepicker({FieldName:"EndDate",Visibility:!0,Label:"To date",PlainText:"To date",ShowLabel:!1});if(n.ParentElement=this.Element,n.UserInput=null,this.AddChild(n),this.Parent.Meta.ShowDatetimeField){var s=new SearchEntry$1({FieldName:"DateTimeField",PlainText:"Loại ngày",FormatData:"{ShortDesc}",ShowLabel:!1,RefName:"Component"});s.ParentElement=this.Element,s.UserInput=null,this.AddChild(s)}Html.Take(this.Element).Div.ClassName("searching-block").Icon("btn fa fa-search").Event(EventType.Click,()=>{this.Parent.ClearSelected(),this.Parent.ReloadData().Done()}).End.Icon("btn fa fa-cog").Title("Advance").Event(EventType.Click,this.AdvancedOptions.bind(this)).End.Icon("btn fa fa-undo").Title("Refresh").Event(EventType.Click,this.RefreshListView.bind(this)).End.Render(),this.Meta.ShowHotKey&&this.ParentGridView!=null&&Html.Take(this.Element).Div.ClassName("hotkey-block").Button2("F1","btn btn-light btn-sm").Event(EventType.Click,()=>this.ParentGridView.ToggleAll()).Attr("title","Uncheck all").End.Button2("F2","btn btn-light btn-sm").Event(EventType.Click,a=>{var r=this.Parent.LastListViewItem.Children.find(o=>o.Meta.Id===this.ParentGridView.LastComponentFocus.Id);this.ParentGridView.ActionKeyHandler(a,this.ParentGridView.LastComponentFocus,this.ParentGridView.LastListViewItem,r,r.Element.Closest(ElementType.td.toString()),KeyCodeEnum.F2)}).Attr("title","Filter except").End.Button2("F3","btn btn-light btn-sm").Event(EventType.Click,a=>{var r=this.Parent.LastListViewItem.Children.find(o=>o.Meta.Id===this.ParentGridView.LastComponentFocus.Id);this.ParentGridView.ActionKeyHandler(a,this.ParentGridView.LastComponentFocus,this.ParentGridView.LastListViewItem,r,r.Element.Closest(ElementType.td.toString()),KeyCodeEnum.F3)}).Attr("title","Summary selected").End.Button2("F4","btn btn-light btn-sm").Event(EventType.Click,a=>{var r=this.Parent.LastListViewItem.Children.find(o=>o.Meta.Id===this.ParentGridView.LastComponentFocus.Id);this.ParentGridView.ActionKeyHandler(a,this.ParentGridView.LastComponentFocus,this.ParentGridView.LastListViewItem,r,r.Element.Closest(ElementType.td.toString()),KeyCodeEnum.F4)}).Attr("title","Lọc tiếp theo các phép tính (Chứa: Bằng; Lớn hơn; Nhỏ hơn; Lớn hơn hoặc bằng;...)").End.Button2("F6","btn btn-light btn-sm").Event(EventType.Click,a=>{this.ParentGridView.HotKeyF6Handler(a,KeyCodeEnum.F6)}).Attr("title","Quay lại lần lọc trước").End.Button2("F8","btn btn-light btn-sm").Event(EventType.Click,a=>{var r=this.Parent.LastListViewItem.Children.find(o=>o.Meta.Id===this.ParentGridView.LastComponentFocus.Id);this.ParentGridView.ActionKeyHandler(a,this.ParentGridView.LastComponentFocus,this.ParentGridView.LastListViewItem,r,r.Element.Closest(ElementType.td.toString()),KeyCodeEnum.F8)}).Attr("title","Xóa/ Vô hiệu hóa dòng hiện thời hoặc các dòng đánh dấu").End.Button2("F9","btn btn-light btn-sm").Event(EventType.Click,a=>{var r=this.Parent.LastListViewItem.Children.find(o=>o.Meta.Id===this.ParentGridView.LastComponentFocus.Id);this.ParentGridView.ActionKeyHandler(a,this.ParentGridView.LastComponentFocus,this.ParentGridView.LastListViewItem,r,r.Element.Closest(ElementType.td.toString()),KeyCodeEnum.F9)}).Attr("title","Lọc tại chỗ theo giá trị ô hiện thời").End.Button2("F10","btn btn-light btn-sm").Event(EventType.Click,a=>{var r=this.Parent.LastListViewItem.Children.find(o=>o.Meta.Id===this.ParentGridView.LastComponentFocus.Id);this.ParentGridView.ActionKeyHandler(a,this.ParentGridView.LastComponentFocus,this.ParentGridView.LastListViewItem,r,r.Element.Closest(ElementType.td.toString()),KeyCodeEnum.F10)}).Attr("title","Gộp theo cột hiện thời(thống kê lại số nội dung trong cột)").End.Button2("F11","btn btn-light btn-sm").Event(EventType.Click,a=>{var r=this.Parent.LastListViewItem.Children.find(o=>o.Meta.Id===this.ParentGridView.LastComponentFocus.Id);this.ParentGridView.ActionKeyHandler(a,this.ParentGridView.LastComponentFocus,this.ParentGridView.LastListViewItem,r,r.Element.Closest(ElementType.td.toString()),KeyCodeEnum.F11)}).Attr("title","Sắp xếp thứ tự tăng dần, giảm dần. (Shift+F11 để sort nhiều cấp)").End.Render()}}RefreshListView(){if(this.EntityVM.SearchTerm="",this.EntityVM.StartDate=null,this.EntityVM.EndDate=null,this.UpdateView(),!this.Parent)return;const t=this.Parent;t.ClearSelected(),t.CellSelected.Clear(),t.AdvSearchVM.Conditions.Clear(),t.Wheres.Clear(),t.ApplyFilter()}FullScreen(){var t=this.Parent.Element;t.requestFullscreen&&t.requestFullscreen()}EnterSearch(t){t.KeyCode()===13&&this.Parent.ApplyFilter().Done()}UploadCsv(t){var e=t.target.files;if(!(!e||e.length===0)){var n=this._uploader.parentElement,s=new FormData(n),a=this.Parent.Meta;Client.Instance.SubmitAsync({FormData:s,Url:`/user/importCsv?table=${a.RefName}&comId=${a.Id}&connKey=${a.MetaConn}`,Method:HttpMethod.POST,ResponseMimeType:Utils$1.GetMimeType("csv")}).Done(()=>{Toast.Success("Import excel success"),this._uploader.value=""}).catch(r=>{Toast.Warning(r.Message),this._uploader.value=""})}}AdvancedOptions(t){var n=t.target.getBoundingClientRect();localStorage.getItem(`Show${this.Meta.Id}`);var s=ContextMenu.Instance;s.Top=n.bottom,s.Left=n.left,s.MenuItems=[{Icon:"fa fa-search-plus mr-1",Text:"Advanced search",Click:this.AdvancedSearch.bind(this)},{Icon:"fa fa-search mr-1",Text:"Show selected only",Click:this.FilterSelected.bind(this)},{Icon:"fa fa-download mr-1",Text:"Import csv",Click:()=>this._uploader.Click()},{Icon:"fa fa-download mr-1",Text:"Export all",Click:this.ExportAllData.bind(this)},{Icon:"fa fal fa-ballot-check mr-1",Text:"Export selected",Click:this.ExportSelectedData.bind(this)},{Icon:"fa fa-download mr-1",Text:"Customize export",Click:this.ExportCustomData.bind(this)}],s.Render()}RenderImportBtn(){Html.Take(this.Element).Form.Attr("method","POST").Attr("enctype","multipart/form-data").Display(!1).Input.Type("file").Id(`id_${Uuid7.Id25()}`).Attr("name","files").Attr("accept",".csv"),this._uploader=Html.Context,this._uploader.addEventListener(EventType.Change,t=>this.UploadCsv(t))}FilterSelected(t){var e=this.Parent.SelectedIds;if(!e||e.length===0){Toast.Warning("Select rows to filter");return}this.Parent.CellSelected.some(n=>n.FieldName===this.IdField)?(this.Parent.CellSelected.find(n=>n.FieldName===this.IdField).Value=e.join(),this.Parent.CellSelected.find(n=>n.FieldName===this.IdField).ValueText=e.join()):(this.Parent.CellSelected.push({FieldName:this.IdField,FieldText:"Mã",ComponentType:"Input",Value:e.join(),ValueText:e.join(),Operator:OperatorEnum.In,OperatorText:"Chứa",Logic:LogicOperation.And}),this.ParentGridView._summarys.push(new HTMLElement)),this.Parent.ActionFilter()}ExportCustomData(t){var e;(e=this.TabEditor)==null||e.OpenPopup("Export CustomData",()=>this.Exporter()).Done()}async Exporter(){var e;const{ExportCustomData:t}=await __vitePreload(async()=>{const{ExportCustomData:n}=await import("./exportCustomData-Dz3_cl-h.js");return{ExportCustomData:n}},__vite__mapDeps([4,1]));return this._export||(this._export=new t(this.Parent),this._export.ParentElement=(e=this.TabEditor)==null?void 0:e.Element,this._export.Disposed.add(()=>this._export=null)),this._export}async ExportAllData(t){(await this.Exporter()).Export()}async ExportSelectedData(t){if(!this.Parent.SelectedIds||this.Parent.SelectedIds.length===0){Toast.Warning("Select at least 1 one to export excel");return}(await this.Exporter()).Export(this.Parent.SelectedIds)}OpenExcelFileDialog(t){this._uploader.click()}CalcFilterQuery(){var o;this.EntityVM.DateTimeField&&(this.DateTimeField=this.Parent.Header.find(h=>h.Id===this.EntityVM.DateTimeField).FieldName);const t=this.Parent.Header,e=Utils$1.EncodeSpecialChar((o=this.EntityVM.SearchTerm)==null?void 0:o.trim())||"";let s=t.map(h=>ComponentExt.MapToFilterOperator(h,e)).filter(h=>h!=null&&h!="").join(" or ");const a=this.Parent.Header.filter(h=>h.AddDate).map(h=>h.Id),r=a.length&&a.some(h=>this.ParentGridView.AdvSearchVM.Conditions.some(d=>d.FieldId===h&&d.Value));if(!r&&this.EntityVM.StartDate){const h=`ds.[${this.DateTimeField}] >= '${this.EntityVM.StartDate.toISOString().slice(0,10)}'`,d=this.Parent.Wheres.find(u=>u.Condition.includes(`ds.[${this.DateTimeField}] >=`));d?d.Condition=h:this.Parent.Wheres.push({Condition:h,Group:!1}),localStorage.setItem("FromDate"+this.Parent.Meta.Id,this.EntityVM.StartDate.toISOString().slice(0,10))}else if(!this.EntityVM.StartDate){const h=this.Parent.Wheres.findIndex(d=>d.Condition.includes(`ds.[${this.DateTimeField}] >=`));h!==-1&&this.Parent.Wheres.splice(h,1),localStorage.removeItem("FromDate"+this.Parent.Meta.Id)}if(!r&&this.EntityVM.EndDate){s&&(s+=" and ");const h=new Date(this.EntityVM.EndDate.getTime()+864e5),d=`ds.[${this.DateTimeField}] < '${h.toISOString().slice(0,10)}'`,u=this.Parent.Wheres.find(m=>m.Condition.includes(`ds.[${this.DateTimeField}] <`));u?u.Condition=d:this.Parent.Wheres.push({Condition:d,Group:!1}),localStorage.setItem("ToDate"+this.Parent.Meta.Id,h.toISOString().slice(0,10))}else if(!this.EntityVM.EndDate){const h=this.Parent.Wheres.findIndex(d=>d.Condition.includes(`ds.[${this.DateTimeField}] <`));h!==-1&&this.Parent.Wheres.splice(h,1),localStorage.removeItem("ToDate"+this.Parent.Meta.Id)}return(this.EntityVM.EndDate||this.EntityVM.StartDate)&&this.Parent.Meta.ShowNull&&(s+=` or ds.${this.DateTimeField} is null`),s}get Disabled(){return!1}set Disabled(t){}AdvancedSearch(t){ComponentExt.OpenPopup(this.TabEditor,"AdvancedSearch",()=>{var e=new AdvancedSearch(this.ParentListView);return e.Parent=this.Parent,e.ParentElement=this.TabEditor.Element,e}).Done()}}var G;let ListViewItem$1=(G=class extends Section$1{constructor(t=ElementType.tr){super(t);c(this,"IsRow",!0);c(this,"masterDataComponent",["Dropdown","Select2","MultipleSearchEntry","SearchEntry"]);this.GroupSection=null,this.ListViewSection=null,this.ListView=null,this.PreQueryFn=null,this._selected=!1,this._focused=!1,this._emptyRow=!1,this.RowNo=0,this.FocusEvent=new Action,this.GroupRow=!1,this._focusAwaiter=0,this.PatchModel=[],this.ShowMessage=!0,this.IsListViewItem=!0}get Selected(){return this._selected}set Selected(t){this._selected=t,this.SetSelected(t);const e=this.EntityId;if(t)this.ListView.SelectedIds.includes(e)||this.ListView.SelectedIds.push(e);else{const n=this.ListView.SelectedIds.indexOf(e);n!==-1&&this.ListView.SelectedIds.splice(n,1)}}Focused(t=null,e=!0){var s;if(t===null)return this._focused;this._focused=t;const n=this.EntityId;return this._focused?(this.Element.classList.add(G.FocusedClass),this.ListView.FocusId=n):(this.Element.classList.remove(G.FocusedClass),this.ListView.FocusId=null),e&&((s=this.FocusEvent)==null||s.invoke(this._focused)),this._focused}SetSelected(t){t?this.Element.classList.add(G.SelectedClass):this.Element.classList.remove(G.SelectedClass)}get EmptyRow(){return this._emptyRow}set EmptyRow(t){this._emptyRow=t,this.FilterChildren().forEach(e=>e.EmptyRow=t),this.AlwaysValid=t,this.Element!=null&&(t?this.Element.classList.add(G.EmptyRowClass):this.Element.classList.remove(G.EmptyRowClass))}Render(){this.ListView=this.ListView??this.FindClosest(t=>t.IsListView),this.Meta=this.Meta??this.ListView.Meta,super.Render(),this._selected&&this.Element.classList.add(G.SelectedClass),Html.Instance.Take(this.Element).Event(EventType.Click,this.RowItemClick.bind(this)).Event(EventType.DblClick,this.RowDblClick.bind(this)).Event(EventType.FocusIn,()=>{this.Meta.CanAdd&&this.ListView.EmptySection.Children.ForEach(t=>{t.Focused&&(t.Focused=!1)}),this.ListView.AllListViewItem.ForEach(t=>{t.Focused&&(t.Focused=!1)}),this.Focused=!0}).Event(EventType.FocusOut,this.RowFocusOut.bind(this)).Event(EventType.MouseEnter,this.MouseEnter.bind(this)).Event(EventType.MouseLeave,this.MouseLeave.bind(this))}AfterSaveHandler(t){t||(this.EntityId=null)}BindingEvents(){this.Element&&Html.Take(this.Element).Event(EventType.Click,this.RowItemClick.bind(this)).Event(EventType.DblClick,this.RowDblClick.bind(this)).Event(EventType.FocusIn,()=>{var t;this.ListView.AllListViewItem.forEach(e=>{e._focused&&(e._focused=!1)}),this._focused=!0,(t=this.FocusEvent)==null||t.invoke(!0)}).Event(EventType.FocusOut,this.RowFocusOut.bind(this)).Event(EventType.MouseEnter,this.MouseEnter.bind(this)).Event(EventType.MouseLeave,this.MouseLeave.bind(this))}RenderRowData(t,e,n=null,s=!1){n!==null&&((n>=this.Element.parentElement.children.length||n<0)&&(n=0),this.Element.parentElement.insertBefore(this.Element,this.Element.parentElement.children[n]));const a=Utils$1.IsFunction(this.Meta.Renderer);a?a.call(this,this,t):t.filter(r=>!r.Hidden).forEach(r=>{this.RenderTableCell(e,r,this.Element)}),this.BindingEvents()}RenderTableCell(t,e,n=null){if(e.FieldName){this.masterDataComponent.includes(e.ComponentType)&&(e.LocalData=e.LocalData);var s=e.CanWrite&&e.Editable||!e.Editable&&e.ComponentType=="Button"?ComponentFactory.GetComponent(e,this.EditForm,null,e.CanWrite):new Label(e);s&&(s.Id=e.Id,s.Name=e.FieldName,s.Entity=t,s.ParentElement=n||Html.Context,this.AddChild(s),(this.Disabled||e.Disabled)&&s.SetDisabled(!0),s.Element&&e.ChildStyle&&(s.Element.style.cssText=e.ChildStyle),s.UserInput.add(a=>this.UserInputHandler(a,s)))}}UserInputHandler(t,e){if(!e.Disabled)if(e.ComponentType=="Input"||e.ComponentType=="Textarea"){if(t.EvType==EventType.Abort||t.EvType==EventType.Change||t.EvType==EventType.Blur){if(e.Disabled)return;this.ListView.RowChangeHandler(e.Entity,this,t,e).then(()=>{this.ListView.RealtimeUpdateAsync(this,t).then()})}}else this.ListView.RowChangeHandler(e.Entity,this,t,e).then(()=>{if(e.ComponentType!="Button"&&t.EvType==EventType.Change){if(e.Disabled)return;this.ListView.RealtimeUpdateAsync(this,t).then()}})}async PatchUpdateOrCreate(t=!0){return this.Dirty?new Promise(e=>{const n=this.GetPatchEntity();n.Changes.length!=1&&this.DispatchCustomEvent(this.Meta.Events,CustomEventType.BeforePatchUpdate,this.Entity,n,this).then(()=>{this.ShowMessage=t,this.ValidateAsync().then(s=>{s&&Client.Instance.PatchAsync(n).then(a=>{this.PatchUpdateCb(a),e(a.updatedItem[0])})})})}):!1}PatchUpdateCb(t){var e;t&&t.status==200&&(Toast.Success("Save data success"),this.EntityId=t.updatedItem[0][this.IdField],this.Dirty=!1,this.EmptyRow=!1),this.Entity[this.IdField].startsWith("-")&&(this.Entity[this.IdField]=t.updatedItem[0][this.IdField]),this.UpdateView(!0),(e=this.AfterSaved)==null||e.invoke(t),this.DispatchCustomEvent(this.Meta.Events,CustomEventType.AfterPatchUpdate,this.Entity,this).then()}GetPatchEntity(){const t=this.EntityId===null;var e=[];return this.EntityId.startsWith("-")?(Object.getOwnPropertyNames(this.Entity).forEach(n=>{var s="";this.Entity[n]instanceof Boolean?this.Entity[n]?s="1":s="0":s=this.Entity[n];var a={Label:n,Field:n,OldVal:null,Value:s};e.push(a)}),e=e.filter(n=>n.Value)):(e=this.FilterChildren(n=>n instanceof EditableComponent&&!(n instanceof Button)&&(t||n.Dirty)&&n.Meta&&n.Meta.FieldName.trim().length>0).flatMap(n=>{var a,r;let s=[];if(typeof n.PatchDetail=="function")s=n.PatchDetail.call(n);else{let o=n.FieldVal;this.EditForm.Meta.IgnoreEncode||(o=o==null?null:o.trim().EncodeSpecialChar()),(o==null||o.toString().trim().length===0)&&(o=null),s=[{Label:n.ComLabel,Field:n.Name,OldVal:n.OldValue!==null&&n.ComponentType.includes(ComponentType.Datepicker)?(a=n.OldValue)==null?void 0:a.toString().DateConverter():(r=n.OldValue)==null?void 0:r.toString(),Value:o}]}return s}).filter((n,s,a)=>a.findIndex(r=>r.Field===n.Field)===s),this.AddIdToPatch(e)),e.length==1&&(e=[],Object.getOwnPropertyNames(this.Entity).forEach(n=>{var s="";this.Entity[n]instanceof Boolean?this.Entity[n]?s="1":s="0":s=this.Entity[n];var a={Label:n,Field:n,OldVal:null,Value:s};e.push(a)}),e=e.filter(n=>n.Value)),this.PatchModel.push(...e),{CacheName:this.CacheName,QueueName:this.QueueName,Changes:e,Table:this.ListView.Meta.RefName,MetaConn:this.ListView.MetaConn,DataConn:this.ListView.DataConn}}RowDblClick(t){var e;t.stopPropagation(),(e=this.ListView.DblClick)==null||e.invoke(this.Entity),this.DispatchEvent(this.Meta.Events,EventType.DblClick,this.Entity).then()}RowItemClick(t){var r;t.stopPropagation();const e=t.CtrlOrMetaKey(),n=t.ShiftKey(),s=t.target,a=this.FirstOrDefault(o=>o.Element===s||o.ParentElement.contains(s))!==null;this.HotKeySelectRow(e,n,a),t.ShiftKey()||(r=this.ListView.RowClick)==null||r.invoke(this.Entity),this.ListView.LastListViewItem=this,this.DispatchEvent(this.Meta.Events,EventType.Click,this.Entity).then()}HotKeySelectRow(t,e,n){if(!this.EmptyRow)if(this.ListView.VirtualScroll){if((t||e)&&(this.Selected=!this._selected,this._selected&&(this.ListView.SelectedIndex=this.Children.indexOf(this))),e){const a=this.ListView.AllListViewItem;this.ListView.LastShiftViewItem===null&&(this.ListView.LastShiftViewItem=this,this.ListView.LastIndex=this.RowNo);let r=this.ListView.LastIndex,o=this.RowNo;if(r>o){let h=r;r=o,o=h}if(this.ListView.VirtualScroll&&o>r){const h=this.ListView.GetSql(r-1,o-r+1,!0);Client.Instance.GetIds(h).then(d=>{this.Selected?d.filter(u=>!this.ListView.SelectedIds.includes(u)).forEach(u=>this.ListView.SelectedIds.push(u)):d.forEach(u=>{const m=this.ListView.SelectedIds.indexOf(u);m!==-1&&this.ListView.SelectedIds.splice(m,1)}),this.SetSeletedListViewItem(a,r,o),this.ListView.LastShiftViewItem=null})}else this.SetSeletedListViewItem(a,r,o)}}else{if(!t&&!e){this.ListView.SelectedIds.length<=1&&(this.ListView.ClearSelected(),this.Selected=!this._selected,this._selected&&(this.ListView.SelectedIndex=this.ListView.Children.indexOf(this)));return}if(this.Selected=!this._selected,!e&&!t&&this._selected&&(this.ListView.SelectedIndex=this.ListView.Children.indexOf(this)),e){const a=this.ListView.AllListViewItem,r=a.find(h=>h.Selected);let o=a.indexOf(r);var s=this.ListView.Children.indexOf(this);if(s>o){let h=s;s=o,o=h}for(let h=o;h<=s;h++){let d=this.ListView.Children[h];d instanceof G&&(d.Selected=!0)}}}}SetSeletedListViewItem(t,e,n){const s=t[0].RowNo>e?t[0].RowNo:e,a=this.ListView.AllListViewItem.filter(r=>r.RowNo>=s&&r.RowNo<=n);this.ListView.VirtualScroll||(this.ListView.SelectedIds=a.map(r=>r.EntityId)),a.forEach(r=>{const o=r.EntityId;this.ListView.SelectedIds.includes(o)?r.Selected=this.Selected:r.Selected=!1})}RowFocusOut(){return this.DispatchCustomEvent(this.Meta.Events,CustomEventType.RowFocusOut,this.Entity)}MouseEnter(){return this.Element.classList.add(G.HoveringClass),this.DispatchCustomEvent(this.ListView.Meta.Events,CustomEventType.RowMouseEnter,this.Entity)}MouseLeave(){return this.Element.classList.remove(G.HoveringClass),this.DispatchCustomEvent(this.ListView.Meta.Events,CustomEventType.RowMouseLeave,this.Entity)}get ShowMessage(){return this._showMessage}set ShowMessage(t){this._showMessage=t}ValidateAsync(){return new Promise((t,e)=>{this.FilterChildren(s=>s.Children.length===0,s=>s.AlwaysValid).ForEachAsync(s=>s.ValidateAsync()).then(s=>{const a=s.every(r=>r.IsValid);if(t(a),!a&&this.ShowMessage){const r=s.filter(o=>!o.IsValid).map(o=>Object.values(o.ValidationResult).Combine(null,Utils$1.BreakLine)).Combine(null,Utils$1.BreakLine);Toast.Warning(r)}}).catch(e)})}},c(G,"NotCellText",["Button","Image","Checkbox"]),c(G,"EmptyRowClass","empty-row"),c(G,"SelectedClass","__selected__"),c(G,"FocusedClass","focus"),c(G,"HoveringClass","hovering"),c(G,"GroupRowClass","group-row"),G);const ft=class ft extends EditableComponent{constructor(t,e=null){super(t,e);c(this,"IsListView",!0);c(this,"SelectedIds",[]);c(this,"MainSection");c(this,"OrderBy",[]);c(this,"CacheData",[]);c(this,"RefData",[]);c(this,"DataLoaded",new Action);c(this,"DblClick",new Action);c(this,"RowClick",new Action);c(this,"VirtualScroll",!1);c(this,"FocusId");c(this,"GridPolicies",[]);c(this,"GeneralPolicies",[]);c(this,"Wheres",[]);c(this,"ShouldSetEntity",!0);c(this,"FormattedRowData");c(this,"BodyContextMenuShow",new Action);c(this,"CellSelected",[]);c(this,"Dropdown","Dropdown");c(this,"NotCellText",["Button","Image","ImageUploader"]);c(this,"_copiedRows");c(this,"RecordPolicy",[]);this.DeleteTempIds=[],this.Meta=t,this.Id=t.Id,this.Name=t.FieldName,this.Header=[],this.RowData=new ObservableList,this.AdvSearchVM={ActiveState:ActiveStateEnum.Yes,OrderBy:localStorage.getItem("OrderBy"+this.Meta.Id)??[]},this._hasLoadRef=!1,e!==null&&this.Resolve(t,e),this._rowHeight=this.Meta.BodyItemHeight??26,this._theadTable=this.Meta.HeaderHeight??40,this._tfooterTable=this.Meta.FooterHeight??35,this._scrollTable=this.Meta.ScrollHeight??10,window.addEventListener(this.QueueName,this.RealtimeUpdateListViewItem.bind(this)),this._preQueryFn=Utils$1.IsFunction(this.Meta.PreQuery),this.LastShiftViewItem=void 0,this.LastIndex=void 0,this.EntityFocusId="",this.LastElementFocus=null,this.LastComponentFocus=null}get Editable(){return this.Meta.CanAdd}RealtimeUpdateListViewItem(t){let e=t.Message,n=this.MainSection.FilterChildren(a=>a.EntityId===e[this.IdField]).FirstOrDefault();if(n===null)return;this.CacheData.FirstOrDefault(a=>a[this.IdField]===e[this.IdField]).CopyPropFrom(e),n.Entity.CopyPropFrom(e);let s=n.FilterChildren(a=>!a.Dirty||a.GetValueText()!=null).Select(a=>a.Name).ToArray();n.UpdateView(!1,s),this.DispatchCustomEvent(this.Meta.Events,CustomEventType.AfterWebsocket,e,n).Done()}Resolve(t,e=null){let n=document.createElement("textarea");n.innerHTML=e.innerHTML,t.FormatEntity=n.value,e.innerHTML=null}Render(){var t;this.EditForm&&(this.GridPolicies=this.EditForm.GetElementPolicies(this.Meta.Id)??[],this.GeneralPolicies=this.EditForm.Policies),this.CanWrite=this.CanDo(e=>e.CanWrite||e.CanWriteAll),Html.Take(this.ParentElement).DataAttr("name",this.Name),this.AddSections(),this.SetRowDataIfExists(),(t=this.EditForm)==null||t.ResizeListView(),this.Meta.LocalRender?this.LocalRender():this.LoadAllData()}LocalRender(){this.Header=this.Header??this.Meta.LocalHeader,this.Meta.LocalRender?this.Rerender():this.RowData.Data=this.Meta.LocalData}Rerender(){this.DisposeNoRecord(),this.MainSection.DisposeChildren(),Html.Take(this.MainSection.Element).Clear(),this.RenderContent()}CanDo(t){var e,n;return((e=this.GeneralPolicies)==null?void 0:e.some(t))||((n=this.GridPolicies)==null?void 0:n.some(t))}async ReloadData(t=!1,e=null,n=null){var a,r,o,h;if(this.Meta.LocalQuery&&Array.isArray(this.Meta.LocalQuery)&&(this.Meta.LocalData=this.Meta.LocalQuery,this.Meta.LocalRender=!0),this.Meta.LocalQuery&&!Array.isArray(this.Meta.LocalQuery)&&(this.Meta.LocalData=this.Meta.LocalData??typeof this.Meta.LocalQuery===Str.Type?JSON.parse(this.Meta.LocalQuery.toString()):this.Meta.LocalQuery,this.Meta.LocalRender=!0),this.Meta.LocalRender&&this.Meta.LocalData!=null)return this.SetRowData(this.Meta.LocalData),this.Meta.LocalData;this.Paginator!=null&&(this.Paginator.Options.PageSize=this.Paginator.Options.PageSize===0?this.Meta.Row??12:this.Paginator.Options.PageSize),n=n??((r=(a=this.Paginator)==null?void 0:a.Options)==null?void 0:r.PageSize)??this.Meta.Row??20,e=e?((h=(o=this.Paginator)==null?void 0:o.Options)==null?void 0:h.PageIndex)*n:0;let s=this.GetSql(e,n,t);return await this.CustomQuery(s)}CalcFilterQuery(){return this.ListViewSearch.CalcFilterQuery()}GetSql(t=null,e=null,n=!1,s=!0){let a=Utils$1.IsFunction(this.Meta.PreQuery,!0,this),r=this.AdvSearchVM.OrderBy.Any()?this.AdvSearchVM.OrderBy.Combine(m=>{let f=m.OrderbyDirectionId===OrderbyDirection.ASC?"asc":"desc";return`ds.${m.FieldName} ${f}`}):null,o=this.CalcFilterQuery(),h=this.Wheres.Combine(m=>`(${m.Condition})`," and "),d=[o,h].filter(m=>m).Combine(null," and ");return{ComId:this.Meta.Id,Params:a,OrderBy:r||(this.Meta.OrderBy?this.Meta.OrderBy:"ds.Id asc"),Where:d,Count:s,Skip:t,Top:e,SkipXQuery:n,MetaConn:this.MetaConn,DataConn:this.DataConn}}SetRowData(t){var n;(n=this.RowData)==null||n.Clear(),t.length&&this.RowData._data.push(...t),this.RenderContent(),this.Entity!==null&&this.ShouldSetEntity&&(this.Entity[this.Name]=this.RowData.Data)}async CustomQuery(t){var e,n,s;try{const a=await Client.Instance.SubmitAsync({NoQueue:!0,Url:`/api/feature/com?t=${Client.Token.TenantCode||Client.Tenant}`,Method:"POST",JsonData:JSON.stringify(t,this.getCircularReplacer(),2),AllowAnonymous:!0,ErrorHandler:h=>{h.status===400&&(Client.Token=null,Toast.Warning("Phiên truy cập đã hết hạn! Vui lòng chờ trong giây lát, hệ thống đang tải lại trang"))}});let r=((e=a.count)==null?void 0:e.total)??0,o=a.value;return!o||!o.length?(this.SetRowData(null),null):(Spinner.Hide(),await this.LoadMasterData(o),this.SetRowData(o),this.UpdatePagination(r,o.length),(n=Utils$1.IsFunction(this.Meta.FormatEntity))==null||n.call(null,o,this),(s=this.DataLoaded)==null||s.invoke(ds),o)}catch(a){throw console.error("Error during custom query:",a),a}}getCircularReplacer(){const t=new WeakSet;return(e,n)=>{if(typeof n=="object"&&n!==null){if(t.has(n))return;t.add(n)}return n}}async LoadMasterData(t=null,e=!0){var n=this.Header.filter(o=>!Utils$1.isNullOrWhiteSpace(o.RefName));if(n.length==0)return;t=t||this.RowData.Data,this.SyncMasterData(t,n);let s=n.map(o=>this.FormatDataSourceByEntity(o,n,t)).filter(o=>o!==null);if(s.Nothing())return;let a=s.filter(o=>o.DataSourceOptimized).map(o=>({Header:o,Data:Client.Instance.GetByIdAsync(o.RefName,o.DataSourceOptimized)})),r=await Promise.all(a.map(o=>o.Data));a.forEach((o,h)=>{o.Data=r[h],this.setRemoteSource(o.Data.data,o.Header.RefName,o.Header)}),this.SyncMasterData(t,n)}setRemoteSource(t,e,n){let s=this.RefData[e];s?t.forEach(a=>{s.some(r=>r[this.IdField]===a[this.IdField])||s.push(a)}):this.RefData[e]=t,n&&(n.LocalData=t)}SyncMasterData(t=null,e=null){t=t||this.RowData.Data,e=e||this.Header,e.filter(n=>n.RefName).forEach(n=>{!n.FieldName||n.FieldName.length<=2||!(n.FieldName.substr(n.FieldName.length-2)===this.IdField)||t.forEach(a=>{var u;let r=n.FieldName.substr(0,n.FieldName.length-2),o=n.RefName;if(!o)return;let h=a[r],d=(u=this.RefData[o])==null?void 0:u.find(m=>m[this.IdField]===a[n.FieldName]);d?a[r]=d:h&&!d&&(this.RefData[o]=this.RefData[o]||[],this.RefData[o].push(h))})})}FormatDataSourceByEntity(t,e,n){let s=e.filter(a=>a.RefName===t.RefName).flatMap(a=>this.getEntityIds(a,n)).filter((a,r,o)=>o.indexOf(a)===r);return s.length===0?null:(t.DataSourceOptimized=s.sort(),t)}getEntityIds(t,e){if(!e||e.length===0)return[];let n=[];return e.forEach(s=>{let a=s[t.FieldName];if(a)a.includes(",")?n.push(...a.split(",").map(r=>r)):n.push(a);else return}),n}UpdatePagination(t,e){if(!this.Paginator)return;let n=this.Paginator.Options;n.Total=t,n.CurrentPageCount=e,n.PageNumber=n.PageIndex+1,n.StartIndex=n.PageIndex*n.PageSize+1,n.EndIndex=n.StartIndex+n.CurrentPageCount-1,this.Paginator.UpdateView()}AddSections(){if(this.Meta.LiteGrid){this.Element=this.ParentElement,this.Element.innerHTML=null,this.MainSection=new ListViewSection(null,this.ParentElement),this.AddChild(this.MainSection);return}Html.Take(this.ParentElement).Div.ClassName("grid-wrapper"),this.Element=Html.Context,this.Meta.CanSearch&&Html.Instance.Div.ClassName("grid-toolbar search").End.Render(),this.ListViewSearch=new ListViewSearch(this.Meta),this.AddChild(this.ListViewSearch),Html.Take(this.Element).Div.ClassName("list-content").End.Div.ClassName("empty"),this.EmptySection=new ListViewSection(null,Html.Context),this.EmptySection.ParentElement=this.Element,this.AddChild(this.EmptySection),this.MainSection=new ListViewSection(null,this.EmptySection.Element.previousElementSibling),this.AddChild(this.MainSection),Html.Instance.EndOf(".list-content"),this.RenderPaginator()}RenderContent(){var t;this.MainSection.DisposeChildren(),(t=this.EmptySection)==null||t.DisposeChildren(),this.FormattedRowData=this.FormattedRowData.Nothing()?this.RowData.Data:this.FormattedRowData,!this.FormattedRowData.Nothing()&&(this.FormattedRowData.SelectForEach((e,n)=>{this.RenderRowData(this.Header,e,this.MainSection)}),this.ContentRendered())}RenderRowData(t,e,n,s=null,a=!1){let r=this.Meta.LiteGrid?new ListViewItem$1:new ListViewItem$1("div");return r.EmptyRow=a,r.Entity=e,r.ParentElement=n.Element,r.ListView=this,r.ListViewSection=n instanceof ListViewSection?n:null,r.Meta=this.Meta,r.EditForm=this.EditForm,n.AddChild(r,s),r.RenderRowData(t,e,s,a),r}ClearRowData(){this.RowData.Clear(),this.RowAction(t=>t.Dispose(),t=>!t.EmptyRow),this.MainSection.Element.innerHTML=null,!(this.Entity==null||this.Parent.IsSearchEntry)&&this.ShouldSetEntity&&(this.Entity[this.Name]=this.RowData.Data)}get AllListViewItem(){return this.MainSection.Children}RowAction(t,e=null){this.AllListViewItem.filter(n=>!e||e(n)).forEach(t)}SetRowDataIfExists(){const t=Utils$1.GetPropValue(this.Entity,this.Name);this.Entity!=null&&Array.isArray(t)&&(this.RowData._data=t)}UpdateView(t=!1,e=null,n=[]){this.Editable?this.RowAction(s=>s.UpdateView(t,e,n),s=>!s.EmptyRow):t&&this.ListViewSearch.RefreshListView()}AddNewEmptyRow(){var s;if(this.Meta.LiteGrid||this.Disabled||!this.Editable||((s=this.EmptySection)==null?void 0:s.Children.HasElement())===!0)return;let t={},e=Utils$1.IsFunction(this.Meta.DefaultVal);if(!this.Meta.DefaultVal&&e){let a=e.call(this,this);Object.keys(a).forEach(r=>{t[r]=a[r]})}t[this.IdField]=null;let n=this.RenderRowData(this.Header,t,this.EmptySection,null,!0);Object.entries(t).forEach(([a,r])=>{n.PatchModel.push({Field:a,Value:r==null?void 0:r.toString()})}),this.Meta.TopEmpty?this.MainSection.Element.appendChild(this.EmptySection.Element.firstElementChild):this.MainSection.Element.insertBefore(this.MainSection.Element,this.EmptySection.Element),this.DispatchCustomEvent(this.Meta.Events,CustomEventType.AfterEmptyRowCreated,t).Done()}RenderPaginator(){if(this.Meta.LocalRender||this.Meta.LiteGrid){this.Paginator&&(this.Paginator.Show=!1);return}(!this.Meta.Row||this.Meta.Row===0)&&(this.Meta.Row=20),this.Paginator||(this.Paginator=new Paginator({Total:0,PageSize:this.Meta.Row??50,CurrentPageCount:this.RowData.Data.length}),this.AddChild(this.Paginator))}get UpdatedRows(){return this.AllListViewItem.OrderBy(t=>t.RowNo).Where(t=>t.Dirty).Select(t=>t.Entity).Distinct()}get UpdatedListItems(){return this.AllListViewItem.OrderBy(t=>t.RowNo).Where(t=>t.Dirty)}GetPatches(t=!1){if(!this.Dirty)return null;this.Meta.IdField!==null&&this.Meta.IdField!==this.IdField&&this.UpdatedRows.forEach(n=>{n[this.Meta.IdField]=this.EntityId});const e=[];return this.UpdatedListItems.forEach(n=>{e.push(n.GetPatchEntity())}),t&&this.UpdateView(),e}FilterColumns(t){if(t.length===0)return t;t.some(a=>a.ComponentId===this.Meta.Id)?t=t.filter(a=>a.ComponentId===this.Meta.Id):t=t.filter(a=>a.ComponentId===null);let n=this.EditForm.GetGridPolicies(t.map(a=>a.Id),Utils$1.ComponentId),s=t.filter(a=>!a.IsPrivate||n.filter(r=>r.RecordId===a.Id).every(r=>r.CanRead)).sort((a,r)=>a.Frozen!==r.Frozen?a.Frozen-r.Frozen:a.Order-r.Order);return this.OrderHeaderGroup(s),this.Header.length=0,this.Header.push(...s),this.Header=this.Header.filter(a=>a!==null),this.Header}ApplyFilter(){return this.ClearRowData(),this.ReloadData(!0,0)}GetSelectedRows(){var t;return((t=this.LastListViewItem)==null?void 0:t.GroupRow)===!0?[this.LastListViewItem.Entity]:this.MainSection.Children.filter(e=>e.IsListViewItem&&e.Selected).map(e=>e.Entity)}BodyContextMenuHandler(t){var n;if(t.preventDefault(),t.stopPropagation(),ContextMenu.Instance.MenuItems.Clear(),(n=this.BodyContextMenuShow)==null||n.invoke(),this.Disabled)return;this.SetSelected(t);let e=ContextMenu.Instance;this.RenderCopyPasteMenu(this.CanWrite),this.RenderEditMenu(this.CanWrite),e.Top=t.Top(),e.Left=t.Left(),e.Render(),document.body.appendChild(e.Element),e.Element.style.position="absolute"}async RenderRelatedDataMenu(){const t=await Client.Instance.GetByIdAsync("EntityRef",this.DataConn,[this.Meta.Id]);if(t.Nothing())return;const e=t.Select(n=>({Text:n.MenuText,Click:s=>this.OpenFeature(n)})).ToList();ContextMenu.Instance.MenuItems.push({Icon:"fal fal fa-ellipsis-h",Text:"Dữ liệu liên quan",MenuItems:e})}async OpenFeature(t){const e=await __vitePreload(()=>Promise.resolve().then(()=>tabEditor),void 0),n=await __vitePreload(()=>Promise.resolve().then(()=>searchEntry),void 0);let a=e.TabEditor.Tabs.find(h=>h.Name===t.ViewClass);if(a){a.Focus(),this.Filter(a,t),this.HasLoadRef=!0;return}this.HasLoadRef=!1;const r=await ComponentExt.LoadFeature(t.ViewClass),o=r.Name+r.Id;a=new e.TabEditor(r.EntityName),a.Name=r.Name,a.Id=o,a.Icon=r.Icon,a.Meta=a.Meta=r,a.Render(),a.DOMContentLoaded.add(()=>{a.FilterChildren(d=>d instanceof n.SearchEntry).find(d=>d.Meta.Id===t.TargetComId).DOMContentLoaded.add(()=>{this.HasLoadRef||(this.Filter(a,t),this.HasLoadRef=!0)})})}Filter(t,e){let n=t.FilterChildren(s=>s instanceof EditableComponent.GridViewMd.GridView).find(s=>s.Meta.Id===e.TargetComId);n&&(n.CellSelected=[],n.AdvSearchVM.Conditions=[],n.ListViewSearch.EntityVM.StartDate=null,n.ListViewSearch.EntityVM.EndDate=null,this.GetRealTimeSelectedRows().then(s=>{let a=n.Header.find(o=>o.FieldName===e.TargetFieldName);if(!a)return;let r=s.map(o=>({FieldName:e.TargetFieldName,FieldText:a.Label,ComponentType:a.ComponentType,Value:o[e.FieldName].toString(),ValueText:o[e.FieldName].toString(),Operator:OperatorEnum.In,OperatorText:"Contains",Logic:"Or",IsSearch:!0,Group:!0}));n.CellSelected.push(...r),n.ActionFilter()}))}SetSelected(t){let e=t.target.closest("tr"),n=this.MainSection.Children.find(s=>s.Element===e);n&&(!n.GroupRow||this.Meta.GroupReferenceId)&&(this.SelectedIds.length===1&&this.ClearSelected(),n.Selected=!0,this.LastListViewItem=n,this.SelectedIndex=n.RowNo)}LoadAllData(){this.LoadHeader().then(()=>{this.ReloadData(!0).then(()=>{this.RenderContent()})})}async LoadHeader(){var t=this.LoadGridPolicy();this.DispatchCustomEvent(this.Meta.Events,CustomEventType.UpdateHeader,t),t=this.FilterColumns(t),this.Header=t}LoadGridPolicy(){var t=[];return this.Meta.Columns.length>0?t=this.Meta.Columns:Utils$1.isNullOrWhiteSpace(this.Meta.Template)?t=this.EditForm.Meta.GridPolicies.filter(e=>e.EntityId==this.Meta.FieldName):t=JSON.parse(this.Meta.Template,null,2),t}OrderHeaderGroup(t){for(let s=0;s<t.length;s++){var e=this.EditForm.GetDefaultGridPolicies(),n=e.filter(a=>a.EntityId=="GridPolicyId"&&a.RecordId==t[s].Id);t[s].CanWrite=(t[s].Editable||this.NotCellText.includes(t[s].ComponentType))&&(this.EditForm.Meta.IsPublic||e.some(a=>a.CanWrite)&&n.some(a=>a.CanWrite)||e.some(a=>a.CanWrite)&&n.length==0)||t[s].ComponentType=="Button";for(let a=s+1;a<t.length;a++)if(t[s].GroupName&&t[s].GroupName===t[a].GroupName&&t[s+1].GroupName!==t[a].GroupName){let r=t[s+1];t[s+1]=t[a],t[a]=r}}}CopySelected(t){this._originRows=this.GetSelectedRows();const e=JSON.stringify(this._originRows);this._copiedRows=JSON.parse(e),window.navigator.clipboard.writeText(e),this.DispatchCustomEvent(this.Meta.Events,CustomEventType.AfterCopied,this._originRows,this._copiedRows)}async PasteSelected(t){var e=await window.navigator.clipboard.readText();!e&&this._copiedRows.Nothing()&&(this._copiedRows=JSON.parse(e)),!this._copiedRows.Nothing()&&(Toast.Success("Copying..."),this.DispatchCustomEvent(this.Meta.Events,CustomEventType.BeforePasted,this._originRows,this._copiedRows).Done(()=>{var n=this.AllListViewItem.IndexOf(s=>s.Selected);this.AddRowsNo(this._copiedRows,n).Done(s=>{super.Focus(),this.Meta.IsRealtime?Promise.all(s.Select(a=>a.PatchUpdateOrCreate())).Done(()=>{Toast.Success("Data pasted successfully !"),super.Dirty=!1,this.ClearSelected()}):Toast.Success("Data pasted successfully !"),this.DispatchCustomEvent(this.Meta.Events,CustomEventType.AfterPasted,this._originRows,this._copiedRows).Done()})}))}RenderCopyPasteMenu(t){t&&(ContextMenu.Instance.MenuItems.push({Icon:"fal fa-copy",Text:"Copy",Click:()=>this.CopySelected()}),ContextMenu.Instance.MenuItems.push({Icon:"fal fa-clone",Text:"Copy & Paste",Click:()=>this.DuplicateSelected(null,!1)})),t&&this._copiedRows&&this._copiedRows.length>0&&ContextMenu.Instance.MenuItems.push({Icon:"fal fa-paste",Text:"Paste",Click:()=>this.PasteSelected()})}RenderEditMenu(t){t&&ContextMenu.Instance.MenuItems.push({Icon:"fal fa-history",Text:"View History",Click:async()=>await this.ViewHistory()}),this.CanDo(e=>e.CanDeactivate||e.CanDeactivateAll)&&ContextMenu.Instance.MenuItems.push({Icon:"fal fa-unlink",Text:"Deactivate",Click:()=>this.DeactivateSelected()}),this.CanDo(e=>e.CanDelete||e.CanDeleteAll)&&ContextMenu.Instance.MenuItems.push({Icon:"fal fa-trash",Text:"Delete Data",Click:()=>this.HardDeleteSelected()})}async ViewHistory(t){this.GetSelectedRows().LastOrDefault(),Html.Take(this.EditForm.Element).Div.ClassName("backdrop").Style("align-items: center;").Escape(o=>this.Dispose()),this._history=Html.Context,Html.Instance.Div.ClassName("popup-content confirm-dialog").Style("top: 0;").Div.ClassName("popup-title").InnerHTML("Xem lịch sử").Div.ClassName("icon-box").Span.ClassName("fal fa-times").Event(EventType.Click,()=>this._history.remove()).EndOf(".popup-title").Div.ClassName("popup-body scroll-content");const n=Html.Context,s=new Component;s.Id=Uuid7.Id25(),s.FieldName="Conditions",s.Column=4,s.RefName="History";const a=await __vitePreload(()=>Promise.resolve().then(()=>gridView),void 0),r=new a.GridView(s);r.Meta.LocalHeader=[{Id:"1",FieldName:"InsertedBy",Label:"User create",RefName:"User",FormatData:"FullName",Active:!0,ComponentType:"SearchEntry",MaxWidth:"100px",MinWidth:"100px"},{Id:"2",FieldName:"InsertedDate",Label:"Created date",Active:!0,FormatData:"{0:dd/MM/yyyy HH:mm}",ComponentType:"Datepicker",TextAlign:"left",MaxWidth:"150px",MinWidth:"150px"},{Id:"4",FieldName:"TextHistory",Label:"Dữ liệu thay đổi",Active:!0,ComponentType:"Label",MaxWidth:"700px",MinWidth:"700px"}],r.ParentElement=n,this.TabEditor.AddChild(r)}async RenderShareMenu(t){const e="PermissionLoaded";if(t.length===0)return;const n=t.filter(o=>!o[e]),s=n.map(o=>o[this.IdField].toString());(await this.LoadRecordPolicy(this.Meta.RefName,s)).forEach(o=>this.RecordPolicy.push(o)),n.forEach(o=>o[e]=!0),this.CanDo(o=>o.CanShare||o.CanShareAll)&&t.some(o=>o[ft.IsOwner])&&ContextMenu.Instance.MenuItems.push({Icon:"mif-security",Text:"Security & Permissions",Click:()=>this.SecurityRows()})}async SecurityRows(){const t=await __vitePreload(()=>import("./securityBL-DvboSDy1.js"),[]),e=this.GetSelectedRows().filter(s=>s[ft.IsOwner]===!0).map(s=>{var a;return(a=s[this.IdField])==null?void 0:a.toString()}),n=new t.SecurityBL;n.Entity={RecordIds:e,EntityId:this.Meta.ReferenceId},n.ParentElement=this.TabEditor.Element,this.TabEditor.AddChild(n)}async LoadRecordPolicy(t,e){if(e.length===0||e.every(s=>s===null))return[];const n={ComId:"Policy",Action:"GetById",Table:"FeaturePolicy",MetaConn:this.MetaConn,DataConn:this.DataConn,Params:JSON.stringify({ids:e,table:t})};return await Client.Instance.UserSvc(n)}async DeactivateSelected(){const t=new ConfirmDialog;t.Content="Are you sure you want to deactivate?",t.Render(),t.YesConfirmed+=async()=>{t.Dispose(),await this.Deactivate(),this.DispatchCustomEvent(this.Meta.Events,CustomEventType.Deactivated,this.Entity)}}async Deactivate(){const t=this.GetSelectedRows().map(n=>n[this.IdField].toString()),e=await Client.Instance.DeactivateAsync(t,this.Meta.RefName,this.DataConn);return e.length>0?Toast.Success("Data deactivated successfully"):Toast.Warning("An error occurred during deactivation"),e}async HardDeleteSelected(){var t=[];if(t=this.GetSelectedRows(),t.length==0)return;const e=new ConfirmDialog;e.Title="Are you sure you want to delete the selected rows?",e.Render(),e.YesConfirmed.add(()=>{this.HardDeleteConfirmed(t).then(n=>{this.DispatchCustomEvent(this.Meta.Events,CustomEventType.AfterDeleted,n)})})}async HardDeleteConfirmed(t){const e=t.map(s=>s[this.IdField]).filter(s=>s!=null);return(await Client.Instance.HardDeleteAsync(e,this.Meta.RefName,this.DataConn)).status==200?(this.AllListViewItem.filter(s=>s.Selected).forEach(s=>s.Dispose()),this.Meta.IsRealtime&&(this.Dirty=!1),Toast.Success("Data deleted successfully")):Toast.Warning("No rows were deleted"),t}async DuplicateSelected(t,e=!1){const n=this.GetSelectedRows(),s=n.map(a=>({...a}));Toast.Success("Duplicating data!"),this.DispatchCustomEvent(this.Meta.Events,CustomEventType.BeforePasted,n,s).then(()=>{let a=e?0:this.MainSection.Children.length;this.AddRowsNo(s,a).then(r=>{this.RenderIndex(),this.ClearSelected(),Toast.Success("Data duplicated successfully!")})})}AddRowsNo(t,e=0){let n,s,a=new Promise((r,o)=>{n=r,s=o});return this.DispatchCustomEvent(this.Meta.Events,CustomEventType.BeforeCreatedList,t).then(()=>{const r=t.map((o,h)=>this.AddRow(o,e+h,!1));Promise.all(r).then(o=>{this.AddNewEmptyRow(),n(o),this.DispatchCustomEvent(this.Meta.Events,CustomEventType.AfterCreatedList,t).then()}).catch(s)}),a}RenderIndex(){this.MainSection.Children.length!==0&&this.AllListViewItem.forEach((t,e)=>{if(t.Children.length===0||t.FirstChild===null||t.FirstChild.Element===null)return;const n=t.FirstChild.Element.closest("td").previousElementSibling;if(n===null)return;const s=this.Paginator.Options.StartIndex+e;n.innerHTML=s.toString(),t.Selected=this.SelectedIds.includes(t.Entity[this.IdField]),t.RowNo=s})}RowChangeHandler(t,e,n,s=null){return new Promise((r,o)=>{!e.EmptyRow||!this.Editable?this.DispatchEvent(this.Meta.Events,EventType.Change,t).then(()=>{r(!1)}):this.DispatchCustomEvent(this.Meta.Events,CustomEventType.BeforeCreated,t).then(()=>{this.RowData.Data.push(t),this.Entity[this.Name]=this.RowData.Data,e.FilterChildren(h=>!0).forEach(h=>{h.EmptyRow=!1,h.UpdateView(!0)}),this.EmptySection.Children.Clear(),this.AddNewEmptyRow(),this.DispatchCustomEvent(this.Meta.Events,CustomEventType.AfterCreated,t).then(()=>{r(!0)})})})}RemoveRowById(t){const e=this.RowData.Data.find(n=>n[this.IdField]===t);if(e){this.RowData.Data.splice(this.RowData.Data.indexOf(e),1);const n=this.MainSection.Children.find(s=>s.EntityId===t);n&&n.Dispose()}}async AddRow(t,e=0,n=!0){n&&this.RowData.Data.splice(e,0,t),await this.DispatchCustomEvent(this.Meta.Events,CustomEventType.BeforeCreated,t);const s=this.RenderRowData(this.Header,t,this.MainSection,e);return await this.DispatchCustomEvent(this.Meta.Events,CustomEventType.AfterCreated,t),s}async AddRows(t,e=0){await this.DispatchCustomEvent(this.Meta.Events,CustomEventType.BeforeCreatedList,t);const n=[];for(let s=0;s<t.length;s++){const a=await this.AddRow(t[s],e+s,!1);n.push(a)}return await this.DispatchCustomEvent(this.Meta.Events,CustomEventType.AfterCreatedList,t),this.AddNewEmptyRow(),n}ClearSelected(){this.SelectedIds.forEach(t=>{const e=this.AllListViewItem.find(n=>n.Entity[this.IdField]===t);e&&(e.Selected=!1)}),this.SelectedIds=[],this.LastListViewItem=null}UpdateRow(t,e=!1,n=[]){const s=this.AllListViewItem.find(a=>a.Entity===t);s&&s.UpdateView(e,n)}DomLoaded(){var t;this.Meta.LocalRender||this.Header.ForEach(e=>e.LocalData=null),(t=this.DOMContentLoaded)==null||t.invoke()}ContentRendered(){this.RenderIndex(),this.DomLoaded(),this.Editable&&this.AddNewEmptyRow(),this.RowData.Data.length===0&&!this.Editable?this.NoRecordFound():this.DisposeNoRecord(),this.Editable&&this.MainSection.Element.addEventListener("contextmenu",this.BodyContextMenuHandler.bind(this))}NoRecordFound(){this.MainSection.Children.length>0&&this.MainSection.Children.forEach(t=>t.Dispose()),this.DisposeNoRecord(),this._noRecord=new Section$1(ElementType.div),this._noRecord.ParentElement=this.Element,this.AddChild(this._noRecord),this._noRecord.Element.AddClass("no-records"),Html.Take(this._noRecord.Element).InnerHTML("No record found"),this.DomLoaded()}DisposeNoRecord(){this._noRecord&&(this._noRecord.Dispose(),this._noRecord=null)}GetItemFocus(){return this.AllListViewItem.Where(t=>t.Focused()).FirstOrDefault()}GetRealTimeSelectedRows(){return new Promise((t,e)=>{Client.Instance.GetByIdAsync(this.Meta.RefName,this.DataConn||Client.DataConn,this.SelectedIds.ToArray()).then(n=>{t(n?n.slice():[])}).catch(n=>{e(n)})})}GetRowCountByHeight(t){return t/this._rowHeight>=0?Math.floor(t/this._rowHeight):Math.ceil(t/this._rowHeight)}RemoveRow(t){var e;t!==null&&(this.RowData.Data.Remove(t),(e=this.MainSection.FirstOrDefault(n=>n.Entity==t))==null||e.Dispose())}CalcTextAlign(t){return t.TextAlign&&t.TextAlign.length>0&&Object.values(t.TextAlign).includes(t.textAlign)&&(t.textAlignEnum=t.textAlign),t}MergeComponent(t,e){if(!e)return t;const n=JSON.parse(e.value);if(!n||n.length===0)return t;const s=n.reduce((a,r)=>(a[r.id]=r,a),{});return t.forEach(a=>{const r=s[a.id];r&&(a.width=r.width,a.maxWidth=r.maxWidth,a.minWidth=r.minWidth,a.order=r.order,a.frozen=r.frozen)}),t}ActionFilter(){this.ClearRowData(),this.ReloadData().Done()}MoveUp(){this.ClearSelected(),(this.SelectedIndex<=0||this.SelectedIndex===this.AllListViewItem.length)&&(this.SelectedIndex=this.AllListViewItem.length-1),this.RowAction(t=>{t instanceof ListViewItem$1&&(t.Selected=!0)},!0)}MoveDown(){this.ClearSelected(),(this.SelectedIndex===-1||this.SelectedIndex===this.AllListViewItem.length)&&(this.SelectedIndex=0),this.RowAction(t=>{t instanceof ListViewItem$1&&(t.Selected=!0)},!1)}GetUserSetting(t){return Client.Instance.UserSvc({MetaConn:this.MetaConn,DataConn:this.DataConn,ComId:"UserSetting",Action:"GetByComId",Params:JSON.stringify({ComId:this.Meta.Id,Prefix:t})})}async RealtimeUpdateAsync(t,e){if(this.EmptyRow){this.EmptyRow=!1;return}if(!(!this.Meta.IsRealtime||!e)){var n=await t.ValidateAsync();n&&await t.PatchUpdateOrCreate()}}};c(ft,"IsOwner","__IsOwner");let ListView=ft;class GridViewItem extends ListViewItem$1{constructor(i){super(i)}RenderRowData(i,t,e=null,n=!1){e!==null&&((e>=this.Element.parentElement.children.length||e<0)&&(e=0),this.Element.parentElement.insertBefore(this.Element,this.Element.parentElement.children[e])),i.filter(s=>!s.Hidden).forEach(s=>{this.RenderTableCell(t,s,null)}),this.BindingEvents()}RenderTableCell(i,t,e=null){Html.Take(this.Element).TData.TabIndex(-1).TextAlign(t.TextAlign).Event("focusin",s=>this.FocusCell(s,t));var n=Html.Instance.GetContext();Html.Instance.Event("keydown",s=>this.ListViewItemTab(s,n,t)),super.RenderTableCell(i,t,e??Html.Context),Html.Instance.EndOf(ElementType.td)}FocusCell(i,t){var n;if(this.ListViewSection==null)return;this.ListViewSection.ListView.LastElementFocus&&((n=this.ListViewSection.ListView.LastElementFocus)==null||n.closest("td").classList.remove("cell-selected"));let e=i.target;e.closest("td").classList.add("cell-selected"),this.ListViewSection.ListView.LastElementFocus=e,this.ListViewSection.ListView.LastComponentFocus=t,this.ListViewSection.ListView.EntityFocusId=this.EntityId}}var wt;let GridView$1=(wt=class extends ListView{constructor(t,e){super(t,e);c(this,"mouseMoveHandler");c(this,"mouseUpHandler");c(this,"x",0);c(this,"w",0);this.SummaryClass="summary",this.CellCountNoSticky=50,this._summarys=[],this.LastThClick=null,this.LastNumClick=null,this.AutoFocus=!1,this.LoadRerender=!1,this._waitingLoad=!1,this._renderPrepareCacheAwaiter=0,this.DataTable=null,this.LastElementFocus=null,this.lastListViewItem=null,this._hasFirstLoad=!1,this._renderIndexAwaiter=0,this._lastScrollTop=0,this.ToolbarColumn={StatusBar:!0,Label:"",Frozen:!0},this.DOMContentLoaded.add(this.DOMContentLoadedHandler.bind(this))}DOMContentLoadedHandler(){this.Meta.IsSumary&&this.AddSummaries(),this.PopulateFields()}PopulateFields(){if(this.Meta.PopulateField){let t=this.Meta.PopulateField.split(",");t.length>0&&this.EditForm.UpdateView(!0,t)}}Rerender(){this.LoadRerender=!0,this.Header=this.Header.filter(t=>!t.Hidden),this.RenderTableHeader(this.Header),this.Editable&&this.AddNewEmptyRow(),this.RenderContent(),this.StickyColumn(this),!this.Editable&&this.RowData.Data.Nothing()?this.NoRecordFound():this.DisposeNoRecord(),this.Editable&&(this.MainSection.Element.addEventListener("contextmenu",this.BodyContextMenuHandler.bind(this)),this.EmptySection.Element.addEventListener("contextmenu",this.BodyContextMenuHandler.bind(this)))}StickyColumn(t,e=null){let n=["th","td"];t.FilterChildren(a=>a.Meta!=null&&a.Meta.Frozen,a=>!(a instanceof ListViewSearch)).forEach(a=>{let r=a.Element;n.includes(a.Element.tagName.toLowerCase())||(r=a.Element.closest("td")),e?Html.Take(r).Sticky({top:e}):Html.Take(r).Sticky({left:"0"})})}AddSections(){if(this.HeaderSection&&this.HeaderSection.Element!=null)return;if(Html.Take(this.ParentElement),Html.Instance.Div.Event("keydown",n=>this.HotKeyF6Handler(n,n.KeyCodeEnum())).Style(this.Meta.ChildStyle).ClassName("grid-wrapper").ClassName(this.Meta.ClassName).ClassName(this.Editable?"editable":""),this.Element=Html.Context,this.Meta.CanSearch&&Html.Instance.Div.ClassName("grid-toolbar search").End.Render(),this.ListViewSearch=new ListViewSearch(this.Meta),this.ListViewSearch.Entity=new ListViewSearchVM,this.Meta.DefaultAddStart){let n=this.Meta.DefaultAddStart;this.ListViewSearch.EntityVM.StartDate=new Date(Date.now()+n*24*3600*1e3)}let t=window.localStorage.getItem("FromDate"+this.Meta.Id);if(t!=null&&(this.ListViewSearch.EntityVM.StartDate=new Date(t)),this.Meta.DefaultAddEnd){let n=this.Meta.DefaultAddEnd;this.ListViewSearch.EntityVM.EndDate=new Date(Date.now()+n*24*3600*1e3)}let e=window.localStorage.getItem("ToDate"+this.Meta.Id);e!=null&&(this.ListViewSearch.EntityVM.EndDate=new Date(e)),this.AddChild(this.ListViewSearch),this.DataTable=Html.Take(this.Element).Div.ClassName("table-wrapper").Table.ClassName("table").GetContext(),Html.Instance.Thead.TabIndex(-1).End.TBody.ClassName("empty").End.TBody.End.TFooter.Render(),this.FooterSection=new ListViewSection(null,Html.Context),this.FooterSection.ParentElement=this.DataTable,this.AddChild(this.FooterSection),this.MainSection=new ListViewSection(null,this.FooterSection.Element.previousElementSibling),this.MainSection.ParentElement=this.DataTable,this.AddChild(this.MainSection),this.EmptySection=new ListViewSection(null,this.MainSection.Element.previousElementSibling),this.EmptySection.ParentElement=this.DataTable,this.AddChild(this.EmptySection),this.HeaderSection=new ListViewSection(null,this.EmptySection.Element.previousElementSibling),this.HeaderSection.ParentElement=this.DataTable,this.AddChild(this.HeaderSection),Html.Instance.EndOf(".table-wrapper"),Html.Take(this.Element),this.RenderPaginator()}SwapList(t,e){let n=this.Header[t];this.Header.splice(t,1),this.Header.splice(e,0,n)}SwapHeader(t,e){const n=this.Header[t];this.Header.splice(t,1),this.Header.splice(e,0,n)}ClickHeader(t,e){let n=this.LastNumClick;const s=this.DataTable;this.LastNumClick!=null&&s.querySelectorAll("tr:not(.summary)").forEach(function(o){if(o.hasAttribute("virtualrow")||o.classList.contains("group-row"))return;const h=Array.from(o.querySelectorAll("th, td"));h[n]&&(h[n].style.removeProperty("background-color"),h[n].style.removeProperty("color"))});const a=t.target.closest("th");n=Array.from(a.parentElement.querySelectorAll("th")).findIndex(o=>o===a),!(n<0)&&(this.LastThClick=a,this.LastNumClick=n,s.querySelectorAll("tr:not(.summary)").forEach(function(o){if(o.hasAttribute("virtualrow")||o.classList.contains("group-row"))return;const h=Array.from(o.querySelectorAll("th, td"));h[n]&&(h[n].style.backgroundColor="#cbdcc2",h[n].style.color="#000")}))}FocusOutHeader(t,e){let n=this.LastNumClick;const s=this.DataTable;this.LastNumClick!==null&&s.querySelectorAll("tr:not(.summary)").forEach(function(a){if(a.hasAttribute("virtualrow")||a.classList.contains("group-row"))return;const r=Array.from(a.querySelectorAll("th, td"));r[n].style.removeProperty("background-color"),r[n].style.removeProperty("color")})}ThHotKeyHandler(t,e){if(this.Meta.Focus)return;const n=t.keyCode;if(n===39){t.stopPropagation();const s=t.target.closest("th"),r=Array.from(s.parentElement.querySelectorAll("th")).findIndex(o=>o===s);s.parentElement.parentElement.parentElement.querySelectorAll("tr").forEach(function(o){if(o.hasAttribute("virtualrow")||o.classList.contains("group-row"))return;const h=Array.from(o.querySelectorAll("th, td"));if(!h[0].classList.contains("summary-header")){var d=r,u=r+1;d>u?h[u].parentNode.insertBefore(h[d],h[u]):h[u].parentNode.insertBefore(h[d],h[u].nextSibling),h[d].style.backgroundColor="#cbdcc2"}}),this.SwapList(r-1,r),this.SwapHeader(r,r+1),this.UpdateHeaders(this.GetHeaderSettings(),["Order","FieldName"]),s.focus()}else if(n===37){t.stopPropagation();const s=t.target.closest("th"),r=Array.from(s.parentElement.querySelectorAll("th")).findIndex(o=>o===s);s.parentElement.parentElement.parentElement.querySelectorAll("tr").forEach(function(o){if(o.hasAttribute("virtualrow")||o.classList.contains("group-row"))return;const h=Array.from(o.querySelectorAll("th, td"));if(!h[0].classList.contains("summary-header")){var d=r,u=r-1;d>u?h[u].parentNode.insertBefore(h[d],h[u]):h[u].parentNode.insertBefore(h[d],h[u].nextSibling),h[d].style.backgroundColor="#cbdcc2"}}),this.SwapList(r-1,r-2),this.SwapHeader(r,r-1),this.UpdateHeaders(),s.focus()}}FilterInSelected(t){let e=t;if(this._waitingLoad&&window.clearTimeout(this._renderPrepareCacheAwaiter),e.Operator===null)return;let n=this.Header.find(o=>o.Name===e.FieldName),s="",a=window.localStorage.getItem("LastSearch"+this.Meta.Id+n.Id);a!==null&&(s=a.toString());let r=new ConfirmDialog({Content:`Nhập ${n.Label} cần tìm `+e.OperatorText,NeedAnswer:!0,MultipleLine:!1,ComType:n.ComponentType==="Datepicker"||n.ComponentType==="Number"?n.ComponentType:"Textbox",Precision:n.Precision,PElement:this.MainSection.Element});if(r.YesConfirmed=()=>{let o=null,h=null;if(n.ComponentType==="Datepicker"?h=o=r.Datepicker.Value.toString():n.ComponentType==="Number"?(h=r.Number.GetValueText(),o=r.Number.Value.toString()):(h=r.Textbox.Text.trim().EncodeSpecialChar(),o=r.Textbox.Text.trim().EncodeSpecialChar()),window.localStorage.setItem("LastSearch"+this.Meta.Id+n.Id,o),this.CellSelected.some(d=>d.FieldName===e.FieldName&&d.Operator===OperatorEnum.In)&&!e.Shift){let d=this.CellSelected.find(u=>u.FieldName===e.FieldName&&u.Operator===OperatorEnum.In);d.Value=o,d.ValueText=h}else this.CellSelected.push({FieldName:e.FieldName,FieldText:n.Label,ComponentType:n.ComponentType,Shift:e.Shift,Value:o,ValueText:h,Operator:e.Operator,OperatorText:e.OperatorText,Logic:void 0,IsSearch:!1,Group:!1});this._summarys.push(new HTMLElement),r.Textbox.Text=null,this.ActionFilter()},r.Entity={ReasonOfChange:""},r.PElement=this.Element,r.Render(),s)if(n.ComponentType==="Datepicker"){r.Datepicker.Value=new Date(s);let o=r.Datepicker.Element;o.selectionStart=0,o.selectionEnd=s.length}else if(n.ComponentType==="Number"){r.Number.Value=parseFloat(s);let o=r.Number.Element;o.selectionStart=0,o.selectionEnd=s.length}else{r.Textbox.Text=s;let o=r.Textbox.Element;o.selectionStart=0,o.selectionEnd=s.length}}ActionFilter(){if(this.CellSelected.Nothing()){this.NoCellSelected();return}Spinner.AppendTo(this.DataTable);const t=this.CellSelected.filter(e=>(e.Value||e.ValueText)&&e.ComponentType==="SearchEntry"||e.FieldName.includes("."));this.CellSelected.filter(e=>e.FieldName.includes(".")),this.FilterDropdownIds(t).done(e=>{let n=0;const s=[];if(this.CellSelected.forEach(a=>{n=this.BuildCondition(a,e,n,s)}),Spinner.Hide(),this.Meta.ComponentType==="VirtualGrid"&&this.Meta.CanSearch&&this.HeaderSection.Element.focus(),this.Meta.ComponentType==="SearchEntry"&&this.Parent instanceof SearchEntry$1){const a=this.Parent;a._input&&a._input.focus()}Toast.Success(s.join("</br>")),this.ApplyFilter()})}async FilterDropdownIds(t){let e=t.map(n=>{let s=this.Header.find(a=>a.FieldName===n.FieldName);if(n.isSearch)return Promise.resolve([n.value]);{let a="Like";switch(n.operator){case OperatorEnum.Lr:a="StartWith";break;case OperatorEnum.Rl:a="EndWidth";break;case OperatorEnum.NotIn:a="NotLike";break}let r=`${a} ds.[${s.FormatData}] ${n.value}`;return Client.Instance.GetIds({ComId:s.Id,Where:r,MetaConn:this.MetaConn,DataConn:this.DataConn})}});return Promise.all(e)}BuildCondition(t,e,n,s){let a="",r=this.Header.find(m=>m.FieldName===t.FieldName),o=null,h=!t.Value.trim(),d=t.Operator===OperatorEnum.NotIn?AdvSearchOperation.NotIn:AdvSearchOperation.In;if(r.FieldName===this.IdField)a=t.Operator===OperatorEnum.NotIn?`[ds].${t.FieldName} not in (${t.Value})`:`[ds].${t.FieldName} in (${t.Value})`,s.push(t.FieldText+" <span class='text-danger'>"+t.OperatorText+"</span> "+t.ValueText);else if(r.ComponentType==="SearchEntry"&&r.FormatData.trim()){if(h)d=t.Operator===OperatorEnum.NotIn?AdvSearchOperation.NotEqualNull:AdvSearchOperation.EqualNull,a=t.Operator===OperatorEnum.NotIn?`[ds].${t.FieldName} is not null`:`[ds].${t.FieldName} is null`;else{let m=e[n];m.length?(o=m.join(","),a=t.Operator===OperatorEnum.NotIn?`[ds].${t.FieldName} not in (${o})`:`[ds].${t.FieldName} in (${o})`):a=t.Operator===OperatorEnum.NotIn?`[ds].${t.FieldName} != ${t.Value}`:`[ds].${t.FieldName} = ${t.Value}`,n++}s.push(r.Label+" <span class='text-danger'>"+t.OperatorText+"</span> "+t.ValueText)}else if(["Input","Textbox","Textarea"].includes(r.ComponentType))h?(d=t.Operator===OperatorEnum.NotIn?AdvSearchOperation.NotEqualNull:AdvSearchOperation.EqualNull,a=t.Operator===OperatorEnum.NotIn?`([ds].${t.FieldName} is not null and [ds].${t.FieldName} != '')`:`([ds].${t.FieldName} is null or [ds].${t.FieldName} = '')`):(d=t.Operator===OperatorEnum.NotIn?AdvSearchOperation.NotLike:AdvSearchOperation.Like,a=t.Operator===OperatorEnum.NotIn?`(CHARINDEX(N'${t.Value}', [ds].${t.FieldName}) = 0 or [ds].${t.FieldName} is null)`:`CHARINDEX(N'${t.Value}', [ds].${t.FieldName}) > 0`,t.Operator===OperatorEnum.Lr&&(d=t.Operator===OperatorEnum.NotIn?AdvSearchOperation.NotStartWith:AdvSearchOperation.StartWith,a=t.Operator===OperatorEnum.NotIn?` [ds].${t.FieldName} not like N'${t.Value}%' or [ds].${t.FieldName} is null)`:` [ds].${t.FieldName} like N'${t.Value}%'`),t.Operator===OperatorEnum.Rl&&(d=t.Operator===OperatorEnum.NotIn?AdvSearchOperation.NotEndWidth:AdvSearchOperation.EndWidth,a=t.Operator===OperatorEnum.NotIn?` [ds].${t.FieldName} not like N'%${t.Value}' or [ds].${t.FieldName} is null)`:` [ds].${t.FieldName} like N'%${t.Value}'`)),s.push(r.Label+" <span class='text-danger'>"+t.OperatorText+"</span> "+t.ValueText);else if(r.ComponentType==="Number"||r.ComponentType==="Label"&&r.FieldName.includes("Id"))t.Operator===OperatorEnum.NotIn||t.Operator===OperatorEnum.In?h?(d=t.Operator===OperatorEnum.NotIn?AdvSearchOperation.NotEqualNull:AdvSearchOperation.EqualNull,a=t.Operator===OperatorEnum.NotIn?`[ds].${t.FieldName} is not null`:`[ds].${t.FieldName} is null`):(d=t.Operator===OperatorEnum.NotIn?AdvSearchOperation.NotEqual:AdvSearchOperation.Equal,a=t.Operator===OperatorEnum.NotIn?`[ds].${t.FieldName} != ${t.Value.replace(",","")}`:`[ds].${t.FieldName} = ${t.Value.replace(",","")}`):t.Operator===OperatorEnum.Gt||t.Operator===OperatorEnum.Lt?(a=t.Operator===OperatorEnum.Gt?`[ds].${t.FieldName} > ${t.Value}`:`[ds].${t.FieldName} < ${t.Value}`,d=t.Operator===OperatorEnum.Gt?AdvSearchOperation.GreaterThan:AdvSearchOperation.LessThan):(t.Operator===OperatorEnum.Ge||t.Operator===OperatorEnum.Le)&&(a=t.Operator===OperatorEnum.Ge?`[ds].${t.FieldName} >= ${t.Value}`:`[ds].${t.FieldName} <= ${t.Value}`,d=t.Operator===OperatorEnum.Ge?AdvSearchOperation.GreaterThanOrEqual:AdvSearchOperation.LessThanOrEqual),s.push(r.Label+" <span class='text-danger'>"+t.OperatorText+"</span> "+t.ValueText);else if(r.ComponentType==="Checkbox")h?(d=t.Operator===OperatorEnum.NotIn?AdvSearchOperation.NotEqualNull:AdvSearchOperation.EqualNull,a=t.Operator===OperatorEnum.NotIn?`[ds].${t.FieldName} is not null`:`[ds].${t.FieldName} is null`):a=t.Operator===OperatorEnum.NotIn?`[ds].${t.FieldName} != ${t.Value==="true"?"1":"0"}`:`[ds].${t.FieldName} = ${t.Value==="true"?"1":"0"}`,s.push(r.Label+" <span class='text-danger'>"+t.OperatorText+"</span> "+t.ValueText);else if(r.ComponentType==="Datepicker"){if(t.Value=decodeURIComponent(t.Value),t.ValueText=decodeURIComponent(t.Value),t.Operator===OperatorEnum.NotIn||t.Operator===OperatorEnum.In)if(h)a=t.Operator===OperatorEnum.NotIn?`[ds].${t.FieldName} is not null`:`[ds].${t.FieldName} is null`,d=t.Operator===OperatorEnum.NotIn?AdvSearchOperation.NotEqualNull:AdvSearchOperation.EqualNull;else try{let m=new Date(t.Value);a=t.Operator===OperatorEnum.NotIn?`[ds].${t.FieldName} != '${m.toISOString().split("T")[0]}'`:`[ds].${t.FieldName} = '${m.toISOString().split("T")[0]}'`,d=t.Operator===OperatorEnum.NotIn?AdvSearchOperation.NotEqualDatime:AdvSearchOperation.EqualDatime}catch{let m=new Date(t.Value);a=t.Operator===OperatorEnum.NotIn?`[ds].${t.FieldName} != '${m.toISOString().split("T")[0]}'`:`[ds].${t.FieldName} = '${m.toISOString().split("T")[0]}'`,d=t.Operator===OperatorEnum.NotIn?AdvSearchOperation.NotEqualDatime:AdvSearchOperation.EqualDatime}else if(!h){let m=new Date(t.Value);t.Operator===OperatorEnum.Gt||t.Operator===OperatorEnum.Lt?(a=t.Operator===OperatorEnum.Gt?`[ds].${t.FieldName} > '${m.toISOString()}'`:`[ds].${t.FieldName} < '${m.toISOString()}'`,d=t.Operator===OperatorEnum.Gt?AdvSearchOperation.GreaterThanDatime:AdvSearchOperation.LessThanDatime):(t.Operator===OperatorEnum.Ge||t.Operator===OperatorEnum.Le)&&(a=t.Operator===OperatorEnum.Ge?`[ds].${t.FieldName} >= '${m.toISOString()}'`:`[ds].${t.FieldName} <= '${m.toISOString()}'`,d=t.Operator===OperatorEnum.Ge?AdvSearchOperation.GreaterEqualDatime:AdvSearchOperation.LessEqualDatime)}s.push(r.Label+" <span class='text-danger'>"+t.OperatorText+"</span> "+t.ValueText)}let u=o||t.Value;if(this.AdvSearchVM.Conditions.some(m=>m.Field.FieldName===t.FieldName&&m.CompareOperatorId===d&&(m.CompareOperatorId===AdvSearchOperation.Like||m.CompareOperatorId===AdvSearchOperation.In||m.CompareOperatorId===AdvSearchOperation.EqualDatime))&&!t.Shift&&!t.Group){let m=this.AdvSearchVM.Conditions.find(f=>f.Field.FieldName===t.FieldName&&f.CompareOperatorId===d);m.Value=u.trim()?u:t.ValueText,this.Wheres.find(f=>f.Condition.includes(`[ds].${t.FieldName}`)).Condition=a}else if(!this.AdvSearchVM.Conditions.some(m=>m.Field.FieldName===t.FieldName&&m.CompareOperatorId===d&&m.Value===t.Value)){if(t.ComponentType==="Input"&&!t.Value.trim())this.AdvSearchVM.Conditions.push({Field:r,CompareOperatorId:t.Operator===OperatorEnum.NotIn?AdvSearchOperation.NotEqualNull:AdvSearchOperation.EqualNull,LogicOperatorId:t.Operator===OperatorEnum.NotIn?LogicOperation.And:LogicOperation.Or,Value:null,Group:!0}),this.AdvSearchVM.Conditions.push({Field:r,CompareOperatorId:t.Operator===OperatorEnum.NotIn?AdvSearchOperation.NotEqual:AdvSearchOperation.Equal,LogicOperatorId:t.Operator===OperatorEnum.NotIn?LogicOperation.And:LogicOperation.Or,Value:"",Group:!0});else if(r.FieldName.includes(".")){let m=r.FieldName.split(".")[0]+"Id";r.FieldName=m,this.AdvSearchVM.Conditions.push({Field:r,CompareOperatorId:d,LogicOperatorId:t.Logic||LogicOperation.And,Value:u.trim()?u:t.ValueText,Group:t.Group})}else this.AdvSearchVM.Conditions.push({Field:r,CompareOperatorId:d,LogicOperatorId:t.Logic||LogicOperation.And,Value:u.trim()?u:t.ValueText,Group:t.Group});this.Wheres.push({Condition:a,Group:t.Group})}return n}NoCellSelected(){if(this.MainSection.DisposeChildren(),this.ApplyFilter(),this.Meta.ComponentType==="VirtualGrid"&&this.Meta.CanSearch&&this.HeaderSection.Element.focus(),this.Meta.ComponentType==="SearchEntry"&&this.Parent instanceof SearchEntry$1){const t=this.Parent;t._input&&t._input.focus()}}ApplyLocal(t){if(!(t instanceof HTMLTableElement)){console.error("Invalid DataTable: not an HTMLTableElement");return}var e;if(this.Meta.TopEmpty?e=t.tBodies[t.tBodies.length-1].children:e=t.tBodies[0].children,this.CellSelected.Nothing()){for(var n=0;n<e.length;n++)e[n].classList.remove("d-none");return}this.LastElementFocus=null;var s=[],a=this.Header.findIndex(r=>r.FieldName===this.CellSelected[0].FieldName);this.CellSelected.forEach(r=>{for(var o=0;o<e.length;o++){var h=e[o].children;if(h[a]!==void 0){var d=h[a].textContent||"";r.Operator===OperatorEnum.In?d.toLowerCase().indexOf(r.ValueText.toLowerCase())===-1&&(s.some(u=>u===e[o])||s.push(e[o])):d.toLowerCase().indexOf(r.ValueText.toLowerCase())!==-1&&(s.some(u=>u===e[o])||s.push(e[o]))}}});for(var n=0;n<e.length;n++)s.some(o=>o===e[n])?e[n].classList.add("d-none"):(this.LastElementFocus===null&&(this.LastElementFocus=e[n].children[a]),e[n].classList.remove("d-none"));this.LastElementFocus!==null&&(this.LastElementFocus.focus(),this.LastElementFocus=null)}FilterSelected(t){if(t.Operator){if(!this.CellSelected.some(e=>e.FieldName===t.FieldName&&e.Value===t.Value&&e.ValueText===t.ValueText&&e.Operator===t.Operator)){const e=this.Header.find(n=>n.FieldName===t.FieldName);this.CellSelected.push({FieldName:t.FieldName,FieldText:e?e.Label:"",ComponentType:e?e.ComponentType:"",Value:t.Value,ValueText:t.ValueText,Operator:t.Operator,OperatorText:t.OperatorText,IsSearch:t.ActValue}),this._summarys.push(document.createElement("HTMLElement"))}this.ActionFilter()}}DisposeSumary(){this._summarys.length>0&&(this._summarys[this._summarys.length-1].remove(),this._summarys.pop()),this.lastListViewItem&&this.LastElementFocus&&(this.lastListViewItem.Focused(!0),this.LastElementFocus.focus())}HiddenSumary(){const t=this._summarys[this._summarys.length-1];t&&(t.style.display="none")}SearchDisplayRows(){if(!(this.DataTable instanceof HTMLTableElement)){console.error("Invalid DataTable: not an HTMLTableElement");return}const t=this.DataTable,e=t.tBodies[t.tBodies.length-1].children;for(let n=0;n<e.length;n++){if(e[n].classList.contains("virtual-row"))continue;const s=e[n].childNodes;let a=!1;for(let r=0;r<s.length;r++){const o=s[r];if(!(o instanceof HTMLElement))continue;const h=o.querySelector("input:first-child");let d;if(h!==null?d=String(Utils$1.GetPropValue(h,"value")):d=s[r].textContent||"",Utils$1.DecodeSpecialChar(d).toLowerCase().indexOf(Utils$1.DecodeSpecialChar(this.ListViewSearch.EntityVM.FullTextSearch.toLowerCase()))>-1){a=!0;break}}a?e[n].classList.remove("d-none"):e[n].classList.add("d-none")}}FocusCell(t,e){const n=t.target.closest("td"),s=t.target.closest("table");s.querySelectorAll("tbody tr").forEach(a=>a.classList.remove("focus")),s.querySelectorAll("tbody td").forEach(a=>a.classList.remove("cell-selected")),n.closest("tr").classList.add("focus"),n.classList.add("cell-selected")}ActionKeyHandler(t,e,n,s,a,r){let o="",h="",d="";if([KeyCodeEnum.F4,KeyCodeEnum.F8,KeyCodeEnum.F9,KeyCodeEnum.F10,KeyCodeEnum.F11,KeyCodeEnum.F2,KeyCodeEnum.UpArrow,KeyCodeEnum.DownArrow,KeyCodeEnum.Home,KeyCodeEnum.End,KeyCodeEnum.Insert].includes(r)||(t.ctrlKey||t.metaKey)&&r===KeyCodeEnum.D){if(t.preventDefault(),t.stopPropagation(),!s)return;switch(o=s.FieldName,s.Meta.ComponentType){case"SearchEntry":d=n.Entity[e.FieldName].toString().EncodeSpecialChar();break;case"Number":d=n.Entity[e.FieldName].toString().replace(",","");break;case"Checkbox":d=s.GetValue().toString().toLowerCase();break;default:d=s.GetValue().toString().EncodeSpecialChar();break}d===null?h=null:s.Meta.Editable?h=s.GetValueText().toString().DecodeSpecialChar():h=s.GetValueTextAct().toString().DecodeSpecialChar()}switch(r){case KeyCodeEnum.F2:this.FilterSelected({Operator:2,OperatorText:"Exclude",Value:d,FieldName:o,ValueText:h,ActValue:!0});break;case KeyCodeEnum.F4:this.ProcessFilterDetail(t,s,a,o,h,d);break;case KeyCodeEnum.F8:this.ProcessHardDelete();break;case KeyCodeEnum.F9:this.FilterSelected({Operator:1,OperatorText:"Contains",Value:d,FieldName:o,ValueText:h,ActValue:!0}),s.Focus();break;case KeyCodeEnum.F11:this.ProcessSort(t,s);break;case KeyCodeEnum.UpArrow:this.MoveFocusUp(t,s,o);break;case KeyCodeEnum.DownArrow:this.MoveFocusDown(t,s,o);break;case KeyCodeEnum.LeftArrow:this.MoveFocusLeft(t,s);break;case KeyCodeEnum.RightArrow:this.MoveFocusRight(t,s);break;case KeyCodeEnum.Home:this.MoveFocusHome();break;case KeyCodeEnum.End:this.MoveFocusEnd();break;case KeyCodeEnum.Insert:this.ToggleItemSelection();break}}MoveFocusUp(t,e,n){let s=this.GetItemFocus();if(s.RowNo===0&&!(t.ctrlKey||t.metaKey))return;let a=this.AllListViewItem.filter(r=>!r.GroupRow).find(r=>r.RowNo===s.RowNo-1);if(!a)if(this.Meta.CanAdd)a=this.EmptySection.FirstChild;else return;this.CopyValue(t,e,n,s,a)}MoveFocusDown(t,e,n){let s=this.GetItemFocus();if(!s&&!(t.ctrlKey||t.metaKey))return;let a=this.AllListViewItem.filter(r=>!r.GroupRow).find(r=>r.RowNo===s.RowNo+1);if(!a)if(this.Meta.CanAdd)a=this.EmptySection.FirstChild;else return;this.CopyValue(t,e,n,s,a)}MoveFocusLeft(t,e){var a;if(!this.Meta.IsRealtime&&!(t.ctrlKey||t.metaKey))return;t.preventDefault(),t.stopPropagation();let n=this.LastListViewItem,s=n.Children.find(r=>r.Element.closest("td")===e.Element.closest("td").previousElementSibling);!s||n.Children.length===0||((a=s.ParentElement)==null||a.focus(),s.Focus(),s.Meta.Editable&&!s.Disabled&&s.Element instanceof HTMLInputElement&&(s.Element.selectionStart=0,s.Element.selectionEnd=s.GetValueText().length))}MoveFocusRight(t,e){var a;if(!this.Meta.IsRealtime&&!(t.ctrlKey||t.metaKey))return;t.preventDefault(),t.stopPropagation();let s=this.LastListViewItem.Children.find(r=>r.Element.closest("td")===e.element.closest("td").nextElementSibling);s&&((a=s.ParentElement)==null||a.focus(),s.Focus(),s.Meta.Editable&&!s.Disabled&&s.Element instanceof HTMLInputElement&&(s.Element.selectionStart=0,s.Element.selectionEnd=s.GetValueText().length))}MoveFocusHome(){let t=this.AllListViewItem[0];t==null||t.Focus(),this.DataTable.parentElement.scrollTop=0}MoveFocusEnd(){let t=this.AllListViewItem[this.AllListViewItem.length-1];t==null||t.Focus(),this.DataTable.parentElement.scrollTop=this.DataTable.parentElement.scrollHeight}ToggleItemSelection(){let t=this.GetItemFocus();t.Selected=!t.Selected}ProcessHardDelete(){if(this.Disabled)return;const t=this.GetSelectedRows();if(t.length===0){Toast.Warning("Vui lòng chọn dòng cần xóa");return}const e=t.every(s=>Utils$1.IsOwner(s,!1));this.CanDo(s=>s.CanDelete&&e||s.CanDeleteAll)&&this.HardDeleteSelected()}ProcessFilterDetail(t,e,n,s,a,r){const o=ContextMenu.Instance;o.PElement=this.MainSection.Element,o.Top=n.getBoundingClientRect().top,o.Left=n.getBoundingClientRect().left,o.MenuItems=[{Icon:"fal fa-angle-double-right",Text:"Chứa",Click:this.FilterInSelected,Parameter:{Operator:OperatorEnum.In,OperatorText:"Chứa",Value:r,FieldName:s,ValueText:a,Shift:t.shiftKey}},{Icon:"fal fa-not-equal",Text:"Không chứa",Click:this.FilterInSelected,Parameter:{Operator:OperatorEnum.NotIn,OperatorText:"Không chứa",Value:r,FieldName:s,ValueText:a,Shift:t.shiftKey}},{Icon:"fal fa-hourglass-start",Text:"Trái phải",Click:this.FilterInSelected,Parameter:{Operator:OperatorEnum.Lr,OperatorText:"Trái phải",Value:r,FieldName:s,ValueText:a,Shift:t.shiftKey}},{Icon:"fal fa-hourglass-end",Text:"Phải trái",Click:this.FilterInSelected,Parameter:{Operator:OperatorEnum.Rl,OperatorText:"Phải trái",Value:r,FieldName:s,ValueText:a,Shift:t.shiftKey}}],(e.Meta.ComponentType==="Number"||e.Meta.ComponentType==="Datepicker")&&o.MenuItems.push({Icon:"fal fa-greater-than",Text:"Lớn hơn",Click:this.FilterInSelected,Parameter:{Operator:OperatorEnum.Gt,OperatorText:"Lớn hơn",Value:r,FieldName:s,ValueText:a,Shift:t.shiftKey}},{Icon:"fal fa-less-than",Text:"Nhỏ hơn",Click:this.FilterInSelected,Parameter:{Operator:OperatorEnum.Lt,OperatorText:"Nhỏ hơn",Value:r,FieldName:s,ValueText:a,Shift:t.shiftKey}},{Icon:"fal fa-greater-than-equal",Text:"Lớn hơn bằng",Click:this.FilterInSelected,Parameter:{Operator:OperatorEnum.Ge,OperatorText:"Lớn hơn bằng",Value:r,FieldName:s,ValueText:a,Shift:t.shiftKey}},{Icon:"fal fa-less-than-equal",Text:"Nhỏ hơn bằng",Click:this.FilterInSelected,Parameter:{Operator:OperatorEnum.Le,OperatorText:"Nhỏ hơn bằng",Value:r,FieldName:s,ValueText:a,Shift:t.shiftKey}}),o.Render()}ProcessSort(t,e){if(e.Meta.ComponentType==="Button")return;let n=this.HeaderSection.Children.find(r=>r.Meta.Id===e.Meta.Id);n.Element.classList.remove("desc","asc");const s=e.ComponentType==="SearchEntry"?e.Meta.FieldText:e.FieldName,a={FieldName:s,OrderbyDirectionId:OrderbyDirection.ASC,ComId:e.Meta.Id};if(!this.AdvSearchVM.OrderBy.length)this.AdvSearchVM.OrderBy=[a],n.Element.classList.add("desc");else{const r=this.AdvSearchVM.OrderBy.find(o=>o.FieldName===s);if(r)this.AlterExistSort(n,r);else{const o=t.shiftKey;this.RemoveOtherSorts(o),n.Element.classList.add("desc"),this.AdvSearchVM.OrderBy.push(a)}}localStorage.setItem("OrderBy"+this.Meta.Id,JSON.stringify(this.AdvSearchVM.OrderBy)),this.ReloadData()}AlterExistSort(t,e){if(e.OrderbyDirectionId===OrderbyDirection.ASC)e.OrderbyDirectionId=OrderbyDirection.DESC,t.Element.classList.replace("asc","desc");else{const n=this.AdvSearchVM.OrderBy.indexOf(e);n!==-1&&this.AdvSearchVM.OrderBy.splice(n,1)}}RemoveOtherSorts(t){t||(this.HeaderSection.Children.forEach(e=>{e.Element.classList.remove("desc"),e.Element.classList.remove("asc")}),this.AdvSearchVM.OrderBy.length=0)}CopyValue(t,e,n,s,a){var o;if(this.LastListViewItem=a,s.Focused(!1),a.Focused(!0),!n||n.trim()==="")return;let r=a.FilterChildren(h=>h.Meta.Id===e.Meta.Id)[0];if(r&&(this.LastComponentFocus=r.Meta,(o=r.ParentElement)==null||o.focus(),r.Focus(),r.Meta.Editable&&!r.Disabled&&r.Element instanceof HTMLInputElement&&(r.Element.selectionStart=0,r.Element.selectionEnd=r.GetValueText().length),this.LastElementFocus=r.Element,t.shiftKey)){a.Entity[n]=e.GetValue();let h=a.FilterChildren(d=>d.FieldName===r.FieldName)[0];h&&(!h.Disabled||h.Meta.Editable)&&(h.Dirty=!0,(async()=>{if(h.Meta.ComponentType==="SearchEntry"){h.UpdateView();let d=e;h.PopulateFields(d.Matched),await h.DispatchEvent(h.Meta.Events,"change",a.Entity,d.Matched)}else h.UpdateView(),h.PopulateFields(),await h.DispatchEvent(h.Meta.Events,"change",a.Entity);await a.ListViewSection.ListView.DispatchEvent(a.ListViewSection.ListView.Meta.Events,"change",a.Entity),this.Meta.IsRealtime&&await a.PatchUpdateOrCreate()})())}}RenderViewPort(t=!0,e=!1,n=null){}HotKeyF6Handler(t,e){switch(e){case KeyCodeEnum.F6:if(t.preventDefault(),t.stopPropagation(),this._summarys.length){let s=this._summarys[this._summarys.length-1];if(this.Meta.FilterLocal){s.innerHTML===""?(this.CellSelected.pop(),this.ActionFilter(),this._summarys.pop()):s.style.display==="none"?(this.CellSelected.pop(),this.ActionFilter(),s.style.display=""):(this._summarys.pop(),s.remove());return}if(s.innerHTML===""){this.CellSelected.pop(),this.Wheres.pop();let a=this.AdvSearchVM.Conditions[this.AdvSearchVM.Conditions.length-1];a&&a.Field.ComponentType==="Input"&&!a.Value.trim()?(this.AdvSearchVM.Conditions.pop(),this.AdvSearchVM.Conditions.pop()):this.AdvSearchVM.Conditions.pop(),this.ActionFilter(),this._summarys.pop()}else if(this._waitingLoad&&clearTimeout(this._renderPrepareCacheAwaiter),s.style.display==="none"){this.CellSelected.pop(),this.Wheres.pop();let a=this.AdvSearchVM.Conditions[this.AdvSearchVM.Conditions.length-1];a&&a.Field.ComponentType==="Input"&&!a.Value.trim()?(this.AdvSearchVM.Conditions.pop(),this.AdvSearchVM.Conditions.pop()):this.AdvSearchVM.Conditions.pop(),this.ActionFilter(),s.style.display=""}else this._summarys.pop(),s.remove()}break;case KeyCodeEnum.F3:t.preventDefault(),t.stopPropagation(),this.GetRealTimeSelectedRows().then(s=>{s.length===0&&(s=this.RowData.Data);let a=this.Header.filter(o=>o.ComponentType==="Number");if(a.length===0){Toast.Warning("Vui lòng cấu hình");return}let r=a.map(o=>{let h=s.map(d=>d[o.FieldName]).filter(d=>d!=null).reduce((d,u)=>d+parseFloat(u),0);return o.Label+" : "+(h%2>0?h.toFixed(2):Math.round(h).toString())});Toast.Success(r.join("</br>"),6e3)});break;case KeyCodeEnum.F1:t.preventDefault(),t.stopPropagation(),this.ToggleAll();break;case KeyCodeEnum.U:if(t.ctrlKey||t.metaKey){if(this.Disabled||!this.Meta.CanAdd)return;t.preventDefault(),t.stopPropagation(),this.DuplicateSelected(t,!0)}break}if(!this.LastListViewItem||!this.LastListViewItem.Children)return;let n=this.LastListViewItem.Children.find(s=>{var a;return s.Meta.Id===((a=this.LastComponentFocus)==null?void 0:a.Id)});n&&this.ActionKeyHandler(t,this.LastComponentFocus,this.LastListViewItem,n,n.Element.closest("td"),e)}async AddRow(t,e=0,n=!0){let s=await super.AddRow(t,e,n);return this.StickyColumn(s),this.RenderIndex(),s}AddNewEmptyRow(){if(this.Disabled||!this.Editable||this.EmptySection&&this.EmptySection.Children.length>0)return;let t={};t[this.IdField]=Uuid7.NewGuid();let e=this.RenderRowData(this.Header,t,this.EmptySection,null,!0);this.StickyColumn(e),this.Meta.TopEmpty?this.DataTable.insertBefore(this.EmptySection.Element,this.MainSection.Element):this.DataTable.insertBefore(this.MainSection.Element,this.EmptySection.Element),e.Children.forEach(n=>n.SetRequired()),this.DispatchCustomEvent(this.Meta.Events,"AfterEmptyRowCreated",t).then(()=>{this.StickyColumn(e)})}FilterColumns(t){if(!t||t.length===0)return t;const e=!this.EditForm||this.EditForm.Policies.length==0?[]:this.EditForm.GetGridPolicies(t.map(s=>s.id),Utils$1.ComponentId),n=(e.length==0?t.filter(s=>!s.hidden&&s.id!==this.Meta.Id).filter(s=>!s.isPrivate||e.filter(a=>a.RecordId===s.Id).every(a=>a.CanRead)):t).map(this.CalcTextAlign).sort((s,a)=>a.Frozen-s.Frozen||(a.ComponentType==="Button"?1:0)-(s.ComponentType==="Button"?1:0)||s.Order-a.Order);return this.OrderHeaderGroup(n),this.header=[],this.header.push(this.ToolbarColumn),this.header.push(...n),this.header=this.header.filter(s=>s!==null),this.header}async ApplyFilter(){this.DataTable.parentElement.scrollTop=0,await this.ReloadData(this.cacheHeader=!0)}ColumnResizeHandler(){const t=n=>{if(n===null)return;n.querySelectorAll("th").forEach(a=>{const r=document.createElement("div");r.classList.add("resizer"),a.appendChild(r),e(a,r)})},e=(n,s)=>{let a=0,r=0;const o=u=>{u.preventDefault(),a=u.clientX;const m=window.getComputedStyle(n);r=parseInt(m.width,10),document.addEventListener("mousemove",h),document.addEventListener("mouseup",d),s.classList.add("resizing")},h=u=>{u.preventDefault();const m=u.clientX-a;n.style.width=`${r+m}px`,n.style.minWidth=`${r+m}px`,n.style.maxWidth=`${r+m}px`},d=()=>{s.classList.remove("resizing"),document.removeEventListener("mousemove",h),document.removeEventListener("mouseup",d)};s.addEventListener("mousedown",o)};t(this.DataTable)}RenderContent(){var e,n,s,a;if(this.LoadRerender||this.Rerender(),this.AddSections(),!this._hasFirstLoad&&this.VirtualScroll){this._hasFirstLoad=!0;return}let t=this.GetViewPortItem();if(this.FormattedRowData=this.Meta.LocalRender?this.Meta.LocalData:this.RowData.Data,!this.FormattedRowData||this.FormattedRowData.length===0){this.MainSection.DisposeChildren(),(n=(e=this.MainSection)==null?void 0:e.Element)==null||n.removeEventListener("contextmenu",this.BodyContextMenuHandler),(a=(s=this.MainSection)==null?void 0:s.Element)==null||a.removeEventListener("contextmenu",this.BodyContextMenuHandler),this.DomLoaded();return}if(this.DisposeNoRecord(),this.VirtualScroll&&this.FormattedRowData.length>t&&(this.FormattedRowData=this.FormattedRowData.slice(0,t)),this.MainSection.Children.length>0){this.UpdateExistRowsWrapper(!1,0,t);return}this.MainSection.Show=!1,this.FormattedRowData.forEach(r=>{Html.Take(this.MainSection.Element),this.RenderRowData(this.Header,r,this.MainSection)}),this.MainSection.Show=!0,this.ContentRendered(),this.DomLoaded()}SetFocusingCom(){if(!this.AutoFocus)if(this.EntityFocusId!=null&&this.LastComponentFocus!=null){let t=this.MainSection.Children.flatMap(e=>e.Children).find(e=>e.Entity[this.IdField].toString()===this.EntityFocusId&&e.Meta.Id===this.LastComponentFocus.Id);if(t){let e=this.AllListViewItem.find(n=>n.Entity[this.IdField].toString()===this.EntityFocusId);e&&(e.Focused(!0),t.ParentElement.classList.add("cell-selected"),this.LastListViewItem=e,this.LastComponentFocus=t.Meta,this.LastElementFocus=t.Element)}else this.HeaderSection.Element.focus()}else this.HeaderSection.Element.focus()}UpdateExistRowsWrapper(t,e,n){if(!this._hasFirstLoad){this._hasFirstLoad=!0;return}this.UpdateExistRows(t),this.DomLoaded()}UpdateExistRows(t){const e=this.FormattedRowData.slice(),n=this.AllListViewItem.slice(0,e.length);n.forEach((a,r)=>{a.Entity=e[r],this.FlattenChildren(a).forEach(o=>{o.Entity=e[r]}),a.UpdateView()}),this.AllListViewItem.length<=e.length?e.slice(n.length).forEach(a=>{const r=this.RenderRowData(this.Header,a,this.MainSection);this.StickyColumn(r)}):this.MainSection.Children.slice(e.length).forEach(a=>a.Dispose()),t!==void 0&&(this.Dirty=t)}FlattenChildren(t){const e=[],n=[t];for(;n.length;){const s=n.pop();s.Children&&(e.push(...s.Children),s.Children.forEach(a=>n.push(a)))}return e}RenderRowData(t,e,n,s=null,a=!1){const r=n.Element;Html.Take(r);const o=new GridViewItem(ElementType.tr);o.EmptyRow=a,o.Entity=e,o.ParentElement=r,o.PreQueryFn=this._preQueryFn,o.ListView=this,o.Meta=this.Meta,n.AddChild(o,s),a||(o.Dirty=!0);var h=Html.Context;return h.tabIndex=-1,s&&((s>=h.parentElement.children.length||s<0)&&(s=0),h.parentElement.insertBefore(h,h.parentElement.children[s])),t.length>0&&t.forEach(d=>{o.RenderTableCell(e,d)}),a&&this.Children.forEach(d=>d.AlwaysLogHistory=!0),o}AddSummaries(){if(this.Header.every(s=>!s.Summary||s.Summary.trim()===""))return;const t=this.Header.filter(s=>s.Summary&&s.Summary.trim()!=="");this.MainSection.Element.querySelectorAll(`.${this.SummaryClass}`).forEach(s=>s.remove());const n=new Set(t.map(s=>s.Summary)).size;t.forEach(s=>{this.RenderSummaryRow(s,this.Header,this.FooterSection.Element,n)})}DuplicateSelected(t,e=!1){const n=this.GetSelectedRows(),s=n.map(r=>({...r,[this.IdField]:Uuid7.NewGuid()}));if(!(s.length==0||!this.CanWrite)){Toast.Success("Copying data..."),this.DispatchCustomEvent(this.Meta.Events,CustomEventType.BeforePasted,n,s);var a=this.AllListViewItem.filter(r=>r.EmptyRow).indexOf(r=>r==this.AllListViewItem.filter(o=>o.Selected)[0])+1;this.Meta.TopEmpty?a=0:a=this.AllListViewItem.LastOrDefault().RowNo,this.AddRowsNo(s,a).then(r=>{this.Dirty=!0;var o=r[0].FilterChildren(h=>h.Meta.Editable)[0];o==null||o.Focus(),this.DispatchCustomEvent(this.Meta.Events,CustomEventType.AfterPasted,n,s),this.RenderIndex(),this.Meta.IsSumary&&this.AddSummaries(),this.ClearSelected(),this.LastListViewItem=r.FirstOrDefault(),this.Meta.IsRealtime?(r.forEach(h=>{h.PatchUpdateOrCreate().then()}),Toast.Success("Data copied successfully."),this.Dirty=!1):Toast.Success("Data copied successfully.")})}}GetStartIndex(t,e){let n=this.AllListViewItem.findIndex(s=>s.Selected);return e&&t.keyCode===KeyCodeEnum.U&&(t.ctrlKey||t.metaKey)&&(this.Meta.TopEmpty?n=0:n=this.AllListViewItem[this.AllListViewItem.length-1].RowNo),n}RowsAdded(t,e,n){const s=t[0]?t[0].FilterChildren(a=>a.Meta.Editable)[0]:null;s&&s.Focus(),this.RenderIndex(),this.Meta.IsSumary&&this.AddSummaries(),this.ClearSelected(),t.forEach(a=>{a.Selected=!0}),this.LastListViewItem=t[0]||null,this.Meta.IsRealtime?Promise.all(t.map(a=>a.PatchUpdateOrCreate())).then(()=>{Toast.Success("Sao chép dữ liệu thành công!"),this.Dirty=!1}):Toast.Success("Sao chép dữ liệu thành công!"),this.DispatchCustomEvent(this.Meta.Events,CustomEventType.AfterPasted,e,n)}RenderSummaryRow(t,e,n,s){let a=this.CreateSummaryTableRow(t,n,s);if(!a)return;const r=a.classList.contains("summary"),o=t.SummaryColSpan||0;if(a.classList.add("summary"),!r&&e.includes(t)&&this.ResetSummaryRow(a,o),!e.includes(t)){this.ClearSummaryContent(a);return}this.SetSummaryHeaderText(t,a),this.CalcSumCol(t,e,a,o)}SetRowData(t){t=t??[],this.RowData._data===null||typeof this.RowData._data=="string"?this.RowData._data=t:(this.RowData._data.length=0,t&&t.length>0&&t.forEach(e=>this.RowData._data.push(e))),this.RenderContent(),this.Entity!=null&&this.ShouldSetEntity&&(this.Entity[this.Name]=this.RowData.Data)}SetSummaryHeaderText(t,e){if(!t.Summary||t.Summary.trim()==="")return;let n=e.cells[0];n.colSpan=t.SummaryColSpan,n.textContent=t.Summary,n.classList.add("summary-header")}CreateSummaryTableRow(t,e,n){if(!e)return null;let s=t.Summary,a=Array.from(e.rows).filter(h=>h.classList.contains("summary-header")),r=Array.from(a).reverse().find(h=>Array.from(h.cells).some(d=>d.textContent===s));if(r||(r=a[a.length-1]),a.length>=n)return r;if(!this.MainSection.FirstChild)return null;let o=this.MainSection.FirstChild.Element.cloneNode(!0);return e.appendChild(o),o instanceof Element&&(e.appendChild(o),Array.from(o.children).forEach(h=>h.innerHTML="")),o}CalcSumCol(t,e,n,s){const a=e.indexOf(t),r=n.cells[a-s+1],o=t.FormatData?t.FormatData:"{0:n0}",h=this.RowData.Data.some(u=>typeof u[t.FieldName]=="number"),d=this.RowData.Data.reduce((u,m)=>{const f=m[t.FieldName];return u+(f?parseFloat(f):0)},0);r.textContent=Utils$1.FormatEntity(o,h?d:this.RowData.Data.length)}ResetSummaryRow(t,e){for(let n=1;n<e;n++)t.cells[0]&&t.cells[0].remove();this.ClearSummaryContent(t)}ClearSummaryContent(t){Array.from(t.cells).forEach(e=>{e.innerHTML=""})}async RowChangeHandler(t,e,n,s=null){if(e.EmptyRow&&n.EvType===EventType.Change){if(!Utils$1.isNullOrWhiteSpace(this.Meta.DefaultVal)){var a=Utils$1.IsFunction(this.Meta.DefaultVal,!1,this);a&&Object.getOwnPropertyNames(a).forEach(o=>{e.Entity[o]=a[o]})}await this.DispatchCustomEvent(this.Meta.Events,CustomEventType.BeforeCreated,t,this);let r;this.Meta.IsRealtime?(r=await e.PatchUpdateOrCreate(),e.Entity=r,this.Meta.ComponentType=="VirtualGrid"&&this.CacheData.push(r),this.Dirty=!1):(r=e.Entity,this.Dirty=!0),e.UpdateView(!0),this.MoveEmptyRow(e),this.EmptySection.Children=[],this.AddNewEmptyRow(),this.ClearSelected(),await this.DispatchCustomEvent(this.Meta.Events,CustomEventType.AfterCreated,t,this)}s&&s.ComponentType=="GridView"&&await this.DispatchEvent(s.Meta.Events,n.EvType,t,e),await this.DispatchEvent(this.Meta.Events,n.EvType,t,e),n.EvType===EventType.Change&&(this.PopulateFields(),this.RenderIndex(),this.Meta.IsSumary&&this.AddSummaries())}MoveEmptyRow(t){this.RowData.Data.includes(t.Entity)||(this.Meta.TopEmpty?(this.RowData.Data.unshift(t.Entity),this.MainSection.Children.includes(this.EmptySection.FirstChild)||this.MainSection.Children.unshift(this.EmptySection.FirstChild),this.MainSection.Element.prepend(this.EmptySection.Element.firstElementChild)):(this.RowData.Data.push(t.Entity),this.MainSection.Element.appendChild(this.EmptySection.Element.firstElementChild),this.MainSection.Children.includes(this.EmptySection.FirstChild)||this.MainSection.Children.push(this.EmptySection.FirstChild)),this.Meta.IsRealtime&&t.Element.classList.remove("new-row"),t.Parent=this.MainSection,t.ListViewSection=this.MainSection)}ProcessMetaData(t,e){let n=t.length>1&&t[1].length>0?t[1][0].total:null,s=t.length>2?t[2].map(a=>Utils$1.CastProp(a,"Component")):null;this.Settings=t.length>3&&t[3].length>0?Utils$1.As(t[3][0],"UserSetting"):null,this.FilterColumns(this.MergeComponent(s,this.Settings)),this.RenderTableHeader(this.Header),this.Paginator!=null&&(this.Paginator.Options.Total=n!==null?n:e)}RenderTableHeader(t){(!t||t.length==0)&&(t=this.Header),t.Count!=this.Header.Count&&this.FilterColumns(t),this._hasFirstLoad=!0,this.HeaderSection.Element===null&&this.AddSections(),t.forEach((n,s)=>n.PostOrder=s),this.HeaderSection.DisposeChildren();const e=t.some(n=>n.GroupName&&n.GroupName!=="");Html.Take(this.HeaderSection.Element).Clear().TRow.ForEach(t,(n,s)=>{var o;if(e&&n.GroupName!==""){if(n!==t.find(h=>h.GroupName===n.GroupName))return;Html.Th.Render(),Html.ColSpan(t.filter(h=>h.GroupName===n.GroupName).length),Html.IHtml(n.GroupName).Render();return}Html.Th.TabIndex(-1).Width(n.AutoFit?"auto":n.Width).Style(`${n.Style};min-width: ${n.MinWidth}; max-width: ${n.MaxWidth}`).TextAlign("center").Event(EventType.DblClick,this.EditForm.ComponentProperties.bind(this),n).Event(EventType.ContextMenu,this.HeaderContextMenu.bind(this),n).Event(EventType.FocusOut,h=>this.FocusOutHeader(h,n)).Event(EventType.KeyDown,h=>this.ThHotKeyHandler(h,n));var a=new Section$1(null,Html.Context);a.Meta=n,this.HeaderSection.AddChild(a),e&&(!n.GroupName||n.GroupName==="")&&Html.Instance.RowSpan(2),!e&&this.Header.some(h=>h.GroupName&&h.GroupName.length)&&Html.Instance.ClassName("header-group"),n.StatusBar&&Html.Instance.Icon("fal fa-edit").Event(EventType.Click,this.ToggleAll.bind(this)).End.Render();const r=(o=this.AdvSearchVM.OrderBy)==null?void 0:o.find(h=>h.ComId===n.Id);r&&Html.Instance.ClassName(r.OrderbyDirectionId===OrderbyDirection.ASC?"asc":"desc").Render(),n.Icon?Html.Instance.Icon(n.Icon).Margin(Direction.Right,0).End.Render():n.StatusBar||Html.Instance.Event(EventType.Click,h=>this.ClickHeader(h,n)).IHtml(n.Label).Render(),n.ComponentType==="Number"&&(Html.Instance.Div.End.Render(),Html.Instance.Span.Style("display: block;").End.Render()),n.Description&&Html.Instance.Attr("title",n.Description),Client.Instance.SystemRole&&(Html.Instance.Attr("contenteditable","true"),Html.Instance.Event(EventType.Input,h=>this.ChangeHeader(h,n))),this.CreateResizableTable(Html.Context),Html.Instance.EndOf(ElementType.th)}).EndOf(ElementType.tr).Render(),e&&Html.Instance.TRow.ForEach(t,(n,s)=>{if(e&&n.GroupName!==""){Html.Instance.Th.DataAttr("field",n.FieldName).Width(n.Width).Style(`min-width: ${n.MinWidth}; max-width: ${n.MaxWidth}`).TextAlign(n.TextAlignEnum).Event(EventType.ContextMenu,this.HeaderContextMenu.bind(this),n).InnerHTML(n.Label);const a=new Section$1(ElementType.tr);a.ParentElement=Html.Context.parentElement,a.Meta=n,this.HeaderSection.AddChild(a)}}),this.HeaderSection.Children=this.HeaderSection.Children.sort((n,s)=>n.Meta.PostOrder-s.Meta.PostOrder)}CreateResizableTable(t){var e=document.createElement("div");e.classList.add("resizer"),t.appendChild(e),this.CreateResizableColumn(t,e)}CreateResizableColumn(t,e){this.x=0,this.w=0,e.addEventListener("mousedown",n=>this.MouseDownHandler(n,t,e))}MouseDownHandler(t,e,n){t.preventDefault(),this.x=t.clientX;var s=window.getComputedStyle(e);this.w=parseFloat(s.width.replace("px","")==""?"0":s.width.replace("px","")),this.mouseMoveHandler=a=>this.MouseMoveHandler(a,e,n),this.mouseUpHandler=a=>this.MouseUpHandler(a,e,n),document.addEventListener("mousemove",this.mouseMoveHandler),document.addEventListener("mouseup",this.mouseUpHandler),n.classList.add("resizing")}MouseMoveHandler(t,e,n){t.preventDefault();var s=t.clientX-this.x;e.style.width=`${this.w+s}px`,e.style.minWidth=`${this.w+s}px`,e.style.maxWidth=`${this.w+s}px`}MouseUpHandler(t,e,n){t.preventDefault(),this.UpdateHeaders(),n.classList.remove("resizing"),document.removeEventListener("mousemove",this.mouseMoveHandler),document.removeEventListener("mouseup",this.mouseUpHandler)}UpdateHeaders(){const t=this.HeaderSection.Children.filter(r=>r.Meta&&r.Meta.Id),e=new Map(t.map(r=>[r.Element,r.Meta.Id]));let n=0;const s=Array.from(this.HeaderSection.Element.querySelectorAll("th"));s.forEach(r=>{r.Order=n,n++}),s.map(r=>{const o=e.get(r);if(o){const h=`${r.offsetWidth}px`,d={Width:h,MaxWidth:h,MinWidth:h};return{Changes:[{Field:"Id",Value:o},{Field:"Width",Value:h},{Field:"MaxWidth",Value:h},{Field:"MinWidth",Value:h},{Field:"Order",Value:r.Order}],Table:this.Meta.RefName,header:r,widthProps:d}}return null}).filter(r=>r!=null).forEach(r=>{Client.Instance.PatchAsync(r).then(o=>{Object.assign(r.header.style,r.widthProps)})})}ChangeHeader(t,e){clearTimeout(this._imeout),this._imeout=setTimeout(()=>{let n=t.target,s={Table:"Component",Changes:[{Field:"Component.Id",Value:e.Id,OldVal:e.Id},{Field:"Component.Label",Value:n.textContent.trim(),OldVal:e.Label}]};Client.Instance.PatchAsync(s)},1e3)}async CustomQuery(t){try{const e=await Client.Instance.SubmitAsync({NoQueue:!0,Url:`/api/feature/com?t=${Client.Token.TenantCode||Client.Tenant}`,Method:"POST",JsonData:JSON.stringify(t,this.getCircularReplacer(),2),AllowAnonymous:!0});if(!e.value||e.value.length===0)return this.SetRowData(null),null;let n=e.count.total&&e.count.total>0?e.count.total:e.value.length,s=[...e.value];return this.ClearRowData(),this.UpdatePagination(n,s.length),await this.LoadMasterData(s),this.SetRowData(s),s}catch(e){throw console.error(e),e}}UpdatePagination(t,e){if(this.Paginator){var n=this.Paginator.Options;n.Total=t,n.CurrentPageCount=e,n.PageNumber=(n.PageIndex||0)+1,n.StartIndex=(n.PageIndex||0)*n.PageSize+1,n.EndIndex=n.StartIndex+n.CurrentPageCount,this.Paginator.UpdateView()}}ToggleAll(){if(this.AllListViewItem.some(e=>e.Selected)){this.ClearSelected();return}this.AllListViewItem.forEach(e=>{e.EmptyRow||(e.Selected=!0)})}HeaderContextMenu(t,e){t.preventDefault(),t.stopPropagation();var n=ContextMenu.Instance;n.Top=t.clientY,n.Left=t.clientX,n.MenuItems=[],Client.Instance.SystemRole&&n.MenuItems.push({Icon:"fal fa-wrench",Text:"Column Properties",Click:()=>this.EditForm.ComponentProperties(e)}),n.Render()}HideWidth(t,e){const n=e.target.closest("th");n&&(n.style.minWidth="",n.style.maxWidth="",n.style.width=""),this.UpdateHeaders(this.GetHeaderSettings())}GetHeaderSettings(){const t={};this.HeaderSection.Children.filter(s=>{var a;return((a=s.Meta)==null?void 0:a.Id)!=null}).forEach(s=>{t[s.Meta.Id]=s});const e=Array.from(this.HeaderSection.Element.firstElementChild.children);return this.HeaderSection.Children.forEach(s=>{s.Meta.Order=e.indexOf(s.Element)}),this.Header.filter(s=>s.Id!=null).map(s=>{const a=t[s.Id];return a?(s.Width=`${a.Element.offsetWidth}px`,s.MaxWidth=`${a.Element.offsetWidth}px`,s.MinWidth=`${a.Element.offsetWidth}px`,s):null}).filter(s=>s!=null).sort((s,a)=>s.Frozen-a.Frozen||s.Order-a.Order)}ShowWidth(t){const e=t.header,n=t.events;n.target.firstChild&&!n.target.firstChild.length&&n.target.prepend(document.createTextNode(e.ShortDesc)),n.target.style.minWidth="",n.target.style.maxWidth="",n.target.style.width="",this.UpdateHeaders(this.GetHeaderSettings())}FrozenColumn(t){const e=t.header,n=this.Header.find(s=>s.Id===e.Id);n&&(n.Frozen=!n.Frozen),this.UpdateHeaders(this.GetHeaderSettings())}CloneHeader(t){{var e=t,n=new ConfirmDialog;n.Content="Bạn có chắc chắn muốn clone cột này không?",n.Render(),n.YesConfirmed+=()=>{var s=e.Clone();s.Id=Uuid7.Id25();var a=s.MapToPatch();Client.Instance.PatchAsync(a).then(r=>{if(r==0){Toast.Warning("Clone error");return}this.Header.push(s),this.Header=this.Header.sort((o,h)=>h.Frozen-o.Frozen||h.ComponentType==="Button"-o.ComponentType==="Button"||o.Order-h.Order),this.Rerender(),Toast.Success("Clone success")}).catch(r=>{Toast.Warning("Clone header NOT success")})}}}RemoveHeader(t){var e=t,n=new ConfirmDialog;n.Content="Bạn có chắc chắn muốn clone cột này không?",n.Render(),n.YesConfirmed+=()=>{const s=[e.Id];Client.Instance.HardDeleteAsync(s,"Component",this.MetaConn,this.MetaConn).then(a=>{if(!a){Toast.Warning("delete error");return}Toast.Success("Delete success"),this.Header.Remove(e),this.Rerender()})}}RemoveRowById(t){super.RemoveRowById(t),this.RenderIndex()}RemoveRow(t){super.RemoveRow(t),this.RenderIndex()}HardDeleteConfirmed(t){return new Promise((e,n)=>{super.HardDeleteConfirmed(t).then(s=>{this.RenderIndex(),this.Meta.IsSumary&&this.AddSummaries(),e(s)}).catch(s=>n(s))})}UpdateView(t=!1,e=null,n=[]){!this.Editable&&!this.Meta.CanCache?t&&(this.DisposeNoRecord(),this.ListViewSearch.RefreshListView()):this.RowAction(s=>!s.EmptyRow,s=>s.UpdateView(t,e,n))}async RowChangeHandlerGrid(t,e,n,s=null){if(await new Promise(a=>setTimeout(a,this.CellCountNoSticky)),e.EmptyRow&&n.EvType===EventType.Change){await this.DispatchCustomEvent(this.Meta.Events,CustomEventType.BeforeCreated,t),e.EmptyRow=!1,this.MoveEmptyRow(e);const a=this.Header.filter(h=>h.Editable),r=a.find(h=>h.FieldName===s.FieldName),o=a.indexOf(r);if(a.length>o+1){const h=a[o+1],d=e.Children.find(u=>u.FieldName===h.FieldName);d&&d.Focus()}this.EmptySection.Children=[],this.AddNewEmptyRow(),this.Entity[this.Name]=this.RowData.Data,await this.DispatchCustomEvent(this.Meta.Events,CustomEventType.AfterCreated,t)}this.AddSummaries(),this.PopulateFields(),await this.DispatchEvent(this.Meta.Events,EventType.Change,t)}GetViewPortItem(){if(!this.Element||!this.Element.classList.contains("sticky"))return this.RowData.Data.length;let t=this.Element.clientHeight-(this.HeaderSection.Element?this.HeaderSection.Element.clientHeight:0)-this.Paginator.Element.clientHeight-this._theadTable;return this.Header=this.Header.filter(e=>e!=null),this.Header.some(e=>e.Summary&&e.Summary.trim()!=="")&&(t-=this._tfooterTable),this.Meta.CanAdd&&(t-=this._rowHeight),this.GetRowCountByHeight(t)}},c(wt,"ToolbarColumn",{StatusBar:!0,Label:"",Frozen:!0}),wt);const gridView=Object.freeze(Object.defineProperty({__proto__:null,GridView:GridView$1},Symbol.toStringTag,{value:"Module"}));class Textarea extends Textbox{constructor(i,t=null){super(i,t),this.MultipleLine=!0}}class App{static Init(){var i=new Textbox({FieldName:"appointment_name",PlainText:"FullName"},document.getElementsByName("appointment_name")[0]);i.Render();var i=new Textbox({FieldName:"appointment_email",PlainText:"E-Mail"},document.getElementsByName("appointment_email")[0]);i.Render();var i=new Textbox({FieldName:"appointment_phone",PlainText:"Phone Number"},document.getElementsByName("appointment_phone")[0]);i.Render();var i=new Textbox({FieldName:"appointment_website",PlainText:"Your Website"},document.getElementsByName("appointment_website")[0]);i.Render();var i=new Textbox({FieldName:"name",PlainText:"Name"},document.getElementsByName("name")[0]);i.Render();var i=new Textbox({FieldName:"email",PlainText:"E-Mail"},document.getElementsByName("email")[0]);i.Render();var i=new Textbox({FieldName:"phone",PlainText:"Phone Number"},document.getElementsByName("phone")[0]);i.Render();var i=new Textbox({FieldName:"website",PlainText:"Your Website"},document.getElementsByName("website")[0]);i.Render();var i=new Textarea({FieldName:"message",PlainText:"Your message Here"},document.getElementsByName("message")[0]);i.Render()}}App.Init();export{Client as C,FeaturePolicy as F,Html as H,ListView as L,TabEditor as T,Utils$1 as U,Toast as a};
